<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="An open source textbook for psychology students learning programming and online research methods.Primary Author: Nicholaus P. Brosowsky Co-Authors: Liam Yeo, Jackie Spear">

<title>22&nbsp; Randomization in Experimental Design – Online Behavioural Research Methods: Programming with jsPsych</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./23-L10.html" rel="next">
<link href="./21-L09.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e9b5551c1c55c86b42a831a3c09ea90c.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-f4f6c4c33169695420a9dce568207992.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>
.tabset-fullscreen-btn {
  position: absolute;
  top: 5px;
  right: 10px;
  z-index: 1000;
  padding: 5px 10px;
  background-color: none;
  color: #6c757d;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
  transition: all 0.2s ease;
}
.tabset-fullscreen-btn:hover {
  background-color: #e9ecef;
  color: #495057;
}
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.panel-tabset').forEach(function(tabset) {
    const btn = document.createElement('button');
    btn.innerHTML = '⛶ Open Code in New Tab';
    btn.className = 'tabset-fullscreen-btn';

    tabset.style.position = 'relative';
    tabset.insertBefore(btn, tabset.firstChild);

    btn.addEventListener('click', function() {
      const clone = tabset.cloneNode(true);
      const cloneBtn = clone.querySelector('.tabset-fullscreen-btn');
      if (cloneBtn) cloneBtn.remove();

      // Get all stylesheets from current page
      const stylesheets = Array.from(document.styleSheets)
        .map(sheet => {
          try {
            if (sheet.href) {
              return `<link rel="stylesheet" href="${sheet.href}">`;
            } else if (sheet.ownerNode) {
              return `<style>${Array.from(sheet.cssRules).map(rule => rule.cssText).join('\n')}</style>`;
            }
          } catch (e) {
            if (sheet.href) return `<link rel="stylesheet" href="${sheet.href}">`;
          }
          return '';
        })
        .join('\n');

      const newWindow = window.open('', '_blank');
      newWindow.document.write(`
        <html>
          <head>
            <title>Tab Panel View</title>
            ${stylesheets}
            <style>
              body { 
                margin: 20px auto; 
                padding: 20px; 
                max-width: 1200px;
              }
            </style>
          </head>
          <body>
            ${clone.outerHTML}
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"><\/script>
          </body>
        </html>
      `);
      newWindow.document.close();
    });
  });
});
</script>


</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./22-randomization.html">Unit 10: Randomization</a></li><li class="breadcrumb-item"><a href="./22-randomization.html"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Randomization in Experimental Design</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Online Behavioural Research Methods: Programming with jsPsych</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/icoglab/online-behavioural-research-methods" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">UNIT 1: Fundamentals (I)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-html.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">HTML</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-css.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">CSS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-L01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Lab 1: About Me</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">UNIT 2: Fundamentals (II)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-javascript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Javascript</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-debugging-javascript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Debugging JavaScript</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-L02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Lab 2: JS Exercises</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">UNIT 3: Intro to JsPsych</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-jspsych.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">jsPsych</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-L03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Lab 3: Language &amp; Thought</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">UNIT 4: Timelines</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-timelines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Timelines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-plugins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">More Plugins</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-L04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Lab 4: Memory</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Unit 5: Multimedia</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-multimedia.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Multimedia</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-L05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Lab 5: Mental Imagery</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Unit 6: Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Saving and Labeling Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-data-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Accessing and Summarizing Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-L06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Lab 6: Creativity</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Unit 7: Dynamic Parameters</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-dynamic-html.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Dynamic Parameters</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-L07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Lab 7: Spatial Attention</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Unit 8: Controlling the Flow</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-dynamic-flow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Controlling the Flow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-L08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Lab 8: Cognitive Control</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true">
 <span class="menu-text">Unit 9: Skills Checkpoint</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-L09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Lab 9: Working Memory</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true">
 <span class="menu-text">Unit 10: Randomization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-randomization.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Randomization in Experimental Design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-L10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Lab 10: Judgment &amp; Decision-Making</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-L11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Lab 11: Face Perception</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Unit 11: Gamification</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A01_JS_Builtins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">JavaScript Built-in Functions</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
<div class="quarto-sidebar-footer"><div class="sidebar-footer-item">
<p>© 2024. This work is openly licensed via <a href="https://creativecommons.org/licenses/by-nc/4.0">CC BY NC 4.0</a>.</p>
</div></div></nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">22.1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#randomization-vs.-counterbalancing" id="toc-randomization-vs.-counterbalancing" class="nav-link" data-scroll-target="#randomization-vs.-counterbalancing"><span class="header-section-number">22.1.1</span> Randomization vs.&nbsp;Counterbalancing</a></li>
  <li><a href="#types-of-randomization-in-jspsych-experiments" id="toc-types-of-randomization-in-jspsych-experiments" class="nav-link" data-scroll-target="#types-of-randomization-in-jspsych-experiments"><span class="header-section-number">22.1.2</span> Types of Randomization in jsPsych Experiments</a></li>
  </ul></li>
  <li><a href="#random-assignment-of-participants-to-conditions" id="toc-random-assignment-of-participants-to-conditions" class="nav-link" data-scroll-target="#random-assignment-of-participants-to-conditions"><span class="header-section-number">22.2</span> Random Assignment of Participants to Conditions</a>
  <ul class="collapse">
  <li><a href="#implementing-random-assignment" id="toc-implementing-random-assignment" class="nav-link" data-scroll-target="#implementing-random-assignment"><span class="header-section-number">22.2.1</span> Implementing Random Assignment</a></li>
  <li><a href="#simple-solution-math.random" id="toc-simple-solution-math.random" class="nav-link" data-scroll-target="#simple-solution-math.random"><span class="header-section-number">22.2.2</span> Simple Solution: Math.random()</a></li>
  <li><a href="#preferred-solution-external-id-in-url" id="toc-preferred-solution-external-id-in-url" class="nav-link" data-scroll-target="#preferred-solution-external-id-in-url"><span class="header-section-number">22.2.3</span> Preferred Solution: External ID in URL</a></li>
  <li><a href="#assigning-multiple-conditions" id="toc-assigning-multiple-conditions" class="nav-link" data-scroll-target="#assigning-multiple-conditions"><span class="header-section-number">22.2.4</span> Assigning Multiple Conditions</a></li>
  <li><a href="#handling-missing-ids-allow-access-or-restrict" id="toc-handling-missing-ids-allow-access-or-restrict" class="nav-link" data-scroll-target="#handling-missing-ids-allow-access-or-restrict"><span class="header-section-number">22.2.5</span> Handling Missing IDs: Allow Access or Restrict?</a></li>
  <li><a href="#testing-with-url-parameters" id="toc-testing-with-url-parameters" class="nav-link" data-scroll-target="#testing-with-url-parameters"><span class="header-section-number">22.2.6</span> Testing with URL Parameters</a></li>
  <li><a href="#how-recruitment-platforms-use-url-parameters" id="toc-how-recruitment-platforms-use-url-parameters" class="nav-link" data-scroll-target="#how-recruitment-platforms-use-url-parameters"><span class="header-section-number">22.2.7</span> How Recruitment Platforms Use URL Parameters</a></li>
  <li><a href="#key-principles-for-participant-assignment" id="toc-key-principles-for-participant-assignment" class="nav-link" data-scroll-target="#key-principles-for-participant-assignment"><span class="header-section-number">22.2.8</span> Key Principles for Participant Assignment</a></li>
  </ul></li>
  <li><a href="#randomization-of-trial-order" id="toc-randomization-of-trial-order" class="nav-link" data-scroll-target="#randomization-of-trial-order"><span class="header-section-number">22.3</span> Randomization of Trial Order</a>
  <ul class="collapse">
  <li><a href="#basic-trial-randomization-with-randomize_order" id="toc-basic-trial-randomization-with-randomize_order" class="nav-link" data-scroll-target="#basic-trial-randomization-with-randomize_order"><span class="header-section-number">22.3.1</span> Basic Trial Randomization with <code>randomize_order</code></a></li>
  <li><a href="#custom-randomization-with-sample" id="toc-custom-randomization-with-sample" class="nav-link" data-scroll-target="#custom-randomization-with-sample"><span class="header-section-number">22.3.2</span> Custom Randomization with <code>sample</code></a></li>
  <li><a href="#example-1-two-repetitions-as-one-fully-randomized-block" id="toc-example-1-two-repetitions-as-one-fully-randomized-block" class="nav-link" data-scroll-target="#example-1-two-repetitions-as-one-fully-randomized-block"><span class="header-section-number">22.3.3</span> Example 1: Two Repetitions as One Fully Randomized Block</a></li>
  <li><a href="#example-2-always-start-with-a-specific-trial" id="toc-example-2-always-start-with-a-specific-trial" class="nav-link" data-scroll-target="#example-2-always-start-with-a-specific-trial"><span class="header-section-number">22.3.4</span> Example 2: Always Start with a Specific Trial</a></li>
  <li><a href="#example-3-unequal-repetitions" id="toc-example-3-unequal-repetitions" class="nav-link" data-scroll-target="#example-3-unequal-repetitions"><span class="header-section-number">22.3.5</span> Example 3: Unequal Repetitions</a></li>
  </ul></li>
  <li><a href="#randomization-of-block-order" id="toc-randomization-of-block-order" class="nav-link" data-scroll-target="#randomization-of-block-order"><span class="header-section-number">22.4</span> Randomization of Block Order</a>
  <ul class="collapse">
  <li><a href="#basic-block-randomization-with-shuffle" id="toc-basic-block-randomization-with-shuffle" class="nav-link" data-scroll-target="#basic-block-randomization-with-shuffle"><span class="header-section-number">22.4.1</span> Basic Block Randomization with <code>shuffle()</code></a></li>
  <li><a href="#randomizing-block-order-across-participants" id="toc-randomizing-block-order-across-participants" class="nav-link" data-scroll-target="#randomizing-block-order-across-participants"><span class="header-section-number">22.4.2</span> Randomizing Block Order Across Participants</a></li>
  <li><a href="#independent-randomization-of-condition-and-block-order" id="toc-independent-randomization-of-condition-and-block-order" class="nav-link" data-scroll-target="#independent-randomization-of-condition-and-block-order"><span class="header-section-number">22.4.3</span> Independent Randomization of Condition and Block Order</a></li>
  <li><a href="#key-principles-for-block-order-randomization" id="toc-key-principles-for-block-order-randomization" class="nav-link" data-scroll-target="#key-principles-for-block-order-randomization"><span class="header-section-number">22.4.4</span> Key Principles for Block Order Randomization</a></li>
  </ul></li>
  <li><a href="#random-assignment-of-stimuli-to-conditions" id="toc-random-assignment-of-stimuli-to-conditions" class="nav-link" data-scroll-target="#random-assignment-of-stimuli-to-conditions"><span class="header-section-number">22.5</span> Random Assignment of Stimuli to Conditions</a>
  <ul class="collapse">
  <li><a href="#programmatically-generating-timeline_variables" id="toc-programmatically-generating-timeline_variables" class="nav-link" data-scroll-target="#programmatically-generating-timeline_variables"><span class="header-section-number">22.5.1</span> Programmatically Generating <code>timeline_variables</code></a></li>
  <li><a href="#example-1-randomly-select-a-subset-of-stimuli-and-assign-to-conditions" id="toc-example-1-randomly-select-a-subset-of-stimuli-and-assign-to-conditions" class="nav-link" data-scroll-target="#example-1-randomly-select-a-subset-of-stimuli-and-assign-to-conditions"><span class="header-section-number">22.5.2</span> Example 1: Randomly Select a Subset of Stimuli and Assign to Conditions</a></li>
  <li><a href="#example-2-randomly-assign-stimuli-to-old-and-new-lists" id="toc-example-2-randomly-assign-stimuli-to-old-and-new-lists" class="nav-link" data-scroll-target="#example-2-randomly-assign-stimuli-to-old-and-new-lists"><span class="header-section-number">22.5.3</span> Example 2: Randomly Assign Stimuli to “Old” and “New” Lists</a></li>
  <li><a href="#example-3-random-pairing-of-stimuli" id="toc-example-3-random-pairing-of-stimuli" class="nav-link" data-scroll-target="#example-3-random-pairing-of-stimuli"><span class="header-section-number">22.5.4</span> Example 3: Random Pairing of Stimuli</a></li>
  <li><a href="#example-4-balanced-random-assignment-with-constraints" id="toc-example-4-balanced-random-assignment-with-constraints" class="nav-link" data-scroll-target="#example-4-balanced-random-assignment-with-constraints"><span class="header-section-number">22.5.5</span> Example 4: Balanced Random Assignment with Constraints</a></li>
  <li><a href="#verifying-your-randomization" id="toc-verifying-your-randomization" class="nav-link" data-scroll-target="#verifying-your-randomization"><span class="header-section-number">22.5.6</span> Verifying Your Randomization</a></li>
  <li><a href="#key-principles-for-stimulus-assignment" id="toc-key-principles-for-stimulus-assignment" class="nav-link" data-scroll-target="#key-principles-for-stimulus-assignment"><span class="header-section-number">22.5.7</span> Key Principles for Stimulus Assignment</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/icoglab/online-behavioural-research-methods/edit/main/22-randomization.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/icoglab/online-behavioural-research-methods/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./22-randomization.html">Unit 10: Randomization</a></li><li class="breadcrumb-item"><a href="./22-randomization.html"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Randomization in Experimental Design</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Randomization in Experimental Design</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-note callout-titled" title="learning goals">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
learning goals
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Implement random assignment to allocate participants to experimental conditions using URL parameters</li>
<li>Randomize trial order using built-in methods and custom functions with constraints</li>
<li>Randomize block order across participants while maintaining experimental control</li>
<li>Programmatically assign stimuli to conditions with balanced or constrained randomization</li>
<li>Test and verify randomization procedures to ensure methodological rigor</li>
</ol>
</div>
</div>
</div>
<section id="introduction" class="level2" data-number="22.1">
<h2 data-number="22.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">22.1</span> Introduction</h2>
<p>When you run an experiment, you’re trying to isolate the effect of your independent variable on your dependent variable. But the world is messy, and participants differ from each other in countless ways, stimuli have unique characteristics, and the order in which things happen can influence responses. Without proper randomization, these factors can become confounding variables that make it impossible to draw clear conclusions from your data.</p>
<p>Randomization is your primary tool for controlling these potential confounds. It helps ensure that any differences you observe between conditions are due to your experimental manipulation, not to systematic biases in how participants were assigned, how stimuli were selected, or how trials were ordered.</p>
<section id="randomization-vs.-counterbalancing" class="level3" data-number="22.1.1">
<h3 data-number="22.1.1" class="anchored" data-anchor-id="randomization-vs.-counterbalancing"><span class="header-section-number">22.1.1</span> Randomization vs.&nbsp;Counterbalancing</h3>
<p>Before we dive into implementation, it’s important to distinguish between randomization and counterbalancing, as both are mentioned in experimental design textbooks but require different technical approaches.</p>
<p>Randomization means using a random process to determine assignment or order for each participant independently. For example, each participant might be randomly assigned to a condition, or each participant might see trials in a randomly shuffled order. This is straightforward to implement in jsPsych using JavaScript’s built-in random functions.</p>
<p>Counterbalancing means systematically varying the order of conditions across participants according to a predetermined scheme (like complete counterbalancing or Latin square designs). For example, if you have conditions A and B, you might want exactly half your participants to experience A-then-B and the other half to experience B-then-A. This requires tracking how many participants have been assigned to each order and making assignments accordingly. This typically requires server-side code because you need coordinate across participants.</p>
<p>In this chapter, we’ll focus on randomization techniques that can be fully implemented in jsPsych without server-side coordination. While counterbalancing is often preferred in experimental design (especially for within-subjects experiments with few conditions), randomization is more practical for online experiments and still provides good control over confounds, particularly with larger sample sizes. If you need true counterbalancing for your research, you’ll need to implement server-side logic beyond the scope of this textbook.</p>
</section>
<section id="types-of-randomization-in-jspsych-experiments" class="level3" data-number="22.1.2">
<h3 data-number="22.1.2" class="anchored" data-anchor-id="types-of-randomization-in-jspsych-experiments"><span class="header-section-number">22.1.2</span> Types of Randomization in jsPsych Experiments</h3>
<p>In online experiments built with jsPsych, you’ll typically need to implement three distinct types of randomization:</p>
<ol type="1">
<li>Random assignment of participants to conditions: In between-subjects designs, ensuring that participants are equivalently distributed across experimental conditions</li>
<li>Randomization of trial and block order: Preventing order effects by randomizing the sequence in which participants experience trials and blocks, and implementing counterbalancing strategies for within-subjects designs</li>
<li>Random assignment of stimuli to conditions: Controlling for item-level differences by randomly selecting or assigning specific stimuli from your stimulus pool</li>
</ol>
<p>By the end of this chapter, you’ll be able to implement each of these randomization strategies in jsPsych, building experiments that properly control for confounds through strategic use of randomization, an important skill for conducting rigorous experimental research.</p>
<p><strong>Note:</strong> While randomization is a powerful tool, remember that it’s not magic. Random assignment works better with larger samples, and even with proper randomization, you should always check whether your groups are balanced on key variables. The inferential statistics you’ll use to analyze your data account for the probabilistic nature of random assignment, but good experimental design starts with thoughtful implementation of these randomization principles.</p>
</section>
</section>
<section id="random-assignment-of-participants-to-conditions" class="level2" data-number="22.2">
<h2 data-number="22.2" class="anchored" data-anchor-id="random-assignment-of-participants-to-conditions"><span class="header-section-number">22.2</span> Random Assignment of Participants to Conditions</h2>
<p>In between-subjects designs, where each participant experiences only one level of your independent variable, you need to randomly assign participants to conditions. This ensures that the groups are equivalent on average in that they should have similar distributions of age, motivation, fatigue, prior knowledge, and countless other variables you haven’t even measured.</p>
<p>For example, if you’re testing whether studying with music affects memory performance, you might randomly assign half your participants to study with music and half to study in silence. Random assignment means that any pre-existing differences in memory ability should be distributed equally across both groups.</p>
<p><strong>Key Principle:</strong> Random assignment controls for participant-level confounds in between-subjects designs.</p>
<section id="implementing-random-assignment" class="level3" data-number="22.2.1">
<h3 data-number="22.2.1" class="anchored" data-anchor-id="implementing-random-assignment"><span class="header-section-number">22.2.1</span> Implementing Random Assignment</h3>
<p>We have already learned some techniques for controlling what participants do in the experiment using conditional functions. For instance, we can show/skip the ‘music’ versus ‘no music’ condition based on which condition they were assigned to like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">let</span> assigned_condition <span class="op">=</span> <span class="st">"music"</span></span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">let</span> music_trials <span class="op">=</span> {</span>
<span id="cb1-4"><a href="#cb1-4"></a>    <span class="dt">timeline</span><span class="op">:</span> [<span class="co">/* trials */</span>]<span class="op">,</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>    <span class="dt">conditional_function</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb1-6"><a href="#cb1-6"></a>      <span class="cf">if</span>(assigned_condition <span class="op">==</span> <span class="st">"music"</span>){</span>
<span id="cb1-7"><a href="#cb1-7"></a>        <span class="cf">return</span> <span class="kw">true</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>      } <span class="cf">else</span> {</span>
<span id="cb1-9"><a href="#cb1-9"></a>        <span class="cf">return</span> <span class="kw">false</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>      }</span>
<span id="cb1-11"><a href="#cb1-11"></a>    }</span>
<span id="cb1-12"><a href="#cb1-12"></a>}</span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="kw">let</span> no_music_trials <span class="op">=</span> {</span>
<span id="cb1-15"><a href="#cb1-15"></a>    <span class="dt">timeline</span><span class="op">:</span> [<span class="co">/* trials */</span>]<span class="op">,</span></span>
<span id="cb1-16"><a href="#cb1-16"></a>    <span class="dt">conditional_function</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb1-17"><a href="#cb1-17"></a>      <span class="cf">if</span>(assigned_condition <span class="op">==</span> <span class="st">"no music"</span>){</span>
<span id="cb1-18"><a href="#cb1-18"></a>        <span class="cf">return</span> <span class="kw">true</span></span>
<span id="cb1-19"><a href="#cb1-19"></a>      } <span class="cf">else</span> {</span>
<span id="cb1-20"><a href="#cb1-20"></a>        <span class="cf">return</span> <span class="kw">false</span></span>
<span id="cb1-21"><a href="#cb1-21"></a>      }</span>
<span id="cb1-22"><a href="#cb1-22"></a>    }</span>
<span id="cb1-23"><a href="#cb1-23"></a>}</span>
<span id="cb1-24"><a href="#cb1-24"></a></span>
<span id="cb1-25"><a href="#cb1-25"></a>jsPsych<span class="op">.</span><span class="fu">run</span>([</span>
<span id="cb1-26"><a href="#cb1-26"></a>  introduction<span class="op">,</span></span>
<span id="cb1-27"><a href="#cb1-27"></a>  music_trials<span class="op">,</span></span>
<span id="cb1-28"><a href="#cb1-28"></a>  no_music_trials<span class="op">,</span></span>
<span id="cb1-29"><a href="#cb1-29"></a>  debrief</span>
<span id="cb1-30"><a href="#cb1-30"></a>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can even control what version of the task they see using simpler <code>if else</code> logic. For instance, I could simply change what is placed in <code>jsPsych.run</code> like this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1"></a><span class="cf">if</span>(assigned_condition <span class="op">===</span> <span class="st">"music"</span>){</span>
<span id="cb2-2"><a href="#cb2-2"></a>  </span>
<span id="cb2-3"><a href="#cb2-3"></a>  jsPsych<span class="op">.</span><span class="fu">run</span>([</span>
<span id="cb2-4"><a href="#cb2-4"></a>    introduction<span class="op">,</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>    music_trials<span class="op">,</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>    debrief</span>
<span id="cb2-7"><a href="#cb2-7"></a>  ])</span>
<span id="cb2-8"><a href="#cb2-8"></a>  </span>
<span id="cb2-9"><a href="#cb2-9"></a>} <span class="cf">else</span> <span class="cf">if</span>(assigned_condition <span class="op">===</span> <span class="st">"no music"</span>){</span>
<span id="cb2-10"><a href="#cb2-10"></a>  </span>
<span id="cb2-11"><a href="#cb2-11"></a>  jsPsych<span class="op">.</span><span class="fu">run</span>([</span>
<span id="cb2-12"><a href="#cb2-12"></a>    introduction<span class="op">,</span></span>
<span id="cb2-13"><a href="#cb2-13"></a>    no_music_trials<span class="op">,</span></span>
<span id="cb2-14"><a href="#cb2-14"></a>    debrief</span>
<span id="cb2-15"><a href="#cb2-15"></a>  ])</span>
<span id="cb2-16"><a href="#cb2-16"></a>  </span>
<span id="cb2-17"><a href="#cb2-17"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>But, how exactly do we determine whether the current participant should be assigned to the ‘music’ or ‘no music’ group?</p>
</section>
<section id="simple-solution-math.random" class="level3" data-number="22.2.2">
<h3 data-number="22.2.2" class="anchored" data-anchor-id="simple-solution-math.random"><span class="header-section-number">22.2.2</span> Simple Solution: Math.random()</h3>
<p>The most straightforward approach is to use JavaScript’s built-in <code>Math.random()</code> function to randomly assign each participant when they load the experiment. This function returns a random decimal between 0 and 1, which we can use to make assignment decisions.</p>
<p>For a simple two-condition experiment:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">// Randomly assign to one of two conditions</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw">let</span> assigned_condition<span class="op">;</span></span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="cf">if</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>() <span class="op">&lt;</span> <span class="fl">0.5</span>){</span>
<span id="cb3-5"><a href="#cb3-5"></a>  assigned_condition <span class="op">=</span> <span class="st">"music"</span><span class="op">;</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>} <span class="cf">else</span> {</span>
<span id="cb3-7"><a href="#cb3-7"></a>  assigned_condition <span class="op">=</span> <span class="st">"no music"</span><span class="op">;</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For experiments with more than two conditions, you can extend this logic:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">// Randomly assign to one of three conditions</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="kw">let</span> assigned_condition<span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="kw">let</span> random_number <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>()<span class="op">;</span></span>
<span id="cb4-4"><a href="#cb4-4"></a></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="cf">if</span>(random_number <span class="op">&lt;</span> <span class="fl">0.33</span>){</span>
<span id="cb4-6"><a href="#cb4-6"></a>  assigned_condition <span class="op">=</span> <span class="st">"music"</span><span class="op">;</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>} <span class="cf">else</span> <span class="cf">if</span>(random_number <span class="op">&lt;</span> <span class="fl">0.67</span>){</span>
<span id="cb4-8"><a href="#cb4-8"></a>  assigned_condition <span class="op">=</span> <span class="st">"no music"</span><span class="op">;</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>} <span class="cf">else</span> {</span>
<span id="cb4-10"><a href="#cb4-10"></a>  assigned_condition <span class="op">=</span> <span class="st">"white noise"</span><span class="op">;</span></span>
<span id="cb4-11"><a href="#cb4-11"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>jsPsych also has built-in randomization methods, which you can use for cleaner code. For instance, we use the <code>sampleWithoutReplacement</code> to select one item from a <code>conditions</code> array:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1"></a><span class="co">// Randomly select one condition from an array</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="kw">let</span> conditions <span class="op">=</span> [<span class="st">"music"</span><span class="op">,</span> <span class="st">"no music"</span><span class="op">,</span> <span class="st">"white noise"</span>]<span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="kw">let</span> assigned_condition <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">randomization</span><span class="op">.</span><span class="fu">sampleWithoutReplacement</span>(conditions<span class="op">,</span> <span class="dv">1</span>)[<span class="dv">0</span>]<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The advantages to using these approaches is that it is simple to implement, requires no external services, and works immediately.</p>
<p>There are some limitations, however:</p>
<p>First, you have no control over how many participants end up in each condition. With small samples, you might end up with unequal group sizes (e.g., 7 in one condition and 13 in another). This is generally not a serious problem, but it’s less statistically efficient than equal group sizes. Typically, if you wanted at least 50 participants per group, you’d have to keep collecting data until both groups reach a minimum of 50, and you may end up with something like 54 in one group and 50 in the other.</p>
<p>A more important limitation, however, is that this approach doesn’t actually randomly assign <strong>participants</strong> to conditions! Instead, it randomly assigns <strong>sessions</strong> to a conditions. Each time someone reloads the webpage, they are randomly assigned again. This means a single participant could reload the page multiple times and experience different conditions, either accidentally or intentionally. This violates the principle of random assignment, where each participant should be assigned to exactly one condition.</p>
<p>To give one example where this could be a serious limitation, consider a ‘reward’ versus ‘no reward’ manipulation. In the introductory instructions one group receives the prompt “You will have the opportunity to earn up to $5!”, but the no reward group does not receive that instruction. A participant could reload the page multiple times until they get the instruction version they would prefer.</p>
<p>For casual testing or demonstrations this may be acceptable, but for research purposes, this is a significant limitation.</p>
</section>
<section id="preferred-solution-external-id-in-url" class="level3" data-number="22.2.3">
<h3 data-number="22.2.3" class="anchored" data-anchor-id="preferred-solution-external-id-in-url"><span class="header-section-number">22.2.3</span> Preferred Solution: External ID in URL</h3>
<p>Many online research platforms (like Prolific, MTurk, or SONA) can pass a participant ID through the URL when launching your experiment. You can use this ID to determine condition assignment in a reproducible way.</p>
<p>Before we dive into the code, let’s understand what URL parameters are. You’ve probably seen URLs that look like this: <code>https://www.example.com/search?query=psychology&amp;sort=recent</code></p>
<p>Everything after the question mark (?) consists of URL parameters (also called query parameters). These are key-value pairs separated by ampersands (&amp;). In the example above:</p>
<ul>
<li><code>query=psychology</code> (the key is “query” and the value is “psychology”)</li>
<li><code>sort=recent</code> (the key is “sort” and the value is “recent”)</li>
</ul>
<p>URL parameters are a way to pass information to a webpage. When you click a link or type a URL with parameters, the webpage can read those values and use them to customize what it displays or how it behaves.</p>
<p>For online experiments, recruitment platforms can automatically add a participant ID to your experiment’s URL. For example: <code>https://yourstudy.com/experiment.html?participant=12345</code></p>
<p>Or with multiple parameters: <code>https://yourstudy.com/experiment.html?participant=12345&amp;session=2&amp;study=memory</code></p>
<p>This ID is linked to a particular participant, and does not change when they reload the page. That means we can use it as a way of assigning a <strong>participant</strong> to a condition!</p>
<p>jsPsych provides a convenient method for reading URL parameters: <code>jsPsych.data.getURLVariable()</code>. This method takes the name of the parameter you want to retrieve and returns its value. If your URL is <code>https://yourstudy.com/experiment.html?participant=12345</code></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1"></a><span class="co">// URL: https://yourstudy.com/experiment.html?participant=12345</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co">// Extract the participant ID from the URL</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="kw">const</span> participant_id <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">getURLVariable</span>(<span class="st">'participant'</span>)<span class="op">;</span></span>
<span id="cb6-4"><a href="#cb6-4"></a></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(participant_id)<span class="op">;</span> <span class="co">// Will print: 12345</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If a parameter doesn’t exist in the URL, <code>getURLVariable()</code>returns undefined:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1"></a><span class="co">// URL: https://yourstudy.com/experiment.html</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw">const</span> participant_id <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">getURLVariable</span>(<span class="st">'participant'</span>)<span class="op">;</span> <span class="co">// undefined if not in URL</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="kw">const</span> session_num <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">getURLVariable</span>(<span class="st">'session'</span>)<span class="op">;</span> <span class="co">// undefined if not in URL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now that we can extract the participant ID from the URL, we can use it to determine condition assignment. However, the exact approach depends on the format of the participant ID provided by your recruitment platform.</p>
<section id="numeric-ids-e.g.-sona" class="level4" data-number="22.2.3.1">
<h4 data-number="22.2.3.1" class="anchored" data-anchor-id="numeric-ids-e.g.-sona"><span class="header-section-number">22.2.3.1</span> Numeric IDs (e.g., SONA)</h4>
<p>SONA and some other platforms provide numeric participant IDs. These can be used directly with the modulo operator:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1"></a><span class="co">// // URL: https://yourstudy.com/experiment.html?id=12345</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co">// Get participant ID from URL</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="kw">const</span> participant_id <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">getURLVariable</span>(<span class="st">'id'</span>)<span class="op">;</span></span>
<span id="cb8-4"><a href="#cb8-4"></a></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="co">// Use the ID to determine condition</span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="co">// Even IDs get music, odd IDs get no music</span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="kw">let</span> assigned_condition<span class="op">;</span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="cf">if</span>(participant_id <span class="op">%</span> <span class="dv">2</span> <span class="op">===</span> <span class="dv">0</span>){</span>
<span id="cb8-9"><a href="#cb8-9"></a>  assigned_condition <span class="op">=</span> <span class="st">"music"</span><span class="op">;</span></span>
<span id="cb8-10"><a href="#cb8-10"></a>} <span class="cf">else</span> {</span>
<span id="cb8-11"><a href="#cb8-11"></a>  assigned_condition <span class="op">=</span> <span class="st">"no music"</span><span class="op">;</span></span>
<span id="cb8-12"><a href="#cb8-12"></a>}</span>
<span id="cb8-13"><a href="#cb8-13"></a></span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="co">// Save id and assignment to data</span></span>
<span id="cb8-15"><a href="#cb8-15"></a>jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">addProperties</span>({</span>
<span id="cb8-16"><a href="#cb8-16"></a>  <span class="dt">participant_id</span><span class="op">:</span> participant_id<span class="op">,</span></span>
<span id="cb8-17"><a href="#cb8-17"></a>  <span class="dt">assigned_condition</span><span class="op">:</span> assigned_condition</span>
<span id="cb8-18"><a href="#cb8-18"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The modulo operator (%) gives us the remainder after division. So <code>participant_id % 2</code> will be 0 for even numbers and 1 for odd numbers. This creates a simple alternating pattern of condition assignment.</p>
<p>For more than two conditions:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb9-1"><a href="#cb9-1"></a><span class="co">// Assign to one of three conditions based on ID</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="kw">let</span> conditions <span class="op">=</span> [<span class="st">"music"</span><span class="op">,</span> <span class="st">"no music"</span><span class="op">,</span> <span class="st">"white noise"</span>]<span class="op">;</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="kw">let</span> assigned_condition <span class="op">=</span> conditions[participant_id <span class="op">%</span> <span class="dv">3</span>]<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here’s how this works:</p>
<ul>
<li>If <code>participant_id</code> is 12345, then 12345 % 3 = 0, so they get <code>conditions[0]</code> = “music”</li>
<li>If <code>participant_id</code> is 12346, then 12346 % 3 = 1, so they get <code>conditions[1]</code> = “no music”</li>
<li>If <code>participant_id</code> is 12347, then 12347 % 3 = 2, so they get <code>conditions[2]</code> = “white noise”</li>
<li>If <code>participant_id</code> is 12348, then 12348 % 3 = 0, so they get <code>conditions[0]</code> = “music” (the pattern repeats)</li>
</ul>
<p>There’s one problem with the code above: if someone opens your webpage without the ID in their URL, the experiment will crash. We can add a fallback to handle this:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb10-1"><a href="#cb10-1"></a><span class="co">// Get participant ID from URL, or generate random one if not found</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="kw">let</span> participant_id <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">getURLVariable</span>(<span class="st">'participant'</span>) <span class="op">||</span> jsPsych<span class="op">.</span><span class="at">randomization</span><span class="op">.</span><span class="fu">randomInt</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">100000</span>)<span class="op">;</span></span>
<span id="cb10-3"><a href="#cb10-3"></a></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="co">// Assign to one of three conditions based on ID</span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="kw">let</span> conditions <span class="op">=</span> [<span class="st">"music"</span><span class="op">,</span> <span class="st">"no music"</span><span class="op">,</span> <span class="st">"white noise"</span>]<span class="op">;</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="kw">let</span> assigned_condition <span class="op">=</span> conditions[participant_id <span class="op">%</span> <span class="dv">3</span>]<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>||</code> operator (logical OR) works as a fallback: if <code>getURLVariable('participant')</code> returns <code>undefined</code>, it will use the randomly generated ID instead.</p>
<p>This approach is useful during development and testing, but remember that visitors without a proper ID will be randomly assigned each time they reload the page (the same limitation as the <code>Math.random()</code> approach).</p>
</section>
<section id="alphanumeric-ids-e.g.-prolific" class="level4" data-number="22.2.3.2">
<h4 data-number="22.2.3.2" class="anchored" data-anchor-id="alphanumeric-ids-e.g.-prolific"><span class="header-section-number">22.2.3.2</span> Alphanumeric IDs (e.g., Prolific)</h4>
<p>Some platforms like Prolific use alphanumeric IDs that look like <code>5f8d9a2b3c4e5f6a7b8c9d0e</code>. These cannot be used directly with the modulo operator because they’re strings, not numbers. You need to convert them to numbers first.</p>
<p>A reliable approach is to sum the character codes of all characters in the string:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb11-1"><a href="#cb11-1"></a><span class="co">// Function to convert any string to a number</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw">function</span> <span class="fu">stringToNumber</span>(str) {</span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="kw">let</span> sum <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> str<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb11-5"><a href="#cb11-5"></a>    sum <span class="op">+=</span> str<span class="op">.</span><span class="fu">charCodeAt</span>(i)<span class="op">;</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>  }</span>
<span id="cb11-7"><a href="#cb11-7"></a>  <span class="cf">return</span> sum<span class="op">;</span></span>
<span id="cb11-8"><a href="#cb11-8"></a>}</span>
<span id="cb11-9"><a href="#cb11-9"></a></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="co">// Get participant ID from URL, or generate random one if not found</span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="kw">let</span> participant_id <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">getURLVariable</span>(<span class="st">'participant'</span>) <span class="op">||</span> jsPsych<span class="op">.</span><span class="at">randomization</span><span class="op">.</span><span class="fu">randomInt</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">100000</span>)<span class="op">.</span><span class="fu">toString</span>()<span class="op">;</span></span>
<span id="cb11-12"><a href="#cb11-12"></a></span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="co">// Convert to number and assign condition</span></span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="kw">const</span> numeric_id <span class="op">=</span> <span class="fu">stringToNumber</span>(participant_id)<span class="op">;</span></span>
<span id="cb11-15"><a href="#cb11-15"></a><span class="kw">let</span> conditions <span class="op">=</span> [<span class="st">"music"</span><span class="op">,</span> <span class="st">"no music"</span><span class="op">,</span> <span class="st">"white noise"</span>]<span class="op">;</span></span>
<span id="cb11-16"><a href="#cb11-16"></a><span class="kw">let</span> assigned_condition <span class="op">=</span> conditions[numeric_id <span class="op">%</span> <span class="dv">3</span>]<span class="op">;</span></span>
<span id="cb11-17"><a href="#cb11-17"></a></span>
<span id="cb11-18"><a href="#cb11-18"></a><span class="co">// Save id and assignment to data</span></span>
<span id="cb11-19"><a href="#cb11-19"></a>jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">addProperties</span>({</span>
<span id="cb11-20"><a href="#cb11-20"></a>  <span class="dt">participant_id</span><span class="op">:</span> participant_id<span class="op">,</span></span>
<span id="cb11-21"><a href="#cb11-21"></a>  <span class="dt">assigned_condition</span><span class="op">:</span> assigned_condition</span>
<span id="cb11-22"><a href="#cb11-22"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This works because:</p>
<ul>
<li>Each character has a numeric code (e.g., ‘a’ = 97, ‘b’ = 98, ‘5’ = 53)</li>
<li>Summing these codes gives us a unique number for each unique string</li>
<li>As long as the platform generates IDs randomly, the sums will be evenly distributed</li>
<li>The modulo operator then distributes these evenly across conditions</li>
</ul>
<p>This solution also includes the fallback for missing URL parameters. Note that we convert the random integer to a string using <code>.toString()</code> so it matches the format of IDs from recruitment platforms. The <code>stringToNumber()</code> function works for both numeric IDs (like “12345”) and alphanumeric IDs (like “5f8d9a2b3c4e”), making it a flexible solution for any recruitment platform.</p>
</section>
</section>
<section id="assigning-multiple-conditions" class="level3" data-number="22.2.4">
<h3 data-number="22.2.4" class="anchored" data-anchor-id="assigning-multiple-conditions"><span class="header-section-number">22.2.4</span> Assigning Multiple Conditions</h3>
<p>Sometimes we have multiple between-subjects conditions and participants need to be assigned to a combination of conditions. For example, you might manipulate both background music (music vs.&nbsp;no music) and block order (ABC vs.&nbsp;BCA vs.&nbsp;CAB), creating a 2 × 3 factorial design with 6 total condition combinations.</p>
<p>The key challenge is ensuring that these assignments are independent—that is, participants assigned to the “music” condition should be equally likely to receive any of the three block orders, and vice versa. If we simply used the participant ID directly for both assignments, they would be correlated.</p>
<p>The solution is to use different “seeds” by adding different strings to the participant ID before converting it to a number:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">function</span> <span class="fu">stringToNumber</span>(str) {</span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="kw">let</span> sum <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> str<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb12-4"><a href="#cb12-4"></a>    sum <span class="op">+=</span> str<span class="op">.</span><span class="fu">charCodeAt</span>(i)<span class="op">;</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>  }</span>
<span id="cb12-6"><a href="#cb12-6"></a>  <span class="cf">return</span> sum<span class="op">;</span></span>
<span id="cb12-7"><a href="#cb12-7"></a>}</span>
<span id="cb12-8"><a href="#cb12-8"></a></span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="kw">let</span> participant_id <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">getURLVariable</span>(<span class="st">'participant'</span>) <span class="op">||</span> </span>
<span id="cb12-10"><a href="#cb12-10"></a>                     jsPsych<span class="op">.</span><span class="at">randomization</span><span class="op">.</span><span class="fu">randomInt</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">100000</span>)<span class="op">.</span><span class="fu">toString</span>()<span class="op">;</span></span>
<span id="cb12-11"><a href="#cb12-11"></a></span>
<span id="cb12-12"><a href="#cb12-12"></a><span class="co">// Use ID with different "seeds" for independent assignments</span></span>
<span id="cb12-13"><a href="#cb12-13"></a><span class="kw">let</span> music_hash <span class="op">=</span> <span class="fu">stringToNumber</span>(participant_id <span class="op">+</span> <span class="st">"_music"</span>)<span class="op">;</span></span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="kw">let</span> font_hash <span class="op">=</span> <span class="fu">stringToNumber</span>(participant_id <span class="op">+</span> <span class="st">"_font"</span>)<span class="op">;</span></span>
<span id="cb12-15"><a href="#cb12-15"></a></span>
<span id="cb12-16"><a href="#cb12-16"></a><span class="kw">let</span> music_conditions <span class="op">=</span> [<span class="st">"music"</span><span class="op">,</span> <span class="st">"no_music"</span>]<span class="op">;</span></span>
<span id="cb12-17"><a href="#cb12-17"></a><span class="kw">let</span> assigned_music <span class="op">=</span> music_conditions[music_hash <span class="op">%</span> <span class="dv">2</span>]<span class="op">;</span></span>
<span id="cb12-18"><a href="#cb12-18"></a></span>
<span id="cb12-19"><a href="#cb12-19"></a><span class="kw">let</span> font_conditions <span class="op">=</span> [<span class="st">"large"</span><span class="op">,</span> <span class="st">"small"</span>]<span class="op">;</span></span>
<span id="cb12-20"><a href="#cb12-20"></a><span class="kw">let</span> assigned_font <span class="op">=</span> font_conditions[font_hash <span class="op">%</span> <span class="dv">2</span>]<span class="op">;</span></span>
<span id="cb12-21"><a href="#cb12-21"></a></span>
<span id="cb12-22"><a href="#cb12-22"></a><span class="co">// Save both assignments to data</span></span>
<span id="cb12-23"><a href="#cb12-23"></a>jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">addProperties</span>({</span>
<span id="cb12-24"><a href="#cb12-24"></a>  <span class="dt">participant_id</span><span class="op">:</span> participant_id<span class="op">,</span></span>
<span id="cb12-25"><a href="#cb12-25"></a>  <span class="dt">music_condition</span><span class="op">:</span> assigned_music<span class="op">,</span></span>
<span id="cb12-26"><a href="#cb12-26"></a>  <span class="dt">font_condition</span><span class="op">:</span> assigned_font</span>
<span id="cb12-27"><a href="#cb12-27"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By adding “_music” and “_font” to the participant ID before hashing, we create two different numbers from the same ID. These numbers will be uncorrelated, ensuring independent random assignment to each factor.</p>
<p>This approach scales to any number of factors. For example, if you also wanted to randomly assign text color (red vs.&nbsp;blue), you could add:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw">let</span> color_hash <span class="op">=</span> <span class="fu">stringToNumber</span>(participant_id <span class="op">+</span> <span class="st">"_color"</span>)<span class="op">;</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="kw">let</span> color_conditions <span class="op">=</span> [<span class="st">"red"</span><span class="op">,</span> <span class="st">"blue"</span>]<span class="op">;</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="kw">let</span> assigned_color <span class="op">=</span> color_conditions[color_hash <span class="op">%</span> <span class="dv">2</span>]<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Each factor uses a unique seed string, ensuring all assignments are independent while remaining consistent for each participant ID. This creates a fully crossed factorial design where participants are randomly assigned to one combination of all factors, and the assignment remains stable across sessions.</p>
</section>
<section id="handling-missing-ids-allow-access-or-restrict" class="level3" data-number="22.2.5">
<h3 data-number="22.2.5" class="anchored" data-anchor-id="handling-missing-ids-allow-access-or-restrict"><span class="header-section-number">22.2.5</span> Handling Missing IDs: Allow Access or Restrict?</h3>
<p>The examples above use a fallback that generates a random ID when none is provided in the URL. This is convenient for testing, but you have another option for actual data collection: restricting access entirely to participants with valid IDs.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw">let</span> participant_id <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">getURLVariable</span>(<span class="st">'participant'</span>)<span class="op">;</span></span>
<span id="cb14-2"><a href="#cb14-2"></a></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="co">// evaluates to true if present or false if undefined/null</span></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="cf">if</span>(participant_id){</span>
<span id="cb14-5"><a href="#cb14-5"></a></span>
<span id="cb14-6"><a href="#cb14-6"></a>  <span class="co">// Valid ID - run the actual experiment</span></span>
<span id="cb14-7"><a href="#cb14-7"></a>  jsPsych<span class="op">.</span><span class="fu">run</span>([experiment])<span class="op">;</span></span>
<span id="cb14-8"><a href="#cb14-8"></a>  </span>
<span id="cb14-9"><a href="#cb14-9"></a>} <span class="cf">else</span> {</span>
<span id="cb14-10"><a href="#cb14-10"></a></span>
<span id="cb14-11"><a href="#cb14-11"></a>  <span class="co">// No valid ID - show error message</span></span>
<span id="cb14-12"><a href="#cb14-12"></a>  <span class="kw">let</span> no_experiment <span class="op">=</span> {</span>
<span id="cb14-13"><a href="#cb14-13"></a>    <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb14-14"><a href="#cb14-14"></a>    <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`</span></span>
<span id="cb14-15"><a href="#cb14-15"></a><span class="vs">      &lt;p&gt;This study is only accessible through SONA/Prolific.&lt;/p&gt;</span></span>
<span id="cb14-16"><a href="#cb14-16"></a><span class="vs">      &lt;p&gt;Please return to the recruitment platform and use the provided link.&lt;/p&gt;</span></span>
<span id="cb14-17"><a href="#cb14-17"></a><span class="vs">    `</span><span class="op">,</span></span>
<span id="cb14-18"><a href="#cb14-18"></a>    <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span></span>
<span id="cb14-19"><a href="#cb14-19"></a>  }<span class="op">;</span></span>
<span id="cb14-20"><a href="#cb14-20"></a></span>
<span id="cb14-21"><a href="#cb14-21"></a>  jsPsych<span class="op">.</span><span class="fu">run</span>([no_experiment])<span class="op">;</span></span>
<span id="cb14-22"><a href="#cb14-22"></a></span>
<span id="cb14-23"><a href="#cb14-23"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This ensures that only participants with valid IDs from your recruitment platform can complete the study, preventing accidental or unauthorized access.</p>
<p>Which approach should you use? During development, the fallback with random assignment is most convenient for testing. For actual data collection, restricting access provides the most control and ensures data quality by preventing unauthorized access.</p>
</section>
<section id="testing-with-url-parameters" class="level3" data-number="22.2.6">
<h3 data-number="22.2.6" class="anchored" data-anchor-id="testing-with-url-parameters"><span class="header-section-number">22.2.6</span> Testing with URL Parameters</h3>
<p>When you’re developing your experiment locally, you can test different conditions by manually adding parameters to your URL. For example:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource text number-lines code-with-copy"><code class="sourceCode"><span id="cb15-1"><a href="#cb15-1"></a>file:///path/to/your/experiment.html?participant=100</span>
<span id="cb15-2"><a href="#cb15-2"></a>file:///path/to/your/experiment.html?participant=101</span>
<span id="cb15-3"><a href="#cb15-3"></a>file:///path/to/your/experiment.html?participant=5f8d9a2b3c4e</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Or if you’re using a local server:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource text number-lines code-with-copy"><code class="sourceCode"><span id="cb16-1"><a href="#cb16-1"></a>http://localhost:8000/experiment.html?participant=100</span>
<span id="cb16-2"><a href="#cb16-2"></a>http://localhost:8000/experiment.html?participant=101</span>
<span id="cb16-3"><a href="#cb16-3"></a>http://localhost:8000/experiment.html?participant=5f8d9a2b3c4e</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can also test the fallback behavior by opening the URL without any parameters:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource text number-lines code-with-copy"><code class="sourceCode"><span id="cb17-1"><a href="#cb17-1"></a>http://localhost:8000/experiment.html</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This lets you verify that each condition works correctly before deploying your experiment.</p>
</section>
<section id="how-recruitment-platforms-use-url-parameters" class="level3" data-number="22.2.7">
<h3 data-number="22.2.7" class="anchored" data-anchor-id="how-recruitment-platforms-use-url-parameters"><span class="header-section-number">22.2.7</span> How Recruitment Platforms Use URL Parameters</h3>
<p>When you set up your study on platforms like SONA or Prolific, you’ll provide them with your experiment’s base URL. They will automatically append the participant ID (and sometimes other information) to this URL when directing participants to your study.</p>
<p>For example, on SONA you might configure your study URL as:</p>
<p><code>https://yourstudy.com/experiment.html?id=%SURVEY_CODE%</code></p>
<p>SONA will replace %SURVEY_CODE% with each participant’s unique ID. On Prolific, you might use:</p>
<p><code>https://yourstudy.com/experiment.html?participant={{%PROLIFIC_PID%}}</code></p>
<p>Each platform has its own syntax for these placeholders so you should check their documentation for the exact format.</p>
<p>Advantages:</p>
<ol type="1">
<li>Assignment is reproducible—the same ID always gets the same condition, which can be helpful for debugging.</li>
<li>This ensures that a single participant is assigned to exactly one condition. If a participant drops out and restarts, or accidentally reloads the page, they’ll get the same condition because their participant ID doesn’t change. This is true random assignment of participants (not just sessions) to conditions.</li>
<li>You can plan your sample size to ensure equal groups (e.g., recruit participants in multiples of your number of conditions).</li>
</ol>
<p>Limitations: Requires that you’re using a platform that provides participant IDs. The assignment is only pseudo-random, so it depends on the order in which the platform assigns IDs to participants, though in practice this is rarely a concern.</p>
</section>
<section id="key-principles-for-participant-assignment" class="level3" data-number="22.2.8">
<h3 data-number="22.2.8" class="anchored" data-anchor-id="key-principles-for-participant-assignment"><span class="header-section-number">22.2.8</span> Key Principles for Participant Assignment</h3>
<p>When implementing participant assignment to conditions:</p>
<ol type="1">
<li>Use URL parameters for consistency: Extract participant IDs from the URL to ensure participants always see the same condition across sessions</li>
<li>Handle different ID formats: Account for both numeric (e.g., SONA) and alphanumeric (e.g., Prolific) ID systems using appropriate conversion methods</li>
<li>Implement fallback logic: Decide whether to allow access with a random ID (for testing) or restrict access (for data collection) when IDs are missing</li>
<li>Use modulo for balanced assignment: The modulo operator ensures equal distribution across conditions as participant numbers grow</li>
<li>Save assignments to data: Always record the assigned condition and participant ID in your data file for later analysis</li>
<li>Test with multiple IDs: Verify that your assignment logic produces the expected distribution across a range of participant IDs</li>
<li>Use independent hash seeds: When making multiple assignments from the same ID, add different strings before hashing to ensure assignments are uncorrelated</li>
</ol>
<p>By following these principles, you can implement robust participant assignment procedures that ensure balanced, consistent, and reproducible condition assignments across your study.</p>
</section>
</section>
<section id="randomization-of-trial-order" class="level2" data-number="22.3">
<h2 data-number="22.3" class="anchored" data-anchor-id="randomization-of-trial-order"><span class="header-section-number">22.3</span> Randomization of Trial Order</h2>
<p>The order in which trials and blocks appear can profoundly affect participant responses. As discussed in the textbook excerpt, order effects can take several forms:</p>
<ul>
<li>Practice effects: Performance improves because participants get better at the task</li>
<li>Fatigue effects: Performance declines because participants get tired or bored</li>
<li>Context effects: Responses to one stimulus are influenced by what came immediately before it</li>
</ul>
<p>These effects can occur both within blocks (trial-to-trial) and across blocks. For example, if your experiment has a memory block followed by an attention block, participants might perform differently than if the attention block came first.</p>
<p>Order randomization (at both trial and block levels) helps control for these order effects and carryover effects. For within-subjects designs with many trials, you typically randomize the trial order for each participant. When you have multiple blocks or tasks, you may also need to randomize or counterbalance the block order.</p>
<section id="basic-trial-randomization-with-randomize_order" class="level3" data-number="22.3.1">
<h3 data-number="22.3.1" class="anchored" data-anchor-id="basic-trial-randomization-with-randomize_order"><span class="header-section-number">22.3.1</span> Basic Trial Randomization with <code>randomize_order</code></h3>
<p>We have already been using a simple method for randomizing the order of trials. It’s worth revisiting that method so that we fully understand what it does:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">let</span> sart <span class="op">=</span> {</span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb18-3"><a href="#cb18-3"></a>    {</span>
<span id="cb18-4"><a href="#cb18-4"></a>    <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb18-5"><a href="#cb18-5"></a>    <span class="dt">stimulus</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">"number"</span>)<span class="op">,</span></span>
<span id="cb18-6"><a href="#cb18-6"></a>    <span class="dt">choices</span><span class="op">:</span> [<span class="st">" "</span>]<span class="op">,</span></span>
<span id="cb18-7"><a href="#cb18-7"></a>    <span class="dt">trial_duration</span><span class="op">:</span> <span class="dv">1300</span></span>
<span id="cb18-8"><a href="#cb18-8"></a>    }</span>
<span id="cb18-9"><a href="#cb18-9"></a>  ]<span class="op">,</span></span>
<span id="cb18-10"><a href="#cb18-10"></a>  <span class="dt">timeline_variables</span><span class="op">:</span> [</span>
<span id="cb18-11"><a href="#cb18-11"></a>    {<span class="dt">number</span><span class="op">:</span> <span class="dv">0</span>}<span class="op">,</span> </span>
<span id="cb18-12"><a href="#cb18-12"></a>    {<span class="dt">number</span><span class="op">:</span> <span class="dv">1</span>}<span class="op">,</span> </span>
<span id="cb18-13"><a href="#cb18-13"></a>    {<span class="dt">number</span><span class="op">:</span> <span class="dv">2</span>}<span class="op">,</span> </span>
<span id="cb18-14"><a href="#cb18-14"></a>    {<span class="dt">number</span><span class="op">:</span> <span class="dv">3</span>}<span class="op">,</span> </span>
<span id="cb18-15"><a href="#cb18-15"></a>    {<span class="dt">number</span><span class="op">:</span> <span class="dv">4</span>}<span class="op">,</span></span>
<span id="cb18-16"><a href="#cb18-16"></a>    {<span class="dt">number</span><span class="op">:</span> <span class="dv">5</span>}<span class="op">,</span>  </span>
<span id="cb18-17"><a href="#cb18-17"></a>    {<span class="dt">number</span><span class="op">:</span> <span class="dv">6</span>}<span class="op">,</span> </span>
<span id="cb18-18"><a href="#cb18-18"></a>    {<span class="dt">number</span><span class="op">:</span> <span class="dv">7</span>}<span class="op">,</span> </span>
<span id="cb18-19"><a href="#cb18-19"></a>    {<span class="dt">number</span><span class="op">:</span> <span class="dv">8</span>}<span class="op">,</span> </span>
<span id="cb18-20"><a href="#cb18-20"></a>    {<span class="dt">number</span><span class="op">:</span> <span class="dv">9</span>}</span>
<span id="cb18-21"><a href="#cb18-21"></a>  ]<span class="op">,</span></span>
<span id="cb18-22"><a href="#cb18-22"></a>  <span class="dt">randomize_order</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb18-23"><a href="#cb18-23"></a>  <span class="dt">repetitions</span><span class="op">:</span> <span class="dv">2</span></span>
<span id="cb18-24"><a href="#cb18-24"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By adding <code>randomize_order: true</code>, we are instructing jsPsych to randomly shuffle the order of our timeline_variables so that one participant might see <code>1,6,7,8,2,5,3,0,4,9</code> and the next might see <code>0,4,1,9,2,8,6,7,3,5</code>.</p>
<p>But what happens when we add repetitions: 2? Of course, we are instructing jsPsych to repeat through our timeline_variables twice, but <strong>how</strong> are they randomized?</p>
<p>It turns out that jsPsych treats each repetition as a separate block. In practice, that means if you’re randomizing the order and repeating twice, you first complete one randomized list of 0-9, then you complete another randomized list of 0-9. That’s a small but quite important detail. Even though we’re asking for two repetitions in a random order, the two repetitions are kept separate. Therefore, you can never receive two 9s in a row (one from the end of the first repetition and one from the start of the second), even though each number is presented twice overall.</p>
<p>That, of course, might be exactly what you want to happen. But it may not be. Perhaps you really want the possibility of the same number appearing on consecutive trials. This method does not accomplish that. In fact, if we use this method, we have no control over how the trials are randomized since we can only shuffle the order within each repetition block.</p>
</section>
<section id="custom-randomization-with-sample" class="level3" data-number="22.3.2">
<h3 data-number="22.3.2" class="anchored" data-anchor-id="custom-randomization-with-sample"><span class="header-section-number">22.3.2</span> Custom Randomization with <code>sample</code></h3>
<p>Fortunately, jsPsych provides a method for defining custom randomization functions through the <code>sample</code> parameter. This gives us complete freedom to arrange the trials in any way we see fit.</p>
<p>The <code>sample</code> parameter accepts an object with two properties:</p>
<ul>
<li><code>type</code>: The sampling method to use (set to ‘custom’ for custom functions)</li>
<li><code>fn</code>: A custom function that determines the trial order</li>
</ul>
<p>The custom function receives an array of indices (position numbers) as input and must return an array of indices that specifies the order in which trials should be presented.</p>
<p>For example, if you have 5 <code>timeline_variables</code>, jsPsych passes your function the array<code>[0, 1, 2, 3, 4]</code>. Each number corresponds to a position in your timeline_variables array:</p>
<ul>
<li>0 refers to the first timeline variable</li>
<li>1 refers to the second timeline variable</li>
<li>2 refers to the third timeline variable</li>
<li>And so on…</li>
</ul>
<p>Whatever array of indices you return determines the exact order trials will be presented. For example:</p>
<ul>
<li>Returning [0, 1, 2, 3, 4] presents trials in their original order</li>
<li>Returning [4, 3, 2, 1, 0] presents trials in reverse order</li>
<li>Returning [0, 0, 1, 1, 2, 2, 3, 3, 4, 4] presents each trial twice in sequence</li>
</ul>
<p>Let’s look at a simple example using words to make this concrete:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb19-1"><a href="#cb19-1"></a><span class="kw">let</span> lexical_decision <span class="op">=</span> {</span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb19-3"><a href="#cb19-3"></a>    {</span>
<span id="cb19-4"><a href="#cb19-4"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb19-5"><a href="#cb19-5"></a>      <span class="dt">stimulus</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">"word"</span>)<span class="op">,</span></span>
<span id="cb19-6"><a href="#cb19-6"></a>      <span class="dt">choices</span><span class="op">:</span> [<span class="st">'f'</span><span class="op">,</span> <span class="st">'j'</span>]<span class="op">,</span></span>
<span id="cb19-7"><a href="#cb19-7"></a>      <span class="dt">prompt</span><span class="op">:</span> <span class="st">'&lt;p&gt;Press F for word, J for non-word&lt;/p&gt;'</span></span>
<span id="cb19-8"><a href="#cb19-8"></a>    }</span>
<span id="cb19-9"><a href="#cb19-9"></a>  ]<span class="op">,</span></span>
<span id="cb19-10"><a href="#cb19-10"></a>  <span class="dt">timeline_variables</span><span class="op">:</span> [</span>
<span id="cb19-11"><a href="#cb19-11"></a>    {<span class="dt">word</span><span class="op">:</span> <span class="st">"table"</span>}<span class="op">,</span>   <span class="co">// index 0</span></span>
<span id="cb19-12"><a href="#cb19-12"></a>    {<span class="dt">word</span><span class="op">:</span> <span class="st">"blirk"</span>}<span class="op">,</span>   <span class="co">// index 1</span></span>
<span id="cb19-13"><a href="#cb19-13"></a>    {<span class="dt">word</span><span class="op">:</span> <span class="st">"chair"</span>}<span class="op">,</span>   <span class="co">// index 2</span></span>
<span id="cb19-14"><a href="#cb19-14"></a>    {<span class="dt">word</span><span class="op">:</span> <span class="st">"glorp"</span>}<span class="op">,</span>   <span class="co">// index 3</span></span>
<span id="cb19-15"><a href="#cb19-15"></a>    {<span class="dt">word</span><span class="op">:</span> <span class="st">"house"</span>}    <span class="co">// index 4</span></span>
<span id="cb19-16"><a href="#cb19-16"></a>  ]<span class="op">,</span></span>
<span id="cb19-17"><a href="#cb19-17"></a>  <span class="dt">sample</span><span class="op">:</span> {</span>
<span id="cb19-18"><a href="#cb19-18"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">'custom'</span><span class="op">,</span></span>
<span id="cb19-19"><a href="#cb19-19"></a>    <span class="dt">fn</span><span class="op">:</span> <span class="kw">function</span>(indices) {</span>
<span id="cb19-20"><a href="#cb19-20"></a>      <span class="co">// indices = [0, 1, 2, 3, 4]</span></span>
<span id="cb19-21"><a href="#cb19-21"></a>      <span class="co">// Let's return them in reverse order</span></span>
<span id="cb19-22"><a href="#cb19-22"></a>      <span class="cf">return</span> [<span class="dv">4</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb19-23"><a href="#cb19-23"></a>      <span class="co">// This will present: "house", then "glorp", then "chair", then "blirk", then "table"</span></span>
<span id="cb19-24"><a href="#cb19-24"></a>    }</span>
<span id="cb19-25"><a href="#cb19-25"></a>  }</span>
<span id="cb19-26"><a href="#cb19-26"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In this example, indices is [0, 1, 2, 3, 4], and we return [4, 3, 2, 1, 0], which means:</p>
<ol type="1">
<li>First trial: show <code>timeline_variables[4]</code> (which is {word: “house”})</li>
<li>Second trial: show <code>timeline_variables[3]</code> (which is {word: “glorp”})</li>
<li>Third trial: show <code>timeline_variables[2]</code> (which is {word: “chair”})</li>
<li>Fourth trial: show <code>timeline_variables[1]</code> (which is {word: “blirk”})</li>
<li>Fifth trial: show <code>timeline_variables[0]</code> (which is {word: “table”})</li>
</ol>
<p>Now let’s look at several practical examples of how we can use custom sampling to achieve different randomization goals.</p>
<p>You’ll notice across these examples, we’re going to be taking advantage of the built-in array methods you can review in the Appendix, and the jsPsych randomization functions, <a href="https://www.jspsych.org/latest/reference/jspsych-randomization/" class="external" target="_blank">you can read more about here.</a></p>
</section>
<section id="example-1-two-repetitions-as-one-fully-randomized-block" class="level3" data-number="22.3.3">
<h3 data-number="22.3.3" class="anchored" data-anchor-id="example-1-two-repetitions-as-one-fully-randomized-block"><span class="header-section-number">22.3.3</span> Example 1: Two Repetitions as One Fully Randomized Block</h3>
<p>What if we want two repetitions but truly randomized as one block, allowing the same number to appear consecutively?</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw">let</span> lexical_decision <span class="op">=</span> {</span>
<span id="cb20-2"><a href="#cb20-2"></a>  <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb20-3"><a href="#cb20-3"></a>    {</span>
<span id="cb20-4"><a href="#cb20-4"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb20-5"><a href="#cb20-5"></a>      <span class="dt">stimulus</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">"word"</span>)<span class="op">,</span></span>
<span id="cb20-6"><a href="#cb20-6"></a>      <span class="dt">choices</span><span class="op">:</span> [<span class="st">'f'</span><span class="op">,</span> <span class="st">'j'</span>]<span class="op">,</span></span>
<span id="cb20-7"><a href="#cb20-7"></a>      <span class="dt">prompt</span><span class="op">:</span> <span class="st">'&lt;p&gt;Press F for word, J for non-word&lt;/p&gt;'</span></span>
<span id="cb20-8"><a href="#cb20-8"></a>    }</span>
<span id="cb20-9"><a href="#cb20-9"></a>  ]<span class="op">,</span></span>
<span id="cb20-10"><a href="#cb20-10"></a>  <span class="dt">timeline_variables</span><span class="op">:</span> [</span>
<span id="cb20-11"><a href="#cb20-11"></a>    {<span class="dt">word</span><span class="op">:</span> <span class="st">"table"</span>}<span class="op">,</span>   <span class="co">// index 0</span></span>
<span id="cb20-12"><a href="#cb20-12"></a>    {<span class="dt">word</span><span class="op">:</span> <span class="st">"blirk"</span>}<span class="op">,</span>   <span class="co">// index 1</span></span>
<span id="cb20-13"><a href="#cb20-13"></a>    {<span class="dt">word</span><span class="op">:</span> <span class="st">"chair"</span>}<span class="op">,</span>   <span class="co">// index 2</span></span>
<span id="cb20-14"><a href="#cb20-14"></a>    {<span class="dt">word</span><span class="op">:</span> <span class="st">"glorp"</span>}<span class="op">,</span>   <span class="co">// index 3</span></span>
<span id="cb20-15"><a href="#cb20-15"></a>    {<span class="dt">word</span><span class="op">:</span> <span class="st">"house"</span>}    <span class="co">// index 4</span></span>
<span id="cb20-16"><a href="#cb20-16"></a>  ]<span class="op">,</span></span>
<span id="cb20-17"><a href="#cb20-17"></a>  <span class="dt">sample</span><span class="op">:</span> {</span>
<span id="cb20-18"><a href="#cb20-18"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">'custom'</span><span class="op">,</span></span>
<span id="cb20-19"><a href="#cb20-19"></a>    <span class="dt">fn</span><span class="op">:</span> <span class="kw">function</span>(indices) {</span>
<span id="cb20-20"><a href="#cb20-20"></a>      <span class="co">// indices = [0, 1, 2, 3, 4</span></span>
<span id="cb20-21"><a href="#cb20-21"></a>      <span class="co">// Duplicate the array to get two of each index</span></span>
<span id="cb20-22"><a href="#cb20-22"></a>      <span class="kw">let</span> doubled <span class="op">=</span> indices<span class="op">.</span><span class="fu">concat</span>(indices)<span class="op">;</span></span>
<span id="cb20-23"><a href="#cb20-23"></a>      <span class="co">// doubled = [0, 1, 2, 3, 4, 0, 1, 2, 3, 4]</span></span>
<span id="cb20-24"><a href="#cb20-24"></a></span>
<span id="cb20-25"><a href="#cb20-25"></a>      <span class="co">// Shuffle the entire combined array</span></span>
<span id="cb20-26"><a href="#cb20-26"></a>      <span class="cf">return</span> jsPsych<span class="op">.</span><span class="at">randomization</span><span class="op">.</span><span class="fu">shuffle</span>(doubled)<span class="op">;</span></span>
<span id="cb20-27"><a href="#cb20-27"></a>      <span class="co">// Might return something like: [3, 0, 0, 1, 2, 4, 1, 3, 2, 4]</span></span>
<span id="cb20-28"><a href="#cb20-28"></a>    }</span>
<span id="cb20-29"><a href="#cb20-29"></a>  }</span>
<span id="cb20-30"><a href="#cb20-30"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This approach:</p>
<ol type="1">
<li>Takes the original array of indices [0, 1, 2, 3, 4]</li>
<li>Concatenates it with itself to create two copies: [0, 1, 2, 3, 4, 0, 1, 2, 3, 4]</li>
<li>Shuffles the entire combined array as one block</li>
<li>Now consecutive trials can be the same number (e.g., you might see 3 followed by 3)</li>
</ol>
<p>Note that I’m using some of JavaScript’s built-in functions for arrays. You can read more about those in the Appendix.</p>
</section>
<section id="example-2-always-start-with-a-specific-trial" class="level3" data-number="22.3.4">
<h3 data-number="22.3.4" class="anchored" data-anchor-id="example-2-always-start-with-a-specific-trial"><span class="header-section-number">22.3.4</span> Example 2: Always Start with a Specific Trial</h3>
<p>What if we always want to start the block with 0, but randomize the rest of the trials?</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb21-1"><a href="#cb21-1"></a><span class="kw">let</span> lexical_decision <span class="op">=</span> {</span>
<span id="cb21-2"><a href="#cb21-2"></a>  <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb21-3"><a href="#cb21-3"></a>    {</span>
<span id="cb21-4"><a href="#cb21-4"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb21-5"><a href="#cb21-5"></a>      <span class="dt">stimulus</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">"word"</span>)<span class="op">,</span></span>
<span id="cb21-6"><a href="#cb21-6"></a>      <span class="dt">choices</span><span class="op">:</span> [<span class="st">'f'</span><span class="op">,</span> <span class="st">'j'</span>]<span class="op">,</span></span>
<span id="cb21-7"><a href="#cb21-7"></a>      <span class="dt">prompt</span><span class="op">:</span> <span class="st">'&lt;p&gt;Press F for word, J for non-word&lt;/p&gt;'</span></span>
<span id="cb21-8"><a href="#cb21-8"></a>    }</span>
<span id="cb21-9"><a href="#cb21-9"></a>  ]<span class="op">,</span></span>
<span id="cb21-10"><a href="#cb21-10"></a>  <span class="dt">timeline_variables</span><span class="op">:</span> [</span>
<span id="cb21-11"><a href="#cb21-11"></a>    {<span class="dt">word</span><span class="op">:</span> <span class="st">"table"</span>}<span class="op">,</span>   <span class="co">// index 0</span></span>
<span id="cb21-12"><a href="#cb21-12"></a>    {<span class="dt">word</span><span class="op">:</span> <span class="st">"blirk"</span>}<span class="op">,</span>   <span class="co">// index 1</span></span>
<span id="cb21-13"><a href="#cb21-13"></a>    {<span class="dt">word</span><span class="op">:</span> <span class="st">"chair"</span>}<span class="op">,</span>   <span class="co">// index 2</span></span>
<span id="cb21-14"><a href="#cb21-14"></a>    {<span class="dt">word</span><span class="op">:</span> <span class="st">"glorp"</span>}<span class="op">,</span>   <span class="co">// index 3</span></span>
<span id="cb21-15"><a href="#cb21-15"></a>    {<span class="dt">word</span><span class="op">:</span> <span class="st">"house"</span>}    <span class="co">// index 4</span></span>
<span id="cb21-16"><a href="#cb21-16"></a>  ]<span class="op">,</span></span>
<span id="cb21-17"><a href="#cb21-17"></a>  <span class="dt">sample</span><span class="op">:</span> {</span>
<span id="cb21-18"><a href="#cb21-18"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">'custom'</span><span class="op">,</span></span>
<span id="cb21-19"><a href="#cb21-19"></a>    <span class="dt">fn</span><span class="op">:</span> <span class="kw">function</span>(indices) {</span>
<span id="cb21-20"><a href="#cb21-20"></a>      <span class="co">// remove the first one and put it in first_trial</span></span>
<span id="cb21-21"><a href="#cb21-21"></a>      <span class="kw">let</span> first_trial <span class="op">=</span> indices<span class="op">.</span><span class="fu">shift</span>()</span>
<span id="cb21-22"><a href="#cb21-22"></a>      </span>
<span id="cb21-23"><a href="#cb21-23"></a>      <span class="co">// shuffle the rest of the trials</span></span>
<span id="cb21-24"><a href="#cb21-24"></a>      <span class="kw">let</span> trials <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">randomization</span><span class="op">.</span><span class="fu">shuffle</span>(indices)</span>
<span id="cb21-25"><a href="#cb21-25"></a>      </span>
<span id="cb21-26"><a href="#cb21-26"></a>      <span class="co">// put the first trial at the beginning</span></span>
<span id="cb21-27"><a href="#cb21-27"></a>      <span class="kw">let</span> all_trials <span class="op">=</span> [first_trial]<span class="op">.</span><span class="fu">concat</span>(trials)</span>
<span id="cb21-28"><a href="#cb21-28"></a>    </span>
<span id="cb21-29"><a href="#cb21-29"></a>      <span class="co">// return all trials</span></span>
<span id="cb21-30"><a href="#cb21-30"></a>      <span class="cf">return</span> all_trials</span>
<span id="cb21-31"><a href="#cb21-31"></a>      <span class="co">// might return something like 0,4,2,3,1 </span></span>
<span id="cb21-32"><a href="#cb21-32"></a>    }</span>
<span id="cb21-33"><a href="#cb21-33"></a>  }</span>
<span id="cb21-34"><a href="#cb21-34"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="example-3-unequal-repetitions" class="level3" data-number="22.3.5">
<h3 data-number="22.3.5" class="anchored" data-anchor-id="example-3-unequal-repetitions"><span class="header-section-number">22.3.5</span> Example 3: Unequal Repetitions</h3>
<p>What if we want half the trials to appear twice and half to appear once, all in a random order? BUT we want to randomly pick which ones appear twice, so that each participant gets different items that repeat?</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw">let</span> sart <span class="op">=</span> {</span>
<span id="cb22-2"><a href="#cb22-2"></a>  <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb22-3"><a href="#cb22-3"></a>    {</span>
<span id="cb22-4"><a href="#cb22-4"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb22-5"><a href="#cb22-5"></a>      <span class="dt">stimulus</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">"number"</span>)<span class="op">,</span></span>
<span id="cb22-6"><a href="#cb22-6"></a>      <span class="dt">choices</span><span class="op">:</span> [<span class="st">" "</span>]<span class="op">,</span></span>
<span id="cb22-7"><a href="#cb22-7"></a>      <span class="dt">trial_duration</span><span class="op">:</span> <span class="dv">1300</span></span>
<span id="cb22-8"><a href="#cb22-8"></a>    }</span>
<span id="cb22-9"><a href="#cb22-9"></a>  ]<span class="op">,</span></span>
<span id="cb22-10"><a href="#cb22-10"></a>  <span class="dt">timeline_variables</span><span class="op">:</span> [</span>
<span id="cb22-11"><a href="#cb22-11"></a>    {<span class="dt">number</span><span class="op">:</span> <span class="dv">0</span>}<span class="op">,</span> </span>
<span id="cb22-12"><a href="#cb22-12"></a>    {<span class="dt">number</span><span class="op">:</span> <span class="dv">1</span>}<span class="op">,</span> </span>
<span id="cb22-13"><a href="#cb22-13"></a>    {<span class="dt">number</span><span class="op">:</span> <span class="dv">2</span>}<span class="op">,</span> </span>
<span id="cb22-14"><a href="#cb22-14"></a>    {<span class="dt">number</span><span class="op">:</span> <span class="dv">3</span>}<span class="op">,</span> </span>
<span id="cb22-15"><a href="#cb22-15"></a>    {<span class="dt">number</span><span class="op">:</span> <span class="dv">4</span>}<span class="op">,</span></span>
<span id="cb22-16"><a href="#cb22-16"></a>    {<span class="dt">number</span><span class="op">:</span> <span class="dv">5</span>}<span class="op">,</span>  </span>
<span id="cb22-17"><a href="#cb22-17"></a>    {<span class="dt">number</span><span class="op">:</span> <span class="dv">6</span>}<span class="op">,</span> </span>
<span id="cb22-18"><a href="#cb22-18"></a>    {<span class="dt">number</span><span class="op">:</span> <span class="dv">7</span>}<span class="op">,</span> </span>
<span id="cb22-19"><a href="#cb22-19"></a>    {<span class="dt">number</span><span class="op">:</span> <span class="dv">8</span>}<span class="op">,</span></span>
<span id="cb22-20"><a href="#cb22-20"></a>    {<span class="dt">number</span><span class="op">:</span> <span class="dv">9</span>}</span>
<span id="cb22-21"><a href="#cb22-21"></a>  ]<span class="op">,</span></span>
<span id="cb22-22"><a href="#cb22-22"></a>  <span class="dt">sample</span><span class="op">:</span> {</span>
<span id="cb22-23"><a href="#cb22-23"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">'custom'</span><span class="op">,</span></span>
<span id="cb22-24"><a href="#cb22-24"></a>    <span class="dt">fn</span><span class="op">:</span> <span class="kw">function</span>(indices) {</span>
<span id="cb22-25"><a href="#cb22-25"></a>      <span class="co">// indices will be = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span></span>
<span id="cb22-26"><a href="#cb22-26"></a></span>
<span id="cb22-27"><a href="#cb22-27"></a>      <span class="co">// shuffle the full array</span></span>
<span id="cb22-28"><a href="#cb22-28"></a>      <span class="kw">let</span> shuffled <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">randomization</span><span class="op">.</span><span class="fu">shuffle</span>(indices)<span class="op">;</span></span>
<span id="cb22-29"><a href="#cb22-29"></a></span>
<span id="cb22-30"><a href="#cb22-30"></a>      <span class="co">// get both halves of the shuffled array</span></span>
<span id="cb22-31"><a href="#cb22-31"></a>      <span class="kw">let</span> half1 <span class="op">=</span> shuffled<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(indices<span class="op">.</span><span class="at">length</span> <span class="op">/</span> <span class="dv">2</span>))<span class="op">;</span></span>
<span id="cb22-32"><a href="#cb22-32"></a>      <span class="kw">let</span> half2 <span class="op">=</span> shuffled<span class="op">.</span><span class="fu">slice</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(indices<span class="op">.</span><span class="at">length</span> <span class="op">/</span> <span class="dv">2</span>)<span class="op">,</span> indices<span class="op">.</span><span class="at">length</span> )<span class="op">;</span></span>
<span id="cb22-33"><a href="#cb22-33"></a>      </span>
<span id="cb22-34"><a href="#cb22-34"></a>      <span class="co">// randomize and repeat each item twice</span></span>
<span id="cb22-35"><a href="#cb22-35"></a>      half1 <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">randomization</span><span class="op">.</span><span class="fu">repeat</span>(half1<span class="op">,</span> <span class="dv">2</span>)</span>
<span id="cb22-36"><a href="#cb22-36"></a>      </span>
<span id="cb22-37"><a href="#cb22-37"></a>      <span class="co">// Combine both halves</span></span>
<span id="cb22-38"><a href="#cb22-38"></a>      <span class="kw">let</span> combined <span class="op">=</span> half1<span class="op">.</span><span class="fu">concat</span>(half2)<span class="op">;</span></span>
<span id="cb22-39"><a href="#cb22-39"></a>      <span class="co">// Shuffle the entire array</span></span>
<span id="cb22-40"><a href="#cb22-40"></a>      combined <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">randomization</span><span class="op">.</span><span class="fu">shuffle</span>(combined)<span class="op">;</span></span>
<span id="cb22-41"><a href="#cb22-41"></a>    </span>
<span id="cb22-42"><a href="#cb22-42"></a>      <span class="cf">return</span> combined</span>
<span id="cb22-43"><a href="#cb22-43"></a>    }</span>
<span id="cb22-44"><a href="#cb22-44"></a>  }</span>
<span id="cb22-45"><a href="#cb22-45"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="randomization-of-block-order" class="level2" data-number="22.4">
<h2 data-number="22.4" class="anchored" data-anchor-id="randomization-of-block-order"><span class="header-section-number">22.4</span> Randomization of Block Order</h2>
<p>In many experiments, you need to present multiple blocks or tasks to participants. The order in which these blocks appear can influence performance due to practice effects, fatigue, or carryover effects between tasks. Randomizing block order helps control for these sequential effects.</p>
<section id="basic-block-randomization-with-shuffle" class="level3" data-number="22.4.1">
<h3 data-number="22.4.1" class="anchored" data-anchor-id="basic-block-randomization-with-shuffle"><span class="header-section-number">22.4.1</span> Basic Block Randomization with <code>shuffle()</code></h3>
<p>The simplest way to randomize block order is to store your blocks in an array and shuffle them:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb23-1"><a href="#cb23-1"></a><span class="co">// Define your experimental blocks</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="kw">let</span> memory_block <span class="op">=</span> {</span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="dt">timeline</span><span class="op">:</span> [<span class="co">/* memory task trials */</span>]</span>
<span id="cb23-4"><a href="#cb23-4"></a>}<span class="op">;</span></span>
<span id="cb23-5"><a href="#cb23-5"></a></span>
<span id="cb23-6"><a href="#cb23-6"></a><span class="kw">let</span> attention_block <span class="op">=</span> {</span>
<span id="cb23-7"><a href="#cb23-7"></a>  <span class="dt">timeline</span><span class="op">:</span> [<span class="co">/* attention task trials */</span>]</span>
<span id="cb23-8"><a href="#cb23-8"></a>}<span class="op">;</span></span>
<span id="cb23-9"><a href="#cb23-9"></a></span>
<span id="cb23-10"><a href="#cb23-10"></a><span class="kw">let</span> reasoning_block <span class="op">=</span> {</span>
<span id="cb23-11"><a href="#cb23-11"></a>  <span class="dt">timeline</span><span class="op">:</span> [<span class="co">/* reasoning task trials */</span>]</span>
<span id="cb23-12"><a href="#cb23-12"></a>}<span class="op">;</span></span>
<span id="cb23-13"><a href="#cb23-13"></a></span>
<span id="cb23-14"><a href="#cb23-14"></a><span class="co">// Put blocks in an array</span></span>
<span id="cb23-15"><a href="#cb23-15"></a><span class="kw">let</span> blocks <span class="op">=</span> [memory_block<span class="op">,</span> attention_block<span class="op">,</span> reasoning_block]<span class="op">;</span></span>
<span id="cb23-16"><a href="#cb23-16"></a></span>
<span id="cb23-17"><a href="#cb23-17"></a><span class="co">// Shuffle the order</span></span>
<span id="cb23-18"><a href="#cb23-18"></a>blocks <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">randomization</span><span class="op">.</span><span class="fu">shuffle</span>(blocks)<span class="op">;</span></span>
<span id="cb23-19"><a href="#cb23-19"></a></span>
<span id="cb23-20"><a href="#cb23-20"></a><span class="co">// Add shuffled order to a new timeline</span></span>
<span id="cb23-21"><a href="#cb23-21"></a><span class="kw">let</span> all_tasks <span class="op">=</span> {</span>
<span id="cb23-22"><a href="#cb23-22"></a>  <span class="dt">timeline</span><span class="op">:</span> blocks</span>
<span id="cb23-23"><a href="#cb23-23"></a>}</span>
<span id="cb23-24"><a href="#cb23-24"></a></span>
<span id="cb23-25"><a href="#cb23-25"></a><span class="co">// Run</span></span>
<span id="cb23-26"><a href="#cb23-26"></a>jsPsych<span class="op">.</span><span class="fu">run</span>([</span>
<span id="cb23-27"><a href="#cb23-27"></a>   welcome<span class="op">,</span></span>
<span id="cb23-28"><a href="#cb23-28"></a>   all_tasks<span class="op">,</span></span>
<span id="cb23-29"><a href="#cb23-29"></a>   debrief</span>
<span id="cb23-30"><a href="#cb23-30"></a>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Each participant will now see the three blocks in a different random order, while the welcome and debrief screens remain in fixed positions.</p>
</section>
<section id="randomizing-block-order-across-participants" class="level3" data-number="22.4.2">
<h3 data-number="22.4.2" class="anchored" data-anchor-id="randomizing-block-order-across-participants"><span class="header-section-number">22.4.2</span> Randomizing Block Order Across Participants</h3>
<p>Just as we used participant IDs to assign conditions, we can use them to determine block order. This ensures that each participant consistently sees the same block order if they need to return to the experiment:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb24-1"><a href="#cb24-1"></a><span class="co">// Get participant ID from URL</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="kw">let</span> participant_id <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">getURLVariable</span>(<span class="st">'participant'</span>) <span class="op">||</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>                     jsPsych<span class="op">.</span><span class="at">randomization</span><span class="op">.</span><span class="fu">randomInt</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">100000</span>)<span class="op">.</span><span class="fu">toString</span>()<span class="op">;</span></span>
<span id="cb24-4"><a href="#cb24-4"></a></span>
<span id="cb24-5"><a href="#cb24-5"></a><span class="co">// Convert to number (using our stringToNumber function for alphanumeric IDs) if you need to</span></span>
<span id="cb24-6"><a href="#cb24-6"></a><span class="kw">function</span> <span class="fu">stringToNumber</span>(str) {</span>
<span id="cb24-7"><a href="#cb24-7"></a>  <span class="kw">let</span> sum <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb24-8"><a href="#cb24-8"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> str<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb24-9"><a href="#cb24-9"></a>    sum <span class="op">+=</span> str<span class="op">.</span><span class="fu">charCodeAt</span>(i)<span class="op">;</span></span>
<span id="cb24-10"><a href="#cb24-10"></a>  }</span>
<span id="cb24-11"><a href="#cb24-11"></a>  <span class="cf">return</span> sum<span class="op">;</span></span>
<span id="cb24-12"><a href="#cb24-12"></a>}</span>
<span id="cb24-13"><a href="#cb24-13"></a></span>
<span id="cb24-14"><a href="#cb24-14"></a><span class="kw">let</span> numeric_id <span class="op">=</span> <span class="fu">stringToNumber</span>(participant_id)<span class="op">;</span></span>
<span id="cb24-15"><a href="#cb24-15"></a></span>
<span id="cb24-16"><a href="#cb24-16"></a><span class="co">// Define blocks</span></span>
<span id="cb24-17"><a href="#cb24-17"></a><span class="kw">let</span> memory_block <span class="op">=</span> {</span>
<span id="cb24-18"><a href="#cb24-18"></a>  <span class="dt">timeline</span><span class="op">:</span> [<span class="co">/* memory task trials */</span>]</span>
<span id="cb24-19"><a href="#cb24-19"></a>}<span class="op">;</span></span>
<span id="cb24-20"><a href="#cb24-20"></a></span>
<span id="cb24-21"><a href="#cb24-21"></a><span class="kw">let</span> attention_block <span class="op">=</span> {</span>
<span id="cb24-22"><a href="#cb24-22"></a>  <span class="dt">timeline</span><span class="op">:</span> [<span class="co">/* attention task trials */</span>]</span>
<span id="cb24-23"><a href="#cb24-23"></a>}<span class="op">;</span></span>
<span id="cb24-24"><a href="#cb24-24"></a></span>
<span id="cb24-25"><a href="#cb24-25"></a><span class="kw">let</span> reasoning_block <span class="op">=</span> {</span>
<span id="cb24-26"><a href="#cb24-26"></a>  <span class="dt">timeline</span><span class="op">:</span> [<span class="co">/* reasoning task trials */</span>]</span>
<span id="cb24-27"><a href="#cb24-27"></a>}<span class="op">;</span></span>
<span id="cb24-28"><a href="#cb24-28"></a></span>
<span id="cb24-29"><a href="#cb24-29"></a><span class="co">// Create array of possible block orders</span></span>
<span id="cb24-30"><a href="#cb24-30"></a><span class="kw">let</span> block_orders <span class="op">=</span> [</span>
<span id="cb24-31"><a href="#cb24-31"></a>  [memory_block<span class="op">,</span> attention_block<span class="op">,</span> reasoning_block]<span class="op">,</span></span>
<span id="cb24-32"><a href="#cb24-32"></a>  [memory_block<span class="op">,</span> reasoning_block<span class="op">,</span> attention_block]<span class="op">,</span></span>
<span id="cb24-33"><a href="#cb24-33"></a>  [attention_block<span class="op">,</span> memory_block<span class="op">,</span> reasoning_block]<span class="op">,</span></span>
<span id="cb24-34"><a href="#cb24-34"></a>  [attention_block<span class="op">,</span> reasoning_block<span class="op">,</span> memory_block]<span class="op">,</span></span>
<span id="cb24-35"><a href="#cb24-35"></a>  [reasoning_block<span class="op">,</span> memory_block<span class="op">,</span> attention_block]<span class="op">,</span></span>
<span id="cb24-36"><a href="#cb24-36"></a>  [reasoning_block<span class="op">,</span> attention_block<span class="op">,</span> memory_block]</span>
<span id="cb24-37"><a href="#cb24-37"></a>]<span class="op">;</span></span>
<span id="cb24-38"><a href="#cb24-38"></a></span>
<span id="cb24-39"><a href="#cb24-39"></a><span class="co">// Assign block order based on participant ID using modulo</span></span>
<span id="cb24-40"><a href="#cb24-40"></a><span class="kw">let</span> assigned_blocks <span class="op">=</span> block_orders[numeric_id <span class="op">%</span> block_orders<span class="op">.</span><span class="at">length</span>]<span class="op">;</span></span>
<span id="cb24-41"><a href="#cb24-41"></a></span>
<span id="cb24-42"><a href="#cb24-42"></a><span class="co">// Add to timeline</span></span>
<span id="cb24-43"><a href="#cb24-43"></a><span class="kw">let</span> all_tasks <span class="op">=</span> {</span>
<span id="cb24-44"><a href="#cb24-44"></a>  <span class="dt">timeline</span><span class="op">:</span> assigned_blocks</span>
<span id="cb24-45"><a href="#cb24-45"></a>}</span>
<span id="cb24-46"><a href="#cb24-46"></a></span>
<span id="cb24-47"><a href="#cb24-47"></a><span class="co">// Run</span></span>
<span id="cb24-48"><a href="#cb24-48"></a>jsPsych<span class="op">.</span><span class="fu">runs</span>([</span>
<span id="cb24-49"><a href="#cb24-49"></a>  welcome<span class="op">,</span></span>
<span id="cb24-50"><a href="#cb24-50"></a>  all_tasks<span class="op">,</span></span>
<span id="cb24-51"><a href="#cb24-51"></a>  debrief</span>
<span id="cb24-52"><a href="#cb24-52"></a>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This approach ensures that block order is balanced across participants (each order appears equally often) and remains consistent for each participant ID.</p>
</section>
<section id="independent-randomization-of-condition-and-block-order" class="level3" data-number="22.4.3">
<h3 data-number="22.4.3" class="anchored" data-anchor-id="independent-randomization-of-condition-and-block-order"><span class="header-section-number">22.4.3</span> Independent Randomization of Condition and Block Order</h3>
<p>You can use the same participant ID to independently assign both experimental condition and block order by using different “seeds” as we discussed in the participant assignment section:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb25-1"><a href="#cb25-1"></a><span class="kw">let</span> participant_id <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">getURLVariable</span>(<span class="st">'participant'</span>) <span class="op">||</span> </span>
<span id="cb25-2"><a href="#cb25-2"></a>                     jsPsych<span class="op">.</span><span class="at">randomization</span><span class="op">.</span><span class="fu">randomInt</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">100000</span>)<span class="op">.</span><span class="fu">toString</span>()<span class="op">;</span></span>
<span id="cb25-3"><a href="#cb25-3"></a></span>
<span id="cb25-4"><a href="#cb25-4"></a><span class="kw">function</span> <span class="fu">stringToNumber</span>(str) {</span>
<span id="cb25-5"><a href="#cb25-5"></a>  <span class="kw">let</span> sum <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb25-6"><a href="#cb25-6"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> str<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb25-7"><a href="#cb25-7"></a>    sum <span class="op">+=</span> str<span class="op">.</span><span class="fu">charCodeAt</span>(i)<span class="op">;</span></span>
<span id="cb25-8"><a href="#cb25-8"></a>  }</span>
<span id="cb25-9"><a href="#cb25-9"></a>  <span class="cf">return</span> sum<span class="op">;</span></span>
<span id="cb25-10"><a href="#cb25-10"></a>}</span>
<span id="cb25-11"><a href="#cb25-11"></a></span>
<span id="cb25-12"><a href="#cb25-12"></a><span class="co">// Use ID with different seeds for independent assignments</span></span>
<span id="cb25-13"><a href="#cb25-13"></a><span class="kw">let</span> condition_hash <span class="op">=</span> <span class="fu">stringToNumber</span>(participant_id <span class="op">+</span> <span class="st">"_condition"</span>)<span class="op">;</span></span>
<span id="cb25-14"><a href="#cb25-14"></a><span class="kw">let</span> order_hash <span class="op">=</span> <span class="fu">stringToNumber</span>(participant_id <span class="op">+</span> <span class="st">"_order"</span>)<span class="op">;</span></span>
<span id="cb25-15"><a href="#cb25-15"></a></span>
<span id="cb25-16"><a href="#cb25-16"></a><span class="co">// Assign experimental condition (e.g., music vs. no music)</span></span>
<span id="cb25-17"><a href="#cb25-17"></a><span class="kw">let</span> conditions <span class="op">=</span> [<span class="st">"music"</span><span class="op">,</span> <span class="st">"no_music"</span>]<span class="op">;</span></span>
<span id="cb25-18"><a href="#cb25-18"></a><span class="kw">let</span> assigned_condition <span class="op">=</span> conditions[condition_hash <span class="op">%</span> <span class="dv">2</span>]<span class="op">;</span></span>
<span id="cb25-19"><a href="#cb25-19"></a></span>
<span id="cb25-20"><a href="#cb25-20"></a><span class="co">// Assign block order</span></span>
<span id="cb25-21"><a href="#cb25-21"></a><span class="kw">let</span> block_orders <span class="op">=</span> [</span>
<span id="cb25-22"><a href="#cb25-22"></a>  [memory_block<span class="op">,</span> attention_block<span class="op">,</span> reasoning_block]<span class="op">,</span></span>
<span id="cb25-23"><a href="#cb25-23"></a>  [memory_block<span class="op">,</span> reasoning_block<span class="op">,</span> attention_block]<span class="op">,</span></span>
<span id="cb25-24"><a href="#cb25-24"></a>  [attention_block<span class="op">,</span> memory_block<span class="op">,</span> reasoning_block]<span class="op">,</span></span>
<span id="cb25-25"><a href="#cb25-25"></a>  [attention_block<span class="op">,</span> reasoning_block<span class="op">,</span> memory_block]<span class="op">,</span></span>
<span id="cb25-26"><a href="#cb25-26"></a>  [reasoning_block<span class="op">,</span> memory_block<span class="op">,</span> attention_block]<span class="op">,</span></span>
<span id="cb25-27"><a href="#cb25-27"></a>  [reasoning_block<span class="op">,</span> attention_block<span class="op">,</span> memory_block]</span>
<span id="cb25-28"><a href="#cb25-28"></a>]<span class="op">;</span></span>
<span id="cb25-29"><a href="#cb25-29"></a><span class="kw">let</span> assigned_blocks <span class="op">=</span> block_orders[order_hash <span class="op">%</span> block_orders<span class="op">.</span><span class="at">length</span>]<span class="op">;</span></span>
<span id="cb25-30"><a href="#cb25-30"></a></span>
<span id="cb25-31"><a href="#cb25-31"></a><span class="co">// Save assignments to data</span></span>
<span id="cb25-32"><a href="#cb25-32"></a>jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">addProperties</span>({</span>
<span id="cb25-33"><a href="#cb25-33"></a>  <span class="dt">participant_id</span><span class="op">:</span> participant_id<span class="op">,</span></span>
<span id="cb25-34"><a href="#cb25-34"></a>  <span class="dt">condition</span><span class="op">:</span> assigned_condition<span class="op">,</span></span>
<span id="cb25-35"><a href="#cb25-35"></a>  <span class="dt">block_order</span><span class="op">:</span> order_hash <span class="op">%</span> block_orders<span class="op">.</span><span class="at">length</span></span>
<span id="cb25-36"><a href="#cb25-36"></a>})<span class="op">;</span></span>
<span id="cb25-37"><a href="#cb25-37"></a></span>
<span id="cb25-38"><a href="#cb25-38"></a></span>
<span id="cb25-39"><a href="#cb25-39"></a><span class="co">// Add to timeline</span></span>
<span id="cb25-40"><a href="#cb25-40"></a><span class="kw">let</span> all_tasks <span class="op">=</span> {</span>
<span id="cb25-41"><a href="#cb25-41"></a>  <span class="dt">timeline</span><span class="op">:</span> assigned_blocks</span>
<span id="cb25-42"><a href="#cb25-42"></a>}</span>
<span id="cb25-43"><a href="#cb25-43"></a></span>
<span id="cb25-44"><a href="#cb25-44"></a><span class="co">// Run</span></span>
<span id="cb25-45"><a href="#cb25-45"></a>jsPsych<span class="op">.</span><span class="fu">runs</span>([</span>
<span id="cb25-46"><a href="#cb25-46"></a>  welcome<span class="op">,</span></span>
<span id="cb25-47"><a href="#cb25-47"></a>  all_tasks<span class="op">,</span></span>
<span id="cb25-48"><a href="#cb25-48"></a>  debrief</span>
<span id="cb25-49"><a href="#cb25-49"></a>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="key-principles-for-block-order-randomization" class="level3" data-number="22.4.4">
<h3 data-number="22.4.4" class="anchored" data-anchor-id="key-principles-for-block-order-randomization"><span class="header-section-number">22.4.4</span> Key Principles for Block Order Randomization</h3>
<ol type="1">
<li>Store blocks in arrays: Organize your blocks as array elements to enable programmatic reordering</li>
<li>Choose the right randomization method: Use shuffle() or ID-based assignment for between-participant consistency</li>
<li>Create independent assignments: When assigning both condition and block order, use different hash seeds to ensure they’re uncorrelated</li>
<li>Document block orders: Save the block order assignment to your data so you can analyze order effects if needed</li>
<li>Test thoroughly: Verify that all possible block orders work correctly and that randomization produces the expected distribution</li>
</ol>
</section>
</section>
<section id="random-assignment-of-stimuli-to-conditions" class="level2" data-number="22.5">
<h2 data-number="22.5" class="anchored" data-anchor-id="random-assignment-of-stimuli-to-conditions"><span class="header-section-number">22.5</span> Random Assignment of Stimuli to Conditions</h2>
<p>Even within a single participant’s experience, you often need to randomly assign which specific stimuli appear in which conditions. This is particularly important in within-subjects designs, where participants see multiple trials or items.</p>
<p>Consider a word memory experiment where you want to test whether concrete nouns (like “dog” or “table”) are remembered better than abstract nouns (like “truth” or “justice”). You might have 50 concrete nouns and 50 abstract nouns in your stimulus set. But what if, by chance, all your concrete nouns happen to be shorter, more common, or more emotionally charged than your abstract nouns? These differences could drive any effect you observe, rather than the concreteness itself.</p>
<p>The solution is to randomly select which specific words from your larger stimulus pool get shown to each participant, and potentially to randomly assign individual words to conditions when you have stimuli that could plausibly fit into multiple categories.</p>
<p>The key principle is that random stimulus assignment helps control for item-level confounds; characteristics of individual stimuli that might influence your results independent of your experimental manipulation.</p>
<section id="programmatically-generating-timeline_variables" class="level3" data-number="22.5.1">
<h3 data-number="22.5.1" class="anchored" data-anchor-id="programmatically-generating-timeline_variables"><span class="header-section-number">22.5.1</span> Programmatically Generating <code>timeline_variables</code></h3>
<p>In order to understand how we can randomly assign stimuli, it’s worth taking a moment to understanding that the goal, which is to create our <code>timeline_variables</code> array, which is an array of objects <code>{ }</code>, in a programmtic way. That is, we build the array with it’s individual components using JavaScript logic, rather than writing out the array manually.</p>
<p>For instance, let’s say we’re changing the color of the words to see if the color influences response times. If we have 4 words, then we want to randomly assign 2 to be ‘red’ and the other 2 to be ‘green’.</p>
<p>The end result is that we want a <code>timeline_variables</code> array of objects that can be used inside a jsPsych trial, like this:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw">let</span> stims <span class="op">=</span> [</span>
<span id="cb26-2"><a href="#cb26-2"></a>  {<span class="dt">word</span><span class="op">:</span> <span class="st">"house"</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span> <span class="st">"red"</span>}<span class="op">,</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>  {<span class="dt">word</span><span class="op">:</span> <span class="st">"nurse"</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span> <span class="st">"red"</span>}<span class="op">,</span></span>
<span id="cb26-4"><a href="#cb26-4"></a>  {<span class="dt">word</span><span class="op">:</span> <span class="st">"hate"</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span> <span class="st">"blue"</span>}<span class="op">,</span></span>
<span id="cb26-5"><a href="#cb26-5"></a>  {<span class="dt">word</span><span class="op">:</span> <span class="st">"truck"</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span> <span class="st">"blue"</span>}</span>
<span id="cb26-6"><a href="#cb26-6"></a>]</span>
<span id="cb26-7"><a href="#cb26-7"></a></span>
<span id="cb26-8"><a href="#cb26-8"></a><span class="kw">let</span> trials <span class="op">=</span> {</span>
<span id="cb26-9"><a href="#cb26-9"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb26-10"><a href="#cb26-10"></a>  <span class="dt">stimulus</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb26-11"><a href="#cb26-11"></a>    <span class="cf">return</span> <span class="vs">`&lt;p style="color:</span><span class="sc">${</span>jsPsych<span class="op">.</span><span class="fu">evaluateTimelineVariable</span>(<span class="st">"color"</span>)<span class="sc">}</span><span class="vs">"&gt; </span><span class="sc">${</span>jsPsych<span class="op">.</span><span class="fu">evaluateTimelineVariable</span>(<span class="st">"word"</span>)<span class="sc">}</span><span class="vs">&lt;/p&gt;`</span></span>
<span id="cb26-12"><a href="#cb26-12"></a>  }<span class="op">,</span></span>
<span id="cb26-13"><a href="#cb26-13"></a>  <span class="dt">timeline_variables</span><span class="op">:</span> stims</span>
<span id="cb26-14"><a href="#cb26-14"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>But if we’re interested in the effects of color on response time, we want to randomize which words are assigned to each color to control for word-specific effects. For example, “hate” might be a word that people always take longer to respond to because it’s negative. If we make “hate” blue for every participant, we might erroneously conclude that blue words cause people to slow down. Instead, we want about half the participants to see “hate” in blue and the other half in red, so that the effect of “hate” is averaged out across both color conditions across participants.</p>
<section id="building-arrays-programmatically" class="level4" data-number="22.5.1.1">
<h4 data-number="22.5.1.1" class="anchored" data-anchor-id="building-arrays-programmatically"><span class="header-section-number">22.5.1.1</span> Building Arrays Programmatically</h4>
<p>To accomplish random assignment, we need to work backwards. We need to decide on the array structure we want to end up with, separate out the parts, and put them back together. Here’s how we can recreate the same array programmatically:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb27-1"><a href="#cb27-1"></a><span class="co">// Goal: recreate this array of objects</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="co">// let stims = [</span></span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="co">//  {word: "house", color: "red"},</span></span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="co">//  {word: "nurse", color: "red"},</span></span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="co">//  {word: "hate", color: "blue"},</span></span>
<span id="cb27-6"><a href="#cb27-6"></a><span class="co">//  {word: "truck", color: "blue"}</span></span>
<span id="cb27-7"><a href="#cb27-7"></a><span class="co">// ]</span></span>
<span id="cb27-8"><a href="#cb27-8"></a></span>
<span id="cb27-9"><a href="#cb27-9"></a><span class="co">// Step 1: Separate out the parts</span></span>
<span id="cb27-10"><a href="#cb27-10"></a><span class="kw">let</span> words <span class="op">=</span> [<span class="st">"house"</span><span class="op">,</span> <span class="st">"nurse"</span><span class="op">,</span> <span class="st">"hate"</span><span class="op">,</span> <span class="st">"truck"</span>]</span>
<span id="cb27-11"><a href="#cb27-11"></a><span class="kw">let</span> colors <span class="op">=</span> [<span class="st">"red"</span><span class="op">,</span> <span class="st">"red"</span><span class="op">,</span> <span class="st">"blue"</span><span class="op">,</span> <span class="st">"blue"</span>]</span>
<span id="cb27-12"><a href="#cb27-12"></a></span>
<span id="cb27-13"><a href="#cb27-13"></a><span class="co">// Step 2: Use a loop to create each object and add them to an array</span></span>
<span id="cb27-14"><a href="#cb27-14"></a><span class="kw">let</span> stims <span class="op">=</span> []</span>
<span id="cb27-15"><a href="#cb27-15"></a><span class="cf">for</span>(i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> words<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>){</span>
<span id="cb27-16"><a href="#cb27-16"></a>  <span class="kw">let</span> combo <span class="op">=</span> {</span>
<span id="cb27-17"><a href="#cb27-17"></a>    <span class="dt">word</span><span class="op">:</span> words[i]<span class="op">,</span> </span>
<span id="cb27-18"><a href="#cb27-18"></a>    <span class="dt">color</span><span class="op">:</span> colors[i]</span>
<span id="cb27-19"><a href="#cb27-19"></a>    }</span>
<span id="cb27-20"><a href="#cb27-20"></a>    </span>
<span id="cb27-21"><a href="#cb27-21"></a>  stims<span class="op">.</span><span class="fu">push</span>(combo)</span>
<span id="cb27-22"><a href="#cb27-22"></a>}</span>
<span id="cb27-23"><a href="#cb27-23"></a></span>
<span id="cb27-24"><a href="#cb27-24"></a><span class="co">// Step 3: Use the programmatically created array</span></span>
<span id="cb27-25"><a href="#cb27-25"></a><span class="kw">let</span> trials <span class="op">=</span> {</span>
<span id="cb27-26"><a href="#cb27-26"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb27-27"><a href="#cb27-27"></a>  <span class="dt">stimulus</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb27-28"><a href="#cb27-28"></a>    <span class="cf">return</span> <span class="vs">`&lt;p style="color:</span><span class="sc">${</span>jsPsych<span class="op">.</span><span class="fu">evaluateTimelineVariable</span>(<span class="st">"color"</span>)<span class="sc">}</span><span class="vs">"&gt; </span><span class="sc">${</span>jsPsych<span class="op">.</span><span class="fu">evaluateTimelineVariable</span>(<span class="st">"word"</span>)<span class="sc">}</span><span class="vs">&lt;/p&gt;`</span></span>
<span id="cb27-29"><a href="#cb27-29"></a>  }<span class="op">,</span></span>
<span id="cb27-30"><a href="#cb27-30"></a>  <span class="dt">timeline_variables</span><span class="op">:</span> stims</span>
<span id="cb27-31"><a href="#cb27-31"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This code produces exactly the same result as writing the array manually, but now we have the flexibility to modify it programmatically.</p>
</section>
<section id="adding-randomization" class="level4" data-number="22.5.1.2">
<h4 data-number="22.5.1.2" class="anchored" data-anchor-id="adding-randomization"><span class="header-section-number">22.5.1.2</span> Adding Randomization</h4>
<p>Once we understand how to recreate the <code>timeline_variables</code> array programmatically, we can add randomization:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb28-1"><a href="#cb28-1"></a><span class="co">// Goal: Create the same array structure BUT with random word-color pairings</span></span>
<span id="cb28-2"><a href="#cb28-2"></a></span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="co">// Step 1: Separate out the parts</span></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="kw">let</span> words <span class="op">=</span> [<span class="st">"house"</span><span class="op">,</span> <span class="st">"nurse"</span><span class="op">,</span> <span class="st">"hate"</span><span class="op">,</span> <span class="st">"truck"</span>]</span>
<span id="cb28-5"><a href="#cb28-5"></a><span class="kw">let</span> colors <span class="op">=</span> [<span class="st">"red"</span><span class="op">,</span> <span class="st">"red"</span><span class="op">,</span> <span class="st">"blue"</span><span class="op">,</span> <span class="st">"blue"</span>]</span>
<span id="cb28-6"><a href="#cb28-6"></a></span>
<span id="cb28-7"><a href="#cb28-7"></a><span class="co">// Step 2: Randomize the order of words!</span></span>
<span id="cb28-8"><a href="#cb28-8"></a>words <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">randomization</span><span class="op">.</span><span class="fu">shuffle</span>(words)</span>
<span id="cb28-9"><a href="#cb28-9"></a></span>
<span id="cb28-10"><a href="#cb28-10"></a><span class="co">// Step 3: Use a loop to pair each word with a color</span></span>
<span id="cb28-11"><a href="#cb28-11"></a><span class="kw">let</span> stims <span class="op">=</span> []</span>
<span id="cb28-12"><a href="#cb28-12"></a><span class="cf">for</span>(i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> words<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>){</span>
<span id="cb28-13"><a href="#cb28-13"></a>  <span class="kw">let</span> combo <span class="op">=</span> {</span>
<span id="cb28-14"><a href="#cb28-14"></a>    <span class="dt">word</span><span class="op">:</span> words[i]<span class="op">,</span> </span>
<span id="cb28-15"><a href="#cb28-15"></a>    <span class="dt">color</span><span class="op">:</span> colors[i]</span>
<span id="cb28-16"><a href="#cb28-16"></a>    }</span>
<span id="cb28-17"><a href="#cb28-17"></a>    </span>
<span id="cb28-18"><a href="#cb28-18"></a>  stims<span class="op">.</span><span class="fu">push</span>(combo)</span>
<span id="cb28-19"><a href="#cb28-19"></a>}</span>
<span id="cb28-20"><a href="#cb28-20"></a></span>
<span id="cb28-21"><a href="#cb28-21"></a><span class="co">// One possible result:</span></span>
<span id="cb28-22"><a href="#cb28-22"></a><span class="co">// Array(4) [ {…}, {…}, {…}, {…} ]</span></span>
<span id="cb28-23"><a href="#cb28-23"></a><span class="co">// 0: Object { word: "hate", color: "red" }</span></span>
<span id="cb28-24"><a href="#cb28-24"></a><span class="co">// 1: Object { word: "house", color: "red" }</span></span>
<span id="cb28-25"><a href="#cb28-25"></a><span class="co">// 2: Object { word: "truck", color: "blue" }</span></span>
<span id="cb28-26"><a href="#cb28-26"></a><span class="co">// 3: Object { word: "nurs", color: "blue" }</span></span>
<span id="cb28-27"><a href="#cb28-27"></a></span>
<span id="cb28-28"><a href="#cb28-28"></a></span>
<span id="cb28-29"><a href="#cb28-29"></a><span class="co">// Step 4: Use the programmatically created array</span></span>
<span id="cb28-30"><a href="#cb28-30"></a><span class="kw">let</span> trials <span class="op">=</span> {</span>
<span id="cb28-31"><a href="#cb28-31"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb28-32"><a href="#cb28-32"></a>  <span class="dt">stimulus</span><span class="op">:</span> <span class="kw">function</span>(){</span>
<span id="cb28-33"><a href="#cb28-33"></a>    <span class="cf">return</span> <span class="vs">`&lt;p style="color:</span><span class="sc">${</span>jsPsych<span class="op">.</span><span class="fu">evaluateTimelineVariable</span>(<span class="st">"color"</span>)<span class="sc">}</span><span class="vs">"&gt; </span><span class="sc">${</span>jsPsych<span class="op">.</span><span class="fu">evaluateTimelineVariable</span>(<span class="st">"word"</span>)<span class="sc">}</span><span class="vs">&lt;/p&gt;`</span></span>
<span id="cb28-34"><a href="#cb28-34"></a>  }<span class="op">,</span></span>
<span id="cb28-35"><a href="#cb28-35"></a>  <span class="dt">timeline_variables</span><span class="op">:</span> stims</span>
<span id="cb28-36"><a href="#cb28-36"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By shuffling the <code>words</code> array before pairing it with the <code>colors</code> array, each participant gets a different random assignment of words to colors. The first two words (whatever they happen to be after shuffling) will be red, and the last two will be blue.</p>
<p>To accomplish these randomization goals, we’ll need to make use of common JavaScript array methods and jsPsych’s built-in randomization functions. JavaScript provides powerful array methods like <code>.slice()</code>, <code>.concat()</code>, <code>.push()</code>, and <code>.filter()</code> that allow us to manipulate arrays in flexible ways (see the Appendix for a reference guide to these methods). jsPsych provides specialized randomization functions like <code>jsPsych.randomization.shuffle()</code> and <code>jsPsych.randomization.sampleWithoutReplacement()</code> that are specifically designed for experimental randomization needs (see the <a href="https://www.jspsych.org/latest/reference/jspsych-randomization/#jspsychrandomization" class="external" target="_blank">jsPsych randomization documentation</a> for a complete list). By combining these tools, we can implement sophisticated stimulus assignment schemes that meet the specific needs of our experimental designs.</p>
</section>
</section>
<section id="example-1-randomly-select-a-subset-of-stimuli-and-assign-to-conditions" class="level3" data-number="22.5.2">
<h3 data-number="22.5.2" class="anchored" data-anchor-id="example-1-randomly-select-a-subset-of-stimuli-and-assign-to-conditions"><span class="header-section-number">22.5.2</span> Example 1: Randomly Select a Subset of Stimuli and Assign to Conditions</h3>
<p>Often you have a large pool of stimuli but only want to use a subset for each participant. This helps ensure that any effects you observe aren’t driven by the specific items you happened to choose.</p>
<p>Let’s say you have 20 words but only want to show 8 of them, 4 in red and 4 in blue:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb29-1"><a href="#cb29-1"></a><span class="co">// Large pool of possible words</span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="kw">let</span> word_pool <span class="op">=</span> [</span>
<span id="cb29-3"><a href="#cb29-3"></a>  <span class="st">"house"</span><span class="op">,</span> <span class="st">"nurse"</span><span class="op">,</span> <span class="st">"hate"</span><span class="op">,</span> <span class="st">"truck"</span><span class="op">,</span> <span class="st">"table"</span><span class="op">,</span> <span class="st">"chair"</span><span class="op">,</span> </span>
<span id="cb29-4"><a href="#cb29-4"></a>  <span class="st">"love"</span><span class="op">,</span> <span class="st">"anger"</span><span class="op">,</span> <span class="st">"peace"</span><span class="op">,</span> <span class="st">"storm"</span><span class="op">,</span> <span class="st">"garden"</span><span class="op">,</span> <span class="st">"window"</span><span class="op">,</span></span>
<span id="cb29-5"><a href="#cb29-5"></a>  <span class="st">"friend"</span><span class="op">,</span> <span class="st">"enemy"</span><span class="op">,</span> <span class="st">"light"</span><span class="op">,</span> <span class="st">"shadow"</span><span class="op">,</span> <span class="st">"music"</span><span class="op">,</span> <span class="st">"silence"</span><span class="op">,</span></span>
<span id="cb29-6"><a href="#cb29-6"></a>  <span class="st">"hope"</span><span class="op">,</span> <span class="st">"fear"</span></span>
<span id="cb29-7"><a href="#cb29-7"></a>]<span class="op">;</span></span>
<span id="cb29-8"><a href="#cb29-8"></a></span>
<span id="cb29-9"><a href="#cb29-9"></a><span class="co">// Randomly select 8 words from the pool</span></span>
<span id="cb29-10"><a href="#cb29-10"></a><span class="kw">let</span> selected_words <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">randomization</span><span class="op">.</span><span class="fu">sampleWithoutReplacement</span>(word_pool<span class="op">,</span> <span class="dv">8</span>)<span class="op">;</span></span>
<span id="cb29-11"><a href="#cb29-11"></a></span>
<span id="cb29-12"><a href="#cb29-12"></a><span class="co">// Create color assignments (4 red, 4 blue)</span></span>
<span id="cb29-13"><a href="#cb29-13"></a><span class="kw">let</span> colors <span class="op">=</span> [<span class="st">"red"</span><span class="op">,</span> <span class="st">"red"</span><span class="op">,</span> <span class="st">"red"</span><span class="op">,</span> <span class="st">"red"</span><span class="op">,</span> <span class="st">"blue"</span><span class="op">,</span> <span class="st">"blue"</span><span class="op">,</span> <span class="st">"blue"</span><span class="op">,</span> <span class="st">"blue"</span>]<span class="op">;</span></span>
<span id="cb29-14"><a href="#cb29-14"></a></span>
<span id="cb29-15"><a href="#cb29-15"></a><span class="co">// Shuffle the words so they're randomly paired with colors</span></span>
<span id="cb29-16"><a href="#cb29-16"></a>selected_words <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">randomization</span><span class="op">.</span><span class="fu">shuffle</span>(selected_words)<span class="op">;</span></span>
<span id="cb29-17"><a href="#cb29-17"></a></span>
<span id="cb29-18"><a href="#cb29-18"></a><span class="co">// Build the timeline_variables array</span></span>
<span id="cb29-19"><a href="#cb29-19"></a><span class="kw">let</span> stims <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb29-20"><a href="#cb29-20"></a><span class="cf">for</span>(<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> selected_words<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>){</span>
<span id="cb29-21"><a href="#cb29-21"></a>  stims<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb29-22"><a href="#cb29-22"></a>    <span class="dt">word</span><span class="op">:</span> selected_words[i]<span class="op">,</span></span>
<span id="cb29-23"><a href="#cb29-23"></a>    <span class="dt">color</span><span class="op">:</span> colors[i]</span>
<span id="cb29-24"><a href="#cb29-24"></a>  })<span class="op">;</span></span>
<span id="cb29-25"><a href="#cb29-25"></a>}</span>
<span id="cb29-26"><a href="#cb29-26"></a></span>
<span id="cb29-27"><a href="#cb29-27"></a><span class="co">// Result: 8 randomly selected words, with 4 randomly assigned to red and 4 to blue</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This approach ensures that:</p>
<ol type="1">
<li>Each participant sees a different random subset of words</li>
<li>Words are randomly assigned to color conditions</li>
<li>You maintain equal numbers in each condition</li>
</ol>
</section>
<section id="example-2-randomly-assign-stimuli-to-old-and-new-lists" class="level3" data-number="22.5.3">
<h3 data-number="22.5.3" class="anchored" data-anchor-id="example-2-randomly-assign-stimuli-to-old-and-new-lists"><span class="header-section-number">22.5.3</span> Example 2: Randomly Assign Stimuli to “Old” and “New” Lists</h3>
<p>In recognition memory experiments, you typically show participants a study list of items, then test them with both old items (from the study list) and new items (not previously seen). You want to randomly determine which items serve which role.</p>
<p>Keep in mind, we’ll actually need two <code>timeline_variables</code> for this example. We need a <code>timeline_variables</code> array that will only have the old words for the study phase, and a second <code>timeline_variables</code> array that will have both the old and the new words for the testing phase.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb30-1"><a href="#cb30-1"></a><span class="co">// Pool of 20 words</span></span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="kw">let</span> word_pool <span class="op">=</span> [</span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="st">"house"</span><span class="op">,</span> <span class="st">"nurse"</span><span class="op">,</span> <span class="st">"hate"</span><span class="op">,</span> <span class="st">"truck"</span><span class="op">,</span> <span class="st">"table"</span><span class="op">,</span> <span class="st">"chair"</span><span class="op">,</span> </span>
<span id="cb30-4"><a href="#cb30-4"></a>  <span class="st">"love"</span><span class="op">,</span> <span class="st">"anger"</span><span class="op">,</span> <span class="st">"peace"</span><span class="op">,</span> <span class="st">"storm"</span><span class="op">,</span> <span class="st">"garden"</span><span class="op">,</span> <span class="st">"window"</span><span class="op">,</span></span>
<span id="cb30-5"><a href="#cb30-5"></a>  <span class="st">"friend"</span><span class="op">,</span> <span class="st">"enemy"</span><span class="op">,</span> <span class="st">"light"</span><span class="op">,</span> <span class="st">"shadow"</span><span class="op">,</span> <span class="st">"music"</span><span class="op">,</span> <span class="st">"silence"</span><span class="op">,</span></span>
<span id="cb30-6"><a href="#cb30-6"></a>  <span class="st">"hope"</span><span class="op">,</span> <span class="st">"fear"</span></span>
<span id="cb30-7"><a href="#cb30-7"></a>]<span class="op">;</span></span>
<span id="cb30-8"><a href="#cb30-8"></a></span>
<span id="cb30-9"><a href="#cb30-9"></a><span class="co">// Randomly shuffle the pool</span></span>
<span id="cb30-10"><a href="#cb30-10"></a><span class="kw">let</span> shuffled_words <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">randomization</span><span class="op">.</span><span class="fu">shuffle</span>(word_pool)<span class="op">;</span></span>
<span id="cb30-11"><a href="#cb30-11"></a></span>
<span id="cb30-12"><a href="#cb30-12"></a><span class="co">// First 10 words will be "old" (studied), last 10 will be "new" (not studied)</span></span>
<span id="cb30-13"><a href="#cb30-13"></a><span class="kw">let</span> old_words <span class="op">=</span> shuffled_words<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb30-14"><a href="#cb30-14"></a><span class="kw">let</span> new_words <span class="op">=</span> shuffled_words<span class="op">.</span><span class="fu">slice</span>(<span class="dv">10</span><span class="op">,</span> <span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb30-15"><a href="#cb30-15"></a></span>
<span id="cb30-16"><a href="#cb30-16"></a><span class="co">// Create study phase timeline_variables (only old words)</span></span>
<span id="cb30-17"><a href="#cb30-17"></a><span class="kw">let</span> study_stims <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb30-18"><a href="#cb30-18"></a><span class="cf">for</span>(<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> old_words<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>){</span>
<span id="cb30-19"><a href="#cb30-19"></a>  study_stims<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb30-20"><a href="#cb30-20"></a>    <span class="dt">word</span><span class="op">:</span> old_words[i]<span class="op">,</span></span>
<span id="cb30-21"><a href="#cb30-21"></a>    <span class="dt">item_type</span><span class="op">:</span> <span class="st">"study"</span></span>
<span id="cb30-22"><a href="#cb30-22"></a>  })<span class="op">;</span></span>
<span id="cb30-23"><a href="#cb30-23"></a>}</span>
<span id="cb30-24"><a href="#cb30-24"></a></span>
<span id="cb30-25"><a href="#cb30-25"></a><span class="co">// Create test phase timeline_variables (both old and new words)</span></span>
<span id="cb30-26"><a href="#cb30-26"></a><span class="kw">let</span> test_stims <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb30-27"><a href="#cb30-27"></a></span>
<span id="cb30-28"><a href="#cb30-28"></a><span class="co">// Add old words</span></span>
<span id="cb30-29"><a href="#cb30-29"></a><span class="cf">for</span>(<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> old_words<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>){</span>
<span id="cb30-30"><a href="#cb30-30"></a>  test_stims<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb30-31"><a href="#cb30-31"></a>    <span class="dt">word</span><span class="op">:</span> old_words[i]<span class="op">,</span></span>
<span id="cb30-32"><a href="#cb30-32"></a>    <span class="dt">correct_response</span><span class="op">:</span> <span class="st">"old"</span></span>
<span id="cb30-33"><a href="#cb30-33"></a>  })<span class="op">;</span></span>
<span id="cb30-34"><a href="#cb30-34"></a>}</span>
<span id="cb30-35"><a href="#cb30-35"></a></span>
<span id="cb30-36"><a href="#cb30-36"></a><span class="co">// Add new words</span></span>
<span id="cb30-37"><a href="#cb30-37"></a><span class="cf">for</span>(<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> new_words<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>){</span>
<span id="cb30-38"><a href="#cb30-38"></a>  test_stims<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb30-39"><a href="#cb30-39"></a>    <span class="dt">word</span><span class="op">:</span> new_words[i]<span class="op">,</span></span>
<span id="cb30-40"><a href="#cb30-40"></a>    <span class="dt">correct_response</span><span class="op">:</span> <span class="st">"new"</span></span>
<span id="cb30-41"><a href="#cb30-41"></a>  })<span class="op">;</span></span>
<span id="cb30-42"><a href="#cb30-42"></a>}</span>
<span id="cb30-43"><a href="#cb30-43"></a></span>
<span id="cb30-44"><a href="#cb30-44"></a><span class="co">// Shuffle test items so old and new are intermixed</span></span>
<span id="cb30-45"><a href="#cb30-45"></a>test_stims <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">randomization</span><span class="op">.</span><span class="fu">shuffle</span>(test_stims)<span class="op">;</span></span>
<span id="cb30-46"><a href="#cb30-46"></a></span>
<span id="cb30-47"><a href="#cb30-47"></a><span class="co">// Now use study_stims for the study phase and test_stims for the test phase</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="example-3-random-pairing-of-stimuli" class="level3" data-number="22.5.4">
<h3 data-number="22.5.4" class="anchored" data-anchor-id="example-3-random-pairing-of-stimuli"><span class="header-section-number">22.5.4</span> Example 3: Random Pairing of Stimuli</h3>
<p>In many experiments, you need to create random associations between two sets of stimuli. For instance, in a face-name learning task, you might want to randomly pair faces with names so that each participant learns different associations. This controls for the possibility that certain faces are easier to associate with certain names.</p>
<p>Let’s create a simple associative learning task where participants learn which object goes with which location:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb31-1"><a href="#cb31-1"></a><span class="co">// Two sets of stimuli to pair</span></span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="kw">let</span> objects <span class="op">=</span> [<span class="st">"apple"</span><span class="op">,</span> <span class="st">"book"</span><span class="op">,</span> <span class="st">"clock"</span><span class="op">,</span> <span class="st">"lamp"</span><span class="op">,</span> <span class="st">"phone"</span><span class="op">,</span> <span class="st">"plant"</span>]<span class="op">;</span></span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="kw">let</span> locations <span class="op">=</span> [<span class="st">"kitchen"</span><span class="op">,</span> <span class="st">"bedroom"</span><span class="op">,</span> <span class="st">"office"</span><span class="op">,</span> <span class="st">"garage"</span><span class="op">,</span> <span class="st">"bathroom"</span><span class="op">,</span> <span class="st">"garden"</span>]<span class="op">;</span></span>
<span id="cb31-4"><a href="#cb31-4"></a></span>
<span id="cb31-5"><a href="#cb31-5"></a><span class="co">// Shuffle one of the arrays (or both, but shuffling one is sufficient)</span></span>
<span id="cb31-6"><a href="#cb31-6"></a><span class="kw">let</span> shuffled_locations <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">randomization</span><span class="op">.</span><span class="fu">shuffle</span>(locations)<span class="op">;</span></span>
<span id="cb31-7"><a href="#cb31-7"></a></span>
<span id="cb31-8"><a href="#cb31-8"></a><span class="co">// Pair them up by matching indices</span></span>
<span id="cb31-9"><a href="#cb31-9"></a><span class="kw">let</span> study_pairs <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb31-10"><a href="#cb31-10"></a><span class="cf">for</span>(<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> objects<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>){</span>
<span id="cb31-11"><a href="#cb31-11"></a>  study_pairs<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb31-12"><a href="#cb31-12"></a>    <span class="dt">object</span><span class="op">:</span> objects[i]<span class="op">,</span></span>
<span id="cb31-13"><a href="#cb31-13"></a>    <span class="dt">location</span><span class="op">:</span> shuffled_locations[i]<span class="op">,</span></span>
<span id="cb31-14"><a href="#cb31-14"></a>    <span class="dt">phase</span><span class="op">:</span> <span class="st">"study"</span></span>
<span id="cb31-15"><a href="#cb31-15"></a>  })<span class="op">;</span></span>
<span id="cb31-16"><a href="#cb31-16"></a>}</span>
<span id="cb31-17"><a href="#cb31-17"></a></span>
<span id="cb31-18"><a href="#cb31-18"></a><span class="co">// Result might be:</span></span>
<span id="cb31-19"><a href="#cb31-19"></a><span class="co">// [</span></span>
<span id="cb31-20"><a href="#cb31-20"></a><span class="co">//   {object: "apple", location: "garage", phase: "study"},</span></span>
<span id="cb31-21"><a href="#cb31-21"></a><span class="co">//   {object: "book", location: "kitchen", phase: "study"},</span></span>
<span id="cb31-22"><a href="#cb31-22"></a><span class="co">//   {object: "clock", location: "bathroom", phase: "study"},</span></span>
<span id="cb31-23"><a href="#cb31-23"></a><span class="co">//   ...</span></span>
<span id="cb31-24"><a href="#cb31-24"></a><span class="co">// ]</span></span>
<span id="cb31-25"><a href="#cb31-25"></a></span>
<span id="cb31-26"><a href="#cb31-26"></a><span class="co">// Verify the pairings</span></span>
<span id="cb31-27"><a href="#cb31-27"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"Object-Location Pairings:"</span>)<span class="op">;</span></span>
<span id="cb31-28"><a href="#cb31-28"></a>study_pairs<span class="op">.</span><span class="fu">forEach</span>(pair <span class="kw">=&gt;</span> {</span>
<span id="cb31-29"><a href="#cb31-29"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`</span><span class="sc">${</span>pair<span class="op">.</span><span class="at">object</span><span class="sc">}</span><span class="vs"> -&gt; </span><span class="sc">${</span>pair<span class="op">.</span><span class="at">location</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb31-30"><a href="#cb31-30"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="example-4-balanced-random-assignment-with-constraints" class="level3" data-number="22.5.5">
<h3 data-number="22.5.5" class="anchored" data-anchor-id="example-4-balanced-random-assignment-with-constraints"><span class="header-section-number">22.5.5</span> Example 4: Balanced Random Assignment with Constraints</h3>
<p>Sometimes you need random assignment but with specific constraints. For example, you might want to ensure that certain types of stimuli are evenly distributed across conditions.</p>
<p>Let’s say you have positive and negative words, and you want to ensure each color condition has an equal mix of both:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb32-1"><a href="#cb32-1"></a><span class="co">// Separate pools for positive and negative words</span></span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="kw">let</span> positive_words <span class="op">=</span> [<span class="st">"love"</span><span class="op">,</span> <span class="st">"peace"</span><span class="op">,</span> <span class="st">"hope"</span><span class="op">,</span> <span class="st">"friend"</span><span class="op">,</span> <span class="st">"light"</span><span class="op">,</span> <span class="st">"music"</span>]<span class="op">;</span></span>
<span id="cb32-3"><a href="#cb32-3"></a><span class="kw">let</span> negative_words <span class="op">=</span> [<span class="st">"hate"</span><span class="op">,</span> <span class="st">"anger"</span><span class="op">,</span> <span class="st">"fear"</span><span class="op">,</span> <span class="st">"enemy"</span><span class="op">,</span> <span class="st">"shadow"</span><span class="op">,</span> <span class="st">"silence"</span>]<span class="op">;</span></span>
<span id="cb32-4"><a href="#cb32-4"></a></span>
<span id="cb32-5"><a href="#cb32-5"></a><span class="co">// Shuffle each pool</span></span>
<span id="cb32-6"><a href="#cb32-6"></a>positive_words <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">randomization</span><span class="op">.</span><span class="fu">shuffle</span>(positive_words)<span class="op">;</span></span>
<span id="cb32-7"><a href="#cb32-7"></a>negative_words <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">randomization</span><span class="op">.</span><span class="fu">shuffle</span>(negative_words)<span class="op">;</span></span>
<span id="cb32-8"><a href="#cb32-8"></a></span>
<span id="cb32-9"><a href="#cb32-9"></a><span class="co">// Take 2 positive and 2 negative for red condition</span></span>
<span id="cb32-10"><a href="#cb32-10"></a><span class="kw">let</span> red_words <span class="op">=</span> positive_words<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span>)<span class="op">.</span><span class="fu">concat</span>(negative_words<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span>))<span class="op">;</span></span>
<span id="cb32-11"><a href="#cb32-11"></a></span>
<span id="cb32-12"><a href="#cb32-12"></a><span class="co">// Take 2 positive and 2 negative for blue condition</span></span>
<span id="cb32-13"><a href="#cb32-13"></a><span class="kw">let</span> blue_words <span class="op">=</span> positive_words<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">4</span>)<span class="op">.</span><span class="fu">concat</span>(negative_words<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">4</span>))<span class="op">;</span></span>
<span id="cb32-14"><a href="#cb32-14"></a></span>
<span id="cb32-15"><a href="#cb32-15"></a><span class="co">// Shuffle within each condition so positive/negative are intermixed</span></span>
<span id="cb32-16"><a href="#cb32-16"></a>red_words <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">randomization</span><span class="op">.</span><span class="fu">shuffle</span>(red_words)<span class="op">;</span></span>
<span id="cb32-17"><a href="#cb32-17"></a>blue_words <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">randomization</span><span class="op">.</span><span class="fu">shuffle</span>(blue_words)<span class="op">;</span></span>
<span id="cb32-18"><a href="#cb32-18"></a></span>
<span id="cb32-19"><a href="#cb32-19"></a><span class="co">// Build timeline_variables with proper labels</span></span>
<span id="cb32-20"><a href="#cb32-20"></a><span class="kw">let</span> stims <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb32-21"><a href="#cb32-21"></a></span>
<span id="cb32-22"><a href="#cb32-22"></a><span class="cf">for</span>(<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> red_words<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>){</span>
<span id="cb32-23"><a href="#cb32-23"></a>  <span class="co">// Check if word is positive or negative</span></span>
<span id="cb32-24"><a href="#cb32-24"></a>  <span class="kw">let</span> valence <span class="op">=</span> positive_words<span class="op">.</span><span class="fu">includes</span>(red_words[i]) <span class="op">?</span> <span class="st">"positive"</span> <span class="op">:</span> <span class="st">"negative"</span><span class="op">;</span></span>
<span id="cb32-25"><a href="#cb32-25"></a></span>
<span id="cb32-26"><a href="#cb32-26"></a>  stims<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb32-27"><a href="#cb32-27"></a>    <span class="dt">word</span><span class="op">:</span> red_words[i]<span class="op">,</span></span>
<span id="cb32-28"><a href="#cb32-28"></a>    <span class="dt">color</span><span class="op">:</span> <span class="st">"red"</span><span class="op">,</span></span>
<span id="cb32-29"><a href="#cb32-29"></a>    <span class="dt">valence</span><span class="op">:</span> valence</span>
<span id="cb32-30"><a href="#cb32-30"></a>  })<span class="op">;</span></span>
<span id="cb32-31"><a href="#cb32-31"></a>}</span>
<span id="cb32-32"><a href="#cb32-32"></a></span>
<span id="cb32-33"><a href="#cb32-33"></a><span class="cf">for</span>(<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> blue_words<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>){</span>
<span id="cb32-34"><a href="#cb32-34"></a>  <span class="co">// Check if word is positive or negative</span></span>
<span id="cb32-35"><a href="#cb32-35"></a>  <span class="kw">let</span> valence <span class="op">=</span> positive_words<span class="op">.</span><span class="fu">includes</span>(blue_words[i]) <span class="op">?</span> <span class="st">"positive"</span> <span class="op">:</span> <span class="st">"negative"</span><span class="op">;</span></span>
<span id="cb32-36"><a href="#cb32-36"></a></span>
<span id="cb32-37"><a href="#cb32-37"></a>  stims<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb32-38"><a href="#cb32-38"></a>    <span class="dt">word</span><span class="op">:</span> blue_words[i]<span class="op">,</span></span>
<span id="cb32-39"><a href="#cb32-39"></a>    <span class="dt">color</span><span class="op">:</span> <span class="st">"blue"</span><span class="op">,</span></span>
<span id="cb32-40"><a href="#cb32-40"></a>    <span class="dt">valence</span><span class="op">:</span> valence</span>
<span id="cb32-41"><a href="#cb32-41"></a>  })<span class="op">;</span></span>
<span id="cb32-42"><a href="#cb32-42"></a>}</span>
<span id="cb32-43"><a href="#cb32-43"></a></span>
<span id="cb32-44"><a href="#cb32-44"></a><span class="co">// Final shuffle so red and blue trials are intermixed</span></span>
<span id="cb32-45"><a href="#cb32-45"></a>stims <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">randomization</span><span class="op">.</span><span class="fu">shuffle</span>(stims)<span class="op">;</span></span>
<span id="cb32-46"><a href="#cb32-46"></a></span>
<span id="cb32-47"><a href="#cb32-47"></a><span class="co">// Result: Each color has 2 positive and 2 negative words, randomly selected and assigned</span></span>
<span id="cb32-48"><a href="#cb32-48"></a><span class="co">// Each stimulus object now includes: word, color, and valence labels</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This approach ensures that your conditions are balanced on an important stimulus dimension (valence) while still maintaining randomization. By including the <code>valence</code> label in each stimulus object, you can later analyze your data by valence (e.g., to check whether positive words were responded to faster than negative words) or verify that the balancing worked correctly.</p>
</section>
<section id="verifying-your-randomization" class="level3" data-number="22.5.6">
<h3 data-number="22.5.6" class="anchored" data-anchor-id="verifying-your-randomization"><span class="header-section-number">22.5.6</span> Verifying Your Randomization</h3>
<p>When implementing complex stimulus assignment procedures, it’s important to verify that your code is working as intended before running participants. JavaScript’s <code>console.log()</code> function is invaluable for this purpose, allowing you to inspect your arrays at different stages of construction.</p>
<section id="basic-verification-with-console.log" class="level4" data-number="22.5.6.1">
<h4 data-number="22.5.6.1" class="anchored" data-anchor-id="basic-verification-with-console.log"><span class="header-section-number">22.5.6.1</span> Basic Verification with <code>console.log()</code></h4>
<p>The simplest approach is to print your timeline_variables array to the console:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb33-1"><a href="#cb33-1"></a><span class="co">// After building your stims array</span></span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(stims)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This will display the entire array in your browser’s developer console (usually accessible by pressing F12). You can expand the array to inspect individual objects and verify that:</p>
<ol type="1">
<li>Words are assigned to the correct conditions</li>
<li>The number of trials matches your expectations</li>
<li>All required properties are present in each object</li>
</ol>
<p>Using <code>console.log()</code>, you can refresh the page a few times to see how the assignments are changing.</p>
</section>
<section id="counting-assignments" class="level4" data-number="22.5.6.2">
<h4 data-number="22.5.6.2" class="anchored" data-anchor-id="counting-assignments"><span class="header-section-number">22.5.6.2</span> Counting Assignments</h4>
<p>For more complex designs, you might want to verify that your randomization maintains the intended balance. Here’s how to count how many stimuli fall into each condition:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb34-1"><a href="#cb34-1"></a><span class="co">// Count stimuli by color</span></span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="kw">let</span> red_count <span class="op">=</span> stims<span class="op">.</span><span class="fu">filter</span>(s <span class="kw">=&gt;</span> s<span class="op">.</span><span class="at">color</span> <span class="op">===</span> <span class="st">"red"</span>)<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="kw">let</span> blue_count <span class="op">=</span> stims<span class="op">.</span><span class="fu">filter</span>(s <span class="kw">=&gt;</span> s<span class="op">.</span><span class="at">color</span> <span class="op">===</span> <span class="st">"blue"</span>)<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb34-4"><a href="#cb34-4"></a></span>
<span id="cb34-5"><a href="#cb34-5"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"Red trials:"</span><span class="op">,</span> red_count)<span class="op">;</span></span>
<span id="cb34-6"><a href="#cb34-6"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"Blue trials:"</span><span class="op">,</span> blue_count)<span class="op">;</span></span>
<span id="cb34-7"><a href="#cb34-7"></a></span>
<span id="cb34-8"><a href="#cb34-8"></a><span class="co">// For Example 3, also count by valence within each color</span></span>
<span id="cb34-9"><a href="#cb34-9"></a><span class="kw">let</span> red_positive <span class="op">=</span> stims<span class="op">.</span><span class="fu">filter</span>(s <span class="kw">=&gt;</span> s<span class="op">.</span><span class="at">color</span> <span class="op">===</span> <span class="st">"red"</span> <span class="op">&amp;&amp;</span> s<span class="op">.</span><span class="at">valence</span> <span class="op">===</span> <span class="st">"positive"</span>)<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb34-10"><a href="#cb34-10"></a><span class="kw">let</span> red_negative <span class="op">=</span> stims<span class="op">.</span><span class="fu">filter</span>(s <span class="kw">=&gt;</span> s<span class="op">.</span><span class="at">color</span> <span class="op">===</span> <span class="st">"red"</span> <span class="op">&amp;&amp;</span> s<span class="op">.</span><span class="at">valence</span> <span class="op">===</span> <span class="st">"negative"</span>)<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb34-11"><a href="#cb34-11"></a><span class="kw">let</span> blue_positive <span class="op">=</span> stims<span class="op">.</span><span class="fu">filter</span>(s <span class="kw">=&gt;</span> s<span class="op">.</span><span class="at">color</span> <span class="op">===</span> <span class="st">"blue"</span> <span class="op">&amp;&amp;</span> s<span class="op">.</span><span class="at">valence</span> <span class="op">===</span> <span class="st">"positive"</span>)<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb34-12"><a href="#cb34-12"></a><span class="kw">let</span> blue_negative <span class="op">=</span> stims<span class="op">.</span><span class="fu">filter</span>(s <span class="kw">=&gt;</span> s<span class="op">.</span><span class="at">color</span> <span class="op">===</span> <span class="st">"blue"</span> <span class="op">&amp;&amp;</span> s<span class="op">.</span><span class="at">valence</span> <span class="op">===</span> <span class="st">"negative"</span>)<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb34-13"><a href="#cb34-13"></a></span>
<span id="cb34-14"><a href="#cb34-14"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"Red positive:"</span><span class="op">,</span> red_positive)<span class="op">;</span></span>
<span id="cb34-15"><a href="#cb34-15"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"Red negative:"</span><span class="op">,</span> red_negative)<span class="op">;</span></span>
<span id="cb34-16"><a href="#cb34-16"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"Blue positive:"</span><span class="op">,</span> blue_positive)<span class="op">;</span></span>
<span id="cb34-17"><a href="#cb34-17"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"Blue negative:"</span><span class="op">,</span> blue_negative)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="creating-a-summary-table" class="level4" data-number="22.5.6.3">
<h4 data-number="22.5.6.3" class="anchored" data-anchor-id="creating-a-summary-table"><span class="header-section-number">22.5.6.3</span> Creating a Summary Table</h4>
<p>For a more organized view, you can create a summary table that displays the distribution of your stimuli:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb35-1"><a href="#cb35-1"></a><span class="co">// Create a summary table of stimulus assignments</span></span>
<span id="cb35-2"><a href="#cb35-2"></a></span>
<span id="cb35-3"><a href="#cb35-3"></a><span class="kw">let</span> summary <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb35-4"><a href="#cb35-4"></a></span>
<span id="cb35-5"><a href="#cb35-5"></a>stims<span class="op">.</span><span class="fu">forEach</span>(<span class="kw">function</span>(trial) {</span>
<span id="cb35-6"><a href="#cb35-6"></a>  <span class="co">// Create a key combining condition properties</span></span>
<span id="cb35-7"><a href="#cb35-7"></a>  <span class="kw">let</span> key <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>trial<span class="op">.</span><span class="at">color</span><span class="sc">}</span><span class="vs">_</span><span class="sc">${</span>trial<span class="op">.</span><span class="at">valence</span><span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb35-8"><a href="#cb35-8"></a></span>
<span id="cb35-9"><a href="#cb35-9"></a>  <span class="co">// Initialize counter if this combination hasn't been seen</span></span>
<span id="cb35-10"><a href="#cb35-10"></a>  <span class="cf">if</span> (<span class="op">!</span>summary[key]) {</span>
<span id="cb35-11"><a href="#cb35-11"></a>    summary[key] <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb35-12"><a href="#cb35-12"></a>  }</span>
<span id="cb35-13"><a href="#cb35-13"></a></span>
<span id="cb35-14"><a href="#cb35-14"></a>  <span class="co">// Increment counter</span></span>
<span id="cb35-15"><a href="#cb35-15"></a>  summary[key]<span class="op">++;</span></span>
<span id="cb35-16"><a href="#cb35-16"></a>})<span class="op">;</span></span>
<span id="cb35-17"><a href="#cb35-17"></a></span>
<span id="cb35-18"><a href="#cb35-18"></a><span class="bu">console</span><span class="op">.</span><span class="fu">table</span>(summary)<span class="op">;</span></span>
<span id="cb35-19"><a href="#cb35-19"></a></span>
<span id="cb35-20"><a href="#cb35-20"></a></span>
<span id="cb35-21"><a href="#cb35-21"></a><span class="co">// Output will look like:</span></span>
<span id="cb35-22"><a href="#cb35-22"></a><span class="co">// ┌─────────────────┬────────┐</span></span>
<span id="cb35-23"><a href="#cb35-23"></a><span class="co">// │     (index)     │ Values │</span></span>
<span id="cb35-24"><a href="#cb35-24"></a><span class="co">// ├─────────────────┼────────┤</span></span>
<span id="cb35-25"><a href="#cb35-25"></a><span class="co">// │  red_positive   │   2    │</span></span>
<span id="cb35-26"><a href="#cb35-26"></a><span class="co">// │  red_negative   │   2    │</span></span>
<span id="cb35-27"><a href="#cb35-27"></a><span class="co">// │  blue_positive  │   2    │</span></span>
<span id="cb35-28"><a href="#cb35-28"></a><span class="co">// │  blue_negative  │   2    │</span></span>
<span id="cb35-29"><a href="#cb35-29"></a><span class="co">// └─────────────────┴────────┘</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>console.table()</code> function provides a nicely formatted table view that makes it easy to verify your design at a glance.</p>
</section>
<section id="listing-specific-assignments" class="level4" data-number="22.5.6.4">
<h4 data-number="22.5.6.4" class="anchored" data-anchor-id="listing-specific-assignments"><span class="header-section-number">22.5.6.4</span> Listing Specific Assignments</h4>
<p>You might also want to see exactly which words were assigned to which conditions:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb36-1"><a href="#cb36-1"></a><span class="co">// Group words by condition</span></span>
<span id="cb36-2"><a href="#cb36-2"></a><span class="kw">let</span> red_words <span class="op">=</span> stims<span class="op">.</span><span class="fu">filter</span>(s <span class="kw">=&gt;</span> s<span class="op">.</span><span class="at">color</span> <span class="op">===</span> <span class="st">"red"</span>)<span class="op">.</span><span class="fu">map</span>(s <span class="kw">=&gt;</span> s<span class="op">.</span><span class="at">word</span>)<span class="op">;</span></span>
<span id="cb36-3"><a href="#cb36-3"></a><span class="kw">let</span> blue_words <span class="op">=</span> stims<span class="op">.</span><span class="fu">filter</span>(s <span class="kw">=&gt;</span> s<span class="op">.</span><span class="at">color</span> <span class="op">===</span> <span class="st">"blue"</span>)<span class="op">.</span><span class="fu">map</span>(s <span class="kw">=&gt;</span> s<span class="op">.</span><span class="at">word</span>)<span class="op">;</span></span>
<span id="cb36-4"><a href="#cb36-4"></a></span>
<span id="cb36-5"><a href="#cb36-5"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"Red words:"</span><span class="op">,</span> red_words)<span class="op">;</span></span>
<span id="cb36-6"><a href="#cb36-6"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"Blue words:"</span><span class="op">,</span> blue_words)<span class="op">;</span></span>
<span id="cb36-7"><a href="#cb36-7"></a></span>
<span id="cb36-8"><a href="#cb36-8"></a><span class="co">// Output might be:</span></span>
<span id="cb36-9"><a href="#cb36-9"></a><span class="co">// Red words: ["hope", "anger", "light", "fear"]</span></span>
<span id="cb36-10"><a href="#cb36-10"></a><span class="co">// Blue words: ["love", "shadow", "peace", "enemy"]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="key-principles-for-stimulus-assignment" class="level3" data-number="22.5.7">
<h3 data-number="22.5.7" class="anchored" data-anchor-id="key-principles-for-stimulus-assignment"><span class="header-section-number">22.5.7</span> Key Principles for Stimulus Assignment</h3>
<p>When implementing random stimulus assignment:</p>
<ol type="1">
<li>Identify what needs to be randomized: Which stimuli? Which conditions? Which participants?</li>
<li>Separate the components: Break your stimuli and conditions into separate arrays</li>
<li>Apply randomization strategically: Use shuffle() for random ordering, sampleWithoutReplacement() for random selection</li>
<li>Recombine programmatically: Use loops to pair stimuli with conditions</li>
<li>Maintain balance when needed: Ensure equal numbers across conditions if that’s important for your design</li>
<li>Test thoroughly: Print your arrays to the console to verify the randomization works as intended</li>
</ol>
<p>The flexibility of programmatic stimulus assignment allows you to implement sophisticated randomization schemes that control for confounds while maintaining the experimental manipulations you care about.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./21-L09.html" class="pagination-link" aria-label="Lab 9: Working Memory">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Lab 9: Working Memory</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./23-L10.html" class="pagination-link" aria-label="Lab 10: Judgment &amp; Decision-Making">
        <span class="nav-page-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Lab 10: Judgment &amp; Decision-Making</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/icoglab/online-behavioural-research-methods/edit/main/22-randomization.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/icoglab/online-behavioural-research-methods/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>