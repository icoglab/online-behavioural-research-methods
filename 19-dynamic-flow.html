<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="An open source textbook for psychology students learning programming and online research methods.Primary Author: Nicholaus P. Brosowsky Co-Authors: Liam Yeo, Jackie Spear">

<title>19&nbsp; Controlling the Flow – Online Behavioural Research Methods: Programming with jsPsych</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./20-L08.html" rel="next">
<link href="./18-L07.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e9b5551c1c55c86b42a831a3c09ea90c.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-f4f6c4c33169695420a9dce568207992.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>
.tabset-fullscreen-btn {
  position: absolute;
  top: 5px;
  right: 10px;
  z-index: 1000;
  padding: 5px 10px;
  background-color: none;
  color: #6c757d;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
  transition: all 0.2s ease;
}
.tabset-fullscreen-btn:hover {
  background-color: #e9ecef;
  color: #495057;
}
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.panel-tabset').forEach(function(tabset) {
    const btn = document.createElement('button');
    btn.innerHTML = '⛶ Open Code in New Tab';
    btn.className = 'tabset-fullscreen-btn';

    tabset.style.position = 'relative';
    tabset.insertBefore(btn, tabset.firstChild);

    btn.addEventListener('click', function() {
      const clone = tabset.cloneNode(true);
      const cloneBtn = clone.querySelector('.tabset-fullscreen-btn');
      if (cloneBtn) cloneBtn.remove();

      // Get all stylesheets from current page
      const stylesheets = Array.from(document.styleSheets)
        .map(sheet => {
          try {
            if (sheet.href) {
              return `<link rel="stylesheet" href="${sheet.href}">`;
            } else if (sheet.ownerNode) {
              return `<style>${Array.from(sheet.cssRules).map(rule => rule.cssText).join('\n')}</style>`;
            }
          } catch (e) {
            if (sheet.href) return `<link rel="stylesheet" href="${sheet.href}">`;
          }
          return '';
        })
        .join('\n');

      const newWindow = window.open('', '_blank');
      newWindow.document.write(`
        <html>
          <head>
            <title>Tab Panel View</title>
            ${stylesheets}
            <style>
              body { 
                margin: 20px auto; 
                padding: 20px; 
                max-width: 1200px;
              }
            </style>
          </head>
          <body>
            ${clone.outerHTML}
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"><\/script>
          </body>
        </html>
      `);
      newWindow.document.close();
    });
  });
});
</script>


</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./19-dynamic-flow.html">Unit 8: Controlling the Flow</a></li><li class="breadcrumb-item"><a href="./19-dynamic-flow.html"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Controlling the Flow</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Online Behavioural Research Methods: Programming with jsPsych</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/icoglab/online-behavioural-research-methods" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">UNIT 1: Fundamentals (I)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-html.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">HTML</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-css.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">CSS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-L01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Lab 1: About Me</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">UNIT 2: Fundamentals (II)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-javascript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Javascript</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-debugging-javascript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Debugging JavaScript</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-L02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Lab 2: JS Exercises</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">UNIT 3: Intro to JsPsych</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-jspsych.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">jsPsych</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-L03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Lab 3: Language &amp; Thought</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">UNIT 4: Timelines</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-timelines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Timelines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-plugins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">More Plugins</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-L04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Lab 4: Memory</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Unit 5: Multimedia</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-multimedia.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Multimedia</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-L05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Lab 5: Mental Imagery</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Unit 6: Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Saving and Labeling Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-data-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Accessing and Summarizing Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-L06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Lab 6: Creativity</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Unit 7: Dynamic Parameters</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-dynamic-html.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Dynamic Parameters</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-L07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Lab 7: Spatial Attention</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Unit 8: Controlling the Flow</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-dynamic-flow.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Controlling the Flow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-L08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Lab 8: Cognitive Control</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true">
 <span class="menu-text">Unit 9: Skills Checkpoint</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-L09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Lab 9: Working Memory</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true">
 <span class="menu-text">Unit 10: Randomization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-randomization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Randomization in Experimental Design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-L10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Lab 10: Judgment &amp; Decision-Making</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-L11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Lab 11: Face Perception</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="true">
 <span class="menu-text">Unit 11: Gamification</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25-gamification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Gamification in Behavioural Research</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A01_JS_Builtins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">JavaScript Built-in Functions</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
<div class="quarto-sidebar-footer"><div class="sidebar-footer-item">
<p>© 2024. This work is openly licensed via <a href="https://creativecommons.org/licenses/by-nc/4.0">CC BY NC 4.0</a>.</p>
</div></div></nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">19.1</span> Introduction</a></li>
  <li><a href="#its-timelines-all-the-way-down" id="toc-its-timelines-all-the-way-down" class="nav-link" data-scroll-target="#its-timelines-all-the-way-down"><span class="header-section-number">19.2</span> It’s Timelines All the Way Down</a></li>
  <li><a href="#a-side-note-about-organization" id="toc-a-side-note-about-organization" class="nav-link" data-scroll-target="#a-side-note-about-organization"><span class="header-section-number">19.3</span> A Side-Note About Organization</a>
  <ul class="collapse">
  <li><a href="#two-ways-to-write-the-same-thing" id="toc-two-ways-to-write-the-same-thing" class="nav-link" data-scroll-target="#two-ways-to-write-the-same-thing"><span class="header-section-number">19.3.1</span> Two Ways to Write the Same Thing</a></li>
  <li><a href="#when-to-use-each-approach" id="toc-when-to-use-each-approach" class="nav-link" data-scroll-target="#when-to-use-each-approach"><span class="header-section-number">19.3.2</span> When to Use Each Approach</a></li>
  <li><a href="#example-simple-task---inline-works-fine" id="toc-example-simple-task---inline-works-fine" class="nav-link" data-scroll-target="#example-simple-task---inline-works-fine"><span class="header-section-number">19.3.3</span> Example: Simple Task - Inline Works Fine</a></li>
  <li><a href="#example-complex-task---separate-definitions-help" id="toc-example-complex-task---separate-definitions-help" class="nav-link" data-scroll-target="#example-complex-task---separate-definitions-help"><span class="header-section-number">19.3.4</span> Example: Complex Task - Separate Definitions Help</a></li>
  <li><a href="#example-understanding-task-flow" id="toc-example-understanding-task-flow" class="nav-link" data-scroll-target="#example-understanding-task-flow"><span class="header-section-number">19.3.5</span> Example: Understanding Task Flow</a></li>
  <li><a href="#a-practical-guideline" id="toc-a-practical-guideline" class="nav-link" data-scroll-target="#a-practical-guideline"><span class="header-section-number">19.3.6</span> A Practical Guideline</a></li>
  </ul></li>
  <li><a href="#two-levels-of-flow-control" id="toc-two-levels-of-flow-control" class="nav-link" data-scroll-target="#two-levels-of-flow-control"><span class="header-section-number">19.4</span> Two Levels of Flow Control</a></li>
  <li><a href="#conditional-trial-components" id="toc-conditional-trial-components" class="nav-link" data-scroll-target="#conditional-trial-components"><span class="header-section-number">19.5</span> Conditional Trial Components</a>
  <ul class="collapse">
  <li><a href="#example-feedback-only-on-errors" id="toc-example-feedback-only-on-errors" class="nav-link" data-scroll-target="#example-feedback-only-on-errors"><span class="header-section-number">19.5.1</span> Example: Feedback Only on Errors</a></li>
  <li><a href="#example-skip-based-on-survey-response" id="toc-example-skip-based-on-survey-response" class="nav-link" data-scroll-target="#example-skip-based-on-survey-response"><span class="header-section-number">19.5.2</span> Example: Skip Based on Survey Response</a></li>
  <li><a href="#example-conditional-inattention-warning" id="toc-example-conditional-inattention-warning" class="nav-link" data-scroll-target="#example-conditional-inattention-warning"><span class="header-section-number">19.5.3</span> Example: Conditional Inattention Warning</a></li>
  </ul></li>
  <li><a href="#conditional-timelines" id="toc-conditional-timelines" class="nav-link" data-scroll-target="#conditional-timelines"><span class="header-section-number">19.6</span> Conditional Timelines</a>
  <ul class="collapse">
  <li><a href="#understanding-timeline-level-conditionals" id="toc-understanding-timeline-level-conditionals" class="nav-link" data-scroll-target="#understanding-timeline-level-conditionals"><span class="header-section-number">19.6.1</span> Understanding Timeline-Level Conditionals</a></li>
  <li><a href="#example-language-specific-tasks" id="toc-example-language-specific-tasks" class="nav-link" data-scroll-target="#example-language-specific-tasks"><span class="header-section-number">19.6.2</span> Example: Language-Specific Tasks</a></li>
  <li><a href="#example-language-specific-tasks-expanded" id="toc-example-language-specific-tasks-expanded" class="nav-link" data-scroll-target="#example-language-specific-tasks-expanded"><span class="header-section-number">19.6.3</span> Example: Language-Specific Tasks Expanded</a></li>
  <li><a href="#example-time-restricted-experiment" id="toc-example-time-restricted-experiment" class="nav-link" data-scroll-target="#example-time-restricted-experiment"><span class="header-section-number">19.6.4</span> Example: Time-Restricted Experiment</a></li>
  <li><a href="#example-random-assignment-to-conditions" id="toc-example-random-assignment-to-conditions" class="nav-link" data-scroll-target="#example-random-assignment-to-conditions"><span class="header-section-number">19.6.5</span> Example: Random Assignment to Conditions</a></li>
  </ul></li>
  <li><a href="#looping-timelines" id="toc-looping-timelines" class="nav-link" data-scroll-target="#looping-timelines"><span class="header-section-number">19.7</span> Looping Timelines</a>
  <ul class="collapse">
  <li><a href="#example-audio-check" id="toc-example-audio-check" class="nav-link" data-scroll-target="#example-audio-check"><span class="header-section-number">19.7.1</span> Example: Audio Check</a></li>
  <li><a href="#example-comprehension-check-with-attention-trap" id="toc-example-comprehension-check-with-attention-trap" class="nav-link" data-scroll-target="#example-comprehension-check-with-attention-trap"><span class="header-section-number">19.7.2</span> Example: Comprehension Check with Attention Trap</a></li>
  <li><a href="#example-practice-until-proficient" id="toc-example-practice-until-proficient" class="nav-link" data-scroll-target="#example-practice-until-proficient"><span class="header-section-number">19.7.3</span> Example: Practice Until Proficient</a></li>
  </ul></li>
  <li><a href="#avoiding-infinite-loops" id="toc-avoiding-infinite-loops" class="nav-link" data-scroll-target="#avoiding-infinite-loops"><span class="header-section-number">19.8</span> Avoiding Infinite Loops</a></li>
  <li><a href="#combining-conditional-and-loop-logic" id="toc-combining-conditional-and-loop-logic" class="nav-link" data-scroll-target="#combining-conditional-and-loop-logic"><span class="header-section-number">19.9</span> Combining Conditional and Loop Logic</a>
  <ul class="collapse">
  <li><a href="#example-adaptive-practice-with-warnings" id="toc-example-adaptive-practice-with-warnings" class="nav-link" data-scroll-target="#example-adaptive-practice-with-warnings"><span class="header-section-number">19.9.1</span> Example: Adaptive Practice with Warnings</a></li>
  </ul></li>
  <li><a href="#common-patterns-and-best-practices" id="toc-common-patterns-and-best-practices" class="nav-link" data-scroll-target="#common-patterns-and-best-practices"><span class="header-section-number">19.10</span> Common Patterns and Best Practices</a>
  <ul class="collapse">
  <li><a href="#pattern-1-checking-previous-trial-data" id="toc-pattern-1-checking-previous-trial-data" class="nav-link" data-scroll-target="#pattern-1-checking-previous-trial-data"><span class="header-section-number">19.10.1</span> Pattern 1: Checking Previous Trial Data</a></li>
  <li><a href="#pattern-2-checking-specific-trial-types" id="toc-pattern-2-checking-specific-trial-types" class="nav-link" data-scroll-target="#pattern-2-checking-specific-trial-types"><span class="header-section-number">19.10.2</span> Pattern 2: Checking Specific Trial Types</a></li>
  <li><a href="#pattern-3-calculating-performance-metrics" id="toc-pattern-3-calculating-performance-metrics" class="nav-link" data-scroll-target="#pattern-3-calculating-performance-metrics"><span class="header-section-number">19.10.3</span> Pattern 3: Calculating Performance Metrics</a></li>
  <li><a href="#pattern-4-using-external-variables" id="toc-pattern-4-using-external-variables" class="nav-link" data-scroll-target="#pattern-4-using-external-variables"><span class="header-section-number">19.10.4</span> Pattern 4: Using External Variables</a></li>
  </ul></li>
  <li><a href="#best-practices" id="toc-best-practices" class="nav-link" data-scroll-target="#best-practices"><span class="header-section-number">19.11</span> Best Practices</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">19.12</span> Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/icoglab/online-behavioural-research-methods/edit/main/19-dynamic-flow.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/icoglab/online-behavioural-research-methods/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./19-dynamic-flow.html">Unit 8: Controlling the Flow</a></li><li class="breadcrumb-item"><a href="./19-dynamic-flow.html"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Controlling the Flow</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Controlling the Flow</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-note callout-titled" title="learning goals">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
learning goals
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Understand how jsPsych evaluates flow control at different levels (trial, timeline, experiment)</li>
<li>Use conditional functions to show/hide individual trial components (e.g., feedback)</li>
<li>Implement conditional timelines to include/exclude entire phases based on participant data</li>
<li>Create looping timelines that repeat until performance criteria are met</li>
<li>Combine conditional and looping logic to build adaptive experimental designs</li>
</ol>
</div>
</div>
</div>
<section id="introduction" class="level2" data-number="19.1">
<h2 data-number="19.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">19.1</span> Introduction</h2>
<p>Throughout this book, we’ve been building experiments by arranging trials and timelines in a specific order. For instance, in a Stroop task, we might show a fixation cross, then the stimulus, then move on to the next trial:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">let</span> stroop <span class="op">=</span> {</span>
<span id="cb1-2"><a href="#cb1-2"></a>  <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb1-3"><a href="#cb1-3"></a>    {</span>
<span id="cb1-4"><a href="#cb1-4"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>      <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px"&gt;+&lt;/p&gt;`</span><span class="op">,</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>      <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span><span class="op">,</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>      <span class="dt">trial_duration</span><span class="op">:</span> <span class="dv">500</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>    }<span class="op">,</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>    {</span>
<span id="cb1-10"><a href="#cb1-10"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>      <span class="dt">stimulus</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">'stimulus'</span>)<span class="op">,</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>      <span class="dt">choices</span><span class="op">:</span> [<span class="st">"r"</span><span class="op">,</span> <span class="st">"b"</span><span class="op">,</span> <span class="st">"g"</span><span class="op">,</span> <span class="st">"y"</span>]</span>
<span id="cb1-13"><a href="#cb1-13"></a>    }</span>
<span id="cb1-14"><a href="#cb1-14"></a>  ]<span class="op">,</span></span>
<span id="cb1-15"><a href="#cb1-15"></a>  <span class="dt">timeline_variables</span><span class="op">:</span> [</span>
<span id="cb1-16"><a href="#cb1-16"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: blue"&gt;RED&lt;/p&gt;`</span>}<span class="op">,</span></span>
<span id="cb1-17"><a href="#cb1-17"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: red"&gt;RED&lt;/p&gt;`</span>}<span class="op">,</span></span>
<span id="cb1-18"><a href="#cb1-18"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: blue"&gt;BLUE&lt;/p&gt;`</span>}<span class="op">,</span></span>
<span id="cb1-19"><a href="#cb1-19"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: red"&gt;BLUE&lt;/p&gt;`</span>}</span>
<span id="cb1-20"><a href="#cb1-20"></a>  ]</span>
<span id="cb1-21"><a href="#cb1-21"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Similarly, we control the order of entire phases or tasks by arranging them in the array we pass to jsPsych.run():</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1"></a>jsPsych<span class="op">.</span><span class="fu">run</span>([</span>
<span id="cb2-2"><a href="#cb2-2"></a>  instructions<span class="op">,</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>  practice<span class="op">,</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>  main_task<span class="op">,</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>  debrief</span>
<span id="cb2-6"><a href="#cb2-6"></a>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This works great for experiments where the sequence is always the same. But what if you need the flow to change based on what happens during the experiment?</p>
<p>Consider these scenarios:</p>
<ul>
<li>Show feedback <strong>only</strong> on incorrect trials</li>
<li>Repeat a practice block until accuracy reaches 80%</li>
<li>Skip the French language task if the participant indicated English as their first language</li>
<li>Show a warning message after three consecutive missed responses</li>
</ul>
<p>All of these require dynamic flow control, the ability to make decisions about what happens next based on data collected during the experiment. That’s what we’ll learn in this chapter.</p>
</section>
<section id="its-timelines-all-the-way-down" class="level2" data-number="19.2">
<h2 data-number="19.2" class="anchored" data-anchor-id="its-timelines-all-the-way-down"><span class="header-section-number">19.2</span> It’s Timelines All the Way Down</h2>
<p>Before we dive into flow control, let’s clarify an important concept: in jsPsych, everything is a timeline.</p>
<p>When we talk casually about “trials” and “tasks” and “phases,” it’s easy to think of them as fundamentally different things. But to jsPsych, they’re all just timelines. A single trial is a timeline with one object. A task is a timeline with multiple trials. An entire experiment is a timeline containing other timelines.</p>
<p>This means we can nest timelines inside timelines, inside more timelines, as deep as we need:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">let</span> welcome <span class="op">=</span> {</span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;Welcome to the experiment!&lt;/p&gt;`</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>}<span class="op">;</span></span>
<span id="cb3-5"><a href="#cb3-5"></a></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="kw">let</span> goodbye <span class="op">=</span> {</span>
<span id="cb3-7"><a href="#cb3-7"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>  <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;Thank you for participating!&lt;/p&gt;`</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>}<span class="op">;</span></span>
<span id="cb3-10"><a href="#cb3-10"></a></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="kw">let</span> stroop <span class="op">=</span> {</span>
<span id="cb3-12"><a href="#cb3-12"></a>  <span class="dt">timeline</span><span class="op">:</span> [<span class="co">/* stroop trials */</span>]</span>
<span id="cb3-13"><a href="#cb3-13"></a>}<span class="op">;</span></span>
<span id="cb3-14"><a href="#cb3-14"></a></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="kw">let</span> flanker <span class="op">=</span> {</span>
<span id="cb3-16"><a href="#cb3-16"></a>  <span class="dt">timeline</span><span class="op">:</span> [<span class="co">/* flanker trials */</span>]</span>
<span id="cb3-17"><a href="#cb3-17"></a>}<span class="op">;</span></span>
<span id="cb3-18"><a href="#cb3-18"></a></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="kw">let</span> simon <span class="op">=</span> {</span>
<span id="cb3-20"><a href="#cb3-20"></a>  <span class="dt">timeline</span><span class="op">:</span> [<span class="co">/* simon trials */</span>]</span>
<span id="cb3-21"><a href="#cb3-21"></a>}<span class="op">;</span></span>
<span id="cb3-22"><a href="#cb3-22"></a></span>
<span id="cb3-23"><a href="#cb3-23"></a><span class="co">// Group all the cognitive tasks together</span></span>
<span id="cb3-24"><a href="#cb3-24"></a><span class="kw">let</span> allTasks <span class="op">=</span> {</span>
<span id="cb3-25"><a href="#cb3-25"></a>  <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb3-26"><a href="#cb3-26"></a>    stroop<span class="op">,</span></span>
<span id="cb3-27"><a href="#cb3-27"></a>    flanker<span class="op">,</span></span>
<span id="cb3-28"><a href="#cb3-28"></a>    simon</span>
<span id="cb3-29"><a href="#cb3-29"></a>  ]</span>
<span id="cb3-30"><a href="#cb3-30"></a>}<span class="op">;</span></span>
<span id="cb3-31"><a href="#cb3-31"></a></span>
<span id="cb3-32"><a href="#cb3-32"></a><span class="co">// The complete experiment</span></span>
<span id="cb3-33"><a href="#cb3-33"></a><span class="kw">let</span> everything <span class="op">=</span> {</span>
<span id="cb3-34"><a href="#cb3-34"></a>  <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb3-35"><a href="#cb3-35"></a>    welcome<span class="op">,</span></span>
<span id="cb3-36"><a href="#cb3-36"></a>    allTasks<span class="op">,</span></span>
<span id="cb3-37"><a href="#cb3-37"></a>    goodbye</span>
<span id="cb3-38"><a href="#cb3-38"></a>  ]</span>
<span id="cb3-39"><a href="#cb3-39"></a>}<span class="op">;</span></span>
<span id="cb3-40"><a href="#cb3-40"></a></span>
<span id="cb3-41"><a href="#cb3-41"></a>jsPsych<span class="op">.</span><span class="fu">run</span>([everything])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This code will run in the following order:</p>
<ol type="1">
<li>welcome</li>
<li>stroop</li>
<li>flanker</li>
<li>simon</li>
<li>goodbye</li>
</ol>
<p>In this case, it is equivalent to the following code:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1"></a>jsPsych<span class="op">.</span><span class="fu">run</span>([</span>
<span id="cb4-2"><a href="#cb4-2"></a>  welcome<span class="op">,</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  stroop<span class="op">,</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>  flanker<span class="op">,</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>  simon<span class="op">,</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>  goodbye</span>
<span id="cb4-7"><a href="#cb4-7"></a>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Why does this matter? Because the flow control tools we’re about to learn work the same way at every level. Whether you’re controlling a single feedback trial or an entire task phase, you’ll use the same mechanisms. Understanding that it’s “timelines all the way down” helps make sense of how these tools work.</p>
<p>As we will see, by grouping some trials/tasks together, we will gain more control over whether those groups of trials/tasks are shown or not show, repeat, etc.</p>
</section>
<section id="a-side-note-about-organization" class="level2" data-number="19.3">
<h2 data-number="19.3" class="anchored" data-anchor-id="a-side-note-about-organization"><span class="header-section-number">19.3</span> A Side-Note About Organization</h2>
<p>Now that we understand the nested nature of timelines, let’s take a moment to talk about code organization. Understanding that “it’s timelines all the way down” opens up different ways to structure your code, and choosing the right approach can make your experiments much easier to read and modify.</p>
<section id="two-ways-to-write-the-same-thing" class="level3" data-number="19.3.1">
<h3 data-number="19.3.1" class="anchored" data-anchor-id="two-ways-to-write-the-same-thing"><span class="header-section-number">19.3.1</span> Two Ways to Write the Same Thing</h3>
<p>Consider our Stroop task example from earlier. We wrote it like this:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">let</span> stroop <span class="op">=</span> {</span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb5-3"><a href="#cb5-3"></a>    {</span>
<span id="cb5-4"><a href="#cb5-4"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>      <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px"&gt;+&lt;/p&gt;`</span><span class="op">,</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>      <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span><span class="op">,</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>      <span class="dt">trial_duration</span><span class="op">:</span> <span class="dv">500</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>    }<span class="op">,</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>    {</span>
<span id="cb5-10"><a href="#cb5-10"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb5-11"><a href="#cb5-11"></a>      <span class="dt">stimulus</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">'stimulus'</span>)<span class="op">,</span></span>
<span id="cb5-12"><a href="#cb5-12"></a>      <span class="dt">choices</span><span class="op">:</span> [<span class="st">"r"</span><span class="op">,</span> <span class="st">"b"</span><span class="op">,</span> <span class="st">"g"</span><span class="op">,</span> <span class="st">"y"</span>]</span>
<span id="cb5-13"><a href="#cb5-13"></a>    }</span>
<span id="cb5-14"><a href="#cb5-14"></a>  ]<span class="op">,</span></span>
<span id="cb5-15"><a href="#cb5-15"></a>  <span class="dt">timeline_variables</span><span class="op">:</span> [</span>
<span id="cb5-16"><a href="#cb5-16"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: blue"&gt;RED&lt;/p&gt;`</span>}<span class="op">,</span></span>
<span id="cb5-17"><a href="#cb5-17"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: red"&gt;RED&lt;/p&gt;`</span>}<span class="op">,</span></span>
<span id="cb5-18"><a href="#cb5-18"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: blue"&gt;BLUE&lt;/p&gt;`</span>}<span class="op">,</span></span>
<span id="cb5-19"><a href="#cb5-19"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: red"&gt;BLUE&lt;/p&gt;`</span>}</span>
<span id="cb5-20"><a href="#cb5-20"></a>  ]</span>
<span id="cb5-21"><a href="#cb5-21"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>But we could have written it this way instead:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">let</span> fixation <span class="op">=</span> {</span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px"&gt;+&lt;/p&gt;`</span><span class="op">,</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span><span class="op">,</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>  <span class="dt">trial_duration</span><span class="op">:</span> <span class="dv">500</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>}<span class="op">;</span></span>
<span id="cb6-7"><a href="#cb6-7"></a></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="kw">let</span> stroop_stimulus <span class="op">=</span> {</span>
<span id="cb6-9"><a href="#cb6-9"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb6-10"><a href="#cb6-10"></a>  <span class="dt">stimulus</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">'stimulus'</span>)<span class="op">,</span></span>
<span id="cb6-11"><a href="#cb6-11"></a>  <span class="dt">choices</span><span class="op">:</span> [<span class="st">"r"</span><span class="op">,</span> <span class="st">"b"</span><span class="op">,</span> <span class="st">"g"</span><span class="op">,</span> <span class="st">"y"</span>]</span>
<span id="cb6-12"><a href="#cb6-12"></a>}<span class="op">;</span></span>
<span id="cb6-13"><a href="#cb6-13"></a></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="kw">let</span> stroop <span class="op">=</span> {</span>
<span id="cb6-15"><a href="#cb6-15"></a>  <span class="dt">timeline</span><span class="op">:</span> [fixation<span class="op">,</span> stroop_stimulus]<span class="op">,</span></span>
<span id="cb6-16"><a href="#cb6-16"></a>  <span class="dt">timeline_variables</span><span class="op">:</span> [</span>
<span id="cb6-17"><a href="#cb6-17"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: blue"&gt;RED&lt;/p&gt;`</span>}<span class="op">,</span></span>
<span id="cb6-18"><a href="#cb6-18"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: red"&gt;RED&lt;/p&gt;`</span>}<span class="op">,</span></span>
<span id="cb6-19"><a href="#cb6-19"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: blue"&gt;BLUE&lt;/p&gt;`</span>}<span class="op">,</span></span>
<span id="cb6-20"><a href="#cb6-20"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: red"&gt;BLUE&lt;/p&gt;`</span>}</span>
<span id="cb6-21"><a href="#cb6-21"></a>  ]</span>
<span id="cb6-22"><a href="#cb6-22"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>These two approaches are completely equivalent. jsPsych doesn’t care whether you define trials inline (inside the timeline array) or separately (as named variables that you reference in the timeline array).</p>
<p>We can even move our timeline_variables off into their own variable and refer to it inside our stroop trial:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">let</span> fixation <span class="op">=</span> {</span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px"&gt;+&lt;/p&gt;`</span><span class="op">,</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span><span class="op">,</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="dt">trial_duration</span><span class="op">:</span> <span class="dv">500</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>}<span class="op">;</span></span>
<span id="cb7-7"><a href="#cb7-7"></a></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="kw">let</span> stroop_stimulus <span class="op">=</span> {</span>
<span id="cb7-9"><a href="#cb7-9"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>  <span class="dt">stimulus</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">'stimulus'</span>)<span class="op">,</span></span>
<span id="cb7-11"><a href="#cb7-11"></a>  <span class="dt">choices</span><span class="op">:</span> [<span class="st">"r"</span><span class="op">,</span> <span class="st">"b"</span><span class="op">,</span> <span class="st">"g"</span><span class="op">,</span> <span class="st">"y"</span>]</span>
<span id="cb7-12"><a href="#cb7-12"></a>}<span class="op">;</span></span>
<span id="cb7-13"><a href="#cb7-13"></a></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="kw">let</span> stroop_timeline_variables <span class="op">=</span> [</span>
<span id="cb7-15"><a href="#cb7-15"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: blue"&gt;RED&lt;/p&gt;`</span>}<span class="op">,</span></span>
<span id="cb7-16"><a href="#cb7-16"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: red"&gt;RED&lt;/p&gt;`</span>}<span class="op">,</span></span>
<span id="cb7-17"><a href="#cb7-17"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: blue"&gt;BLUE&lt;/p&gt;`</span>}<span class="op">,</span></span>
<span id="cb7-18"><a href="#cb7-18"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: red"&gt;BLUE&lt;/p&gt;`</span>}</span>
<span id="cb7-19"><a href="#cb7-19"></a>  ]</span>
<span id="cb7-20"><a href="#cb7-20"></a></span>
<span id="cb7-21"><a href="#cb7-21"></a><span class="kw">let</span> stroop <span class="op">=</span> {</span>
<span id="cb7-22"><a href="#cb7-22"></a>  <span class="dt">timeline</span><span class="op">:</span> [fixation<span class="op">,</span> stroop_stimulus]<span class="op">,</span></span>
<span id="cb7-23"><a href="#cb7-23"></a>  <span class="dt">timeline_variables</span><span class="op">:</span> stroop_timeline_variables</span>
<span id="cb7-24"><a href="#cb7-24"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="when-to-use-each-approach" class="level3" data-number="19.3.2">
<h3 data-number="19.3.2" class="anchored" data-anchor-id="when-to-use-each-approach"><span class="header-section-number">19.3.2</span> When to Use Each Approach</h3>
<p>Use inline definitions (first approach) when:</p>
<ul>
<li>The trial is simple and short</li>
<li>You want to see the entire task structure at a glance</li>
<li>The task only has a few components</li>
</ul>
<p>Use separate definitions (second approach) when:</p>
<ul>
<li>Trial definitions are getting long or complex</li>
<li>You want to clearly see the flow and structure of your task</li>
<li>You’re building tasks with many components</li>
<li>You want to focus on one piece at a time while coding</li>
</ul>
</section>
<section id="example-simple-task---inline-works-fine" class="level3" data-number="19.3.3">
<h3 data-number="19.3.3" class="anchored" data-anchor-id="example-simple-task---inline-works-fine"><span class="header-section-number">19.3.3</span> Example: Simple Task - Inline Works Fine</h3>
<p>For a simple task with just a couple of short trials, inline definitions are perfectly readable:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">let</span> simple_task <span class="op">=</span> {</span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb8-3"><a href="#cb8-3"></a>    {</span>
<span id="cb8-4"><a href="#cb8-4"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>      <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;Press any key to see a word&lt;/p&gt;`</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>    }<span class="op">,</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>    {</span>
<span id="cb8-8"><a href="#cb8-8"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>      <span class="dt">stimulus</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">'word'</span>)<span class="op">,</span></span>
<span id="cb8-10"><a href="#cb8-10"></a>      <span class="dt">choices</span><span class="op">:</span> [<span class="st">'f'</span><span class="op">,</span> <span class="st">'j'</span>]</span>
<span id="cb8-11"><a href="#cb8-11"></a>    }</span>
<span id="cb8-12"><a href="#cb8-12"></a>  ]<span class="op">,</span></span>
<span id="cb8-13"><a href="#cb8-13"></a>  <span class="dt">timeline_variables</span><span class="op">:</span> [</span>
<span id="cb8-14"><a href="#cb8-14"></a>    {<span class="dt">word</span><span class="op">:</span> <span class="st">'HAPPY'</span>}<span class="op">,</span></span>
<span id="cb8-15"><a href="#cb8-15"></a>    {<span class="dt">word</span><span class="op">:</span> <span class="st">'SAD'</span>}</span>
<span id="cb8-16"><a href="#cb8-16"></a>  ]</span>
<span id="cb8-17"><a href="#cb8-17"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This is easy to read because everything is short and straightforward.</p>
</section>
<section id="example-complex-task---separate-definitions-help" class="level3" data-number="19.3.4">
<h3 data-number="19.3.4" class="anchored" data-anchor-id="example-complex-task---separate-definitions-help"><span class="header-section-number">19.3.4</span> Example: Complex Task - Separate Definitions Help</h3>
<p>But imagine your trials start getting more complex - maybe they have custom styling, data properties, callback functions, and dynamic parameters. The inline approach becomes harder to read:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">let</span> complex_task <span class="op">=</span> {</span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb9-3"><a href="#cb9-3"></a>    {</span>
<span id="cb9-4"><a href="#cb9-4"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>      <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;div style="font-size: 24px; color: #333; background-color: #f0f0f0; padding: 20px; border-radius: 10px;"&gt;</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="vs">        &lt;p&gt;Get ready...&lt;/p&gt;</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="vs">      &lt;/div&gt;`</span><span class="op">,</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>      <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span><span class="op">,</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>      <span class="dt">trial_duration</span><span class="op">:</span> <span class="dv">1000</span><span class="op">,</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>      <span class="dt">post_trial_gap</span><span class="op">:</span> <span class="dv">200</span></span>
<span id="cb9-11"><a href="#cb9-11"></a>    }<span class="op">,</span></span>
<span id="cb9-12"><a href="#cb9-12"></a>    {</span>
<span id="cb9-13"><a href="#cb9-13"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb9-14"><a href="#cb9-14"></a>      <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px"&gt;+&lt;/p&gt;`</span><span class="op">,</span></span>
<span id="cb9-15"><a href="#cb9-15"></a>      <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span><span class="op">,</span></span>
<span id="cb9-16"><a href="#cb9-16"></a>      <span class="dt">trial_duration</span><span class="op">:</span> <span class="dv">500</span><span class="op">,</span></span>
<span id="cb9-17"><a href="#cb9-17"></a>      <span class="dt">post_trial_gap</span><span class="op">:</span> <span class="dv">0</span></span>
<span id="cb9-18"><a href="#cb9-18"></a>    }<span class="op">,</span></span>
<span id="cb9-19"><a href="#cb9-19"></a>    {</span>
<span id="cb9-20"><a href="#cb9-20"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb9-21"><a href="#cb9-21"></a>      <span class="dt">stimulus</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb9-22"><a href="#cb9-22"></a>        <span class="kw">let</span> stim <span class="op">=</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">'stimulus'</span>)<span class="op">;</span></span>
<span id="cb9-23"><a href="#cb9-23"></a>        <span class="kw">let</span> color <span class="op">=</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">'color'</span>)<span class="op">;</span></span>
<span id="cb9-24"><a href="#cb9-24"></a>        <span class="cf">return</span> <span class="vs">`&lt;div style="font-size: 48px; color: </span><span class="sc">${</span>color<span class="sc">}</span><span class="vs">; font-weight: bold;"&gt;</span></span>
<span id="cb9-25"><a href="#cb9-25"></a><span class="vs">          </span><span class="sc">${</span>stim<span class="sc">}</span></span>
<span id="cb9-26"><a href="#cb9-26"></a><span class="vs">        &lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb9-27"><a href="#cb9-27"></a>      }<span class="op">,</span></span>
<span id="cb9-28"><a href="#cb9-28"></a>      <span class="dt">choices</span><span class="op">:</span> [<span class="st">'r'</span><span class="op">,</span> <span class="st">'b'</span><span class="op">,</span> <span class="st">'g'</span><span class="op">,</span> <span class="st">'y'</span>]<span class="op">,</span></span>
<span id="cb9-29"><a href="#cb9-29"></a>      <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb9-30"><a href="#cb9-30"></a>        <span class="dt">task</span><span class="op">:</span> <span class="st">'stroop'</span><span class="op">,</span></span>
<span id="cb9-31"><a href="#cb9-31"></a>        <span class="dt">condition</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">'condition'</span>)<span class="op">,</span></span>
<span id="cb9-32"><a href="#cb9-32"></a>        <span class="dt">correct_response</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">'correct_key'</span>)</span>
<span id="cb9-33"><a href="#cb9-33"></a>      }<span class="op">,</span></span>
<span id="cb9-34"><a href="#cb9-34"></a>      <span class="dt">on_finish</span><span class="op">:</span> <span class="kw">function</span>(data) {</span>
<span id="cb9-35"><a href="#cb9-35"></a>        data<span class="op">.</span><span class="at">correct</span> <span class="op">=</span> data<span class="op">.</span><span class="at">response</span> <span class="op">==</span> data<span class="op">.</span><span class="at">correct_response</span><span class="op">;</span></span>
<span id="cb9-36"><a href="#cb9-36"></a>      }<span class="op">,</span></span>
<span id="cb9-37"><a href="#cb9-37"></a>      <span class="dt">post_trial_gap</span><span class="op">:</span> <span class="dv">250</span></span>
<span id="cb9-38"><a href="#cb9-38"></a>    }<span class="op">,</span></span>
<span id="cb9-39"><a href="#cb9-39"></a>    {</span>
<span id="cb9-40"><a href="#cb9-40"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb9-41"><a href="#cb9-41"></a>      <span class="dt">stimulus</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb9-42"><a href="#cb9-42"></a>        <span class="kw">let</span> last_trial <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">last</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">values</span>()[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb9-43"><a href="#cb9-43"></a>        <span class="cf">if</span> (last_trial<span class="op">.</span><span class="at">correct</span>) {</span>
<span id="cb9-44"><a href="#cb9-44"></a>          <span class="cf">return</span> <span class="vs">`&lt;p style="color: green; font-size: 24px;"&gt;Correct!&lt;/p&gt;`</span><span class="op">;</span></span>
<span id="cb9-45"><a href="#cb9-45"></a>        } <span class="cf">else</span> {</span>
<span id="cb9-46"><a href="#cb9-46"></a>          <span class="cf">return</span> <span class="vs">`&lt;p style="color: red; font-size: 24px;"&gt;Incorrect&lt;/p&gt;`</span><span class="op">;</span></span>
<span id="cb9-47"><a href="#cb9-47"></a>        }</span>
<span id="cb9-48"><a href="#cb9-48"></a>      }<span class="op">,</span></span>
<span id="cb9-49"><a href="#cb9-49"></a>      <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span><span class="op">,</span></span>
<span id="cb9-50"><a href="#cb9-50"></a>      <span class="dt">trial_duration</span><span class="op">:</span> <span class="dv">800</span></span>
<span id="cb9-51"><a href="#cb9-51"></a>    }</span>
<span id="cb9-52"><a href="#cb9-52"></a>  ]<span class="op">,</span></span>
<span id="cb9-53"><a href="#cb9-53"></a>  <span class="dt">timeline_variables</span><span class="op">:</span> [</span>
<span id="cb9-54"><a href="#cb9-54"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="st">'RED'</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span> <span class="st">'red'</span><span class="op">,</span> <span class="dt">condition</span><span class="op">:</span> <span class="st">'congruent'</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">'r'</span>}<span class="op">,</span></span>
<span id="cb9-55"><a href="#cb9-55"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="st">'RED'</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span> <span class="st">'blue'</span><span class="op">,</span> <span class="dt">condition</span><span class="op">:</span> <span class="st">'incongruent'</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">'r'</span>}<span class="op">,</span></span>
<span id="cb9-56"><a href="#cb9-56"></a>    <span class="co">// ... more stimuli</span></span>
<span id="cb9-57"><a href="#cb9-57"></a>  ]</span>
<span id="cb9-58"><a href="#cb9-58"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>That’s a lot to take in! You have to scroll through all the trial details to understand the basic structure. It’s hard to see at a glance that this task has four parts: a warning, a fixation, a stimulus, and feedback.</p>
<p>Now compare this to the separate approach:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb10-1"><a href="#cb10-1"></a><span class="co">// ============================================</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="co">// STROOP COMPONENTS</span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="co">// ============================================</span></span>
<span id="cb10-4"><a href="#cb10-4"></a></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co">// Warning screen before each trial</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="kw">let</span> warning <span class="op">=</span> {</span>
<span id="cb10-7"><a href="#cb10-7"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>  <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;div style="font-size: 24px; color: #333; background-color: #f0f0f0; padding: 20px; border-radius: 10px;"&gt;</span></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="vs">    &lt;p&gt;Get ready...&lt;/p&gt;</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="vs">  &lt;/div&gt;`</span><span class="op">,</span></span>
<span id="cb10-11"><a href="#cb10-11"></a>  <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span><span class="op">,</span></span>
<span id="cb10-12"><a href="#cb10-12"></a>  <span class="dt">trial_duration</span><span class="op">:</span> <span class="dv">1000</span><span class="op">,</span></span>
<span id="cb10-13"><a href="#cb10-13"></a>  <span class="dt">post_trial_gap</span><span class="op">:</span> <span class="dv">200</span></span>
<span id="cb10-14"><a href="#cb10-14"></a>}<span class="op">;</span></span>
<span id="cb10-15"><a href="#cb10-15"></a></span>
<span id="cb10-16"><a href="#cb10-16"></a><span class="co">// Fixation cross</span></span>
<span id="cb10-17"><a href="#cb10-17"></a><span class="kw">let</span> fixation <span class="op">=</span> {</span>
<span id="cb10-18"><a href="#cb10-18"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb10-19"><a href="#cb10-19"></a>  <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px"&gt;+&lt;/p&gt;`</span><span class="op">,</span></span>
<span id="cb10-20"><a href="#cb10-20"></a>  <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span><span class="op">,</span></span>
<span id="cb10-21"><a href="#cb10-21"></a>  <span class="dt">trial_duration</span><span class="op">:</span> <span class="dv">500</span><span class="op">,</span></span>
<span id="cb10-22"><a href="#cb10-22"></a>  <span class="dt">post_trial_gap</span><span class="op">:</span> <span class="dv">0</span></span>
<span id="cb10-23"><a href="#cb10-23"></a>}<span class="op">;</span></span>
<span id="cb10-24"><a href="#cb10-24"></a></span>
<span id="cb10-25"><a href="#cb10-25"></a><span class="co">// Main Stroop stimulus</span></span>
<span id="cb10-26"><a href="#cb10-26"></a><span class="kw">let</span> stroop_stimulus <span class="op">=</span> {</span>
<span id="cb10-27"><a href="#cb10-27"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb10-28"><a href="#cb10-28"></a>  <span class="dt">stimulus</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb10-29"><a href="#cb10-29"></a>    <span class="kw">let</span> stim <span class="op">=</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">'stimulus'</span>)<span class="op">;</span></span>
<span id="cb10-30"><a href="#cb10-30"></a>    <span class="kw">let</span> color <span class="op">=</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">'color'</span>)<span class="op">;</span></span>
<span id="cb10-31"><a href="#cb10-31"></a>    <span class="cf">return</span> <span class="vs">`&lt;div style="font-size: 48px; color: </span><span class="sc">${</span>color<span class="sc">}</span><span class="vs">; font-weight: bold;"&gt;</span></span>
<span id="cb10-32"><a href="#cb10-32"></a><span class="vs">      </span><span class="sc">${</span>stim<span class="sc">}</span></span>
<span id="cb10-33"><a href="#cb10-33"></a><span class="vs">    &lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb10-34"><a href="#cb10-34"></a>  }<span class="op">,</span></span>
<span id="cb10-35"><a href="#cb10-35"></a>  <span class="dt">choices</span><span class="op">:</span> [<span class="st">'r'</span><span class="op">,</span> <span class="st">'b'</span><span class="op">,</span> <span class="st">'g'</span><span class="op">,</span> <span class="st">'y'</span>]<span class="op">,</span></span>
<span id="cb10-36"><a href="#cb10-36"></a>  <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb10-37"><a href="#cb10-37"></a>    <span class="dt">task</span><span class="op">:</span> <span class="st">'stroop'</span><span class="op">,</span></span>
<span id="cb10-38"><a href="#cb10-38"></a>    <span class="dt">condition</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">'condition'</span>)<span class="op">,</span></span>
<span id="cb10-39"><a href="#cb10-39"></a>    <span class="dt">correct_response</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">'correct_key'</span>)</span>
<span id="cb10-40"><a href="#cb10-40"></a>  }<span class="op">,</span></span>
<span id="cb10-41"><a href="#cb10-41"></a>  <span class="dt">on_finish</span><span class="op">:</span> <span class="kw">function</span>(data) {</span>
<span id="cb10-42"><a href="#cb10-42"></a>    data<span class="op">.</span><span class="at">correct</span> <span class="op">=</span> data<span class="op">.</span><span class="at">response</span> <span class="op">==</span> data<span class="op">.</span><span class="at">correct_response</span><span class="op">;</span></span>
<span id="cb10-43"><a href="#cb10-43"></a>  }<span class="op">,</span></span>
<span id="cb10-44"><a href="#cb10-44"></a>  <span class="dt">post_trial_gap</span><span class="op">:</span> <span class="dv">250</span></span>
<span id="cb10-45"><a href="#cb10-45"></a>}<span class="op">;</span></span>
<span id="cb10-46"><a href="#cb10-46"></a></span>
<span id="cb10-47"><a href="#cb10-47"></a><span class="co">// Feedback display</span></span>
<span id="cb10-48"><a href="#cb10-48"></a><span class="kw">let</span> feedback <span class="op">=</span> {</span>
<span id="cb10-49"><a href="#cb10-49"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb10-50"><a href="#cb10-50"></a>  <span class="dt">stimulus</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb10-51"><a href="#cb10-51"></a>    <span class="kw">let</span> last_trial <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">last</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">values</span>()[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb10-52"><a href="#cb10-52"></a>    <span class="cf">if</span> (last_trial<span class="op">.</span><span class="at">correct</span>) {</span>
<span id="cb10-53"><a href="#cb10-53"></a>      <span class="cf">return</span> <span class="vs">`&lt;p style="color: green; font-size: 24px;"&gt;Correct!&lt;/p&gt;`</span><span class="op">;</span></span>
<span id="cb10-54"><a href="#cb10-54"></a>    } <span class="cf">else</span> {</span>
<span id="cb10-55"><a href="#cb10-55"></a>      <span class="cf">return</span> <span class="vs">`&lt;p style="color: red; font-size: 24px;"&gt;Incorrect&lt;/p&gt;`</span><span class="op">;</span></span>
<span id="cb10-56"><a href="#cb10-56"></a>    }</span>
<span id="cb10-57"><a href="#cb10-57"></a>  }<span class="op">,</span></span>
<span id="cb10-58"><a href="#cb10-58"></a>  <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span><span class="op">,</span></span>
<span id="cb10-59"><a href="#cb10-59"></a>  <span class="dt">trial_duration</span><span class="op">:</span> <span class="dv">800</span></span>
<span id="cb10-60"><a href="#cb10-60"></a>}<span class="op">;</span></span>
<span id="cb10-61"><a href="#cb10-61"></a></span>
<span id="cb10-62"><a href="#cb10-62"></a><span class="co">// ============================================</span></span>
<span id="cb10-63"><a href="#cb10-63"></a><span class="co">// STROOP TIMELINE</span></span>
<span id="cb10-64"><a href="#cb10-64"></a><span class="co">// ============================================</span></span>
<span id="cb10-65"><a href="#cb10-65"></a></span>
<span id="cb10-66"><a href="#cb10-66"></a><span class="kw">let</span> stroop <span class="op">=</span> {</span>
<span id="cb10-67"><a href="#cb10-67"></a>  <span class="dt">timeline</span><span class="op">:</span> [warning<span class="op">,</span> fixation<span class="op">,</span> stroop_stimulus<span class="op">,</span> feedback]<span class="op">,</span></span>
<span id="cb10-68"><a href="#cb10-68"></a>  <span class="dt">timeline_variables</span><span class="op">:</span> [</span>
<span id="cb10-69"><a href="#cb10-69"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="st">'RED'</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span> <span class="st">'red'</span><span class="op">,</span> <span class="dt">condition</span><span class="op">:</span> <span class="st">'congruent'</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">'r'</span>}<span class="op">,</span></span>
<span id="cb10-70"><a href="#cb10-70"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="st">'RED'</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span> <span class="st">'blue'</span><span class="op">,</span> <span class="dt">condition</span><span class="op">:</span> <span class="st">'incongruent'</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">'r'</span>}<span class="op">,</span></span>
<span id="cb10-71"><a href="#cb10-71"></a>    <span class="co">// ... more stimuli</span></span>
<span id="cb10-72"><a href="#cb10-72"></a>  ]</span>
<span id="cb10-73"><a href="#cb10-73"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now the structure is immediately clear: <code>timeline: [warning, fixation, stroop_stimulus, feedback]</code>. You can see the flow of the task at a glance. If you need to understand the details of any component, you can look at its definition separately. If you need to modify the feedback, you know exactly where to find it.</p>
</section>
<section id="example-understanding-task-flow" class="level3" data-number="19.3.5">
<h3 data-number="19.3.5" class="anchored" data-anchor-id="example-understanding-task-flow"><span class="header-section-number">19.3.5</span> Example: Understanding Task Flow</h3>
<p>The separate approach is especially helpful when you’re trying to understand or explain the sequence of events in your experiment:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb11-1"><a href="#cb11-1"></a><span class="co">// It's immediately clear what happens in each block</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw">let</span> practice_block <span class="op">=</span> {</span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="dt">timeline</span><span class="op">:</span> [instructions<span class="op">,</span> practice_trial<span class="op">,</span> feedback]</span>
<span id="cb11-4"><a href="#cb11-4"></a>}<span class="op">;</span></span>
<span id="cb11-5"><a href="#cb11-5"></a></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="kw">let</span> main_block <span class="op">=</span> {</span>
<span id="cb11-7"><a href="#cb11-7"></a>  <span class="dt">timeline</span><span class="op">:</span> [fixation<span class="op">,</span> stimulus<span class="op">,</span> response_prompt]</span>
<span id="cb11-8"><a href="#cb11-8"></a>}<span class="op">;</span></span>
<span id="cb11-9"><a href="#cb11-9"></a></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="kw">let</span> experiment <span class="op">=</span> {</span>
<span id="cb11-11"><a href="#cb11-11"></a>  <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb11-12"><a href="#cb11-12"></a>    welcome<span class="op">,</span></span>
<span id="cb11-13"><a href="#cb11-13"></a>    consent<span class="op">,</span></span>
<span id="cb11-14"><a href="#cb11-14"></a>    practice_block<span class="op">,</span></span>
<span id="cb11-15"><a href="#cb11-15"></a>    break_screen<span class="op">,</span></span>
<span id="cb11-16"><a href="#cb11-16"></a>    main_block<span class="op">,</span></span>
<span id="cb11-17"><a href="#cb11-17"></a>    demographics<span class="op">,</span></span>
<span id="cb11-18"><a href="#cb11-18"></a>    debrief</span>
<span id="cb11-19"><a href="#cb11-19"></a>  ]</span>
<span id="cb11-20"><a href="#cb11-20"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Compare this to having all those components defined inline - you’d have to scroll through hundreds of lines of code to see the overall structure.</p>
</section>
<section id="a-practical-guideline" class="level3" data-number="19.3.6">
<h3 data-number="19.3.6" class="anchored" data-anchor-id="a-practical-guideline"><span class="header-section-number">19.3.6</span> A Practical Guideline</h3>
<p>Here’s a simple rule of thumb: If a trial definition is longer than about 10 lines, or if your timeline has more than 2-3 components, consider using separate definitions.</p>
<p>Your code should be organized in a way that makes it easy to understand the flow and structure of your experiment. When someone (including future you!) looks at your code, they should be able to quickly answer:</p>
<ul>
<li>What are the main phases of this experiment?</li>
<li>What happens in each trial?</li>
<li>What’s the sequence of events?</li>
</ul>
<p>The separate approach often makes these questions easier to answer, especially as your experiments grow more complex.</p>
<p>However, your code should be organized in a way that makes it easy for you (and others) to understand and modify. There’s no single “right” way. You should choose the approach that makes the most sense for your specific experiment.</p>
<p>As we move forward with flow control, you’ll see that the separate approach often makes it easier to add conditional and loop functions, because you can clearly see which component you’re adding the function to. But both approaches work, and you can mix them in the same experiment if that makes sense for your design.</p>
</section>
</section>
<section id="two-levels-of-flow-control" class="level2" data-number="19.4">
<h2 data-number="19.4" class="anchored" data-anchor-id="two-levels-of-flow-control"><span class="header-section-number">19.4</span> Two Levels of Flow Control</h2>
<p>jsPsych provides two main mechanisms for controlling flow dynamically:</p>
<ol type="1">
<li>Conditional Functions (conditional_function): Control whether individual trials or entire timelines run</li>
<li>Loop Functions (loop_function): Control whether timelines repeat</li>
</ol>
<p>These mechanisms can operate at different scales:</p>
<ol type="1">
<li>Trial-level control: Show/hide feedback, adjust what appears on screen, change available responses</li>
<li>Timeline-level control: Include/exclude practice blocks, repeat phases, skip entire tasks</li>
</ol>
<p>Let’s start small with trial-level control, then scale up to timeline-level control.</p>
</section>
<section id="conditional-trial-components" class="level2" data-number="19.5">
<h2 data-number="19.5" class="anchored" data-anchor-id="conditional-trial-components"><span class="header-section-number">19.5</span> Conditional Trial Components</h2>
<p>The simplest form of flow control is showing or hiding parts of a single trial. One common use case is conditional feedback, where we show feedback only when participants make errors. When participants are performing well, we may not want to interrupt them every trial with a feedback message, but we still want to provide corrective feedback if they’re making errors.</p>
<p>Notice that this requires some <code>if-then</code> logic: “If they were incorrect on the previous trial, then show feedback. If they were correct on the previous trial then skip the feedback. Another way to say this, is that whether the feedback is shown is <em>conditional</em> on on something being <code>true</code> or <code>false</code>.</p>
<p>A <code>conditional_function</code> is a property you can add to any timeline object. It’s a function that returns either <code>true</code> (run this timeline) or <code>false</code> (skip this timeline). jsPsych calls this function right before it would run the timeline, giving you a chance to decide whether it should actually run.</p>
<p>Here’s the basic structure:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">let</span> some_timeline <span class="op">=</span> {</span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="dt">timeline</span><span class="op">:</span> [<span class="co">/* your trials here */</span>]<span class="op">,</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="dt">conditional_function</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb12-4"><a href="#cb12-4"></a>    <span class="co">// Your logic here</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>    <span class="co">// Return true to show this timeline</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>    <span class="co">// Return false to skip this timeline</span></span>
<span id="cb12-7"><a href="#cb12-7"></a>  }</span>
<span id="cb12-8"><a href="#cb12-8"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A common mistake is trying to put a conditional_function directly on a trial object. This won’t work:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb13-1"><a href="#cb13-1"></a><span class="co">// This DOESN'T work</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="kw">let</span> feedback <span class="op">=</span> {</span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;Incorrect!&lt;/p&gt;`</span><span class="op">,</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>  <span class="dt">conditional_function</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb13-6"><a href="#cb13-6"></a>    <span class="co">// This will be ignored!</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb13-8"><a href="#cb13-8"></a>  }</span>
<span id="cb13-9"><a href="#cb13-9"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Instead, you need to wrap the trial in a timeline, then put the <code>conditional_function</code> on the timeline:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb14-1"><a href="#cb14-1"></a><span class="co">// This DOES work</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="kw">let</span> feedback <span class="op">=</span> {</span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb14-4"><a href="#cb14-4"></a>    {</span>
<span id="cb14-5"><a href="#cb14-5"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>      <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;Incorrect!&lt;/p&gt;`</span></span>
<span id="cb14-7"><a href="#cb14-7"></a>    }</span>
<span id="cb14-8"><a href="#cb14-8"></a>  ]<span class="op">,</span></span>
<span id="cb14-9"><a href="#cb14-9"></a>  <span class="dt">conditional_function</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb14-10"><a href="#cb14-10"></a>    <span class="co">// This will work!</span></span>
<span id="cb14-11"><a href="#cb14-11"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb14-12"><a href="#cb14-12"></a>  }</span>
<span id="cb14-13"><a href="#cb14-13"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Remember: conditional functions control timelines, not individual trials. Even if your timeline only contains one trial, you still need that timeline wrapper.</p>
<section id="example-feedback-only-on-errors" class="level3" data-number="19.5.1">
<h3 data-number="19.5.1" class="anchored" data-anchor-id="example-feedback-only-on-errors"><span class="header-section-number">19.5.1</span> Example: Feedback Only on Errors</h3>
<p>Let’s build a complete example where feedback appears only when participants make mistakes. We’ll break it down step by step.</p>
<section id="step-1-create-the-main-trial" class="level4" data-number="19.5.1.1">
<h4 data-number="19.5.1.1" class="anchored" data-anchor-id="step-1-create-the-main-trial"><span class="header-section-number">19.5.1.1</span> Step 1: Create the main trial</h4>
<p>First, we need a trial that records whether the response was correct:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw">let</span> trial <span class="op">=</span> {</span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="dt">stimulus</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">'stimulus'</span>)<span class="op">,</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>  <span class="dt">choices</span><span class="op">:</span> [<span class="st">'w'</span><span class="op">,</span> <span class="st">'n'</span>]<span class="op">,</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>  <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb15-6"><a href="#cb15-6"></a>    <span class="dt">correct_response</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">'correct_key'</span>)<span class="op">,</span></span>
<span id="cb15-7"><a href="#cb15-7"></a>    <span class="dt">task</span><span class="op">:</span> <span class="st">'Lexical Decision Task'</span></span>
<span id="cb15-8"><a href="#cb15-8"></a>  }<span class="op">,</span></span>
<span id="cb15-9"><a href="#cb15-9"></a>  <span class="dt">on_finish</span><span class="op">:</span> <span class="kw">function</span>(data) {</span>
<span id="cb15-10"><a href="#cb15-10"></a>    <span class="co">// Check if the response matches the correct response</span></span>
<span id="cb15-11"><a href="#cb15-11"></a>    data<span class="op">.</span><span class="at">correct</span> <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">pluginAPI</span><span class="op">.</span><span class="fu">compareKeys</span>(data<span class="op">.</span><span class="at">response</span><span class="op">,</span> data<span class="op">.</span><span class="at">correct_response</span>)<span class="op">;</span></span>
<span id="cb15-12"><a href="#cb15-12"></a>  }</span>
<span id="cb15-13"><a href="#cb15-13"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Notice that we’re using <code>on_finish</code> to add a correct property to the data. This will be either <code>true</code> or <code>false</code>, and we’ll use it in our conditional function.</p>
</section>
<section id="step-2-create-the-feedback-trial" class="level4" data-number="19.5.1.2">
<h4 data-number="19.5.1.2" class="anchored" data-anchor-id="step-2-create-the-feedback-trial"><span class="header-section-number">19.5.1.2</span> Step 2: Create the feedback trial</h4>
<p>Now let’s create a feedback trial that will only appear sometimes. Remember, we need to wrap it in a timeline to use <code>conditional_function</code>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw">let</span> feedback <span class="op">=</span> {</span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb16-3"><a href="#cb16-3"></a>    {</span>
<span id="cb16-4"><a href="#cb16-4"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb16-5"><a href="#cb16-5"></a>      <span class="dt">stimulus</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb16-6"><a href="#cb16-6"></a>        <span class="co">// Get the data from the trial that just finished</span></span>
<span id="cb16-7"><a href="#cb16-7"></a>        <span class="kw">let</span> last_trial <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">last</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">values</span>()[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb16-8"><a href="#cb16-8"></a></span>
<span id="cb16-9"><a href="#cb16-9"></a>        <span class="co">// Create feedback message</span></span>
<span id="cb16-10"><a href="#cb16-10"></a>        <span class="cf">return</span> <span class="vs">`&lt;p style="color: red; font-size: 24px;"&gt;Incorrect!&lt;/p&gt;</span></span>
<span id="cb16-11"><a href="#cb16-11"></a><span class="vs">                &lt;p&gt;You pressed: </span><span class="sc">${</span>last_trial<span class="op">.</span><span class="at">response</span><span class="sc">}</span><span class="vs">&lt;/p&gt;</span></span>
<span id="cb16-12"><a href="#cb16-12"></a><span class="vs">                &lt;p&gt;Correct response: </span><span class="sc">${</span>last_trial<span class="op">.</span><span class="at">correct_response</span><span class="sc">}</span><span class="vs">&lt;/p&gt;`</span><span class="op">;</span></span>
<span id="cb16-13"><a href="#cb16-13"></a>      }<span class="op">,</span></span>
<span id="cb16-14"><a href="#cb16-14"></a>      <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span><span class="op">,</span></span>
<span id="cb16-15"><a href="#cb16-15"></a>      <span class="dt">trial_duration</span><span class="op">:</span> <span class="dv">1500</span></span>
<span id="cb16-16"><a href="#cb16-16"></a>    }</span>
<span id="cb16-17"><a href="#cb16-17"></a>  ]<span class="op">,</span></span>
<span id="cb16-18"><a href="#cb16-18"></a>  <span class="dt">conditional_function</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb16-19"><a href="#cb16-19"></a>    <span class="co">// Get the data from the trial that just finished</span></span>
<span id="cb16-20"><a href="#cb16-20"></a>    <span class="kw">let</span> last_trial <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">last</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">values</span>()[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb16-21"><a href="#cb16-21"></a></span>
<span id="cb16-22"><a href="#cb16-22"></a>    <span class="co">// Only show feedback if they got it wrong</span></span>
<span id="cb16-23"><a href="#cb16-23"></a>    <span class="cf">if</span> (last_trial<span class="op">.</span><span class="at">correct</span> <span class="op">===</span> <span class="kw">true</span>) {</span>
<span id="cb16-24"><a href="#cb16-24"></a>      <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span>  <span class="co">// Don't show feedback</span></span>
<span id="cb16-25"><a href="#cb16-25"></a>    } <span class="cf">else</span> {</span>
<span id="cb16-26"><a href="#cb16-26"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span>   <span class="co">// Show feedback</span></span>
<span id="cb16-27"><a href="#cb16-27"></a>    }</span>
<span id="cb16-28"><a href="#cb16-28"></a>  }</span>
<span id="cb16-29"><a href="#cb16-29"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s break down what’s happening:</p>
<ol type="1">
<li>The feedback is wrapped in a timeline array (even though it’s just one trial)</li>
<li>The conditional_function is at the timeline level, not inside the trial</li>
<li>Inside the conditional function:
<ul>
<li><code>jsPsych.data.get()</code> - Gets all the data collected so far</li>
<li><code>.last(1)</code> - Gets just the most recent trial</li>
<li><code>.values()[0]</code> - Extracts the data object from that trial</li>
<li>We check if <code>last_trial.correct === true</code></li>
<li>Return <code>false</code> to skip the feedback, <code>true</code> to show it</li>
</ul></li>
</ol>
</section>
<section id="step-3-combine-them-into-a-timeline" class="level4" data-number="19.5.1.3">
<h4 data-number="19.5.1.3" class="anchored" data-anchor-id="step-3-combine-them-into-a-timeline"><span class="header-section-number">19.5.1.3</span> Step 3: Combine them into a timeline</h4>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw">let</span> trial_with_feedback <span class="op">=</span> {</span>
<span id="cb17-2"><a href="#cb17-2"></a>  <span class="dt">timeline</span><span class="op">:</span> [trial<span class="op">,</span> feedback]<span class="op">,</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="dt">timeline_variables</span><span class="op">:</span> [</span>
<span id="cb17-4"><a href="#cb17-4"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="st">"HOUSE"</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"w"</span>}<span class="op">,</span></span>
<span id="cb17-5"><a href="#cb17-5"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="st">"BLARB"</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"n"</span>}</span>
<span id="cb17-6"><a href="#cb17-6"></a>  ]</span>
<span id="cb17-7"><a href="#cb17-7"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now when you run this timeline, every trial will show the stimulus and wait for a response. The feedback trial will only appear if the participant was incorrect. If they were correct, jsPsych skips the feedback trial entirely and moves to the next trial</p>
<p>We can see it in action right here:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">index.html</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">exp.js</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">style.css</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">Result</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb18-1"><a href="#cb18-1"></a> <span class="dt">&lt;!DOCTYPE</span> html<span class="dt">&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4"></a>    <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>Demo<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb18-5"><a href="#cb18-5"></a>    <span class="co">&lt;!-- jsPsych --&gt;</span></span>
<span id="cb18-6"><a href="#cb18-6"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/jspsych.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb18-7"><a href="#cb18-7"></a>    <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> href</span><span class="op">=</span><span class="st">"jspsych/jspsych.css"</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text/css"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb18-8"><a href="#cb18-8"></a>    </span>
<span id="cb18-9"><a href="#cb18-9"></a>    <span class="co">&lt;!-- jPsych plugins --&gt;</span></span>
<span id="cb18-10"><a href="#cb18-10"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/plugin-html-keyboard-response.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb18-11"><a href="#cb18-11"></a></span>
<span id="cb18-12"><a href="#cb18-12"></a>    <span class="co">&lt;!-- custom CSS --&gt;</span></span>
<span id="cb18-13"><a href="#cb18-13"></a>     <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> href</span><span class="op">=</span><span class="st">"style.css"</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text/css"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb18-14"><a href="#cb18-14"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb18-15"><a href="#cb18-15"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb18-16"><a href="#cb18-16"></a>  <span class="co">&lt;!-- custom JS --&gt;</span></span>
<span id="cb18-17"><a href="#cb18-17"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"exp.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb18-18"><a href="#cb18-18"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb18-19"><a href="#cb18-19"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb18-20"><a href="#cb18-20"></a> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb19-1"><a href="#cb19-1"></a> </span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="kw">const</span> jsPsych <span class="op">=</span> <span class="fu">initJsPsych</span>()<span class="op">;</span> </span>
<span id="cb19-3"><a href="#cb19-3"></a></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="co">// ============================================</span></span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="co">// Instructions</span></span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="co">// ============================================</span></span>
<span id="cb19-7"><a href="#cb19-7"></a></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="kw">const</span> welcome <span class="op">=</span> {</span>
<span id="cb19-9"><a href="#cb19-9"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb19-10"><a href="#cb19-10"></a>  <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`Welcome to the Experiment! Press any key to begin.`</span><span class="op">,</span></span>
<span id="cb19-11"><a href="#cb19-11"></a>  <span class="dt">choices</span><span class="op">:</span> <span class="st">"ALL_KEYS"</span><span class="op">,</span> </span>
<span id="cb19-12"><a href="#cb19-12"></a>  <span class="dt">post_trial_gap</span><span class="op">:</span> <span class="dv">250</span></span>
<span id="cb19-13"><a href="#cb19-13"></a>}</span>
<span id="cb19-14"><a href="#cb19-14"></a></span>
<span id="cb19-15"><a href="#cb19-15"></a><span class="co">// ============================================</span></span>
<span id="cb19-16"><a href="#cb19-16"></a><span class="co">// Lexical Decision Task</span></span>
<span id="cb19-17"><a href="#cb19-17"></a><span class="co">// ============================================</span></span>
<span id="cb19-18"><a href="#cb19-18"></a></span>
<span id="cb19-19"><a href="#cb19-19"></a><span class="co">// Stimulus</span></span>
<span id="cb19-20"><a href="#cb19-20"></a></span>
<span id="cb19-21"><a href="#cb19-21"></a><span class="kw">let</span> trial <span class="op">=</span> {</span>
<span id="cb19-22"><a href="#cb19-22"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb19-23"><a href="#cb19-23"></a>  <span class="dt">stimulus</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">"stimulus"</span>)<span class="op">,</span></span>
<span id="cb19-24"><a href="#cb19-24"></a>  <span class="dt">choices</span><span class="op">:</span> [<span class="st">"w"</span><span class="op">,</span> <span class="st">"n"</span>]<span class="op">,</span></span>
<span id="cb19-25"><a href="#cb19-25"></a>  <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb19-26"><a href="#cb19-26"></a>    <span class="dt">correct_response</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">"correct_key"</span>)<span class="op">,</span></span>
<span id="cb19-27"><a href="#cb19-27"></a>    <span class="dt">task</span><span class="op">:</span> <span class="st">"Lexical Decision Task"</span></span>
<span id="cb19-28"><a href="#cb19-28"></a>  }<span class="op">,</span></span>
<span id="cb19-29"><a href="#cb19-29"></a>  <span class="dt">on_finish</span><span class="op">:</span> <span class="kw">function</span>(data) {</span>
<span id="cb19-30"><a href="#cb19-30"></a>    <span class="co">// Check if the response matches the correct response</span></span>
<span id="cb19-31"><a href="#cb19-31"></a>    data<span class="op">.</span><span class="at">correct</span> <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">pluginAPI</span><span class="op">.</span><span class="fu">compareKeys</span>(data<span class="op">.</span><span class="at">response</span><span class="op">,</span> data<span class="op">.</span><span class="at">correct_response</span>)<span class="op">;</span></span>
<span id="cb19-32"><a href="#cb19-32"></a></span>
<span id="cb19-33"><a href="#cb19-33"></a>  }</span>
<span id="cb19-34"><a href="#cb19-34"></a>}<span class="op">;</span></span>
<span id="cb19-35"><a href="#cb19-35"></a></span>
<span id="cb19-36"><a href="#cb19-36"></a><span class="co">// Conditional Feedback</span></span>
<span id="cb19-37"><a href="#cb19-37"></a></span>
<span id="cb19-38"><a href="#cb19-38"></a><span class="kw">let</span> feedback <span class="op">=</span> {</span>
<span id="cb19-39"><a href="#cb19-39"></a>  <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb19-40"><a href="#cb19-40"></a>    {</span>
<span id="cb19-41"><a href="#cb19-41"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb19-42"><a href="#cb19-42"></a>      <span class="dt">stimulus</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb19-43"><a href="#cb19-43"></a>        <span class="co">// Get the data from the trial that just finished</span></span>
<span id="cb19-44"><a href="#cb19-44"></a>        <span class="kw">let</span> last_trial <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">last</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">values</span>()[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb19-45"><a href="#cb19-45"></a></span>
<span id="cb19-46"><a href="#cb19-46"></a>        <span class="co">// Create feedback message</span></span>
<span id="cb19-47"><a href="#cb19-47"></a>        <span class="cf">return</span> <span class="vs">`&lt;p style="color: red; font-size: 24px;"&gt;Incorrect!&lt;/p&gt;</span></span>
<span id="cb19-48"><a href="#cb19-48"></a><span class="vs">                &lt;p&gt;You pressed: </span><span class="sc">${</span>last_trial<span class="op">.</span><span class="at">response</span><span class="sc">}</span><span class="vs">&lt;/p&gt;</span></span>
<span id="cb19-49"><a href="#cb19-49"></a><span class="vs">                &lt;p&gt;Correct response: </span><span class="sc">${</span>last_trial<span class="op">.</span><span class="at">correct_response</span><span class="sc">}</span><span class="vs">&lt;/p&gt;`</span><span class="op">;</span></span>
<span id="cb19-50"><a href="#cb19-50"></a>      }<span class="op">,</span></span>
<span id="cb19-51"><a href="#cb19-51"></a>      <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span><span class="op">,</span></span>
<span id="cb19-52"><a href="#cb19-52"></a>      <span class="dt">trial_duration</span><span class="op">:</span> <span class="dv">1500</span></span>
<span id="cb19-53"><a href="#cb19-53"></a>    }</span>
<span id="cb19-54"><a href="#cb19-54"></a>  ]<span class="op">,</span></span>
<span id="cb19-55"><a href="#cb19-55"></a>  <span class="dt">conditional_function</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb19-56"><a href="#cb19-56"></a>    <span class="co">// Get the data from the trial that just finished</span></span>
<span id="cb19-57"><a href="#cb19-57"></a>    <span class="kw">let</span> last_trial <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">last</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">values</span>()[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb19-58"><a href="#cb19-58"></a></span>
<span id="cb19-59"><a href="#cb19-59"></a>    <span class="co">// Only show feedback if they got it wrong</span></span>
<span id="cb19-60"><a href="#cb19-60"></a>    <span class="cf">if</span> (last_trial<span class="op">.</span><span class="at">correct</span> <span class="op">===</span> <span class="kw">true</span>) {</span>
<span id="cb19-61"><a href="#cb19-61"></a>      <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span>  <span class="co">// Dont show feedback</span></span>
<span id="cb19-62"><a href="#cb19-62"></a>    } <span class="cf">else</span> {</span>
<span id="cb19-63"><a href="#cb19-63"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span>   <span class="co">// Show feedback</span></span>
<span id="cb19-64"><a href="#cb19-64"></a>    }</span>
<span id="cb19-65"><a href="#cb19-65"></a>  }</span>
<span id="cb19-66"><a href="#cb19-66"></a>}<span class="op">;</span></span>
<span id="cb19-67"><a href="#cb19-67"></a></span>
<span id="cb19-68"><a href="#cb19-68"></a><span class="co">// Lexical Decision Timeline</span></span>
<span id="cb19-69"><a href="#cb19-69"></a></span>
<span id="cb19-70"><a href="#cb19-70"></a><span class="kw">let</span> trial_with_feedback <span class="op">=</span> {</span>
<span id="cb19-71"><a href="#cb19-71"></a>  <span class="dt">timeline</span><span class="op">:</span> [trial<span class="op">,</span> feedback]<span class="op">,</span></span>
<span id="cb19-72"><a href="#cb19-72"></a>  <span class="dt">timeline_variables</span><span class="op">:</span> [</span>
<span id="cb19-73"><a href="#cb19-73"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="st">"HOUSE"</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"w"</span>}<span class="op">,</span></span>
<span id="cb19-74"><a href="#cb19-74"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="st">"BLARB"</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"n"</span>}</span>
<span id="cb19-75"><a href="#cb19-75"></a>  ]</span>
<span id="cb19-76"><a href="#cb19-76"></a>}<span class="op">;</span></span>
<span id="cb19-77"><a href="#cb19-77"></a></span>
<span id="cb19-78"><a href="#cb19-78"></a><span class="co">// ============================================</span></span>
<span id="cb19-79"><a href="#cb19-79"></a><span class="co">// Experiment Timeline</span></span>
<span id="cb19-80"><a href="#cb19-80"></a><span class="co">// ============================================</span></span>
<span id="cb19-81"><a href="#cb19-81"></a></span>
<span id="cb19-82"><a href="#cb19-82"></a>jsPsych<span class="op">.</span><span class="fu">run</span>([</span>
<span id="cb19-83"><a href="#cb19-83"></a>  welcome<span class="op">,</span></span>
<span id="cb19-84"><a href="#cb19-84"></a>  trial_with_feedback</span>
<span id="cb19-85"><a href="#cb19-85"></a>])<span class="op">;</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="sourceCode" id="cb20"><pre class="sourceCode numberSource css number-lines code-with-copy"><code class="sourceCode css"><span id="cb20-1"><a href="#cb20-1"></a>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div id="demo-container-1" style="border: 1px solid #ddd; border-radius: 8px; overflow: hidden; transition: box-shadow 0.2s ease;">
<div style="background-color: #f8f9fa; padding: 8px 12px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center;">
<div>
<span style="font-weight: bold; color: #495057;">Live JsPsych Demo</span>
<span class="focus-indicator-1" style="margin-left: 10px; font-size: 11px; color: #6c757d; font-style: italic;">Click inside the demo to activate demo</span>
</div>
<div style="display: flex; gap: 8px;">
<button onclick="
            console.log('Full screen button clicked');
            var htmlContent = '<!DOCTYPE html>\n<html>\n  <head>\n    <title>Live JsPsych Demo</title>\n    <script src=\'https://unpkg.com/jspsych@8.2.2\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-preload@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-instructions@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-survey-text@2.1.0\'  crossorigin></script>\n        <script src=\'https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0\' crossorigin></script>\n\n    <link href=\'https://unpkg.com/jspsych@8.2.2/css/jspsych.css\' rel=\'stylesheet\' type=\'text/css\' crossorigin />\n\n\n    <style>\n      /* Paused overlay styles */\n      #paused-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-color: rgba(0, 0, 0, 0.7);\n        display: none;\n        justify-content: center;\n        align-items: center;\n        z-index: 9999;\n        font-family: Arial, sans-serif;\n      }\n\n      #paused-message {\n        background-color: white;\n        padding: 30px;\n        border-radius: 10px;\n        text-align: center;\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n        max-width: 300px;\n      }\n\n      #paused-message h2 {\n        margin-top: 0;\n        color: #dc3545;\n        font-size: 24px;\n      }\n\n      #paused-message p {\n        color: #666;\n        margin-bottom: 0;\n        font-size: 16px;\n      }\n\n      .pulse {\n        animation: pulse 2s infinite;\n      }\n\n      @keyframes pulse {\n        0% { opacity: 1; }\n        50% { opacity: 0.5; }\n        100% { opacity: 1; }\n      }\n    </style>\n  </head>\n  <body>\n    <!-- Paused overlay -->\n    <div id=\'paused-overlay\'>\n      <div id=\'paused-message\'>\n        <h2>Demo Paused</h2>\n        <p class=\'pulse\'>Click Anywhere to Resume</p>\n      </div>\n    </div>\n  </body>\n  <script>\n// Initialize jsPsych with interaction tracking and overlay control\nconst jsPsych = initJsPsych({\n  on_interaction_data_update: function(data) {\n    const overlay = document.getElementById(\'paused-overlay\');\n\n    if (data.event === \'blur\') {\n      // User clicked away - pause experiment and show overlay\n      jsPsych.pauseExperiment();\n      if (overlay) {\n        overlay.style.display = \'flex\';\n      }\n    } else if (data.event === \'focus\') {\n      // User returned - resume experiment and hide overlay\n      jsPsych.resumeExperiment();\n      if (overlay) {\n        overlay.style.display = \'none\';\n      }\n    }\n  }\n});\n\n// Make the overlay clickable to resume\ndocument.addEventListener(\'DOMContentLoaded\', function() {\n  const overlay = document.getElementById(\'paused-overlay\');\n  if (overlay) {\n    overlay.addEventListener(\'click\', function() {\n      // Focus the window and let the interaction handler resume\n      window.focus();\n    });\n  }\n});\n\n\n\n// ============================================\n// Instructions\n// ============================================\n\nconst welcome = {\n  type: jsPsychHtmlKeyboardResponse,\n  stimulus: `Welcome to the Experiment! Press any key to begin.`,\n  choices: &quot;ALL_KEYS&quot;, \n  post_trial_gap: 250\n}\n\n// ============================================\n// Lexical Decision Task\n// ============================================\n\n// Stimulus\n\nlet trial = {\n  type: jsPsychHtmlKeyboardResponse,\n  stimulus: jsPsych.timelineVariable(&quot;stimulus&quot;),\n  choices: [&quot;w&quot;, &quot;n&quot;],\n  data: {\n    correct_response: jsPsych.timelineVariable(&quot;correct_key&quot;),\n    task: &quot;Lexical Decision Task&quot;\n  },\n  on_finish: function(data) {\n    // Check if the response matches the correct response\n    data.correct = jsPsych.pluginAPI.compareKeys(data.response, data.correct_response);\n\n  }\n};\n\n// Conditional Feedback\n\nlet feedback = {\n  timeline: [\n    {\n      type: jsPsychHtmlKeyboardResponse,\n      stimulus: function() {\n        // Get the data from the trial that just finished\n        let last_trial = jsPsych.data.get().last(1).values()[0];\n\n        // Create feedback message\n        return `<p style=&quot;color: red; font-size: 24px;&quot;>Incorrect!</p>\n                <p>You pressed: ${last_trial.response}</p>\n                <p>Correct response: ${last_trial.correct_response}</p>`;\n      },\n      choices: &quot;NO_KEYS&quot;,\n      trial_duration: 1500\n    }\n  ],\n  conditional_function: function() {\n    // Get the data from the trial that just finished\n    let last_trial = jsPsych.data.get().last(1).values()[0];\n\n    // Only show feedback if they got it wrong\n    if (last_trial.correct === true) {\n      return false;  // Dont show feedback\n    } else {\n      return true;   // Show feedback\n    }\n  }\n};\n\n// Lexical Decision Timeline\n\nlet trial_with_feedback = {\n  timeline: [trial, feedback],\n  timeline_variables: [\n    {stimulus: &quot;HOUSE&quot;, correct_key: &quot;w&quot;},\n    {stimulus: &quot;BLARB&quot;, correct_key: &quot;n&quot;}\n  ]\n};\n\n// ============================================\n// Experiment Timeline\n// ============================================\n\njsPsych.run([\n  welcome,\n  trial_with_feedback\n]);\n  </script>\n</html>';
            var newWindow = window.open('', '_blank');
            if (newWindow) {
              newWindow.document.write(htmlContent);
              newWindow.document.close();
            } else {
              alert('Pop-up blocked! Please allow pop-ups for this site.');
            }
          " style="background-color: #28a745; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Open in New Tab</button>
<button onclick="
            var iframe = document.getElementById('demo-iframe-1');
            var srcdoc = iframe.getAttribute('srcdoc');
            iframe.setAttribute('srcdoc', '');
            setTimeout(function() {
              iframe.setAttribute('srcdoc', srcdoc);
            }, 10);
          " style="background-color: #007bff; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Refresh</button>
</div>
</div>
<iframe id="demo-iframe-1" srcdoc="<!DOCTYPE html>
<html>
  <head>
    <title>Live JsPsych Demo</title>
    <script src='https://unpkg.com/jspsych@8.2.2' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-preload@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-instructions@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-survey-text@2.1.0'  crossorigin></script>
        <script src='https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0' crossorigin></script>

    <link href='https://unpkg.com/jspsych@8.2.2/css/jspsych.css' rel='stylesheet' type='text/css' crossorigin />


    <style>
      /* Paused overlay styles */
      #paused-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        font-family: Arial, sans-serif;
      }

      #paused-message {
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        max-width: 300px;
      }

      #paused-message h2 {
        margin-top: 0;
        color: #dc3545;
        font-size: 24px;
      }

      #paused-message p {
        color: #666;
        margin-bottom: 0;
        font-size: 16px;
      }

      .pulse {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
      }
    </style>
  </head>
  <body style='max-height: 300px'>
    <!-- Paused overlay -->
    <div id='paused-overlay'>
      <div id='paused-message'>
        <h2>Demo Paused</h2>
        <p class='pulse'>Click Anywhere to Resume</p>
      </div>
    </div>
  </body>
  <script>
// Initialize jsPsych with interaction tracking and overlay control
const jsPsych = initJsPsych({
  on_interaction_data_update: function(data) {
    const overlay = document.getElementById('paused-overlay');

    if (data.event === 'blur') {
      // User clicked away - pause experiment and show overlay
      jsPsych.pauseExperiment();
      if (overlay) {
        overlay.style.display = 'flex';
      }
    } else if (data.event === 'focus') {
      // User returned - resume experiment and hide overlay
      jsPsych.resumeExperiment();
      if (overlay) {
        overlay.style.display = 'none';
      }
    }
  }
});

// Make the overlay clickable to resume
document.addEventListener('DOMContentLoaded', function() {
  const overlay = document.getElementById('paused-overlay');
  if (overlay) {
    overlay.addEventListener('click', function() {
      // Focus the window and let the interaction handler resume
      window.focus();
    });
  }
});



// ============================================
// Instructions
// ============================================

const welcome = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: `Welcome to the Experiment! Press any key to begin.`,
  choices: &quot;ALL_KEYS&quot;, 
  post_trial_gap: 250
}

// ============================================
// Lexical Decision Task
// ============================================

// Stimulus

let trial = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: jsPsych.timelineVariable(&quot;stimulus&quot;),
  choices: [&quot;w&quot;, &quot;n&quot;],
  data: {
    correct_response: jsPsych.timelineVariable(&quot;correct_key&quot;),
    task: &quot;Lexical Decision Task&quot;
  },
  on_finish: function(data) {
    // Check if the response matches the correct response
    data.correct = jsPsych.pluginAPI.compareKeys(data.response, data.correct_response);

  }
};

// Conditional Feedback

let feedback = {
  timeline: [
    {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: function() {
        // Get the data from the trial that just finished
        let last_trial = jsPsych.data.get().last(1).values()[0];

        // Create feedback message
        return `<p style=&quot;color: red; font-size: 24px;&quot;>Incorrect!</p>
                <p>You pressed: ${last_trial.response}</p>
                <p>Correct response: ${last_trial.correct_response}</p>`;
      },
      choices: &quot;NO_KEYS&quot;,
      trial_duration: 1500
    }
  ],
  conditional_function: function() {
    // Get the data from the trial that just finished
    let last_trial = jsPsych.data.get().last(1).values()[0];

    // Only show feedback if they got it wrong
    if (last_trial.correct === true) {
      return false;  // Dont show feedback
    } else {
      return true;   // Show feedback
    }
  }
};

// Lexical Decision Timeline

let trial_with_feedback = {
  timeline: [trial, feedback],
  timeline_variables: [
    {stimulus: &quot;HOUSE&quot;, correct_key: &quot;w&quot;},
    {stimulus: &quot;BLARB&quot;, correct_key: &quot;n&quot;}
  ]
};

// ============================================
// Experiment Timeline
// ============================================

jsPsych.run([
  welcome,
  trial_with_feedback
]);
  </script>
</html>" width="100%" height="300px" scrolling="yes" style="border: none; display: block;" onload="javascript:(function(iframe){
        var container = document.getElementById(&quot;demo-container-1&quot;);
        var indicator = container.querySelector(&quot;.focus-indicator-1&quot;);

        function showFocus() {
          container.style.boxShadow = &quot;0 0 0 3px #007bff&quot;;
          if (indicator) {
            indicator.textContent = &quot;✓ Demo Active&quot;;
            indicator.style.color = &quot;#28a745&quot;;
          }
        }

        function hideFocus() {
          container.style.boxShadow = &quot;none&quot;;
          if (indicator) {
            indicator.textContent = &quot;Click inside the demo to activate&quot;;
            indicator.style.color = &quot;#6c757d&quot;;
          }
        }

        var iframeWindow = iframe.contentWindow;
        if (iframeWindow) {
          iframeWindow.onfocus = showFocus;
          iframeWindow.onblur = hideFocus;
          iframeWindow.document.addEventListener(&quot;click&quot;, function() {
            iframeWindow.focus();
            showFocus();
          });
          document.addEventListener(&quot;click&quot;, function(e) {
            if (!container.contains(e.target)) {
              iframeWindow.blur();
              hideFocus();
            }
          });
        }
      }(this));"></iframe>
</div>
</div>
</div>
</div>
</section>
<section id="simplifying-the-conditional-logic" class="level4" data-number="19.5.1.4">
<h4 data-number="19.5.1.4" class="anchored" data-anchor-id="simplifying-the-conditional-logic"><span class="header-section-number">19.5.1.4</span> Simplifying the Conditional Logic</h4>
<p>You might notice that our conditional function is a bit verbose. There are always multiple ways to write the same code. In this case, we could write it in at least three different ways:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb21-1"><a href="#cb21-1"></a>conditional_function<span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb21-2"><a href="#cb21-2"></a>  <span class="kw">let</span> last_trial <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">last</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">values</span>()[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb21-3"><a href="#cb21-3"></a></span>
<span id="cb21-4"><a href="#cb21-4"></a>  <span class="co">// These three versions do the same thing:</span></span>
<span id="cb21-5"><a href="#cb21-5"></a></span>
<span id="cb21-6"><a href="#cb21-6"></a>  <span class="co">// Version 1: Explicit if/else</span></span>
<span id="cb21-7"><a href="#cb21-7"></a>  <span class="cf">if</span> (last_trial<span class="op">.</span><span class="at">correct</span> <span class="op">===</span> <span class="kw">true</span>) {</span>
<span id="cb21-8"><a href="#cb21-8"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb21-9"><a href="#cb21-9"></a>  } <span class="cf">else</span> {</span>
<span id="cb21-10"><a href="#cb21-10"></a>    <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb21-11"><a href="#cb21-11"></a>  }</span>
<span id="cb21-12"><a href="#cb21-12"></a></span>
<span id="cb21-13"><a href="#cb21-13"></a>  <span class="co">// Version 2: Return the opposite of correct</span></span>
<span id="cb21-14"><a href="#cb21-14"></a>  <span class="cf">return</span> <span class="op">!</span>last_trial<span class="op">.</span><span class="at">correct</span><span class="op">;</span>  <span class="co">// ! means "not"</span></span>
<span id="cb21-15"><a href="#cb21-15"></a></span>
<span id="cb21-16"><a href="#cb21-16"></a>  <span class="co">// Version 3: Check if correct is false</span></span>
<span id="cb21-17"><a href="#cb21-17"></a>  <span class="cf">return</span> last_trial<span class="op">.</span><span class="at">correct</span> <span class="op">===</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb21-18"><a href="#cb21-18"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>All three versions work identically. Use whichever makes the most sense to you. The <code>!</code> operator (called “not”) flips true to false and false to true, which is handy for these situations.</p>
<p>As a beginner, I’d stick with the code that is the clearest to you, even if that means it’s more verbose.</p>
</section>
</section>
<section id="example-skip-based-on-survey-response" class="level3" data-number="19.5.2">
<h3 data-number="19.5.2" class="anchored" data-anchor-id="example-skip-based-on-survey-response"><span class="header-section-number">19.5.2</span> Example: Skip Based on Survey Response</h3>
<p>Let’s look at another simple example. Imagine you want to ask participants if they wear glasses, and only show a follow-up question if they answer “Yes”. I won’t walk through the steps of creating this example, but the general principles are the same as the previous.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">index.html</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">exp.js</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">style.css</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false">Result</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="sourceCode" id="cb22"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb22-1"><a href="#cb22-1"></a> <span class="dt">&lt;!DOCTYPE</span> html<span class="dt">&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb22-4"><a href="#cb22-4"></a>    <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>Demo<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb22-5"><a href="#cb22-5"></a>    <span class="co">&lt;!-- jsPsych --&gt;</span></span>
<span id="cb22-6"><a href="#cb22-6"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/jspsych.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb22-7"><a href="#cb22-7"></a>    <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> href</span><span class="op">=</span><span class="st">"jspsych/jspsych.css"</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text/css"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb22-8"><a href="#cb22-8"></a>    </span>
<span id="cb22-9"><a href="#cb22-9"></a>    <span class="co">&lt;!-- jPsych plugins --&gt;</span></span>
<span id="cb22-10"><a href="#cb22-10"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/plugin-html-keyboard-response.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb22-11"><a href="#cb22-11"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/plugin-survey-text.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb22-12"><a href="#cb22-12"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/plugin-survey-multi-choice.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb22-13"><a href="#cb22-13"></a></span>
<span id="cb22-14"><a href="#cb22-14"></a>    <span class="co">&lt;!-- custom CSS --&gt;</span></span>
<span id="cb22-15"><a href="#cb22-15"></a>     <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> href</span><span class="op">=</span><span class="st">"style.css"</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text/css"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb22-16"><a href="#cb22-16"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb22-17"><a href="#cb22-17"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb22-18"><a href="#cb22-18"></a>  <span class="co">&lt;!-- custom JS --&gt;</span></span>
<span id="cb22-19"><a href="#cb22-19"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"exp.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb22-20"><a href="#cb22-20"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb22-21"><a href="#cb22-21"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb22-22"><a href="#cb22-22"></a> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="sourceCode" id="cb23"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb23-1"><a href="#cb23-1"></a> </span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="kw">const</span> jsPsych <span class="op">=</span> <span class="fu">initJsPsych</span>()<span class="op">;</span> </span>
<span id="cb23-3"><a href="#cb23-3"></a></span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="co">// ============================================</span></span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="co">// Instructions</span></span>
<span id="cb23-6"><a href="#cb23-6"></a><span class="co">// ============================================</span></span>
<span id="cb23-7"><a href="#cb23-7"></a></span>
<span id="cb23-8"><a href="#cb23-8"></a><span class="kw">const</span> welcome <span class="op">=</span> {</span>
<span id="cb23-9"><a href="#cb23-9"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb23-10"><a href="#cb23-10"></a>  <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`Welcome to the Experiment! Press any key to begin.`</span><span class="op">,</span></span>
<span id="cb23-11"><a href="#cb23-11"></a>  <span class="dt">choices</span><span class="op">:</span> <span class="st">"ALL_KEYS"</span><span class="op">,</span> </span>
<span id="cb23-12"><a href="#cb23-12"></a>  <span class="dt">post_trial_gap</span><span class="op">:</span> <span class="dv">250</span></span>
<span id="cb23-13"><a href="#cb23-13"></a>}</span>
<span id="cb23-14"><a href="#cb23-14"></a></span>
<span id="cb23-15"><a href="#cb23-15"></a><span class="kw">const</span> debrief <span class="op">=</span> {</span>
<span id="cb23-16"><a href="#cb23-16"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb23-17"><a href="#cb23-17"></a>  <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`Thank you for completing our survey!`</span><span class="op">,</span></span>
<span id="cb23-18"><a href="#cb23-18"></a>  <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span><span class="op">,</span> </span>
<span id="cb23-19"><a href="#cb23-19"></a>  <span class="dt">post_trial_gap</span><span class="op">:</span> <span class="dv">250</span></span>
<span id="cb23-20"><a href="#cb23-20"></a>}</span>
<span id="cb23-21"><a href="#cb23-21"></a></span>
<span id="cb23-22"><a href="#cb23-22"></a><span class="co">// ============================================</span></span>
<span id="cb23-23"><a href="#cb23-23"></a><span class="co">// Vision Questionnaire</span></span>
<span id="cb23-24"><a href="#cb23-24"></a><span class="co">// ============================================</span></span>
<span id="cb23-25"><a href="#cb23-25"></a></span>
<span id="cb23-26"><a href="#cb23-26"></a><span class="kw">let</span> glasses_question <span class="op">=</span> {</span>
<span id="cb23-27"><a href="#cb23-27"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychSurveyMultiChoice<span class="op">,</span></span>
<span id="cb23-28"><a href="#cb23-28"></a>  <span class="dt">questions</span><span class="op">:</span> [</span>
<span id="cb23-29"><a href="#cb23-29"></a>    {</span>
<span id="cb23-30"><a href="#cb23-30"></a>      <span class="dt">prompt</span><span class="op">:</span> <span class="st">"Do you wear glasses or contact lenses?"</span><span class="op">,</span></span>
<span id="cb23-31"><a href="#cb23-31"></a>      <span class="dt">options</span><span class="op">:</span> [<span class="st">"Yes"</span><span class="op">,</span> <span class="st">"No"</span>]<span class="op">,</span></span>
<span id="cb23-32"><a href="#cb23-32"></a>      <span class="dt">required</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb23-33"><a href="#cb23-33"></a>      <span class="dt">name</span><span class="op">:</span> <span class="st">"wears_glasses"</span></span>
<span id="cb23-34"><a href="#cb23-34"></a>    }</span>
<span id="cb23-35"><a href="#cb23-35"></a>  ]</span>
<span id="cb23-36"><a href="#cb23-36"></a>}<span class="op">;</span></span>
<span id="cb23-37"><a href="#cb23-37"></a></span>
<span id="cb23-38"><a href="#cb23-38"></a><span class="kw">let</span> glasses_followup <span class="op">=</span> {</span>
<span id="cb23-39"><a href="#cb23-39"></a>  <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb23-40"><a href="#cb23-40"></a>    {</span>
<span id="cb23-41"><a href="#cb23-41"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychSurveyText<span class="op">,</span></span>
<span id="cb23-42"><a href="#cb23-42"></a>      <span class="dt">questions</span><span class="op">:</span> [</span>
<span id="cb23-43"><a href="#cb23-43"></a>        {</span>
<span id="cb23-44"><a href="#cb23-44"></a>          <span class="dt">prompt</span><span class="op">:</span> <span class="st">"How many years have you been wearing glasses or contacts?"</span><span class="op">,</span></span>
<span id="cb23-45"><a href="#cb23-45"></a>          <span class="dt">name</span><span class="op">:</span> <span class="st">"years_wearing_glasses"</span><span class="op">,</span></span>
<span id="cb23-46"><a href="#cb23-46"></a>          <span class="dt">required</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb23-47"><a href="#cb23-47"></a>        }</span>
<span id="cb23-48"><a href="#cb23-48"></a>      ]</span>
<span id="cb23-49"><a href="#cb23-49"></a>    }</span>
<span id="cb23-50"><a href="#cb23-50"></a>  ]<span class="op">,</span></span>
<span id="cb23-51"><a href="#cb23-51"></a>  <span class="dt">conditional_function</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb23-52"><a href="#cb23-52"></a>    <span class="co">// Get the response from the previous question</span></span>
<span id="cb23-53"><a href="#cb23-53"></a>    <span class="kw">let</span> last_response <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">last</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">values</span>()[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb23-54"><a href="#cb23-54"></a></span>
<span id="cb23-55"><a href="#cb23-55"></a>    <span class="co">// Only show this follow-up if they answered "Yes"</span></span>
<span id="cb23-56"><a href="#cb23-56"></a>    <span class="cf">if</span> (last_response<span class="op">.</span><span class="at">response</span><span class="op">.</span><span class="at">wears_glasses</span> <span class="op">===</span> <span class="st">"Yes"</span>) {</span>
<span id="cb23-57"><a href="#cb23-57"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span>   <span class="co">// Show the follow-up</span></span>
<span id="cb23-58"><a href="#cb23-58"></a>    } <span class="cf">else</span> {</span>
<span id="cb23-59"><a href="#cb23-59"></a>      <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span>  <span class="co">// Skip the follow-up</span></span>
<span id="cb23-60"><a href="#cb23-60"></a>    }</span>
<span id="cb23-61"><a href="#cb23-61"></a>  }</span>
<span id="cb23-62"><a href="#cb23-62"></a>}<span class="op">;</span></span>
<span id="cb23-63"><a href="#cb23-63"></a></span>
<span id="cb23-64"><a href="#cb23-64"></a><span class="co">// Run both in sequence</span></span>
<span id="cb23-65"><a href="#cb23-65"></a><span class="kw">let</span> vision_questions <span class="op">=</span> {</span>
<span id="cb23-66"><a href="#cb23-66"></a>  <span class="dt">timeline</span><span class="op">:</span> [glasses_question<span class="op">,</span> glasses_followup]</span>
<span id="cb23-67"><a href="#cb23-67"></a>}<span class="op">;</span></span>
<span id="cb23-68"><a href="#cb23-68"></a></span>
<span id="cb23-69"><a href="#cb23-69"></a><span class="co">// ============================================</span></span>
<span id="cb23-70"><a href="#cb23-70"></a><span class="co">// Experiment Timeline</span></span>
<span id="cb23-71"><a href="#cb23-71"></a><span class="co">// ============================================</span></span>
<span id="cb23-72"><a href="#cb23-72"></a></span>
<span id="cb23-73"><a href="#cb23-73"></a>jsPsych<span class="op">.</span><span class="fu">run</span>([</span>
<span id="cb23-74"><a href="#cb23-74"></a>  welcome<span class="op">,</span></span>
<span id="cb23-75"><a href="#cb23-75"></a>  vision_questions<span class="op">,</span></span>
<span id="cb23-76"><a href="#cb23-76"></a>  debrief</span>
<span id="cb23-77"><a href="#cb23-77"></a>])<span class="op">;</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="sourceCode" id="cb24"><pre class="sourceCode numberSource css number-lines code-with-copy"><code class="sourceCode css"><span id="cb24-1"><a href="#cb24-1"></a>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<div id="demo-container-2" style="border: 1px solid #ddd; border-radius: 8px; overflow: hidden; transition: box-shadow 0.2s ease;">
<div style="background-color: #f8f9fa; padding: 8px 12px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center;">
<div>
<span style="font-weight: bold; color: #495057;">Live JsPsych Demo</span>
<span class="focus-indicator-2" style="margin-left: 10px; font-size: 11px; color: #6c757d; font-style: italic;">Click inside the demo to activate demo</span>
</div>
<div style="display: flex; gap: 8px;">
<button onclick="
            console.log('Full screen button clicked');
            var htmlContent = '<!DOCTYPE html>\n<html>\n  <head>\n    <title>Live JsPsych Demo</title>\n    <script src=\'https://unpkg.com/jspsych@8.2.2\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-preload@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-instructions@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-survey-text@2.1.0\'  crossorigin></script>\n        <script src=\'https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0\' crossorigin></script>\n\n    <link href=\'https://unpkg.com/jspsych@8.2.2/css/jspsych.css\' rel=\'stylesheet\' type=\'text/css\' crossorigin />\n\n\n    <style>\n      /* Paused overlay styles */\n      #paused-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-color: rgba(0, 0, 0, 0.7);\n        display: none;\n        justify-content: center;\n        align-items: center;\n        z-index: 9999;\n        font-family: Arial, sans-serif;\n      }\n\n      #paused-message {\n        background-color: white;\n        padding: 30px;\n        border-radius: 10px;\n        text-align: center;\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n        max-width: 300px;\n      }\n\n      #paused-message h2 {\n        margin-top: 0;\n        color: #dc3545;\n        font-size: 24px;\n      }\n\n      #paused-message p {\n        color: #666;\n        margin-bottom: 0;\n        font-size: 16px;\n      }\n\n      .pulse {\n        animation: pulse 2s infinite;\n      }\n\n      @keyframes pulse {\n        0% { opacity: 1; }\n        50% { opacity: 0.5; }\n        100% { opacity: 1; }\n      }\n    </style>\n  </head>\n  <body>\n    <!-- Paused overlay -->\n    <div id=\'paused-overlay\'>\n      <div id=\'paused-message\'>\n        <h2>Demo Paused</h2>\n        <p class=\'pulse\'>Click Anywhere to Resume</p>\n      </div>\n    </div>\n  </body>\n  <script>\n// Initialize jsPsych with interaction tracking and overlay control\nconst jsPsych = initJsPsych({\n  on_interaction_data_update: function(data) {\n    const overlay = document.getElementById(\'paused-overlay\');\n\n    if (data.event === \'blur\') {\n      // User clicked away - pause experiment and show overlay\n      jsPsych.pauseExperiment();\n      if (overlay) {\n        overlay.style.display = \'flex\';\n      }\n    } else if (data.event === \'focus\') {\n      // User returned - resume experiment and hide overlay\n      jsPsych.resumeExperiment();\n      if (overlay) {\n        overlay.style.display = \'none\';\n      }\n    }\n  }\n});\n\n// Make the overlay clickable to resume\ndocument.addEventListener(\'DOMContentLoaded\', function() {\n  const overlay = document.getElementById(\'paused-overlay\');\n  if (overlay) {\n    overlay.addEventListener(\'click\', function() {\n      // Focus the window and let the interaction handler resume\n      window.focus();\n    });\n  }\n});\n\n\n\n// ============================================\n// Instructions\n// ============================================\n\nconst welcome = {\n  type: jsPsychHtmlKeyboardResponse,\n  stimulus: `Welcome to the Experiment! Press any key to begin.`,\n  choices: &quot;ALL_KEYS&quot;, \n  post_trial_gap: 250\n}\n\nconst debrief = {\n  type: jsPsychHtmlKeyboardResponse,\n  stimulus: `Thank you for completing our survey!`,\n  choices: &quot;NO_KEYS&quot;, \n  post_trial_gap: 250\n}\n\n// ============================================\n// Vision Questionnaire\n// ============================================\n\nlet glasses_question = {\n  type: jsPsychSurveyMultiChoice,\n  questions: [\n    {\n      prompt: &quot;Do you wear glasses or contact lenses?&quot;,\n      options: [&quot;Yes&quot;, &quot;No&quot;],\n      required: true,\n      name: &quot;wears_glasses&quot;\n    }\n  ]\n};\n\nlet glasses_followup = {\n  timeline: [\n    {\n      type: jsPsychSurveyText,\n      questions: [\n        {\n          prompt: &quot;How many years have you been wearing glasses or contacts?&quot;,\n          name: &quot;years_wearing_glasses&quot;,\n          required: true\n        }\n      ]\n    }\n  ],\n  conditional_function: function() {\n    // Get the response from the previous question\n    let last_response = jsPsych.data.get().last(1).values()[0];\n\n    // Only show this follow-up if they answered &quot;Yes&quot;\n    if (last_response.response.wears_glasses === &quot;Yes&quot;) {\n      return true;   // Show the follow-up\n    } else {\n      return false;  // Skip the follow-up\n    }\n  }\n};\n\n// Run both in sequence\nlet vision_questions = {\n  timeline: [glasses_question, glasses_followup]\n};\n\n// ============================================\n// Experiment Timeline\n// ============================================\n\njsPsych.run([\n  welcome,\n  vision_questions,\n  debrief\n]);\n  </script>\n</html>';
            var newWindow = window.open('', '_blank');
            if (newWindow) {
              newWindow.document.write(htmlContent);
              newWindow.document.close();
            } else {
              alert('Pop-up blocked! Please allow pop-ups for this site.');
            }
          " style="background-color: #28a745; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Open in New Tab</button>
<button onclick="
            var iframe = document.getElementById('demo-iframe-2');
            var srcdoc = iframe.getAttribute('srcdoc');
            iframe.setAttribute('srcdoc', '');
            setTimeout(function() {
              iframe.setAttribute('srcdoc', srcdoc);
            }, 10);
          " style="background-color: #007bff; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Refresh</button>
</div>
</div>
<iframe id="demo-iframe-2" srcdoc="<!DOCTYPE html>
<html>
  <head>
    <title>Live JsPsych Demo</title>
    <script src='https://unpkg.com/jspsych@8.2.2' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-preload@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-instructions@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-survey-text@2.1.0'  crossorigin></script>
        <script src='https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0' crossorigin></script>

    <link href='https://unpkg.com/jspsych@8.2.2/css/jspsych.css' rel='stylesheet' type='text/css' crossorigin />


    <style>
      /* Paused overlay styles */
      #paused-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        font-family: Arial, sans-serif;
      }

      #paused-message {
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        max-width: 300px;
      }

      #paused-message h2 {
        margin-top: 0;
        color: #dc3545;
        font-size: 24px;
      }

      #paused-message p {
        color: #666;
        margin-bottom: 0;
        font-size: 16px;
      }

      .pulse {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
      }
    </style>
  </head>
  <body style='max-height: 300px'>
    <!-- Paused overlay -->
    <div id='paused-overlay'>
      <div id='paused-message'>
        <h2>Demo Paused</h2>
        <p class='pulse'>Click Anywhere to Resume</p>
      </div>
    </div>
  </body>
  <script>
// Initialize jsPsych with interaction tracking and overlay control
const jsPsych = initJsPsych({
  on_interaction_data_update: function(data) {
    const overlay = document.getElementById('paused-overlay');

    if (data.event === 'blur') {
      // User clicked away - pause experiment and show overlay
      jsPsych.pauseExperiment();
      if (overlay) {
        overlay.style.display = 'flex';
      }
    } else if (data.event === 'focus') {
      // User returned - resume experiment and hide overlay
      jsPsych.resumeExperiment();
      if (overlay) {
        overlay.style.display = 'none';
      }
    }
  }
});

// Make the overlay clickable to resume
document.addEventListener('DOMContentLoaded', function() {
  const overlay = document.getElementById('paused-overlay');
  if (overlay) {
    overlay.addEventListener('click', function() {
      // Focus the window and let the interaction handler resume
      window.focus();
    });
  }
});



// ============================================
// Instructions
// ============================================

const welcome = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: `Welcome to the Experiment! Press any key to begin.`,
  choices: &quot;ALL_KEYS&quot;, 
  post_trial_gap: 250
}

const debrief = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: `Thank you for completing our survey!`,
  choices: &quot;NO_KEYS&quot;, 
  post_trial_gap: 250
}

// ============================================
// Vision Questionnaire
// ============================================

let glasses_question = {
  type: jsPsychSurveyMultiChoice,
  questions: [
    {
      prompt: &quot;Do you wear glasses or contact lenses?&quot;,
      options: [&quot;Yes&quot;, &quot;No&quot;],
      required: true,
      name: &quot;wears_glasses&quot;
    }
  ]
};

let glasses_followup = {
  timeline: [
    {
      type: jsPsychSurveyText,
      questions: [
        {
          prompt: &quot;How many years have you been wearing glasses or contacts?&quot;,
          name: &quot;years_wearing_glasses&quot;,
          required: true
        }
      ]
    }
  ],
  conditional_function: function() {
    // Get the response from the previous question
    let last_response = jsPsych.data.get().last(1).values()[0];

    // Only show this follow-up if they answered &quot;Yes&quot;
    if (last_response.response.wears_glasses === &quot;Yes&quot;) {
      return true;   // Show the follow-up
    } else {
      return false;  // Skip the follow-up
    }
  }
};

// Run both in sequence
let vision_questions = {
  timeline: [glasses_question, glasses_followup]
};

// ============================================
// Experiment Timeline
// ============================================

jsPsych.run([
  welcome,
  vision_questions,
  debrief
]);
  </script>
</html>" width="100%" height="300px" scrolling="yes" style="border: none; display: block;" onload="javascript:(function(iframe){
        var container = document.getElementById(&quot;demo-container-2&quot;);
        var indicator = container.querySelector(&quot;.focus-indicator-2&quot;);

        function showFocus() {
          container.style.boxShadow = &quot;0 0 0 3px #007bff&quot;;
          if (indicator) {
            indicator.textContent = &quot;✓ Demo Active&quot;;
            indicator.style.color = &quot;#28a745&quot;;
          }
        }

        function hideFocus() {
          container.style.boxShadow = &quot;none&quot;;
          if (indicator) {
            indicator.textContent = &quot;Click inside the demo to activate&quot;;
            indicator.style.color = &quot;#6c757d&quot;;
          }
        }

        var iframeWindow = iframe.contentWindow;
        if (iframeWindow) {
          iframeWindow.onfocus = showFocus;
          iframeWindow.onblur = hideFocus;
          iframeWindow.document.addEventListener(&quot;click&quot;, function() {
            iframeWindow.focus();
            showFocus();
          });
          document.addEventListener(&quot;click&quot;, function(e) {
            if (!container.contains(e.target)) {
              iframeWindow.blur();
              hideFocus();
            }
          });
        }
      }(this));"></iframe>
</div>
</div>
</div>
</div>
<p>Let’s break this down:</p>
<ol type="1">
<li>First question: We ask if they wear glasses, storing the response with the name ‘wears_glasses’</li>
<li>Follow-up question: We wrap it in a timeline so we can add a conditional_function</li>
<li>Conditional logic:
<ul>
<li>We get the last trial’s data (the glasses question)</li>
<li>We check if their response to wears_glasses was “Yes”</li>
<li>If yes, return true to show the follow-up</li>
<li>If no, return false to skip it</li>
</ul></li>
</ol>
<p>This is a common pattern in surveys where you only want to ask certain questions based on previous answers. Participants who answered “No” will never see the follow-up question, and the experiment will simply continue to whatever comes next.</p>
</section>
<section id="example-conditional-inattention-warning" class="level3" data-number="19.5.3">
<h3 data-number="19.5.3" class="anchored" data-anchor-id="example-conditional-inattention-warning"><span class="header-section-number">19.5.3</span> Example: Conditional Inattention Warning</h3>
<p>Here’s a more complicated, but practical example for online studies. The Sustained Attention to Response Task (SART) is designed to measure attention lapses. Participants see a series of digits (1-9) presented one at a time, and their job is to press the spacebar for every digit except the number 3. When they see a 3, they should withhold their response.</p>
<p>The key feature of the SART is that trials don’t wait for a response. Each digit appears for a fixed duration (typically around 1 second) and then the next digit appears automatically. This means participants can miss trials, which could indicate an attention lapse.</p>
<p>However, in online studies, we can’t monitor participants directly. We don’t know if they’re texting on their phone, if they’ve opened another browser tab, or if they’ve simply walked away from the computer. While missing one or two trials in a row might reflect normal attention lapses (which is what we’re trying to measure), missing many trials in a row suggests the participant isn’t doing the task at all.</p>
<p>One solution is to pause the task and show a warning if participants miss more trials than we’d expect from normal attention lapses. This helps ensure they’re actually engaged with the task:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">index.html</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">exp.js</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">style.css</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false">Result</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="sourceCode" id="cb25"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb25-1"><a href="#cb25-1"></a> <span class="dt">&lt;!DOCTYPE</span> html<span class="dt">&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4"></a>    <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>Demo<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb25-5"><a href="#cb25-5"></a>    <span class="co">&lt;!-- jsPsych --&gt;</span></span>
<span id="cb25-6"><a href="#cb25-6"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/jspsych.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb25-7"><a href="#cb25-7"></a>    <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> href</span><span class="op">=</span><span class="st">"jspsych/jspsych.css"</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text/css"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb25-8"><a href="#cb25-8"></a>    </span>
<span id="cb25-9"><a href="#cb25-9"></a>    <span class="co">&lt;!-- jPsych plugins --&gt;</span></span>
<span id="cb25-10"><a href="#cb25-10"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/plugin-html-keyboard-response.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb25-11"><a href="#cb25-11"></a></span>
<span id="cb25-12"><a href="#cb25-12"></a>    <span class="co">&lt;!-- custom CSS --&gt;</span></span>
<span id="cb25-13"><a href="#cb25-13"></a>     <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> href</span><span class="op">=</span><span class="st">"style.css"</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text/css"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb25-14"><a href="#cb25-14"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb25-15"><a href="#cb25-15"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb25-16"><a href="#cb25-16"></a>  <span class="co">&lt;!-- custom JS --&gt;</span></span>
<span id="cb25-17"><a href="#cb25-17"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"exp.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb25-18"><a href="#cb25-18"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb25-19"><a href="#cb25-19"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb25-20"><a href="#cb25-20"></a> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="sourceCode" id="cb26"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb26-1"><a href="#cb26-1"></a> </span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="kw">const</span> jsPsych <span class="op">=</span> <span class="fu">initJsPsych</span>()<span class="op">;</span></span>
<span id="cb26-3"><a href="#cb26-3"></a></span>
<span id="cb26-4"><a href="#cb26-4"></a> <span class="co">// ============================================</span></span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="co">// Instructions</span></span>
<span id="cb26-6"><a href="#cb26-6"></a><span class="co">// ============================================</span></span>
<span id="cb26-7"><a href="#cb26-7"></a></span>
<span id="cb26-8"><a href="#cb26-8"></a><span class="kw">const</span> welcome <span class="op">=</span> {</span>
<span id="cb26-9"><a href="#cb26-9"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb26-10"><a href="#cb26-10"></a>  <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`Welcome to the Experiment! Press any key to begin.`</span><span class="op">,</span></span>
<span id="cb26-11"><a href="#cb26-11"></a>  <span class="dt">choices</span><span class="op">:</span> <span class="st">"ALL_KEYS"</span><span class="op">,</span> </span>
<span id="cb26-12"><a href="#cb26-12"></a>  <span class="dt">post_trial_gap</span><span class="op">:</span> <span class="dv">250</span></span>
<span id="cb26-13"><a href="#cb26-13"></a>}</span>
<span id="cb26-14"><a href="#cb26-14"></a></span>
<span id="cb26-15"><a href="#cb26-15"></a><span class="co">// ============================================</span></span>
<span id="cb26-16"><a href="#cb26-16"></a><span class="co">// Sustained Attention to Response Task</span></span>
<span id="cb26-17"><a href="#cb26-17"></a><span class="co">// ============================================</span></span>
<span id="cb26-18"><a href="#cb26-18"></a></span>
<span id="cb26-19"><a href="#cb26-19"></a><span class="co">// Variable to track consecutive misses</span></span>
<span id="cb26-20"><a href="#cb26-20"></a></span>
<span id="cb26-21"><a href="#cb26-21"></a><span class="kw">let</span> missed_in_a_row <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb26-22"><a href="#cb26-22"></a></span>
<span id="cb26-23"><a href="#cb26-23"></a><span class="co">// sart trial</span></span>
<span id="cb26-24"><a href="#cb26-24"></a></span>
<span id="cb26-25"><a href="#cb26-25"></a><span class="kw">let</span> sart_trial <span class="op">=</span> {</span>
<span id="cb26-26"><a href="#cb26-26"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb26-27"><a href="#cb26-27"></a>  <span class="dt">stimulus</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">"digit"</span>)<span class="op">,</span></span>
<span id="cb26-28"><a href="#cb26-28"></a>  <span class="dt">choices</span><span class="op">:</span> [<span class="st">" "</span>]<span class="op">,</span>  <span class="co">// Spacebar</span></span>
<span id="cb26-29"><a href="#cb26-29"></a>  <span class="dt">trial_duration</span><span class="op">:</span> <span class="dv">1000</span><span class="op">,</span>  <span class="co">// Trial proceeds automatically after 1 second</span></span>
<span id="cb26-30"><a href="#cb26-30"></a>  <span class="dt">response_ends_trial</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span>  <span class="co">// response does NOT end the trial</span></span>
<span id="cb26-31"><a href="#cb26-31"></a>  <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb26-32"><a href="#cb26-32"></a>    <span class="dt">digit</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">"digit"</span>)<span class="op">,</span></span>
<span id="cb26-33"><a href="#cb26-33"></a>    <span class="dt">is_target</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">"is_target"</span>)</span>
<span id="cb26-34"><a href="#cb26-34"></a>  }<span class="op">,</span></span>
<span id="cb26-35"><a href="#cb26-35"></a>  <span class="dt">on_finish</span><span class="op">:</span> <span class="kw">function</span>(data) {</span>
<span id="cb26-36"><a href="#cb26-36"></a>    <span class="co">// Correct response: press space for non-targets (1-2, 4-9), withhold for target (3)</span></span>
<span id="cb26-37"><a href="#cb26-37"></a>    <span class="cf">if</span> (data<span class="op">.</span><span class="at">is_target</span>) {</span>
<span id="cb26-38"><a href="#cb26-38"></a>      data<span class="op">.</span><span class="at">correct</span> <span class="op">=</span> data<span class="op">.</span><span class="at">response</span> <span class="op">===</span> <span class="kw">null</span><span class="op">;</span>  <span class="co">// Should NOT press for target</span></span>
<span id="cb26-39"><a href="#cb26-39"></a>      </span>
<span id="cb26-40"><a href="#cb26-40"></a>      <span class="co">// If it was a target, reset counter</span></span>
<span id="cb26-41"><a href="#cb26-41"></a>      missed_in_a_row <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb26-42"><a href="#cb26-42"></a></span>
<span id="cb26-43"><a href="#cb26-43"></a>    } <span class="cf">else</span> {</span>
<span id="cb26-44"><a href="#cb26-44"></a>      data<span class="op">.</span><span class="at">correct</span> <span class="op">=</span> data<span class="op">.</span><span class="at">response</span> <span class="op">===</span> <span class="st">" "</span><span class="op">;</span>   <span class="co">// Should press for non-target</span></span>
<span id="cb26-45"><a href="#cb26-45"></a></span>
<span id="cb26-46"><a href="#cb26-46"></a>     <span class="co">// Track consecutive misses (only track on non-target trials)</span></span>
<span id="cb26-47"><a href="#cb26-47"></a>        <span class="cf">if</span> (data<span class="op">.</span><span class="at">response</span> <span class="op">===</span> <span class="kw">null</span>) {</span>
<span id="cb26-48"><a href="#cb26-48"></a>          missed_in_a_row<span class="op">++;</span></span>
<span id="cb26-49"><a href="#cb26-49"></a>        } <span class="cf">else</span> {</span>
<span id="cb26-50"><a href="#cb26-50"></a>          missed_in_a_row <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>  <span class="co">// Reset if they responded</span></span>
<span id="cb26-51"><a href="#cb26-51"></a>        }</span>
<span id="cb26-52"><a href="#cb26-52"></a>    }</span>
<span id="cb26-53"><a href="#cb26-53"></a>  }</span>
<span id="cb26-54"><a href="#cb26-54"></a>}<span class="op">;</span></span>
<span id="cb26-55"><a href="#cb26-55"></a></span>
<span id="cb26-56"><a href="#cb26-56"></a><span class="co">// inattention warning</span></span>
<span id="cb26-57"><a href="#cb26-57"></a></span>
<span id="cb26-58"><a href="#cb26-58"></a><span class="kw">let</span> inattention_warning <span class="op">=</span> {</span>
<span id="cb26-59"><a href="#cb26-59"></a>  <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb26-60"><a href="#cb26-60"></a>    {</span>
<span id="cb26-61"><a href="#cb26-61"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb26-62"><a href="#cb26-62"></a>      <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;div style="color: orange; font-size: 24px;"&gt;</span></span>
<span id="cb26-63"><a href="#cb26-63"></a><span class="vs">        &lt;p&gt;⚠️ Attention Check ⚠️&lt;/p&gt;</span></span>
<span id="cb26-64"><a href="#cb26-64"></a><span class="vs">        &lt;p&gt;You've missed </span><span class="sc">${</span>missed_in_a_row<span class="sc">}</span><span class="vs"> trials in a row.&lt;/p&gt;</span></span>
<span id="cb26-65"><a href="#cb26-65"></a><span class="vs">        &lt;p&gt;Please stay focused and respond to the digits.&lt;/p&gt;</span></span>
<span id="cb26-66"><a href="#cb26-66"></a><span class="vs">        &lt;p&gt;Press any key to continue.&lt;/p&gt;</span></span>
<span id="cb26-67"><a href="#cb26-67"></a><span class="vs">      &lt;/div&gt;`</span><span class="op">,</span></span>
<span id="cb26-68"><a href="#cb26-68"></a>      <span class="dt">choices</span><span class="op">:</span> <span class="st">"ALL_KEYS"</span></span>
<span id="cb26-69"><a href="#cb26-69"></a>    }</span>
<span id="cb26-70"><a href="#cb26-70"></a>  ]<span class="op">,</span></span>
<span id="cb26-71"><a href="#cb26-71"></a>  <span class="dt">conditional_function</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb26-72"><a href="#cb26-72"></a>    <span class="co">// Show warning if they've missed 3 or more in a row</span></span>
<span id="cb26-73"><a href="#cb26-73"></a>    <span class="cf">if</span> (missed_in_a_row <span class="op">&gt;=</span> <span class="dv">3</span>) {</span>
<span id="cb26-74"><a href="#cb26-74"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb26-75"><a href="#cb26-75"></a>    } <span class="cf">else</span> {</span>
<span id="cb26-76"><a href="#cb26-76"></a>      <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb26-77"><a href="#cb26-77"></a>    }</span>
<span id="cb26-78"><a href="#cb26-78"></a>  }<span class="op">,</span></span>
<span id="cb26-79"><a href="#cb26-79"></a>  <span class="dt">on_finish</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb26-80"><a href="#cb26-80"></a>    missed_in_a_row <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>  <span class="co">// Reset counter after showing warning</span></span>
<span id="cb26-81"><a href="#cb26-81"></a>  }</span>
<span id="cb26-82"><a href="#cb26-82"></a>}<span class="op">;</span></span>
<span id="cb26-83"><a href="#cb26-83"></a></span>
<span id="cb26-84"><a href="#cb26-84"></a><span class="co">// sart task timeline</span></span>
<span id="cb26-85"><a href="#cb26-85"></a></span>
<span id="cb26-86"><a href="#cb26-86"></a><span class="kw">let</span> sart_task <span class="op">=</span> {</span>
<span id="cb26-87"><a href="#cb26-87"></a>  <span class="dt">timeline</span><span class="op">:</span> [sart_trial<span class="op">,</span> inattention_warning]<span class="op">,</span></span>
<span id="cb26-88"><a href="#cb26-88"></a>  <span class="dt">timeline_variables</span><span class="op">:</span> [</span>
<span id="cb26-89"><a href="#cb26-89"></a>    {<span class="dt">digit</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size: 72px;"&gt;1&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">is_target</span><span class="op">:</span> <span class="kw">false</span>}<span class="op">,</span></span>
<span id="cb26-90"><a href="#cb26-90"></a>    {<span class="dt">digit</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size: 72px;"&gt;2&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">is_target</span><span class="op">:</span> <span class="kw">false</span>}<span class="op">,</span></span>
<span id="cb26-91"><a href="#cb26-91"></a>    {<span class="dt">digit</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size: 72px;"&gt;3&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">is_target</span><span class="op">:</span> <span class="kw">true</span>}<span class="op">,</span></span>
<span id="cb26-92"><a href="#cb26-92"></a>    {<span class="dt">digit</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size: 72px;"&gt;4&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">is_target</span><span class="op">:</span> <span class="kw">false</span>}<span class="op">,</span></span>
<span id="cb26-93"><a href="#cb26-93"></a>    {<span class="dt">digit</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size: 72px;"&gt;5&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">is_target</span><span class="op">:</span> <span class="kw">false</span>}<span class="op">,</span></span>
<span id="cb26-94"><a href="#cb26-94"></a>    {<span class="dt">digit</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size: 72px;"&gt;6&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">is_target</span><span class="op">:</span> <span class="kw">false</span>}<span class="op">,</span></span>
<span id="cb26-95"><a href="#cb26-95"></a>    {<span class="dt">digit</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size: 72px;"&gt;7&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">is_target</span><span class="op">:</span> <span class="kw">false</span>}<span class="op">,</span></span>
<span id="cb26-96"><a href="#cb26-96"></a>    {<span class="dt">digit</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size: 72px;"&gt;8&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">is_target</span><span class="op">:</span> <span class="kw">false</span>}<span class="op">,</span></span>
<span id="cb26-97"><a href="#cb26-97"></a>    {<span class="dt">digit</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size: 72px;"&gt;9&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">is_target</span><span class="op">:</span> <span class="kw">false</span>}</span>
<span id="cb26-98"><a href="#cb26-98"></a>  ]<span class="op">,</span></span>
<span id="cb26-99"><a href="#cb26-99"></a>  <span class="dt">randomize_order</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb26-100"><a href="#cb26-100"></a>  <span class="dt">repetitions</span><span class="op">:</span> <span class="dv">10</span>  <span class="co">// 90 trials total</span></span>
<span id="cb26-101"><a href="#cb26-101"></a>}<span class="op">;</span></span>
<span id="cb26-102"><a href="#cb26-102"></a></span>
<span id="cb26-103"><a href="#cb26-103"></a></span>
<span id="cb26-104"><a href="#cb26-104"></a><span class="co">// ============================================</span></span>
<span id="cb26-105"><a href="#cb26-105"></a><span class="co">// Experiment Timeline</span></span>
<span id="cb26-106"><a href="#cb26-106"></a><span class="co">// ============================================</span></span>
<span id="cb26-107"><a href="#cb26-107"></a></span>
<span id="cb26-108"><a href="#cb26-108"></a>jsPsych<span class="op">.</span><span class="fu">run</span>([</span>
<span id="cb26-109"><a href="#cb26-109"></a>  welcome<span class="op">,</span></span>
<span id="cb26-110"><a href="#cb26-110"></a>  sart_task </span>
<span id="cb26-111"><a href="#cb26-111"></a>])<span class="op">;</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="sourceCode" id="cb27"><pre class="sourceCode numberSource css number-lines code-with-copy"><code class="sourceCode css"><span id="cb27-1"><a href="#cb27-1"></a>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<div id="demo-container-3" style="border: 1px solid #ddd; border-radius: 8px; overflow: hidden; transition: box-shadow 0.2s ease;">
<div style="background-color: #f8f9fa; padding: 8px 12px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center;">
<div>
<span style="font-weight: bold; color: #495057;">Live JsPsych Demo</span>
<span class="focus-indicator-3" style="margin-left: 10px; font-size: 11px; color: #6c757d; font-style: italic;">Click inside the demo to activate demo</span>
</div>
<div style="display: flex; gap: 8px;">
<button onclick="
            console.log('Full screen button clicked');
            var htmlContent = '<!DOCTYPE html>\n<html>\n  <head>\n    <title>Live JsPsych Demo</title>\n    <script src=\'https://unpkg.com/jspsych@8.2.2\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-preload@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-instructions@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-survey-text@2.1.0\'  crossorigin></script>\n        <script src=\'https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0\' crossorigin></script>\n\n    <link href=\'https://unpkg.com/jspsych@8.2.2/css/jspsych.css\' rel=\'stylesheet\' type=\'text/css\' crossorigin />\n\n\n    <style>\n      /* Paused overlay styles */\n      #paused-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-color: rgba(0, 0, 0, 0.7);\n        display: none;\n        justify-content: center;\n        align-items: center;\n        z-index: 9999;\n        font-family: Arial, sans-serif;\n      }\n\n      #paused-message {\n        background-color: white;\n        padding: 30px;\n        border-radius: 10px;\n        text-align: center;\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n        max-width: 300px;\n      }\n\n      #paused-message h2 {\n        margin-top: 0;\n        color: #dc3545;\n        font-size: 24px;\n      }\n\n      #paused-message p {\n        color: #666;\n        margin-bottom: 0;\n        font-size: 16px;\n      }\n\n      .pulse {\n        animation: pulse 2s infinite;\n      }\n\n      @keyframes pulse {\n        0% { opacity: 1; }\n        50% { opacity: 0.5; }\n        100% { opacity: 1; }\n      }\n    </style>\n  </head>\n  <body>\n    <!-- Paused overlay -->\n    <div id=\'paused-overlay\'>\n      <div id=\'paused-message\'>\n        <h2>Demo Paused</h2>\n        <p class=\'pulse\'>Click Anywhere to Resume</p>\n      </div>\n    </div>\n  </body>\n  <script>\n// Initialize jsPsych with interaction tracking and overlay control\nconst jsPsych = initJsPsych({\n  on_interaction_data_update: function(data) {\n    const overlay = document.getElementById(\'paused-overlay\');\n\n    if (data.event === \'blur\') {\n      // User clicked away - pause experiment and show overlay\n      jsPsych.pauseExperiment();\n      if (overlay) {\n        overlay.style.display = \'flex\';\n      }\n    } else if (data.event === \'focus\') {\n      // User returned - resume experiment and hide overlay\n      jsPsych.resumeExperiment();\n      if (overlay) {\n        overlay.style.display = \'none\';\n      }\n    }\n  }\n});\n\n// Make the overlay clickable to resume\ndocument.addEventListener(\'DOMContentLoaded\', function() {\n  const overlay = document.getElementById(\'paused-overlay\');\n  if (overlay) {\n    overlay.addEventListener(\'click\', function() {\n      // Focus the window and let the interaction handler resume\n      window.focus();\n    });\n  }\n});\n\n// ============================================\n// Instructions\n// ============================================\n\nconst welcome = {\n  type: jsPsychHtmlKeyboardResponse,\n  stimulus: `Welcome to the Experiment! Press any key to begin.`,\n  choices: &quot;ALL_KEYS&quot;, \n  post_trial_gap: 250\n}\n\n// ============================================\n// Sustained Attention to Response Task\n// ============================================\n\n// Variable to track consecutive misses\n\nlet missed_in_a_row = 0;\n\n// sart trial\n\nlet sart_trial = {\n  type: jsPsychHtmlKeyboardResponse,\n  stimulus: jsPsych.timelineVariable(&quot;digit&quot;),\n  choices: [&quot; &quot;],  // Spacebar\n  trial_duration: 1000,  // Trial proceeds automatically after 1 second\n  response_ends_trial: false,  // response does NOT end the trial\n  data: {\n    digit: jsPsych.timelineVariable(&quot;digit&quot;),\n    is_target: jsPsych.timelineVariable(&quot;is_target&quot;)\n  },\n  on_finish: function(data) {\n    // Correct response: press space for non-targets (1-2, 4-9), withhold for target (3)\n    if (data.is_target) {\n      data.correct = data.response === null;  // Should NOT press for target\n      \n      // If it was a target, reset counter\n      missed_in_a_row = 0;\n\n    } else {\n      data.correct = data.response === &quot; &quot;;   // Should press for non-target\n\n     // Track consecutive misses (only track on non-target trials)\n        if (data.response === null) {\n          missed_in_a_row++;\n        } else {\n          missed_in_a_row = 0;  // Reset if they responded\n        }\n    }\n  }\n};\n\n// inattention warning\n\nlet inattention_warning = {\n  timeline: [\n    {\n      type: jsPsychHtmlKeyboardResponse,\n      stimulus: `<div style=&quot;color: orange; font-size: 24px;&quot;>\n        <p>⚠️ Attention Check ⚠️</p>\n        <p>You\'ve missed ${missed_in_a_row} trials in a row.</p>\n        <p>Please stay focused and respond to the digits.</p>\n        <p>Press any key to continue.</p>\n      </div>`,\n      choices: &quot;ALL_KEYS&quot;\n    }\n  ],\n  conditional_function: function() {\n    // Show warning if they\'ve missed 3 or more in a row\n    if (missed_in_a_row >= 3) {\n      return true;\n    } else {\n      return false;\n    }\n  },\n  on_finish: function() {\n    missed_in_a_row = 0;  // Reset counter after showing warning\n  }\n};\n\n// sart task timeline\n\nlet sart_task = {\n  timeline: [sart_trial, inattention_warning],\n  timeline_variables: [\n    {digit: `<p style=&quot;font-size: 72px;&quot;>1</p>`, is_target: false},\n    {digit: `<p style=&quot;font-size: 72px;&quot;>2</p>`, is_target: false},\n    {digit: `<p style=&quot;font-size: 72px;&quot;>3</p>`, is_target: true},\n    {digit: `<p style=&quot;font-size: 72px;&quot;>4</p>`, is_target: false},\n    {digit: `<p style=&quot;font-size: 72px;&quot;>5</p>`, is_target: false},\n    {digit: `<p style=&quot;font-size: 72px;&quot;>6</p>`, is_target: false},\n    {digit: `<p style=&quot;font-size: 72px;&quot;>7</p>`, is_target: false},\n    {digit: `<p style=&quot;font-size: 72px;&quot;>8</p>`, is_target: false},\n    {digit: `<p style=&quot;font-size: 72px;&quot;>9</p>`, is_target: false}\n  ],\n  randomize_order: true,\n  repetitions: 10  // 90 trials total\n};\n\n\n// ============================================\n// Experiment Timeline\n// ============================================\n\njsPsych.run([\n  welcome,\n  sart_task \n]);\n  </script>\n</html>';
            var newWindow = window.open('', '_blank');
            if (newWindow) {
              newWindow.document.write(htmlContent);
              newWindow.document.close();
            } else {
              alert('Pop-up blocked! Please allow pop-ups for this site.');
            }
          " style="background-color: #28a745; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Open in New Tab</button>
<button onclick="
            var iframe = document.getElementById('demo-iframe-3');
            var srcdoc = iframe.getAttribute('srcdoc');
            iframe.setAttribute('srcdoc', '');
            setTimeout(function() {
              iframe.setAttribute('srcdoc', srcdoc);
            }, 10);
          " style="background-color: #007bff; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Refresh</button>
</div>
</div>
<iframe id="demo-iframe-3" srcdoc="<!DOCTYPE html>
<html>
  <head>
    <title>Live JsPsych Demo</title>
    <script src='https://unpkg.com/jspsych@8.2.2' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-preload@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-instructions@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-survey-text@2.1.0'  crossorigin></script>
        <script src='https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0' crossorigin></script>

    <link href='https://unpkg.com/jspsych@8.2.2/css/jspsych.css' rel='stylesheet' type='text/css' crossorigin />


    <style>
      /* Paused overlay styles */
      #paused-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        font-family: Arial, sans-serif;
      }

      #paused-message {
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        max-width: 300px;
      }

      #paused-message h2 {
        margin-top: 0;
        color: #dc3545;
        font-size: 24px;
      }

      #paused-message p {
        color: #666;
        margin-bottom: 0;
        font-size: 16px;
      }

      .pulse {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
      }
    </style>
  </head>
  <body style='max-height: 300px'>
    <!-- Paused overlay -->
    <div id='paused-overlay'>
      <div id='paused-message'>
        <h2>Demo Paused</h2>
        <p class='pulse'>Click Anywhere to Resume</p>
      </div>
    </div>
  </body>
  <script>
// Initialize jsPsych with interaction tracking and overlay control
const jsPsych = initJsPsych({
  on_interaction_data_update: function(data) {
    const overlay = document.getElementById('paused-overlay');

    if (data.event === 'blur') {
      // User clicked away - pause experiment and show overlay
      jsPsych.pauseExperiment();
      if (overlay) {
        overlay.style.display = 'flex';
      }
    } else if (data.event === 'focus') {
      // User returned - resume experiment and hide overlay
      jsPsych.resumeExperiment();
      if (overlay) {
        overlay.style.display = 'none';
      }
    }
  }
});

// Make the overlay clickable to resume
document.addEventListener('DOMContentLoaded', function() {
  const overlay = document.getElementById('paused-overlay');
  if (overlay) {
    overlay.addEventListener('click', function() {
      // Focus the window and let the interaction handler resume
      window.focus();
    });
  }
});

// ============================================
// Instructions
// ============================================

const welcome = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: `Welcome to the Experiment! Press any key to begin.`,
  choices: &quot;ALL_KEYS&quot;, 
  post_trial_gap: 250
}

// ============================================
// Sustained Attention to Response Task
// ============================================

// Variable to track consecutive misses

let missed_in_a_row = 0;

// sart trial

let sart_trial = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: jsPsych.timelineVariable(&quot;digit&quot;),
  choices: [&quot; &quot;],  // Spacebar
  trial_duration: 1000,  // Trial proceeds automatically after 1 second
  response_ends_trial: false,  // response does NOT end the trial
  data: {
    digit: jsPsych.timelineVariable(&quot;digit&quot;),
    is_target: jsPsych.timelineVariable(&quot;is_target&quot;)
  },
  on_finish: function(data) {
    // Correct response: press space for non-targets (1-2, 4-9), withhold for target (3)
    if (data.is_target) {
      data.correct = data.response === null;  // Should NOT press for target
      
      // If it was a target, reset counter
      missed_in_a_row = 0;

    } else {
      data.correct = data.response === &quot; &quot;;   // Should press for non-target

     // Track consecutive misses (only track on non-target trials)
        if (data.response === null) {
          missed_in_a_row++;
        } else {
          missed_in_a_row = 0;  // Reset if they responded
        }
    }
  }
};

// inattention warning

let inattention_warning = {
  timeline: [
    {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `<div style=&quot;color: orange; font-size: 24px;&quot;>
        <p>⚠️ Attention Check ⚠️</p>
        <p>You've missed ${missed_in_a_row} trials in a row.</p>
        <p>Please stay focused and respond to the digits.</p>
        <p>Press any key to continue.</p>
      </div>`,
      choices: &quot;ALL_KEYS&quot;
    }
  ],
  conditional_function: function() {
    // Show warning if they've missed 3 or more in a row
    if (missed_in_a_row >= 3) {
      return true;
    } else {
      return false;
    }
  },
  on_finish: function() {
    missed_in_a_row = 0;  // Reset counter after showing warning
  }
};

// sart task timeline

let sart_task = {
  timeline: [sart_trial, inattention_warning],
  timeline_variables: [
    {digit: `<p style=&quot;font-size: 72px;&quot;>1</p>`, is_target: false},
    {digit: `<p style=&quot;font-size: 72px;&quot;>2</p>`, is_target: false},
    {digit: `<p style=&quot;font-size: 72px;&quot;>3</p>`, is_target: true},
    {digit: `<p style=&quot;font-size: 72px;&quot;>4</p>`, is_target: false},
    {digit: `<p style=&quot;font-size: 72px;&quot;>5</p>`, is_target: false},
    {digit: `<p style=&quot;font-size: 72px;&quot;>6</p>`, is_target: false},
    {digit: `<p style=&quot;font-size: 72px;&quot;>7</p>`, is_target: false},
    {digit: `<p style=&quot;font-size: 72px;&quot;>8</p>`, is_target: false},
    {digit: `<p style=&quot;font-size: 72px;&quot;>9</p>`, is_target: false}
  ],
  randomize_order: true,
  repetitions: 10  // 90 trials total
};


// ============================================
// Experiment Timeline
// ============================================

jsPsych.run([
  welcome,
  sart_task 
]);
  </script>
</html>" width="100%" height="300px" scrolling="yes" style="border: none; display: block;" onload="javascript:(function(iframe){
        var container = document.getElementById(&quot;demo-container-3&quot;);
        var indicator = container.querySelector(&quot;.focus-indicator-3&quot;);

        function showFocus() {
          container.style.boxShadow = &quot;0 0 0 3px #007bff&quot;;
          if (indicator) {
            indicator.textContent = &quot;✓ Demo Active&quot;;
            indicator.style.color = &quot;#28a745&quot;;
          }
        }

        function hideFocus() {
          container.style.boxShadow = &quot;none&quot;;
          if (indicator) {
            indicator.textContent = &quot;Click inside the demo to activate&quot;;
            indicator.style.color = &quot;#6c757d&quot;;
          }
        }

        var iframeWindow = iframe.contentWindow;
        if (iframeWindow) {
          iframeWindow.onfocus = showFocus;
          iframeWindow.onblur = hideFocus;
          iframeWindow.document.addEventListener(&quot;click&quot;, function() {
            iframeWindow.focus();
            showFocus();
          });
          document.addEventListener(&quot;click&quot;, function(e) {
            if (!container.contains(e.target)) {
              iframeWindow.blur();
              hideFocus();
            }
          });
        }
      }(this));"></iframe>
</div>
</div>
</div>
</div>
<p>Let’s break down how this works:</p>
<ol type="1">
<li>Tracking misses: The missed_in_a_row variable keeps count of consecutive trials where the participant didn’t respond</li>
<li>Trial proceeds automatically: With trial_duration: 1000, the trial moves on after 1 second whether they respond or not</li>
<li>Updating the counter: In on_finish:
<ul>
<li>If data.response === null (no response), we increment the counter</li>
<li>If they responded, we reset the counter to 0</li>
<li>Conditional warning: The warning timeline only appears when missed_in_a_row &gt;= 3</li>
<li>Resetting after warning: After showing the warning, we reset the counter so they get a fresh start</li>
</ul></li>
</ol>
<p>This pattern helps distinguish between normal attention lapses (which we want to measure) and complete task disengagement (which we want to prevent). The warning pauses the task and requires the participant to actively press a key to continue, ensuring they’re still present and engaged. If a participant continues to not respond even after multiple warnings, you might want to consider ending the experiment early or flagging their data for exclusion during analysis.</p>
</section>
</section>
<section id="conditional-timelines" class="level2" data-number="19.6">
<h2 data-number="19.6" class="anchored" data-anchor-id="conditional-timelines"><span class="header-section-number">19.6</span> Conditional Timelines</h2>
<p>Everything we just learned about conditional functions works exactly the same way for entire timelines. Instead of showing or hiding a single feedback trial, we can show or hide entire phases of the experiment.</p>
<section id="understanding-timeline-level-conditionals" class="level3" data-number="19.6.1">
<h3 data-number="19.6.1" class="anchored" data-anchor-id="understanding-timeline-level-conditionals"><span class="header-section-number">19.6.1</span> Understanding Timeline-Level Conditionals</h3>
<p>When you put a <code>conditional_function</code> on a timeline that contains multiple trials, jsPsych evaluates the condition once, before running any of the trials in that timeline. If the function returns <code>false</code>, the entire timeline is skipped.</p>
<p>This is perfect for scenarios like showing different versions of a task based on participant characteristics, skipping optional sections based on previous performance, or branching to different experimental paths.</p>
<p>The general principles from the previous section apply here in exactly the same way. The only difference is that we’ll control larger timelines that contain entire tasks, rather than single parts of one task.</p>
</section>
<section id="example-language-specific-tasks" class="level3" data-number="19.6.2">
<h3 data-number="19.6.2" class="anchored" data-anchor-id="example-language-specific-tasks"><span class="header-section-number">19.6.2</span> Example: Language-Specific Tasks</h3>
<p>Let’s build an experiment that shows different Stroop tasks based on the participant’s first language. For this first example, we’ll walk through the steps of creating it:</p>
<section id="step-1-ask-about-language" class="level4" data-number="19.6.2.1">
<h4 data-number="19.6.2.1" class="anchored" data-anchor-id="step-1-ask-about-language"><span class="header-section-number">19.6.2.1</span> Step 1: Ask about language</h4>
<div class="sourceCode" id="cb28"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb28-1"><a href="#cb28-1"></a><span class="co">// ============================================</span></span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="co">// Language Check</span></span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="co">// ============================================</span></span>
<span id="cb28-4"><a href="#cb28-4"></a></span>
<span id="cb28-5"><a href="#cb28-5"></a><span class="kw">let</span> language_check <span class="op">=</span> {</span>
<span id="cb28-6"><a href="#cb28-6"></a>    <span class="dt">type</span><span class="op">:</span> jsPsychSurveyMultiChoice<span class="op">,</span></span>
<span id="cb28-7"><a href="#cb28-7"></a>    <span class="dt">questions</span><span class="op">:</span> [</span>
<span id="cb28-8"><a href="#cb28-8"></a>        {</span>
<span id="cb28-9"><a href="#cb28-9"></a>            <span class="dt">prompt</span><span class="op">:</span> <span class="st">"What is your first language?"</span><span class="op">,</span></span>
<span id="cb28-10"><a href="#cb28-10"></a>            <span class="dt">options</span><span class="op">:</span> [<span class="st">"English"</span><span class="op">,</span> <span class="st">"French"</span>]<span class="op">,</span></span>
<span id="cb28-11"><a href="#cb28-11"></a>            <span class="dt">required</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb28-12"><a href="#cb28-12"></a>            <span class="dt">name</span><span class="op">:</span> <span class="st">'first_language'</span></span>
<span id="cb28-13"><a href="#cb28-13"></a>        }</span>
<span id="cb28-14"><a href="#cb28-14"></a>    ]<span class="op">,</span></span>
<span id="cb28-15"><a href="#cb28-15"></a>    <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb28-16"><a href="#cb28-16"></a>        <span class="dt">phase</span><span class="op">:</span> <span class="st">"Language Check"</span></span>
<span id="cb28-17"><a href="#cb28-17"></a>    }</span>
<span id="cb28-18"><a href="#cb28-18"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-2-create-language-specific-tasks" class="level4" data-number="19.6.2.2">
<h4 data-number="19.6.2.2" class="anchored" data-anchor-id="step-2-create-language-specific-tasks"><span class="header-section-number">19.6.2.2</span> Step 2: Create language-specific tasks</h4>
<p>Now, we’ll create our language-specific tasks with conditional functions. In this case, we’re checking to see what their response was in the language check phase.</p>
<p>Since conditional functions only allow us to either show or skip a particular timeline, we’ll need a conditional function on each version of the task. The logic works like this: if the response was “English”, we show the English Stroop and skip the French Stroop. But if the response was “French”, we skip the English version and show the French version.</p>
<p>This means each task needs its own conditional function that checks for a different language:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb29-1"><a href="#cb29-1"></a><span class="co">// ============================================</span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="co">// French Stroop</span></span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="co">// ============================================</span></span>
<span id="cb29-4"><a href="#cb29-4"></a></span>
<span id="cb29-5"><a href="#cb29-5"></a><span class="kw">let</span> french_stroop <span class="op">=</span> {</span>
<span id="cb29-6"><a href="#cb29-6"></a>    <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb29-7"><a href="#cb29-7"></a>        {</span>
<span id="cb29-8"><a href="#cb29-8"></a>            <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb29-9"><a href="#cb29-9"></a>            <span class="dt">stimulus</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">'stimulus'</span>)<span class="op">,</span></span>
<span id="cb29-10"><a href="#cb29-10"></a>            <span class="dt">choices</span><span class="op">:</span> [<span class="st">'r'</span><span class="op">,</span> <span class="st">'b'</span><span class="op">,</span> <span class="st">'v'</span><span class="op">,</span> <span class="st">'j'</span>]</span>
<span id="cb29-11"><a href="#cb29-11"></a>        }</span>
<span id="cb29-12"><a href="#cb29-12"></a>    ]<span class="op">,</span></span>
<span id="cb29-13"><a href="#cb29-13"></a>    <span class="dt">timeline_variables</span><span class="op">:</span> [</span>
<span id="cb29-14"><a href="#cb29-14"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: red"&gt;ROUGE&lt;/p&gt;`</span>}<span class="op">,</span></span>
<span id="cb29-15"><a href="#cb29-15"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: blue"&gt;BLEU&lt;/p&gt;`</span>}<span class="op">,</span></span>
<span id="cb29-16"><a href="#cb29-16"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: green"&gt;VERT&lt;/p&gt;`</span>}<span class="op">,</span></span>
<span id="cb29-17"><a href="#cb29-17"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: yellow"&gt;JAUNE&lt;/p&gt;`</span>}</span>
<span id="cb29-18"><a href="#cb29-18"></a>    ]<span class="op">,</span></span>
<span id="cb29-19"><a href="#cb29-19"></a>    <span class="dt">conditional_function</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb29-20"><a href="#cb29-20"></a>        <span class="co">// Get the response from the language check</span></span>
<span id="cb29-21"><a href="#cb29-21"></a>        <span class="kw">let</span> language_data <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">filter</span>({<span class="dt">phase</span><span class="op">:</span> <span class="st">'Language Check'</span>})<span class="op">.</span><span class="fu">values</span>()[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb29-22"><a href="#cb29-22"></a>        <span class="kw">let</span> selected_language <span class="op">=</span> language_data<span class="op">.</span><span class="at">response</span><span class="op">.</span><span class="at">first_language</span><span class="op">;</span></span>
<span id="cb29-23"><a href="#cb29-23"></a></span>
<span id="cb29-24"><a href="#cb29-24"></a>        <span class="co">// Only run this timeline if they selected French</span></span>
<span id="cb29-25"><a href="#cb29-25"></a>        <span class="cf">return</span> selected_language <span class="op">===</span> <span class="st">"French"</span><span class="op">;</span></span>
<span id="cb29-26"><a href="#cb29-26"></a>    }<span class="op">,</span></span>
<span id="cb29-27"><a href="#cb29-27"></a>    <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb29-28"><a href="#cb29-28"></a>        <span class="dt">phase</span><span class="op">:</span> <span class="st">"French Stroop"</span></span>
<span id="cb29-29"><a href="#cb29-29"></a>    }</span>
<span id="cb29-30"><a href="#cb29-30"></a>}<span class="op">;</span></span>
<span id="cb29-31"><a href="#cb29-31"></a></span>
<span id="cb29-32"><a href="#cb29-32"></a><span class="co">// ============================================</span></span>
<span id="cb29-33"><a href="#cb29-33"></a><span class="co">// English Stroop</span></span>
<span id="cb29-34"><a href="#cb29-34"></a><span class="co">// ============================================</span></span>
<span id="cb29-35"><a href="#cb29-35"></a></span>
<span id="cb29-36"><a href="#cb29-36"></a><span class="kw">let</span> english_stroop <span class="op">=</span> {</span>
<span id="cb29-37"><a href="#cb29-37"></a>    <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb29-38"><a href="#cb29-38"></a>        {</span>
<span id="cb29-39"><a href="#cb29-39"></a>            <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb29-40"><a href="#cb29-40"></a>            <span class="dt">stimulus</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">'stimulus'</span>)<span class="op">,</span></span>
<span id="cb29-41"><a href="#cb29-41"></a>            <span class="dt">choices</span><span class="op">:</span> [<span class="st">'r'</span><span class="op">,</span> <span class="st">'b'</span><span class="op">,</span> <span class="st">'g'</span><span class="op">,</span> <span class="st">'y'</span>]</span>
<span id="cb29-42"><a href="#cb29-42"></a>        }</span>
<span id="cb29-43"><a href="#cb29-43"></a>    ]<span class="op">,</span></span>
<span id="cb29-44"><a href="#cb29-44"></a>    <span class="dt">timeline_variables</span><span class="op">:</span> [</span>
<span id="cb29-45"><a href="#cb29-45"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: red"&gt;RED&lt;/p&gt;`</span>}<span class="op">,</span></span>
<span id="cb29-46"><a href="#cb29-46"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: blue"&gt;BLUE&lt;/p&gt;`</span>}<span class="op">,</span></span>
<span id="cb29-47"><a href="#cb29-47"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: green"&gt;GREEN&lt;/p&gt;`</span>}<span class="op">,</span></span>
<span id="cb29-48"><a href="#cb29-48"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: yellow"&gt;YELLOW&lt;/p&gt;`</span>}</span>
<span id="cb29-49"><a href="#cb29-49"></a>    ]<span class="op">,</span></span>
<span id="cb29-50"><a href="#cb29-50"></a>    <span class="dt">conditional_function</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb29-51"><a href="#cb29-51"></a>        <span class="kw">let</span> language_data <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">filter</span>({<span class="dt">phase</span><span class="op">:</span> <span class="st">'Language Check'</span>})<span class="op">.</span><span class="fu">values</span>()[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb29-52"><a href="#cb29-52"></a>        <span class="kw">let</span> selected_language <span class="op">=</span> language_data<span class="op">.</span><span class="at">response</span><span class="op">.</span><span class="at">first_language</span><span class="op">;</span></span>
<span id="cb29-53"><a href="#cb29-53"></a></span>
<span id="cb29-54"><a href="#cb29-54"></a>        <span class="cf">return</span> selected_language <span class="op">===</span> <span class="st">"English"</span><span class="op">;</span></span>
<span id="cb29-55"><a href="#cb29-55"></a>    }<span class="op">,</span></span>
<span id="cb29-56"><a href="#cb29-56"></a>    <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb29-57"><a href="#cb29-57"></a>        <span class="dt">phase</span><span class="op">:</span> <span class="st">"English Stroop"</span></span>
<span id="cb29-58"><a href="#cb29-58"></a>    }</span>
<span id="cb29-59"><a href="#cb29-59"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-3-run-the-experiment" class="level4" data-number="19.6.2.3">
<h4 data-number="19.6.2.3" class="anchored" data-anchor-id="step-3-run-the-experiment"><span class="header-section-number">19.6.2.3</span> Step 3: Run the experiment</h4>
<p>Finally, we put BOTH tasks into our <code>jsPsych.run</code> to the conditional functions can control whether they are displayed or not.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode numberSource javscript number-lines code-with-copy"><code class="sourceCode"><span id="cb30-1"><a href="#cb30-1"></a>// ============================================</span>
<span id="cb30-2"><a href="#cb30-2"></a>// Experiment Timeline</span>
<span id="cb30-3"><a href="#cb30-3"></a>// ============================================</span>
<span id="cb30-4"><a href="#cb30-4"></a></span>
<span id="cb30-5"><a href="#cb30-5"></a>jsPsych.run([</span>
<span id="cb30-6"><a href="#cb30-6"></a>    welcome,</span>
<span id="cb30-7"><a href="#cb30-7"></a>    language_check,</span>
<span id="cb30-8"><a href="#cb30-8"></a>    french_stroop,   // Only runs if French selected</span>
<span id="cb30-9"><a href="#cb30-9"></a>    english_stroop,  // Only runs if English selected</span>
<span id="cb30-10"><a href="#cb30-10"></a>    debrief</span>
<span id="cb30-11"><a href="#cb30-11"></a>]);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here’s the full working example. Try selecting a language, refreshing and selecting the other language.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">index.html</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">exp.js</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false">style.css</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-4" role="tab" aria-controls="tabset-4-4" aria-selected="false">Result</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="sourceCode" id="cb31"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb31-1"><a href="#cb31-1"></a> <span class="dt">&lt;!DOCTYPE</span> html<span class="dt">&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb31-4"><a href="#cb31-4"></a>    <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>Demo<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb31-5"><a href="#cb31-5"></a>    <span class="co">&lt;!-- jsPsych --&gt;</span></span>
<span id="cb31-6"><a href="#cb31-6"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/jspsych.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb31-7"><a href="#cb31-7"></a>    <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> href</span><span class="op">=</span><span class="st">"jspsych/jspsych.css"</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text/css"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb31-8"><a href="#cb31-8"></a>    </span>
<span id="cb31-9"><a href="#cb31-9"></a>    <span class="co">&lt;!-- jPsych plugins --&gt;</span></span>
<span id="cb31-10"><a href="#cb31-10"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/plugin-html-keyboard-response.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb31-11"><a href="#cb31-11"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/plugin-survey-multi-choice.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb31-12"><a href="#cb31-12"></a></span>
<span id="cb31-13"><a href="#cb31-13"></a>    <span class="co">&lt;!-- custom CSS --&gt;</span></span>
<span id="cb31-14"><a href="#cb31-14"></a>     <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> href</span><span class="op">=</span><span class="st">"style.css"</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text/css"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb31-15"><a href="#cb31-15"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb31-16"><a href="#cb31-16"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb31-17"><a href="#cb31-17"></a>  <span class="co">&lt;!-- custom JS --&gt;</span></span>
<span id="cb31-18"><a href="#cb31-18"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"exp.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb31-19"><a href="#cb31-19"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb31-20"><a href="#cb31-20"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb31-21"><a href="#cb31-21"></a> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="sourceCode" id="cb32"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb32-1"><a href="#cb32-1"></a> </span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="kw">const</span> jsPsych <span class="op">=</span> <span class="fu">initJsPsych</span>()<span class="op">;</span></span>
<span id="cb32-3"><a href="#cb32-3"></a></span>
<span id="cb32-4"><a href="#cb32-4"></a> </span>
<span id="cb32-5"><a href="#cb32-5"></a></span>
<span id="cb32-6"><a href="#cb32-6"></a><span class="co">// ============================================</span></span>
<span id="cb32-7"><a href="#cb32-7"></a><span class="co">// Instructions</span></span>
<span id="cb32-8"><a href="#cb32-8"></a><span class="co">// ============================================</span></span>
<span id="cb32-9"><a href="#cb32-9"></a></span>
<span id="cb32-10"><a href="#cb32-10"></a><span class="kw">const</span> welcome <span class="op">=</span> {</span>
<span id="cb32-11"><a href="#cb32-11"></a>    <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb32-12"><a href="#cb32-12"></a>    <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`Welcome to the Experiment! Press any key to begin.`</span><span class="op">,</span></span>
<span id="cb32-13"><a href="#cb32-13"></a>    <span class="dt">choices</span><span class="op">:</span> <span class="st">"ALL_KEYS"</span><span class="op">,</span></span>
<span id="cb32-14"><a href="#cb32-14"></a>    <span class="dt">post_trial_gap</span><span class="op">:</span> <span class="dv">250</span></span>
<span id="cb32-15"><a href="#cb32-15"></a>}</span>
<span id="cb32-16"><a href="#cb32-16"></a></span>
<span id="cb32-17"><a href="#cb32-17"></a><span class="kw">const</span> debrief <span class="op">=</span> {</span>
<span id="cb32-18"><a href="#cb32-18"></a>    <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb32-19"><a href="#cb32-19"></a>    <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`Thank you for completing our experiment!`</span><span class="op">,</span></span>
<span id="cb32-20"><a href="#cb32-20"></a>    <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span><span class="op">,</span></span>
<span id="cb32-21"><a href="#cb32-21"></a>    <span class="dt">post_trial_gap</span><span class="op">:</span> <span class="dv">250</span></span>
<span id="cb32-22"><a href="#cb32-22"></a>}</span>
<span id="cb32-23"><a href="#cb32-23"></a></span>
<span id="cb32-24"><a href="#cb32-24"></a><span class="co">// ============================================</span></span>
<span id="cb32-25"><a href="#cb32-25"></a><span class="co">// Language Check</span></span>
<span id="cb32-26"><a href="#cb32-26"></a><span class="co">// ============================================</span></span>
<span id="cb32-27"><a href="#cb32-27"></a></span>
<span id="cb32-28"><a href="#cb32-28"></a><span class="kw">let</span> language_check <span class="op">=</span> {</span>
<span id="cb32-29"><a href="#cb32-29"></a>    <span class="dt">type</span><span class="op">:</span> jsPsychSurveyMultiChoice<span class="op">,</span></span>
<span id="cb32-30"><a href="#cb32-30"></a>    <span class="dt">questions</span><span class="op">:</span> [</span>
<span id="cb32-31"><a href="#cb32-31"></a>        {</span>
<span id="cb32-32"><a href="#cb32-32"></a>            <span class="dt">prompt</span><span class="op">:</span> <span class="st">"What is your first language?"</span><span class="op">,</span></span>
<span id="cb32-33"><a href="#cb32-33"></a>            <span class="dt">options</span><span class="op">:</span> [<span class="st">"English"</span><span class="op">,</span> <span class="st">"French"</span>]<span class="op">,</span></span>
<span id="cb32-34"><a href="#cb32-34"></a>            <span class="dt">required</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb32-35"><a href="#cb32-35"></a>            <span class="dt">name</span><span class="op">:</span> <span class="st">"first_language"</span></span>
<span id="cb32-36"><a href="#cb32-36"></a>        }</span>
<span id="cb32-37"><a href="#cb32-37"></a>    ]<span class="op">,</span></span>
<span id="cb32-38"><a href="#cb32-38"></a>    <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb32-39"><a href="#cb32-39"></a>        <span class="dt">phase</span><span class="op">:</span> <span class="st">"Language Check"</span></span>
<span id="cb32-40"><a href="#cb32-40"></a>    }</span>
<span id="cb32-41"><a href="#cb32-41"></a>}<span class="op">;</span></span>
<span id="cb32-42"><a href="#cb32-42"></a></span>
<span id="cb32-43"><a href="#cb32-43"></a><span class="co">// ============================================</span></span>
<span id="cb32-44"><a href="#cb32-44"></a><span class="co">// French Stroop</span></span>
<span id="cb32-45"><a href="#cb32-45"></a><span class="co">// ============================================</span></span>
<span id="cb32-46"><a href="#cb32-46"></a></span>
<span id="cb32-47"><a href="#cb32-47"></a><span class="kw">let</span> french_stroop <span class="op">=</span> {</span>
<span id="cb32-48"><a href="#cb32-48"></a>    <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb32-49"><a href="#cb32-49"></a>        {</span>
<span id="cb32-50"><a href="#cb32-50"></a>            <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb32-51"><a href="#cb32-51"></a>            <span class="dt">stimulus</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">"stimulus"</span>)<span class="op">,</span></span>
<span id="cb32-52"><a href="#cb32-52"></a>            <span class="dt">choices</span><span class="op">:</span> [<span class="st">"r"</span><span class="op">,</span> <span class="st">"b"</span><span class="op">,</span> <span class="st">"v"</span><span class="op">,</span> <span class="st">"j"</span>]</span>
<span id="cb32-53"><a href="#cb32-53"></a>        }</span>
<span id="cb32-54"><a href="#cb32-54"></a>    ]<span class="op">,</span></span>
<span id="cb32-55"><a href="#cb32-55"></a>    <span class="dt">timeline_variables</span><span class="op">:</span> [</span>
<span id="cb32-56"><a href="#cb32-56"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: red"&gt;ROUGE&lt;/p&gt;`</span>}<span class="op">,</span></span>
<span id="cb32-57"><a href="#cb32-57"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: blue"&gt;BLEU&lt;/p&gt;`</span>}<span class="op">,</span></span>
<span id="cb32-58"><a href="#cb32-58"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: green"&gt;VERT&lt;/p&gt;`</span>}<span class="op">,</span></span>
<span id="cb32-59"><a href="#cb32-59"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: yellow"&gt;JAUNE&lt;/p&gt;`</span>}</span>
<span id="cb32-60"><a href="#cb32-60"></a>    ]<span class="op">,</span></span>
<span id="cb32-61"><a href="#cb32-61"></a>    <span class="dt">conditional_function</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb32-62"><a href="#cb32-62"></a>        <span class="co">// Get the response from the language check</span></span>
<span id="cb32-63"><a href="#cb32-63"></a>        <span class="kw">let</span> language_data <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">filter</span>({<span class="dt">phase</span><span class="op">:</span> <span class="st">"Language Check"</span>})<span class="op">.</span><span class="fu">values</span>()[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb32-64"><a href="#cb32-64"></a>        <span class="kw">let</span> selected_language <span class="op">=</span> language_data<span class="op">.</span><span class="at">response</span><span class="op">.</span><span class="at">first_language</span><span class="op">;</span></span>
<span id="cb32-65"><a href="#cb32-65"></a></span>
<span id="cb32-66"><a href="#cb32-66"></a>        <span class="co">// Only run this timeline if they selected French</span></span>
<span id="cb32-67"><a href="#cb32-67"></a>        <span class="cf">return</span> selected_language <span class="op">===</span> <span class="st">"French"</span><span class="op">;</span></span>
<span id="cb32-68"><a href="#cb32-68"></a>    }<span class="op">,</span></span>
<span id="cb32-69"><a href="#cb32-69"></a>    <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb32-70"><a href="#cb32-70"></a>        <span class="dt">phase</span><span class="op">:</span> <span class="st">"French Stroop"</span></span>
<span id="cb32-71"><a href="#cb32-71"></a>    }</span>
<span id="cb32-72"><a href="#cb32-72"></a>}<span class="op">;</span></span>
<span id="cb32-73"><a href="#cb32-73"></a></span>
<span id="cb32-74"><a href="#cb32-74"></a><span class="co">// ============================================</span></span>
<span id="cb32-75"><a href="#cb32-75"></a><span class="co">// English Stroop</span></span>
<span id="cb32-76"><a href="#cb32-76"></a><span class="co">// ============================================</span></span>
<span id="cb32-77"><a href="#cb32-77"></a></span>
<span id="cb32-78"><a href="#cb32-78"></a><span class="kw">let</span> english_stroop <span class="op">=</span> {</span>
<span id="cb32-79"><a href="#cb32-79"></a>    <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb32-80"><a href="#cb32-80"></a>        {</span>
<span id="cb32-81"><a href="#cb32-81"></a>            <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb32-82"><a href="#cb32-82"></a>            <span class="dt">stimulus</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">"stimulus"</span>)<span class="op">,</span></span>
<span id="cb32-83"><a href="#cb32-83"></a>            <span class="dt">choices</span><span class="op">:</span> [<span class="st">"r"</span><span class="op">,</span> <span class="st">"b"</span><span class="op">,</span> <span class="st">"g"</span><span class="op">,</span> <span class="st">"y"</span>]</span>
<span id="cb32-84"><a href="#cb32-84"></a>        }</span>
<span id="cb32-85"><a href="#cb32-85"></a>    ]<span class="op">,</span></span>
<span id="cb32-86"><a href="#cb32-86"></a>    <span class="dt">timeline_variables</span><span class="op">:</span> [</span>
<span id="cb32-87"><a href="#cb32-87"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: red"&gt;RED&lt;/p&gt;`</span>}<span class="op">,</span></span>
<span id="cb32-88"><a href="#cb32-88"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: blue"&gt;BLUE&lt;/p&gt;`</span>}<span class="op">,</span></span>
<span id="cb32-89"><a href="#cb32-89"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: green"&gt;GREEN&lt;/p&gt;`</span>}<span class="op">,</span></span>
<span id="cb32-90"><a href="#cb32-90"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: yellow"&gt;YELLOW&lt;/p&gt;`</span>}</span>
<span id="cb32-91"><a href="#cb32-91"></a>    ]<span class="op">,</span></span>
<span id="cb32-92"><a href="#cb32-92"></a>    <span class="dt">conditional_function</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb32-93"><a href="#cb32-93"></a>        <span class="kw">let</span> language_data <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">filter</span>({<span class="dt">phase</span><span class="op">:</span> <span class="st">"Language Check"</span>})<span class="op">.</span><span class="fu">values</span>()[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb32-94"><a href="#cb32-94"></a>        <span class="kw">let</span> selected_language <span class="op">=</span> language_data<span class="op">.</span><span class="at">response</span><span class="op">.</span><span class="at">first_language</span><span class="op">;</span></span>
<span id="cb32-95"><a href="#cb32-95"></a></span>
<span id="cb32-96"><a href="#cb32-96"></a>        <span class="cf">return</span> selected_language <span class="op">===</span> <span class="st">"English"</span><span class="op">;</span></span>
<span id="cb32-97"><a href="#cb32-97"></a>    }<span class="op">,</span></span>
<span id="cb32-98"><a href="#cb32-98"></a>    <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb32-99"><a href="#cb32-99"></a>        <span class="dt">phase</span><span class="op">:</span> <span class="st">"English Stroop"</span></span>
<span id="cb32-100"><a href="#cb32-100"></a>    }</span>
<span id="cb32-101"><a href="#cb32-101"></a>}<span class="op">;</span></span>
<span id="cb32-102"><a href="#cb32-102"></a></span>
<span id="cb32-103"><a href="#cb32-103"></a></span>
<span id="cb32-104"><a href="#cb32-104"></a><span class="co">// ============================================</span></span>
<span id="cb32-105"><a href="#cb32-105"></a><span class="co">// Experiment Timeline</span></span>
<span id="cb32-106"><a href="#cb32-106"></a><span class="co">// ============================================</span></span>
<span id="cb32-107"><a href="#cb32-107"></a></span>
<span id="cb32-108"><a href="#cb32-108"></a>jsPsych<span class="op">.</span><span class="fu">run</span>([</span>
<span id="cb32-109"><a href="#cb32-109"></a>    welcome<span class="op">,</span></span>
<span id="cb32-110"><a href="#cb32-110"></a>    language_check<span class="op">,</span></span>
<span id="cb32-111"><a href="#cb32-111"></a>    french_stroop<span class="op">,</span>   <span class="co">// Only runs if French selected</span></span>
<span id="cb32-112"><a href="#cb32-112"></a>    english_stroop<span class="op">,</span>  <span class="co">// Only runs if English selected</span></span>
<span id="cb32-113"><a href="#cb32-113"></a>    debrief</span>
<span id="cb32-114"><a href="#cb32-114"></a>])<span class="op">;</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<div class="sourceCode" id="cb33"><pre class="sourceCode numberSource css number-lines code-with-copy"><code class="sourceCode css"><span id="cb33-1"><a href="#cb33-1"></a>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-4-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-4-tab">
<div id="demo-container-4" style="border: 1px solid #ddd; border-radius: 8px; overflow: hidden; transition: box-shadow 0.2s ease;">
<div style="background-color: #f8f9fa; padding: 8px 12px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center;">
<div>
<span style="font-weight: bold; color: #495057;">Live JsPsych Demo</span>
<span class="focus-indicator-4" style="margin-left: 10px; font-size: 11px; color: #6c757d; font-style: italic;">Click inside the demo to activate demo</span>
</div>
<div style="display: flex; gap: 8px;">
<button onclick="
            console.log('Full screen button clicked');
            var htmlContent = '<!DOCTYPE html>\n<html>\n  <head>\n    <title>Live JsPsych Demo</title>\n    <script src=\'https://unpkg.com/jspsych@8.2.2\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-preload@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-instructions@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-survey-text@2.1.0\'  crossorigin></script>\n        <script src=\'https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0\' crossorigin></script>\n\n    <link href=\'https://unpkg.com/jspsych@8.2.2/css/jspsych.css\' rel=\'stylesheet\' type=\'text/css\' crossorigin />\n\n\n    <style>\n      /* Paused overlay styles */\n      #paused-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-color: rgba(0, 0, 0, 0.7);\n        display: none;\n        justify-content: center;\n        align-items: center;\n        z-index: 9999;\n        font-family: Arial, sans-serif;\n      }\n\n      #paused-message {\n        background-color: white;\n        padding: 30px;\n        border-radius: 10px;\n        text-align: center;\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n        max-width: 300px;\n      }\n\n      #paused-message h2 {\n        margin-top: 0;\n        color: #dc3545;\n        font-size: 24px;\n      }\n\n      #paused-message p {\n        color: #666;\n        margin-bottom: 0;\n        font-size: 16px;\n      }\n\n      .pulse {\n        animation: pulse 2s infinite;\n      }\n\n      @keyframes pulse {\n        0% { opacity: 1; }\n        50% { opacity: 0.5; }\n        100% { opacity: 1; }\n      }\n    </style>\n  </head>\n  <body>\n    <!-- Paused overlay -->\n    <div id=\'paused-overlay\'>\n      <div id=\'paused-message\'>\n        <h2>Demo Paused</h2>\n        <p class=\'pulse\'>Click Anywhere to Resume</p>\n      </div>\n    </div>\n  </body>\n  <script>\n// Initialize jsPsych with interaction tracking and overlay control\nconst jsPsych = initJsPsych({\n  on_interaction_data_update: function(data) {\n    const overlay = document.getElementById(\'paused-overlay\');\n\n    if (data.event === \'blur\') {\n      // User clicked away - pause experiment and show overlay\n      jsPsych.pauseExperiment();\n      if (overlay) {\n        overlay.style.display = \'flex\';\n      }\n    } else if (data.event === \'focus\') {\n      // User returned - resume experiment and hide overlay\n      jsPsych.resumeExperiment();\n      if (overlay) {\n        overlay.style.display = \'none\';\n      }\n    }\n  }\n});\n\n// Make the overlay clickable to resume\ndocument.addEventListener(\'DOMContentLoaded\', function() {\n  const overlay = document.getElementById(\'paused-overlay\');\n  if (overlay) {\n    overlay.addEventListener(\'click\', function() {\n      // Focus the window and let the interaction handler resume\n      window.focus();\n    });\n  }\n});\n\n\n\n// ============================================\n// Instructions\n// ============================================\n\nconst welcome = {\n    type: jsPsychHtmlKeyboardResponse,\n    stimulus: `Welcome to the Experiment! Press any key to begin.`,\n    choices: &quot;ALL_KEYS&quot;,\n    post_trial_gap: 250\n}\n\nconst debrief = {\n    type: jsPsychHtmlKeyboardResponse,\n    stimulus: `Thank you for completing our experiment!`,\n    choices: &quot;NO_KEYS&quot;,\n    post_trial_gap: 250\n}\n\n// ============================================\n// Language Check\n// ============================================\n\nlet language_check = {\n    type: jsPsychSurveyMultiChoice,\n    questions: [\n        {\n            prompt: &quot;What is your first language?&quot;,\n            options: [&quot;English&quot;, &quot;French&quot;],\n            required: true,\n            name: &quot;first_language&quot;\n        }\n    ],\n    data: {\n        phase: &quot;Language Check&quot;\n    }\n};\n\n// ============================================\n// French Stroop\n// ============================================\n\nlet french_stroop = {\n    timeline: [\n        {\n            type: jsPsychHtmlKeyboardResponse,\n            stimulus: jsPsych.timelineVariable(&quot;stimulus&quot;),\n            choices: [&quot;r&quot;, &quot;b&quot;, &quot;v&quot;, &quot;j&quot;]\n        }\n    ],\n    timeline_variables: [\n        {stimulus: `<p style=&quot;font-size:48px; color: red&quot;>ROUGE</p>`},\n        {stimulus: `<p style=&quot;font-size:48px; color: blue&quot;>BLEU</p>`},\n        {stimulus: `<p style=&quot;font-size:48px; color: green&quot;>VERT</p>`},\n        {stimulus: `<p style=&quot;font-size:48px; color: yellow&quot;>JAUNE</p>`}\n    ],\n    conditional_function: function() {\n        // Get the response from the language check\n        let language_data = jsPsych.data.get().filter({phase: &quot;Language Check&quot;}).values()[0];\n        let selected_language = language_data.response.first_language;\n\n        // Only run this timeline if they selected French\n        return selected_language === &quot;French&quot;;\n    },\n    data: {\n        phase: &quot;French Stroop&quot;\n    }\n};\n\n// ============================================\n// English Stroop\n// ============================================\n\nlet english_stroop = {\n    timeline: [\n        {\n            type: jsPsychHtmlKeyboardResponse,\n            stimulus: jsPsych.timelineVariable(&quot;stimulus&quot;),\n            choices: [&quot;r&quot;, &quot;b&quot;, &quot;g&quot;, &quot;y&quot;]\n        }\n    ],\n    timeline_variables: [\n        {stimulus: `<p style=&quot;font-size:48px; color: red&quot;>RED</p>`},\n        {stimulus: `<p style=&quot;font-size:48px; color: blue&quot;>BLUE</p>`},\n        {stimulus: `<p style=&quot;font-size:48px; color: green&quot;>GREEN</p>`},\n        {stimulus: `<p style=&quot;font-size:48px; color: yellow&quot;>YELLOW</p>`}\n    ],\n    conditional_function: function() {\n        let language_data = jsPsych.data.get().filter({phase: &quot;Language Check&quot;}).values()[0];\n        let selected_language = language_data.response.first_language;\n\n        return selected_language === &quot;English&quot;;\n    },\n    data: {\n        phase: &quot;English Stroop&quot;\n    }\n};\n\n\n// ============================================\n// Experiment Timeline\n// ============================================\n\njsPsych.run([\n    welcome,\n    language_check,\n    french_stroop,   // Only runs if French selected\n    english_stroop,  // Only runs if English selected\n    debrief\n]);\n  </script>\n</html>';
            var newWindow = window.open('', '_blank');
            if (newWindow) {
              newWindow.document.write(htmlContent);
              newWindow.document.close();
            } else {
              alert('Pop-up blocked! Please allow pop-ups for this site.');
            }
          " style="background-color: #28a745; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Open in New Tab</button>
<button onclick="
            var iframe = document.getElementById('demo-iframe-4');
            var srcdoc = iframe.getAttribute('srcdoc');
            iframe.setAttribute('srcdoc', '');
            setTimeout(function() {
              iframe.setAttribute('srcdoc', srcdoc);
            }, 10);
          " style="background-color: #007bff; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Refresh</button>
</div>
</div>
<iframe id="demo-iframe-4" srcdoc="<!DOCTYPE html>
<html>
  <head>
    <title>Live JsPsych Demo</title>
    <script src='https://unpkg.com/jspsych@8.2.2' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-preload@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-instructions@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-survey-text@2.1.0'  crossorigin></script>
        <script src='https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0' crossorigin></script>

    <link href='https://unpkg.com/jspsych@8.2.2/css/jspsych.css' rel='stylesheet' type='text/css' crossorigin />


    <style>
      /* Paused overlay styles */
      #paused-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        font-family: Arial, sans-serif;
      }

      #paused-message {
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        max-width: 300px;
      }

      #paused-message h2 {
        margin-top: 0;
        color: #dc3545;
        font-size: 24px;
      }

      #paused-message p {
        color: #666;
        margin-bottom: 0;
        font-size: 16px;
      }

      .pulse {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
      }
    </style>
  </head>
  <body style='max-height: 300px'>
    <!-- Paused overlay -->
    <div id='paused-overlay'>
      <div id='paused-message'>
        <h2>Demo Paused</h2>
        <p class='pulse'>Click Anywhere to Resume</p>
      </div>
    </div>
  </body>
  <script>
// Initialize jsPsych with interaction tracking and overlay control
const jsPsych = initJsPsych({
  on_interaction_data_update: function(data) {
    const overlay = document.getElementById('paused-overlay');

    if (data.event === 'blur') {
      // User clicked away - pause experiment and show overlay
      jsPsych.pauseExperiment();
      if (overlay) {
        overlay.style.display = 'flex';
      }
    } else if (data.event === 'focus') {
      // User returned - resume experiment and hide overlay
      jsPsych.resumeExperiment();
      if (overlay) {
        overlay.style.display = 'none';
      }
    }
  }
});

// Make the overlay clickable to resume
document.addEventListener('DOMContentLoaded', function() {
  const overlay = document.getElementById('paused-overlay');
  if (overlay) {
    overlay.addEventListener('click', function() {
      // Focus the window and let the interaction handler resume
      window.focus();
    });
  }
});



// ============================================
// Instructions
// ============================================

const welcome = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `Welcome to the Experiment! Press any key to begin.`,
    choices: &quot;ALL_KEYS&quot;,
    post_trial_gap: 250
}

const debrief = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `Thank you for completing our experiment!`,
    choices: &quot;NO_KEYS&quot;,
    post_trial_gap: 250
}

// ============================================
// Language Check
// ============================================

let language_check = {
    type: jsPsychSurveyMultiChoice,
    questions: [
        {
            prompt: &quot;What is your first language?&quot;,
            options: [&quot;English&quot;, &quot;French&quot;],
            required: true,
            name: &quot;first_language&quot;
        }
    ],
    data: {
        phase: &quot;Language Check&quot;
    }
};

// ============================================
// French Stroop
// ============================================

let french_stroop = {
    timeline: [
        {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: jsPsych.timelineVariable(&quot;stimulus&quot;),
            choices: [&quot;r&quot;, &quot;b&quot;, &quot;v&quot;, &quot;j&quot;]
        }
    ],
    timeline_variables: [
        {stimulus: `<p style=&quot;font-size:48px; color: red&quot;>ROUGE</p>`},
        {stimulus: `<p style=&quot;font-size:48px; color: blue&quot;>BLEU</p>`},
        {stimulus: `<p style=&quot;font-size:48px; color: green&quot;>VERT</p>`},
        {stimulus: `<p style=&quot;font-size:48px; color: yellow&quot;>JAUNE</p>`}
    ],
    conditional_function: function() {
        // Get the response from the language check
        let language_data = jsPsych.data.get().filter({phase: &quot;Language Check&quot;}).values()[0];
        let selected_language = language_data.response.first_language;

        // Only run this timeline if they selected French
        return selected_language === &quot;French&quot;;
    },
    data: {
        phase: &quot;French Stroop&quot;
    }
};

// ============================================
// English Stroop
// ============================================

let english_stroop = {
    timeline: [
        {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: jsPsych.timelineVariable(&quot;stimulus&quot;),
            choices: [&quot;r&quot;, &quot;b&quot;, &quot;g&quot;, &quot;y&quot;]
        }
    ],
    timeline_variables: [
        {stimulus: `<p style=&quot;font-size:48px; color: red&quot;>RED</p>`},
        {stimulus: `<p style=&quot;font-size:48px; color: blue&quot;>BLUE</p>`},
        {stimulus: `<p style=&quot;font-size:48px; color: green&quot;>GREEN</p>`},
        {stimulus: `<p style=&quot;font-size:48px; color: yellow&quot;>YELLOW</p>`}
    ],
    conditional_function: function() {
        let language_data = jsPsych.data.get().filter({phase: &quot;Language Check&quot;}).values()[0];
        let selected_language = language_data.response.first_language;

        return selected_language === &quot;English&quot;;
    },
    data: {
        phase: &quot;English Stroop&quot;
    }
};


// ============================================
// Experiment Timeline
// ============================================

jsPsych.run([
    welcome,
    language_check,
    french_stroop,   // Only runs if French selected
    english_stroop,  // Only runs if English selected
    debrief
]);
  </script>
</html>" width="100%" height="300px" scrolling="yes" style="border: none; display: block;" onload="javascript:(function(iframe){
        var container = document.getElementById(&quot;demo-container-4&quot;);
        var indicator = container.querySelector(&quot;.focus-indicator-4&quot;);

        function showFocus() {
          container.style.boxShadow = &quot;0 0 0 3px #007bff&quot;;
          if (indicator) {
            indicator.textContent = &quot;✓ Demo Active&quot;;
            indicator.style.color = &quot;#28a745&quot;;
          }
        }

        function hideFocus() {
          container.style.boxShadow = &quot;none&quot;;
          if (indicator) {
            indicator.textContent = &quot;Click inside the demo to activate&quot;;
            indicator.style.color = &quot;#6c757d&quot;;
          }
        }

        var iframeWindow = iframe.contentWindow;
        if (iframeWindow) {
          iframeWindow.onfocus = showFocus;
          iframeWindow.onblur = hideFocus;
          iframeWindow.document.addEventListener(&quot;click&quot;, function() {
            iframeWindow.focus();
            showFocus();
          });
          document.addEventListener(&quot;click&quot;, function(e) {
            if (!container.contains(e.target)) {
              iframeWindow.blur();
              hideFocus();
            }
          });
        }
      }(this));"></iframe>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="example-language-specific-tasks-expanded" class="level3" data-number="19.6.3">
<h3 data-number="19.6.3" class="anchored" data-anchor-id="example-language-specific-tasks-expanded"><span class="header-section-number">19.6.3</span> Example: Language-Specific Tasks Expanded</h3>
<p>In the previous example, we just swapped out the task based on first language. Of course, if someone speaks French as a first language, we’d probably want all of the instructions and debrief in French too!</p>
<p>Going back to the idea that it’s ‘timelines all the way down’, we can expand our logic to create more complex, nested timelines so that each task gets its own set of instructions and debrief in the appropriate language.</p>
<p>Let’s update the experiment code to do that:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">index.html</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">exp.js</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false">style.css</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-4" role="tab" aria-controls="tabset-5-4" aria-selected="false">Result</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="sourceCode" id="cb34"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb34-1"><a href="#cb34-1"></a> <span class="dt">&lt;!DOCTYPE</span> html<span class="dt">&gt;</span></span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb34-4"><a href="#cb34-4"></a>    <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>Demo<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb34-5"><a href="#cb34-5"></a>    <span class="co">&lt;!-- jsPsych --&gt;</span></span>
<span id="cb34-6"><a href="#cb34-6"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/jspsych.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb34-7"><a href="#cb34-7"></a>    <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> href</span><span class="op">=</span><span class="st">"jspsych/jspsych.css"</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text/css"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb34-8"><a href="#cb34-8"></a>    </span>
<span id="cb34-9"><a href="#cb34-9"></a>    <span class="co">&lt;!-- jPsych plugins --&gt;</span></span>
<span id="cb34-10"><a href="#cb34-10"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/plugin-html-keyboard-response.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb34-11"><a href="#cb34-11"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/plugin-survey-multi-choice.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb34-12"><a href="#cb34-12"></a></span>
<span id="cb34-13"><a href="#cb34-13"></a>    <span class="co">&lt;!-- custom CSS --&gt;</span></span>
<span id="cb34-14"><a href="#cb34-14"></a>     <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> href</span><span class="op">=</span><span class="st">"style.css"</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text/css"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb34-15"><a href="#cb34-15"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb34-16"><a href="#cb34-16"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb34-17"><a href="#cb34-17"></a>  <span class="co">&lt;!-- custom JS --&gt;</span></span>
<span id="cb34-18"><a href="#cb34-18"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"exp.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb34-19"><a href="#cb34-19"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb34-20"><a href="#cb34-20"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb34-21"><a href="#cb34-21"></a> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="sourceCode" id="cb35"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb35-1"><a href="#cb35-1"></a> </span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="kw">const</span> jsPsych <span class="op">=</span> <span class="fu">initJsPsych</span>()<span class="op">;</span></span>
<span id="cb35-3"><a href="#cb35-3"></a></span>
<span id="cb35-4"><a href="#cb35-4"></a> </span>
<span id="cb35-5"><a href="#cb35-5"></a><span class="co">// ============================================</span></span>
<span id="cb35-6"><a href="#cb35-6"></a><span class="co">// Language Check</span></span>
<span id="cb35-7"><a href="#cb35-7"></a><span class="co">// ============================================</span></span>
<span id="cb35-8"><a href="#cb35-8"></a></span>
<span id="cb35-9"><a href="#cb35-9"></a><span class="kw">let</span> language_check <span class="op">=</span> {</span>
<span id="cb35-10"><a href="#cb35-10"></a>    <span class="dt">type</span><span class="op">:</span> jsPsychSurveyMultiChoice<span class="op">,</span></span>
<span id="cb35-11"><a href="#cb35-11"></a>    <span class="dt">questions</span><span class="op">:</span> [</span>
<span id="cb35-12"><a href="#cb35-12"></a>        {</span>
<span id="cb35-13"><a href="#cb35-13"></a>            <span class="dt">prompt</span><span class="op">:</span> <span class="st">"What is your first language? / Quelle est votre langue maternelle?"</span><span class="op">,</span></span>
<span id="cb35-14"><a href="#cb35-14"></a>            <span class="dt">options</span><span class="op">:</span> [<span class="st">"English"</span><span class="op">,</span> <span class="st">"Français"</span>]<span class="op">,</span></span>
<span id="cb35-15"><a href="#cb35-15"></a>            <span class="dt">required</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb35-16"><a href="#cb35-16"></a>            <span class="dt">name</span><span class="op">:</span> <span class="st">"first_language"</span></span>
<span id="cb35-17"><a href="#cb35-17"></a>        }</span>
<span id="cb35-18"><a href="#cb35-18"></a>    ]<span class="op">,</span></span>
<span id="cb35-19"><a href="#cb35-19"></a>    <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb35-20"><a href="#cb35-20"></a>        <span class="dt">phase</span><span class="op">:</span> <span class="st">"Language Check"</span></span>
<span id="cb35-21"><a href="#cb35-21"></a>    }</span>
<span id="cb35-22"><a href="#cb35-22"></a>}<span class="op">;</span></span>
<span id="cb35-23"><a href="#cb35-23"></a></span>
<span id="cb35-24"><a href="#cb35-24"></a><span class="co">// ============================================</span></span>
<span id="cb35-25"><a href="#cb35-25"></a><span class="co">// French Version (Instructions + Task + Debrief)</span></span>
<span id="cb35-26"><a href="#cb35-26"></a><span class="co">// ============================================</span></span>
<span id="cb35-27"><a href="#cb35-27"></a></span>
<span id="cb35-28"><a href="#cb35-28"></a><span class="kw">let</span> french_instructions <span class="op">=</span> {</span>
<span id="cb35-29"><a href="#cb35-29"></a>    <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb35-30"><a href="#cb35-30"></a>    <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;div style="font-size: 20px;"&gt;</span></span>
<span id="cb35-31"><a href="#cb35-31"></a><span class="vs">        &lt;p&gt;Bienvenue à l'expérience Stroop!&lt;/p&gt;</span></span>
<span id="cb35-32"><a href="#cb35-32"></a><span class="vs">        &lt;p&gt;Vous allez voir des mots de couleur affichés à l'écran.&lt;/p&gt;</span></span>
<span id="cb35-33"><a href="#cb35-33"></a><span class="vs">        &lt;p&gt;Appuyez sur la touche correspondant à la COULEUR du mot:&lt;/p&gt;</span></span>
<span id="cb35-34"><a href="#cb35-34"></a><span class="vs">        &lt;ul style="list-style-type: none;"&gt;</span></span>
<span id="cb35-35"><a href="#cb35-35"></a><span class="vs">            &lt;li&gt;R pour Rouge&lt;/li&gt;</span></span>
<span id="cb35-36"><a href="#cb35-36"></a><span class="vs">            &lt;li&gt;B pour Bleu&lt;/li&gt;</span></span>
<span id="cb35-37"><a href="#cb35-37"></a><span class="vs">            &lt;li&gt;V pour Vert&lt;/li&gt;</span></span>
<span id="cb35-38"><a href="#cb35-38"></a><span class="vs">            &lt;li&gt;J pour Jaune&lt;/li&gt;</span></span>
<span id="cb35-39"><a href="#cb35-39"></a><span class="vs">        &lt;/ul&gt;</span></span>
<span id="cb35-40"><a href="#cb35-40"></a><span class="vs">        &lt;p&gt;Appuyez sur n'importe quelle touche pour commencer.&lt;/p&gt;</span></span>
<span id="cb35-41"><a href="#cb35-41"></a><span class="vs">    &lt;/div&gt;`</span><span class="op">,</span></span>
<span id="cb35-42"><a href="#cb35-42"></a>    <span class="dt">choices</span><span class="op">:</span> <span class="st">"ALL_KEYS"</span></span>
<span id="cb35-43"><a href="#cb35-43"></a>}<span class="op">;</span></span>
<span id="cb35-44"><a href="#cb35-44"></a></span>
<span id="cb35-45"><a href="#cb35-45"></a><span class="kw">let</span> french_stroop_task <span class="op">=</span> {</span>
<span id="cb35-46"><a href="#cb35-46"></a>    <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb35-47"><a href="#cb35-47"></a>        {</span>
<span id="cb35-48"><a href="#cb35-48"></a>            <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb35-49"><a href="#cb35-49"></a>            <span class="dt">stimulus</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">"stimulus"</span>)<span class="op">,</span></span>
<span id="cb35-50"><a href="#cb35-50"></a>            <span class="dt">choices</span><span class="op">:</span> [<span class="st">"r"</span><span class="op">,</span> <span class="st">"b"</span><span class="op">,</span> <span class="st">"v"</span><span class="op">,</span> <span class="st">"j"</span>]<span class="op">,</span></span>
<span id="cb35-51"><a href="#cb35-51"></a>            <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb35-52"><a href="#cb35-52"></a>                <span class="dt">correct_response</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">"correct_key"</span>)</span>
<span id="cb35-53"><a href="#cb35-53"></a>            }<span class="op">,</span></span>
<span id="cb35-54"><a href="#cb35-54"></a>            <span class="dt">on_finish</span><span class="op">:</span> <span class="kw">function</span>(data) {</span>
<span id="cb35-55"><a href="#cb35-55"></a>                data<span class="op">.</span><span class="at">correct</span> <span class="op">=</span> data<span class="op">.</span><span class="at">response</span> <span class="op">===</span> data<span class="op">.</span><span class="at">correct_response</span><span class="op">;</span></span>
<span id="cb35-56"><a href="#cb35-56"></a>            }</span>
<span id="cb35-57"><a href="#cb35-57"></a>        }</span>
<span id="cb35-58"><a href="#cb35-58"></a>    ]<span class="op">,</span></span>
<span id="cb35-59"><a href="#cb35-59"></a>    <span class="dt">timeline_variables</span><span class="op">:</span> [</span>
<span id="cb35-60"><a href="#cb35-60"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: red"&gt;ROUGE&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"r"</span>}<span class="op">,</span></span>
<span id="cb35-61"><a href="#cb35-61"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: blue"&gt;BLEU&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"b"</span>}<span class="op">,</span></span>
<span id="cb35-62"><a href="#cb35-62"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: green"&gt;VERT&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"v"</span>}<span class="op">,</span></span>
<span id="cb35-63"><a href="#cb35-63"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: yellow"&gt;JAUNE&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"j"</span>}<span class="op">,</span></span>
<span id="cb35-64"><a href="#cb35-64"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: blue"&gt;ROUGE&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"b"</span>}<span class="op">,</span></span>
<span id="cb35-65"><a href="#cb35-65"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: red"&gt;BLEU&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"r"</span>}</span>
<span id="cb35-66"><a href="#cb35-66"></a>    ]<span class="op">,</span></span>
<span id="cb35-67"><a href="#cb35-67"></a>    <span class="dt">randomize_order</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb35-68"><a href="#cb35-68"></a>}<span class="op">;</span></span>
<span id="cb35-69"><a href="#cb35-69"></a></span>
<span id="cb35-70"><a href="#cb35-70"></a><span class="kw">let</span> french_debrief <span class="op">=</span> {</span>
<span id="cb35-71"><a href="#cb35-71"></a>    <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb35-72"><a href="#cb35-72"></a>    <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;div style="font-size: 20px;"&gt;</span></span>
<span id="cb35-73"><a href="#cb35-73"></a><span class="vs">        &lt;p&gt;Merci d'avoir participé à notre expérience!&lt;/p&gt;</span></span>
<span id="cb35-74"><a href="#cb35-74"></a><span class="vs">        &lt;p&gt;Appuyez sur n'importe quelle touche pour terminer.&lt;/p&gt;</span></span>
<span id="cb35-75"><a href="#cb35-75"></a><span class="vs">    &lt;/div&gt;`</span><span class="op">,</span></span>
<span id="cb35-76"><a href="#cb35-76"></a>    <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span></span>
<span id="cb35-77"><a href="#cb35-77"></a>}<span class="op">;</span></span>
<span id="cb35-78"><a href="#cb35-78"></a></span>
<span id="cb35-79"><a href="#cb35-79"></a><span class="co">// Combine all French components into one timeline</span></span>
<span id="cb35-80"><a href="#cb35-80"></a><span class="kw">let</span> french_experiment <span class="op">=</span> {</span>
<span id="cb35-81"><a href="#cb35-81"></a>    <span class="dt">timeline</span><span class="op">:</span> [french_instructions<span class="op">,</span> french_stroop_task<span class="op">,</span> french_debrief]<span class="op">,</span></span>
<span id="cb35-82"><a href="#cb35-82"></a>    <span class="dt">conditional_function</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb35-83"><a href="#cb35-83"></a>        <span class="kw">let</span> language_data <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">filter</span>({<span class="dt">phase</span><span class="op">:</span> <span class="st">"Language Check"</span>})<span class="op">.</span><span class="fu">values</span>()[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb35-84"><a href="#cb35-84"></a>        <span class="kw">let</span> selected_language <span class="op">=</span> language_data<span class="op">.</span><span class="at">response</span><span class="op">.</span><span class="at">first_language</span><span class="op">;</span></span>
<span id="cb35-85"><a href="#cb35-85"></a>        <span class="cf">return</span> selected_language <span class="op">===</span> <span class="st">"Français"</span><span class="op">;</span></span>
<span id="cb35-86"><a href="#cb35-86"></a>    }</span>
<span id="cb35-87"><a href="#cb35-87"></a>}<span class="op">;</span></span>
<span id="cb35-88"><a href="#cb35-88"></a></span>
<span id="cb35-89"><a href="#cb35-89"></a><span class="co">// ============================================</span></span>
<span id="cb35-90"><a href="#cb35-90"></a><span class="co">// English Version (Instructions + Task + Debrief)</span></span>
<span id="cb35-91"><a href="#cb35-91"></a><span class="co">// ============================================</span></span>
<span id="cb35-92"><a href="#cb35-92"></a></span>
<span id="cb35-93"><a href="#cb35-93"></a><span class="kw">let</span> english_instructions <span class="op">=</span> {</span>
<span id="cb35-94"><a href="#cb35-94"></a>    <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb35-95"><a href="#cb35-95"></a>    <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;div style="font-size: 20px;"&gt;</span></span>
<span id="cb35-96"><a href="#cb35-96"></a><span class="vs">        &lt;p&gt;Welcome to the Stroop experiment!&lt;/p&gt;</span></span>
<span id="cb35-97"><a href="#cb35-97"></a><span class="vs">        &lt;p&gt;You will see color words displayed on the screen.&lt;/p&gt;</span></span>
<span id="cb35-98"><a href="#cb35-98"></a><span class="vs">        &lt;p&gt;Press the key corresponding to the COLOR of the word:&lt;/p&gt;</span></span>
<span id="cb35-99"><a href="#cb35-99"></a><span class="vs">        &lt;ul style="list-style-type: none;"&gt;</span></span>
<span id="cb35-100"><a href="#cb35-100"></a><span class="vs">            &lt;li&gt;R for Red&lt;/li&gt;</span></span>
<span id="cb35-101"><a href="#cb35-101"></a><span class="vs">            &lt;li&gt;B for Blue&lt;/li&gt;</span></span>
<span id="cb35-102"><a href="#cb35-102"></a><span class="vs">            &lt;li&gt;G for Green&lt;/li&gt;</span></span>
<span id="cb35-103"><a href="#cb35-103"></a><span class="vs">            &lt;li&gt;Y for Yellow&lt;/li&gt;</span></span>
<span id="cb35-104"><a href="#cb35-104"></a><span class="vs">        &lt;/ul&gt;</span></span>
<span id="cb35-105"><a href="#cb35-105"></a><span class="vs">        &lt;p&gt;Press any key to begin.&lt;/p&gt;</span></span>
<span id="cb35-106"><a href="#cb35-106"></a><span class="vs">    &lt;/div&gt;`</span><span class="op">,</span></span>
<span id="cb35-107"><a href="#cb35-107"></a>    <span class="dt">choices</span><span class="op">:</span> <span class="st">"ALL_KEYS"</span></span>
<span id="cb35-108"><a href="#cb35-108"></a>}<span class="op">;</span></span>
<span id="cb35-109"><a href="#cb35-109"></a></span>
<span id="cb35-110"><a href="#cb35-110"></a><span class="kw">let</span> english_stroop_task <span class="op">=</span> {</span>
<span id="cb35-111"><a href="#cb35-111"></a>    <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb35-112"><a href="#cb35-112"></a>        {</span>
<span id="cb35-113"><a href="#cb35-113"></a>            <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb35-114"><a href="#cb35-114"></a>            <span class="dt">stimulus</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">"stimulus"</span>)<span class="op">,</span></span>
<span id="cb35-115"><a href="#cb35-115"></a>            <span class="dt">choices</span><span class="op">:</span> [<span class="st">"r"</span><span class="op">,</span> <span class="st">"b"</span><span class="op">,</span> <span class="st">"g"</span><span class="op">,</span> <span class="st">"y"</span>]<span class="op">,</span></span>
<span id="cb35-116"><a href="#cb35-116"></a>            <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb35-117"><a href="#cb35-117"></a>                <span class="dt">correct_response</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">"correct_key"</span>)</span>
<span id="cb35-118"><a href="#cb35-118"></a>            }<span class="op">,</span></span>
<span id="cb35-119"><a href="#cb35-119"></a>            <span class="dt">on_finish</span><span class="op">:</span> <span class="kw">function</span>(data) {</span>
<span id="cb35-120"><a href="#cb35-120"></a>                data<span class="op">.</span><span class="at">correct</span> <span class="op">=</span> data<span class="op">.</span><span class="at">response</span> <span class="op">===</span> data<span class="op">.</span><span class="at">correct_response</span><span class="op">;</span></span>
<span id="cb35-121"><a href="#cb35-121"></a>            }</span>
<span id="cb35-122"><a href="#cb35-122"></a>        }</span>
<span id="cb35-123"><a href="#cb35-123"></a>    ]<span class="op">,</span></span>
<span id="cb35-124"><a href="#cb35-124"></a>    <span class="dt">timeline_variables</span><span class="op">:</span> [</span>
<span id="cb35-125"><a href="#cb35-125"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: red"&gt;RED&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"r"</span>}<span class="op">,</span></span>
<span id="cb35-126"><a href="#cb35-126"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: blue"&gt;BLUE&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"b"</span>}<span class="op">,</span></span>
<span id="cb35-127"><a href="#cb35-127"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: green"&gt;GREEN&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"g"</span>}<span class="op">,</span></span>
<span id="cb35-128"><a href="#cb35-128"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: yellow"&gt;YELLOW&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"y"</span>}<span class="op">,</span></span>
<span id="cb35-129"><a href="#cb35-129"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: blue"&gt;RED&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"b"</span>}<span class="op">,</span></span>
<span id="cb35-130"><a href="#cb35-130"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="font-size:48px; color: red"&gt;BLUE&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"r"</span>}</span>
<span id="cb35-131"><a href="#cb35-131"></a>    ]<span class="op">,</span></span>
<span id="cb35-132"><a href="#cb35-132"></a>    <span class="dt">randomize_order</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb35-133"><a href="#cb35-133"></a>}<span class="op">;</span></span>
<span id="cb35-134"><a href="#cb35-134"></a></span>
<span id="cb35-135"><a href="#cb35-135"></a><span class="kw">let</span> english_debrief <span class="op">=</span> {</span>
<span id="cb35-136"><a href="#cb35-136"></a>    <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb35-137"><a href="#cb35-137"></a>    <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;div style="font-size: 20px;"&gt;</span></span>
<span id="cb35-138"><a href="#cb35-138"></a><span class="vs">        &lt;p&gt;Thank you for participating in our experiment!&lt;/p&gt;</span></span>
<span id="cb35-139"><a href="#cb35-139"></a><span class="vs">        &lt;p&gt;Press any key to finish.&lt;/p&gt;</span></span>
<span id="cb35-140"><a href="#cb35-140"></a><span class="vs">    &lt;/div&gt;`</span><span class="op">,</span></span>
<span id="cb35-141"><a href="#cb35-141"></a>    <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span></span>
<span id="cb35-142"><a href="#cb35-142"></a>}<span class="op">;</span></span>
<span id="cb35-143"><a href="#cb35-143"></a></span>
<span id="cb35-144"><a href="#cb35-144"></a><span class="co">// Combine all English components into one timeline</span></span>
<span id="cb35-145"><a href="#cb35-145"></a><span class="kw">let</span> english_experiment <span class="op">=</span> {</span>
<span id="cb35-146"><a href="#cb35-146"></a>    <span class="dt">timeline</span><span class="op">:</span> [english_instructions<span class="op">,</span> english_stroop_task<span class="op">,</span> english_debrief]<span class="op">,</span></span>
<span id="cb35-147"><a href="#cb35-147"></a>    <span class="dt">conditional_function</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb35-148"><a href="#cb35-148"></a>        <span class="kw">let</span> language_data <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">filter</span>({<span class="dt">phase</span><span class="op">:</span> <span class="st">"Language Check"</span>})<span class="op">.</span><span class="fu">values</span>()[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb35-149"><a href="#cb35-149"></a>        <span class="kw">let</span> selected_language <span class="op">=</span> language_data<span class="op">.</span><span class="at">response</span><span class="op">.</span><span class="at">first_language</span><span class="op">;</span></span>
<span id="cb35-150"><a href="#cb35-150"></a>        <span class="cf">return</span> selected_language <span class="op">===</span> <span class="st">"English"</span><span class="op">;</span></span>
<span id="cb35-151"><a href="#cb35-151"></a>    }</span>
<span id="cb35-152"><a href="#cb35-152"></a>}<span class="op">;</span></span>
<span id="cb35-153"><a href="#cb35-153"></a></span>
<span id="cb35-154"><a href="#cb35-154"></a><span class="co">// ============================================</span></span>
<span id="cb35-155"><a href="#cb35-155"></a><span class="co">// Experiment Timeline</span></span>
<span id="cb35-156"><a href="#cb35-156"></a><span class="co">// ============================================</span></span>
<span id="cb35-157"><a href="#cb35-157"></a></span>
<span id="cb35-158"><a href="#cb35-158"></a>jsPsych<span class="op">.</span><span class="fu">run</span>([</span>
<span id="cb35-159"><a href="#cb35-159"></a>    language_check<span class="op">,</span></span>
<span id="cb35-160"><a href="#cb35-160"></a>    french_experiment<span class="op">,</span>   <span class="co">// Only runs if French selected</span></span>
<span id="cb35-161"><a href="#cb35-161"></a>    english_experiment   <span class="co">// Only runs if English selected</span></span>
<span id="cb35-162"><a href="#cb35-162"></a>])<span class="op">;</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-5-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">
<div class="sourceCode" id="cb36"><pre class="sourceCode numberSource css number-lines code-with-copy"><code class="sourceCode css"><span id="cb36-1"><a href="#cb36-1"></a>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-5-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-4-tab">
<div id="demo-container-5" style="border: 1px solid #ddd; border-radius: 8px; overflow: hidden; transition: box-shadow 0.2s ease;">
<div style="background-color: #f8f9fa; padding: 8px 12px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center;">
<div>
<span style="font-weight: bold; color: #495057;">Live JsPsych Demo</span>
<span class="focus-indicator-5" style="margin-left: 10px; font-size: 11px; color: #6c757d; font-style: italic;">Click inside the demo to activate demo</span>
</div>
<div style="display: flex; gap: 8px;">
<button onclick="
            console.log('Full screen button clicked');
            var htmlContent = '<!DOCTYPE html>\n<html>\n  <head>\n    <title>Live JsPsych Demo</title>\n    <script src=\'https://unpkg.com/jspsych@8.2.2\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-preload@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-instructions@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-survey-text@2.1.0\'  crossorigin></script>\n        <script src=\'https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0\' crossorigin></script>\n\n    <link href=\'https://unpkg.com/jspsych@8.2.2/css/jspsych.css\' rel=\'stylesheet\' type=\'text/css\' crossorigin />\n\n\n    <style>\n      /* Paused overlay styles */\n      #paused-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-color: rgba(0, 0, 0, 0.7);\n        display: none;\n        justify-content: center;\n        align-items: center;\n        z-index: 9999;\n        font-family: Arial, sans-serif;\n      }\n\n      #paused-message {\n        background-color: white;\n        padding: 30px;\n        border-radius: 10px;\n        text-align: center;\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n        max-width: 300px;\n      }\n\n      #paused-message h2 {\n        margin-top: 0;\n        color: #dc3545;\n        font-size: 24px;\n      }\n\n      #paused-message p {\n        color: #666;\n        margin-bottom: 0;\n        font-size: 16px;\n      }\n\n      .pulse {\n        animation: pulse 2s infinite;\n      }\n\n      @keyframes pulse {\n        0% { opacity: 1; }\n        50% { opacity: 0.5; }\n        100% { opacity: 1; }\n      }\n    </style>\n  </head>\n  <body>\n    <!-- Paused overlay -->\n    <div id=\'paused-overlay\'>\n      <div id=\'paused-message\'>\n        <h2>Demo Paused</h2>\n        <p class=\'pulse\'>Click Anywhere to Resume</p>\n      </div>\n    </div>\n  </body>\n  <script>\n// Initialize jsPsych with interaction tracking and overlay control\nconst jsPsych = initJsPsych({\n  on_interaction_data_update: function(data) {\n    const overlay = document.getElementById(\'paused-overlay\');\n\n    if (data.event === \'blur\') {\n      // User clicked away - pause experiment and show overlay\n      jsPsych.pauseExperiment();\n      if (overlay) {\n        overlay.style.display = \'flex\';\n      }\n    } else if (data.event === \'focus\') {\n      // User returned - resume experiment and hide overlay\n      jsPsych.resumeExperiment();\n      if (overlay) {\n        overlay.style.display = \'none\';\n      }\n    }\n  }\n});\n\n// Make the overlay clickable to resume\ndocument.addEventListener(\'DOMContentLoaded\', function() {\n  const overlay = document.getElementById(\'paused-overlay\');\n  if (overlay) {\n    overlay.addEventListener(\'click\', function() {\n      // Focus the window and let the interaction handler resume\n      window.focus();\n    });\n  }\n});\n\n\n// ============================================\n// Language Check\n// ============================================\n\nlet language_check = {\n    type: jsPsychSurveyMultiChoice,\n    questions: [\n        {\n            prompt: &quot;What is your first language? / Quelle est votre langue maternelle?&quot;,\n            options: [&quot;English&quot;, &quot;Français&quot;],\n            required: true,\n            name: &quot;first_language&quot;\n        }\n    ],\n    data: {\n        phase: &quot;Language Check&quot;\n    }\n};\n\n// ============================================\n// French Version (Instructions + Task + Debrief)\n// ============================================\n\nlet french_instructions = {\n    type: jsPsychHtmlKeyboardResponse,\n    stimulus: `<div style=&quot;font-size: 20px;&quot;>\n        <p>Bienvenue à l\'expérience Stroop!</p>\n        <p>Vous allez voir des mots de couleur affichés à l\'écran.</p>\n        <p>Appuyez sur la touche correspondant à la COULEUR du mot:</p>\n        <ul style=&quot;list-style-type: none;&quot;>\n            <li>R pour Rouge</li>\n            <li>B pour Bleu</li>\n            <li>V pour Vert</li>\n            <li>J pour Jaune</li>\n        </ul>\n        <p>Appuyez sur n\'importe quelle touche pour commencer.</p>\n    </div>`,\n    choices: &quot;ALL_KEYS&quot;\n};\n\nlet french_stroop_task = {\n    timeline: [\n        {\n            type: jsPsychHtmlKeyboardResponse,\n            stimulus: jsPsych.timelineVariable(&quot;stimulus&quot;),\n            choices: [&quot;r&quot;, &quot;b&quot;, &quot;v&quot;, &quot;j&quot;],\n            data: {\n                correct_response: jsPsych.timelineVariable(&quot;correct_key&quot;)\n            },\n            on_finish: function(data) {\n                data.correct = data.response === data.correct_response;\n            }\n        }\n    ],\n    timeline_variables: [\n        {stimulus: `<p style=&quot;font-size:48px; color: red&quot;>ROUGE</p>`, correct_key: &quot;r&quot;},\n        {stimulus: `<p style=&quot;font-size:48px; color: blue&quot;>BLEU</p>`, correct_key: &quot;b&quot;},\n        {stimulus: `<p style=&quot;font-size:48px; color: green&quot;>VERT</p>`, correct_key: &quot;v&quot;},\n        {stimulus: `<p style=&quot;font-size:48px; color: yellow&quot;>JAUNE</p>`, correct_key: &quot;j&quot;},\n        {stimulus: `<p style=&quot;font-size:48px; color: blue&quot;>ROUGE</p>`, correct_key: &quot;b&quot;},\n        {stimulus: `<p style=&quot;font-size:48px; color: red&quot;>BLEU</p>`, correct_key: &quot;r&quot;}\n    ],\n    randomize_order: true\n};\n\nlet french_debrief = {\n    type: jsPsychHtmlKeyboardResponse,\n    stimulus: `<div style=&quot;font-size: 20px;&quot;>\n        <p>Merci d\'avoir participé à notre expérience!</p>\n        <p>Appuyez sur n\'importe quelle touche pour terminer.</p>\n    </div>`,\n    choices: &quot;NO_KEYS&quot;\n};\n\n// Combine all French components into one timeline\nlet french_experiment = {\n    timeline: [french_instructions, french_stroop_task, french_debrief],\n    conditional_function: function() {\n        let language_data = jsPsych.data.get().filter({phase: &quot;Language Check&quot;}).values()[0];\n        let selected_language = language_data.response.first_language;\n        return selected_language === &quot;Français&quot;;\n    }\n};\n\n// ============================================\n// English Version (Instructions + Task + Debrief)\n// ============================================\n\nlet english_instructions = {\n    type: jsPsychHtmlKeyboardResponse,\n    stimulus: `<div style=&quot;font-size: 20px;&quot;>\n        <p>Welcome to the Stroop experiment!</p>\n        <p>You will see color words displayed on the screen.</p>\n        <p>Press the key corresponding to the COLOR of the word:</p>\n        <ul style=&quot;list-style-type: none;&quot;>\n            <li>R for Red</li>\n            <li>B for Blue</li>\n            <li>G for Green</li>\n            <li>Y for Yellow</li>\n        </ul>\n        <p>Press any key to begin.</p>\n    </div>`,\n    choices: &quot;ALL_KEYS&quot;\n};\n\nlet english_stroop_task = {\n    timeline: [\n        {\n            type: jsPsychHtmlKeyboardResponse,\n            stimulus: jsPsych.timelineVariable(&quot;stimulus&quot;),\n            choices: [&quot;r&quot;, &quot;b&quot;, &quot;g&quot;, &quot;y&quot;],\n            data: {\n                correct_response: jsPsych.timelineVariable(&quot;correct_key&quot;)\n            },\n            on_finish: function(data) {\n                data.correct = data.response === data.correct_response;\n            }\n        }\n    ],\n    timeline_variables: [\n        {stimulus: `<p style=&quot;font-size:48px; color: red&quot;>RED</p>`, correct_key: &quot;r&quot;},\n        {stimulus: `<p style=&quot;font-size:48px; color: blue&quot;>BLUE</p>`, correct_key: &quot;b&quot;},\n        {stimulus: `<p style=&quot;font-size:48px; color: green&quot;>GREEN</p>`, correct_key: &quot;g&quot;},\n        {stimulus: `<p style=&quot;font-size:48px; color: yellow&quot;>YELLOW</p>`, correct_key: &quot;y&quot;},\n        {stimulus: `<p style=&quot;font-size:48px; color: blue&quot;>RED</p>`, correct_key: &quot;b&quot;},\n        {stimulus: `<p style=&quot;font-size:48px; color: red&quot;>BLUE</p>`, correct_key: &quot;r&quot;}\n    ],\n    randomize_order: true\n};\n\nlet english_debrief = {\n    type: jsPsychHtmlKeyboardResponse,\n    stimulus: `<div style=&quot;font-size: 20px;&quot;>\n        <p>Thank you for participating in our experiment!</p>\n        <p>Press any key to finish.</p>\n    </div>`,\n    choices: &quot;NO_KEYS&quot;\n};\n\n// Combine all English components into one timeline\nlet english_experiment = {\n    timeline: [english_instructions, english_stroop_task, english_debrief],\n    conditional_function: function() {\n        let language_data = jsPsych.data.get().filter({phase: &quot;Language Check&quot;}).values()[0];\n        let selected_language = language_data.response.first_language;\n        return selected_language === &quot;English&quot;;\n    }\n};\n\n// ============================================\n// Experiment Timeline\n// ============================================\n\njsPsych.run([\n    language_check,\n    french_experiment,   // Only runs if French selected\n    english_experiment   // Only runs if English selected\n]);\n  </script>\n</html>';
            var newWindow = window.open('', '_blank');
            if (newWindow) {
              newWindow.document.write(htmlContent);
              newWindow.document.close();
            } else {
              alert('Pop-up blocked! Please allow pop-ups for this site.');
            }
          " style="background-color: #28a745; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Open in New Tab</button>
<button onclick="
            var iframe = document.getElementById('demo-iframe-5');
            var srcdoc = iframe.getAttribute('srcdoc');
            iframe.setAttribute('srcdoc', '');
            setTimeout(function() {
              iframe.setAttribute('srcdoc', srcdoc);
            }, 10);
          " style="background-color: #007bff; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Refresh</button>
</div>
</div>
<iframe id="demo-iframe-5" srcdoc="<!DOCTYPE html>
<html>
  <head>
    <title>Live JsPsych Demo</title>
    <script src='https://unpkg.com/jspsych@8.2.2' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-preload@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-instructions@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-survey-text@2.1.0'  crossorigin></script>
        <script src='https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0' crossorigin></script>

    <link href='https://unpkg.com/jspsych@8.2.2/css/jspsych.css' rel='stylesheet' type='text/css' crossorigin />


    <style>
      /* Paused overlay styles */
      #paused-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        font-family: Arial, sans-serif;
      }

      #paused-message {
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        max-width: 300px;
      }

      #paused-message h2 {
        margin-top: 0;
        color: #dc3545;
        font-size: 24px;
      }

      #paused-message p {
        color: #666;
        margin-bottom: 0;
        font-size: 16px;
      }

      .pulse {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
      }
    </style>
  </head>
  <body style='max-height: 300px'>
    <!-- Paused overlay -->
    <div id='paused-overlay'>
      <div id='paused-message'>
        <h2>Demo Paused</h2>
        <p class='pulse'>Click Anywhere to Resume</p>
      </div>
    </div>
  </body>
  <script>
// Initialize jsPsych with interaction tracking and overlay control
const jsPsych = initJsPsych({
  on_interaction_data_update: function(data) {
    const overlay = document.getElementById('paused-overlay');

    if (data.event === 'blur') {
      // User clicked away - pause experiment and show overlay
      jsPsych.pauseExperiment();
      if (overlay) {
        overlay.style.display = 'flex';
      }
    } else if (data.event === 'focus') {
      // User returned - resume experiment and hide overlay
      jsPsych.resumeExperiment();
      if (overlay) {
        overlay.style.display = 'none';
      }
    }
  }
});

// Make the overlay clickable to resume
document.addEventListener('DOMContentLoaded', function() {
  const overlay = document.getElementById('paused-overlay');
  if (overlay) {
    overlay.addEventListener('click', function() {
      // Focus the window and let the interaction handler resume
      window.focus();
    });
  }
});


// ============================================
// Language Check
// ============================================

let language_check = {
    type: jsPsychSurveyMultiChoice,
    questions: [
        {
            prompt: &quot;What is your first language? / Quelle est votre langue maternelle?&quot;,
            options: [&quot;English&quot;, &quot;Français&quot;],
            required: true,
            name: &quot;first_language&quot;
        }
    ],
    data: {
        phase: &quot;Language Check&quot;
    }
};

// ============================================
// French Version (Instructions + Task + Debrief)
// ============================================

let french_instructions = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `<div style=&quot;font-size: 20px;&quot;>
        <p>Bienvenue à l'expérience Stroop!</p>
        <p>Vous allez voir des mots de couleur affichés à l'écran.</p>
        <p>Appuyez sur la touche correspondant à la COULEUR du mot:</p>
        <ul style=&quot;list-style-type: none;&quot;>
            <li>R pour Rouge</li>
            <li>B pour Bleu</li>
            <li>V pour Vert</li>
            <li>J pour Jaune</li>
        </ul>
        <p>Appuyez sur n'importe quelle touche pour commencer.</p>
    </div>`,
    choices: &quot;ALL_KEYS&quot;
};

let french_stroop_task = {
    timeline: [
        {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: jsPsych.timelineVariable(&quot;stimulus&quot;),
            choices: [&quot;r&quot;, &quot;b&quot;, &quot;v&quot;, &quot;j&quot;],
            data: {
                correct_response: jsPsych.timelineVariable(&quot;correct_key&quot;)
            },
            on_finish: function(data) {
                data.correct = data.response === data.correct_response;
            }
        }
    ],
    timeline_variables: [
        {stimulus: `<p style=&quot;font-size:48px; color: red&quot;>ROUGE</p>`, correct_key: &quot;r&quot;},
        {stimulus: `<p style=&quot;font-size:48px; color: blue&quot;>BLEU</p>`, correct_key: &quot;b&quot;},
        {stimulus: `<p style=&quot;font-size:48px; color: green&quot;>VERT</p>`, correct_key: &quot;v&quot;},
        {stimulus: `<p style=&quot;font-size:48px; color: yellow&quot;>JAUNE</p>`, correct_key: &quot;j&quot;},
        {stimulus: `<p style=&quot;font-size:48px; color: blue&quot;>ROUGE</p>`, correct_key: &quot;b&quot;},
        {stimulus: `<p style=&quot;font-size:48px; color: red&quot;>BLEU</p>`, correct_key: &quot;r&quot;}
    ],
    randomize_order: true
};

let french_debrief = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `<div style=&quot;font-size: 20px;&quot;>
        <p>Merci d'avoir participé à notre expérience!</p>
        <p>Appuyez sur n'importe quelle touche pour terminer.</p>
    </div>`,
    choices: &quot;NO_KEYS&quot;
};

// Combine all French components into one timeline
let french_experiment = {
    timeline: [french_instructions, french_stroop_task, french_debrief],
    conditional_function: function() {
        let language_data = jsPsych.data.get().filter({phase: &quot;Language Check&quot;}).values()[0];
        let selected_language = language_data.response.first_language;
        return selected_language === &quot;Français&quot;;
    }
};

// ============================================
// English Version (Instructions + Task + Debrief)
// ============================================

let english_instructions = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `<div style=&quot;font-size: 20px;&quot;>
        <p>Welcome to the Stroop experiment!</p>
        <p>You will see color words displayed on the screen.</p>
        <p>Press the key corresponding to the COLOR of the word:</p>
        <ul style=&quot;list-style-type: none;&quot;>
            <li>R for Red</li>
            <li>B for Blue</li>
            <li>G for Green</li>
            <li>Y for Yellow</li>
        </ul>
        <p>Press any key to begin.</p>
    </div>`,
    choices: &quot;ALL_KEYS&quot;
};

let english_stroop_task = {
    timeline: [
        {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: jsPsych.timelineVariable(&quot;stimulus&quot;),
            choices: [&quot;r&quot;, &quot;b&quot;, &quot;g&quot;, &quot;y&quot;],
            data: {
                correct_response: jsPsych.timelineVariable(&quot;correct_key&quot;)
            },
            on_finish: function(data) {
                data.correct = data.response === data.correct_response;
            }
        }
    ],
    timeline_variables: [
        {stimulus: `<p style=&quot;font-size:48px; color: red&quot;>RED</p>`, correct_key: &quot;r&quot;},
        {stimulus: `<p style=&quot;font-size:48px; color: blue&quot;>BLUE</p>`, correct_key: &quot;b&quot;},
        {stimulus: `<p style=&quot;font-size:48px; color: green&quot;>GREEN</p>`, correct_key: &quot;g&quot;},
        {stimulus: `<p style=&quot;font-size:48px; color: yellow&quot;>YELLOW</p>`, correct_key: &quot;y&quot;},
        {stimulus: `<p style=&quot;font-size:48px; color: blue&quot;>RED</p>`, correct_key: &quot;b&quot;},
        {stimulus: `<p style=&quot;font-size:48px; color: red&quot;>BLUE</p>`, correct_key: &quot;r&quot;}
    ],
    randomize_order: true
};

let english_debrief = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `<div style=&quot;font-size: 20px;&quot;>
        <p>Thank you for participating in our experiment!</p>
        <p>Press any key to finish.</p>
    </div>`,
    choices: &quot;NO_KEYS&quot;
};

// Combine all English components into one timeline
let english_experiment = {
    timeline: [english_instructions, english_stroop_task, english_debrief],
    conditional_function: function() {
        let language_data = jsPsych.data.get().filter({phase: &quot;Language Check&quot;}).values()[0];
        let selected_language = language_data.response.first_language;
        return selected_language === &quot;English&quot;;
    }
};

// ============================================
// Experiment Timeline
// ============================================

jsPsych.run([
    language_check,
    french_experiment,   // Only runs if French selected
    english_experiment   // Only runs if English selected
]);
  </script>
</html>" width="100%" height="300px" scrolling="yes" style="border: none; display: block;" onload="javascript:(function(iframe){
        var container = document.getElementById(&quot;demo-container-5&quot;);
        var indicator = container.querySelector(&quot;.focus-indicator-5&quot;);

        function showFocus() {
          container.style.boxShadow = &quot;0 0 0 3px #007bff&quot;;
          if (indicator) {
            indicator.textContent = &quot;✓ Demo Active&quot;;
            indicator.style.color = &quot;#28a745&quot;;
          }
        }

        function hideFocus() {
          container.style.boxShadow = &quot;none&quot;;
          if (indicator) {
            indicator.textContent = &quot;Click inside the demo to activate&quot;;
            indicator.style.color = &quot;#6c757d&quot;;
          }
        }

        var iframeWindow = iframe.contentWindow;
        if (iframeWindow) {
          iframeWindow.onfocus = showFocus;
          iframeWindow.onblur = hideFocus;
          iframeWindow.document.addEventListener(&quot;click&quot;, function() {
            iframeWindow.focus();
            showFocus();
          });
          document.addEventListener(&quot;click&quot;, function(e) {
            if (!container.contains(e.target)) {
              iframeWindow.blur();
              hideFocus();
            }
          });
        }
      }(this));"></iframe>
</div>
</div>
</div>
</div>
<p>Notice what we’ve done here:</p>
<ol type="1">
<li>Created complete language versions: Each language now has its own instructions, task, and debrief</li>
<li>Nested timelines: We created french_experiment and english_experiment, each containing multiple components</li>
<li>Single conditional check: Instead of checking the language for each component separately, we check once at the experiment level</li>
<li>Cleaner structure: The main experiment timeline is now very simple - just the language check followed by two conditional experiment versions</li>
</ol>
<p>This demonstrates the power of nested timelines. The <code>conditional_function</code> on <code>french_experiment</code> controls whether the entire French version runs (instructions, task, and debrief). If it returns <code>false</code>, jsPsych skips all of those components and moves on to check the English version. The <code>conditional_function</code> on <code>english_experiment</code> controls whether the entire English version runs (instructions, task, and debrief). If it returns <code>false</code>, jsPsych skips all of those components and moves on. We could have added further languages, each with their own conditional function if we required more variants.</p>
<p>This pattern is much more maintainable than putting conditional functions on every single component. If you need to add a new section (like a practice block), you just add it to the appropriate language timeline, and it will automatically be included or excluded based on the participant’s language selection.</p>
</section>
<section id="example-time-restricted-experiment" class="level3" data-number="19.6.4">
<h3 data-number="19.6.4" class="anchored" data-anchor-id="example-time-restricted-experiment"><span class="header-section-number">19.6.4</span> Example: Time-Restricted Experiment</h3>
<p>Although up until now, we have been checking a previous response to determine whether something should be displayed, it’s important to remember that we can put whatever logic we want inside of the conditional function.</p>
<p>Here’s an example that will only display the experiment if the participant’s local time is between 5 PM and 10 PM:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">index.html</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">exp.js</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" role="tab" aria-controls="tabset-6-3" aria-selected="false">style.css</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-4" role="tab" aria-controls="tabset-6-4" aria-selected="false">Result</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="sourceCode" id="cb37"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb37-1"><a href="#cb37-1"></a> <span class="dt">&lt;!DOCTYPE</span> html<span class="dt">&gt;</span></span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb37-3"><a href="#cb37-3"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb37-4"><a href="#cb37-4"></a>    <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>Demo<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb37-5"><a href="#cb37-5"></a>    <span class="co">&lt;!-- jsPsych --&gt;</span></span>
<span id="cb37-6"><a href="#cb37-6"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/jspsych.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb37-7"><a href="#cb37-7"></a>    <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> href</span><span class="op">=</span><span class="st">"jspsych/jspsych.css"</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text/css"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb37-8"><a href="#cb37-8"></a>    </span>
<span id="cb37-9"><a href="#cb37-9"></a>    <span class="co">&lt;!-- jPsych plugins --&gt;</span></span>
<span id="cb37-10"><a href="#cb37-10"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/plugin-html-keyboard-response.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb37-11"><a href="#cb37-11"></a></span>
<span id="cb37-12"><a href="#cb37-12"></a>    <span class="co">&lt;!-- custom CSS --&gt;</span></span>
<span id="cb37-13"><a href="#cb37-13"></a>     <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> href</span><span class="op">=</span><span class="st">"style.css"</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text/css"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb37-14"><a href="#cb37-14"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb37-15"><a href="#cb37-15"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb37-16"><a href="#cb37-16"></a>  <span class="co">&lt;!-- custom JS --&gt;</span></span>
<span id="cb37-17"><a href="#cb37-17"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"exp.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb37-18"><a href="#cb37-18"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb37-19"><a href="#cb37-19"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb37-20"><a href="#cb37-20"></a> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="sourceCode" id="cb38"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb38-1"><a href="#cb38-1"></a> </span>
<span id="cb38-2"><a href="#cb38-2"></a><span class="kw">const</span> jsPsych <span class="op">=</span> <span class="fu">initJsPsych</span>()<span class="op">;</span></span>
<span id="cb38-3"><a href="#cb38-3"></a></span>
<span id="cb38-4"><a href="#cb38-4"></a> </span>
<span id="cb38-5"><a href="#cb38-5"></a><span class="kw">let</span> main_experiment <span class="op">=</span> {</span>
<span id="cb38-6"><a href="#cb38-6"></a>  <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb38-7"><a href="#cb38-7"></a>    <span class="co">// Your experiment trials here</span></span>
<span id="cb38-8"><a href="#cb38-8"></a>     {</span>
<span id="cb38-9"><a href="#cb38-9"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb38-10"><a href="#cb38-10"></a>      <span class="dt">stimulus</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb38-11"><a href="#cb38-11"></a>        <span class="kw">let</span> now <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">;</span></span>
<span id="cb38-12"><a href="#cb38-12"></a>        <span class="kw">let</span> current_time <span class="op">=</span> now<span class="op">.</span><span class="fu">toLocaleTimeString</span>()<span class="op">;</span></span>
<span id="cb38-13"><a href="#cb38-13"></a></span>
<span id="cb38-14"><a href="#cb38-14"></a>        <span class="cf">return</span> <span class="vs">`&lt;div style="font-size: 20px;"&gt;</span></span>
<span id="cb38-15"><a href="#cb38-15"></a><span class="vs">          &lt;p&gt;The current local time is </span><span class="sc">${</span>current_time<span class="sc">}</span><span class="vs">&lt;/p&gt;</span></span>
<span id="cb38-16"><a href="#cb38-16"></a><span class="vs">          &lt;p&gt;Welcome to the experiment!&lt;/p&gt;</span></span>
<span id="cb38-17"><a href="#cb38-17"></a><span class="vs">        &lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb38-18"><a href="#cb38-18"></a>      }<span class="op">,</span></span>
<span id="cb38-19"><a href="#cb38-19"></a>    <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span></span>
<span id="cb38-20"><a href="#cb38-20"></a>     }</span>
<span id="cb38-21"><a href="#cb38-21"></a>  ]<span class="op">,</span></span>
<span id="cb38-22"><a href="#cb38-22"></a>  <span class="dt">conditional_function</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb38-23"><a href="#cb38-23"></a>    <span class="co">// Get the current time</span></span>
<span id="cb38-24"><a href="#cb38-24"></a>    <span class="kw">let</span> now <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">;</span></span>
<span id="cb38-25"><a href="#cb38-25"></a>    <span class="kw">let</span> current_hour <span class="op">=</span> now<span class="op">.</span><span class="fu">getHours</span>()<span class="op">;</span>  <span class="co">// Returns 0-23</span></span>
<span id="cb38-26"><a href="#cb38-26"></a></span>
<span id="cb38-27"><a href="#cb38-27"></a>    <span class="co">// Check if it's between 5 PM (17) and 10 PM (20)</span></span>
<span id="cb38-28"><a href="#cb38-28"></a>    <span class="cf">if</span> (current_hour <span class="op">&gt;=</span> <span class="dv">17</span> <span class="op">&amp;&amp;</span> current_hour <span class="op">&lt;</span> <span class="dv">20</span>) {</span>
<span id="cb38-29"><a href="#cb38-29"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span>   <span class="co">// Show the experiment</span></span>
<span id="cb38-30"><a href="#cb38-30"></a>    } <span class="cf">else</span> {</span>
<span id="cb38-31"><a href="#cb38-31"></a>      <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span>  <span class="co">// Skip the experiment</span></span>
<span id="cb38-32"><a href="#cb38-32"></a>    }</span>
<span id="cb38-33"><a href="#cb38-33"></a>  }</span>
<span id="cb38-34"><a href="#cb38-34"></a>}<span class="op">;</span></span>
<span id="cb38-35"><a href="#cb38-35"></a></span>
<span id="cb38-36"><a href="#cb38-36"></a><span class="kw">let</span> time_restriction_message <span class="op">=</span> {</span>
<span id="cb38-37"><a href="#cb38-37"></a>  <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb38-38"><a href="#cb38-38"></a>    {</span>
<span id="cb38-39"><a href="#cb38-39"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb38-40"><a href="#cb38-40"></a>      <span class="dt">stimulus</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb38-41"><a href="#cb38-41"></a>        <span class="kw">let</span> now <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">;</span></span>
<span id="cb38-42"><a href="#cb38-42"></a>        <span class="kw">let</span> current_time <span class="op">=</span> now<span class="op">.</span><span class="fu">toLocaleTimeString</span>()<span class="op">;</span></span>
<span id="cb38-43"><a href="#cb38-43"></a></span>
<span id="cb38-44"><a href="#cb38-44"></a>        <span class="cf">return</span> <span class="vs">`&lt;div style="font-size: 20px;"&gt;</span></span>
<span id="cb38-45"><a href="#cb38-45"></a><span class="vs">          &lt;p&gt;The current local time is </span><span class="sc">${</span>current_time<span class="sc">}</span><span class="vs">.&lt;/p&gt;</span></span>
<span id="cb38-46"><a href="#cb38-46"></a><span class="vs">          &lt;p&gt;This experiment is only available between 5:00 PM and 10:00 PM.&lt;/p&gt;</span></span>
<span id="cb38-47"><a href="#cb38-47"></a><span class="vs">          &lt;p&gt;Please return during these hours to participate.&lt;/p&gt;</span></span>
<span id="cb38-48"><a href="#cb38-48"></a><span class="vs">        &lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb38-49"><a href="#cb38-49"></a>      }<span class="op">,</span></span>
<span id="cb38-50"><a href="#cb38-50"></a>      <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span></span>
<span id="cb38-51"><a href="#cb38-51"></a>    }</span>
<span id="cb38-52"><a href="#cb38-52"></a>  ]<span class="op">,</span></span>
<span id="cb38-53"><a href="#cb38-53"></a>  <span class="dt">conditional_function</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb38-54"><a href="#cb38-54"></a>    <span class="kw">let</span> now <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">;</span></span>
<span id="cb38-55"><a href="#cb38-55"></a>    <span class="kw">let</span> current_hour <span class="op">=</span> now<span class="op">.</span><span class="fu">getHours</span>()<span class="op">;</span></span>
<span id="cb38-56"><a href="#cb38-56"></a></span>
<span id="cb38-57"><a href="#cb38-57"></a>    <span class="co">// Show this message if it's NOT between 5 PM and 10 PM</span></span>
<span id="cb38-58"><a href="#cb38-58"></a>    <span class="cf">if</span> (current_hour <span class="op">&lt;</span> <span class="dv">17</span> <span class="op">||</span> current_hour <span class="op">&gt;=</span> <span class="dv">20</span>) {</span>
<span id="cb38-59"><a href="#cb38-59"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span>   <span class="co">// Show the restriction message</span></span>
<span id="cb38-60"><a href="#cb38-60"></a>    } <span class="cf">else</span> {</span>
<span id="cb38-61"><a href="#cb38-61"></a>      <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span>  <span class="co">// Skip the message</span></span>
<span id="cb38-62"><a href="#cb38-62"></a>    }</span>
<span id="cb38-63"><a href="#cb38-63"></a>  }</span>
<span id="cb38-64"><a href="#cb38-64"></a>}<span class="op">;</span></span>
<span id="cb38-65"><a href="#cb38-65"></a></span>
<span id="cb38-66"><a href="#cb38-66"></a>jsPsych<span class="op">.</span><span class="fu">run</span>([</span>
<span id="cb38-67"><a href="#cb38-67"></a>  main_experiment<span class="op">,</span>           <span class="co">// Only runs during allowed hours</span></span>
<span id="cb38-68"><a href="#cb38-68"></a>  time_restriction_message   <span class="co">// Only runs outside allowed hours</span></span>
<span id="cb38-69"><a href="#cb38-69"></a>])<span class="op">;</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-6-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-3-tab">
<div class="sourceCode" id="cb39"><pre class="sourceCode numberSource css number-lines code-with-copy"><code class="sourceCode css"><span id="cb39-1"><a href="#cb39-1"></a>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-6-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-4-tab">
<div id="demo-container-6" style="border: 1px solid #ddd; border-radius: 8px; overflow: hidden; transition: box-shadow 0.2s ease;">
<div style="background-color: #f8f9fa; padding: 8px 12px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center;">
<div>
<span style="font-weight: bold; color: #495057;">Live JsPsych Demo</span>
<span class="focus-indicator-6" style="margin-left: 10px; font-size: 11px; color: #6c757d; font-style: italic;">Click inside the demo to activate demo</span>
</div>
<div style="display: flex; gap: 8px;">
<button onclick="
            console.log('Full screen button clicked');
            var htmlContent = '<!DOCTYPE html>\n<html>\n  <head>\n    <title>Live JsPsych Demo</title>\n    <script src=\'https://unpkg.com/jspsych@8.2.2\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-preload@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-instructions@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-survey-text@2.1.0\'  crossorigin></script>\n        <script src=\'https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0\' crossorigin></script>\n\n    <link href=\'https://unpkg.com/jspsych@8.2.2/css/jspsych.css\' rel=\'stylesheet\' type=\'text/css\' crossorigin />\n\n\n    <style>\n      /* Paused overlay styles */\n      #paused-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-color: rgba(0, 0, 0, 0.7);\n        display: none;\n        justify-content: center;\n        align-items: center;\n        z-index: 9999;\n        font-family: Arial, sans-serif;\n      }\n\n      #paused-message {\n        background-color: white;\n        padding: 30px;\n        border-radius: 10px;\n        text-align: center;\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n        max-width: 300px;\n      }\n\n      #paused-message h2 {\n        margin-top: 0;\n        color: #dc3545;\n        font-size: 24px;\n      }\n\n      #paused-message p {\n        color: #666;\n        margin-bottom: 0;\n        font-size: 16px;\n      }\n\n      .pulse {\n        animation: pulse 2s infinite;\n      }\n\n      @keyframes pulse {\n        0% { opacity: 1; }\n        50% { opacity: 0.5; }\n        100% { opacity: 1; }\n      }\n    </style>\n  </head>\n  <body>\n    <!-- Paused overlay -->\n    <div id=\'paused-overlay\'>\n      <div id=\'paused-message\'>\n        <h2>Demo Paused</h2>\n        <p class=\'pulse\'>Click Anywhere to Resume</p>\n      </div>\n    </div>\n  </body>\n  <script>\n// Initialize jsPsych with interaction tracking and overlay control\nconst jsPsych = initJsPsych({\n  on_interaction_data_update: function(data) {\n    const overlay = document.getElementById(\'paused-overlay\');\n\n    if (data.event === \'blur\') {\n      // User clicked away - pause experiment and show overlay\n      jsPsych.pauseExperiment();\n      if (overlay) {\n        overlay.style.display = \'flex\';\n      }\n    } else if (data.event === \'focus\') {\n      // User returned - resume experiment and hide overlay\n      jsPsych.resumeExperiment();\n      if (overlay) {\n        overlay.style.display = \'none\';\n      }\n    }\n  }\n});\n\n// Make the overlay clickable to resume\ndocument.addEventListener(\'DOMContentLoaded\', function() {\n  const overlay = document.getElementById(\'paused-overlay\');\n  if (overlay) {\n    overlay.addEventListener(\'click\', function() {\n      // Focus the window and let the interaction handler resume\n      window.focus();\n    });\n  }\n});\n\n\nlet main_experiment = {\n  timeline: [\n    // Your experiment trials here\n     {\n      type: jsPsychHtmlKeyboardResponse,\n      stimulus: function() {\n        let now = new Date();\n        let current_time = now.toLocaleTimeString();\n\n        return `<div style=&quot;font-size: 20px;&quot;>\n          <p>The current local time is ${current_time}</p>\n          <p>Welcome to the experiment!</p>\n        </div>`;\n      },\n    choices: &quot;NO_KEYS&quot;\n     }\n  ],\n  conditional_function: function() {\n    // Get the current time\n    let now = new Date();\n    let current_hour = now.getHours();  // Returns 0-23\n\n    // Check if it\'s between 5 PM (17) and 10 PM (20)\n    if (current_hour >= 17 &amp;&amp; current_hour < 20) {\n      return true;   // Show the experiment\n    } else {\n      return false;  // Skip the experiment\n    }\n  }\n};\n\nlet time_restriction_message = {\n  timeline: [\n    {\n      type: jsPsychHtmlKeyboardResponse,\n      stimulus: function() {\n        let now = new Date();\n        let current_time = now.toLocaleTimeString();\n\n        return `<div style=&quot;font-size: 20px;&quot;>\n          <p>The current local time is ${current_time}.</p>\n          <p>This experiment is only available between 5:00 PM and 10:00 PM.</p>\n          <p>Please return during these hours to participate.</p>\n        </div>`;\n      },\n      choices: &quot;NO_KEYS&quot;\n    }\n  ],\n  conditional_function: function() {\n    let now = new Date();\n    let current_hour = now.getHours();\n\n    // Show this message if it\'s NOT between 5 PM and 10 PM\n    if (current_hour < 17 || current_hour >= 20) {\n      return true;   // Show the restriction message\n    } else {\n      return false;  // Skip the message\n    }\n  }\n};\n\njsPsych.run([\n  main_experiment,           // Only runs during allowed hours\n  time_restriction_message   // Only runs outside allowed hours\n]);\n  </script>\n</html>';
            var newWindow = window.open('', '_blank');
            if (newWindow) {
              newWindow.document.write(htmlContent);
              newWindow.document.close();
            } else {
              alert('Pop-up blocked! Please allow pop-ups for this site.');
            }
          " style="background-color: #28a745; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Open in New Tab</button>
<button onclick="
            var iframe = document.getElementById('demo-iframe-6');
            var srcdoc = iframe.getAttribute('srcdoc');
            iframe.setAttribute('srcdoc', '');
            setTimeout(function() {
              iframe.setAttribute('srcdoc', srcdoc);
            }, 10);
          " style="background-color: #007bff; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Refresh</button>
</div>
</div>
<iframe id="demo-iframe-6" srcdoc="<!DOCTYPE html>
<html>
  <head>
    <title>Live JsPsych Demo</title>
    <script src='https://unpkg.com/jspsych@8.2.2' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-preload@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-instructions@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-survey-text@2.1.0'  crossorigin></script>
        <script src='https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0' crossorigin></script>

    <link href='https://unpkg.com/jspsych@8.2.2/css/jspsych.css' rel='stylesheet' type='text/css' crossorigin />


    <style>
      /* Paused overlay styles */
      #paused-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        font-family: Arial, sans-serif;
      }

      #paused-message {
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        max-width: 300px;
      }

      #paused-message h2 {
        margin-top: 0;
        color: #dc3545;
        font-size: 24px;
      }

      #paused-message p {
        color: #666;
        margin-bottom: 0;
        font-size: 16px;
      }

      .pulse {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
      }
    </style>
  </head>
  <body style='max-height: 300px'>
    <!-- Paused overlay -->
    <div id='paused-overlay'>
      <div id='paused-message'>
        <h2>Demo Paused</h2>
        <p class='pulse'>Click Anywhere to Resume</p>
      </div>
    </div>
  </body>
  <script>
// Initialize jsPsych with interaction tracking and overlay control
const jsPsych = initJsPsych({
  on_interaction_data_update: function(data) {
    const overlay = document.getElementById('paused-overlay');

    if (data.event === 'blur') {
      // User clicked away - pause experiment and show overlay
      jsPsych.pauseExperiment();
      if (overlay) {
        overlay.style.display = 'flex';
      }
    } else if (data.event === 'focus') {
      // User returned - resume experiment and hide overlay
      jsPsych.resumeExperiment();
      if (overlay) {
        overlay.style.display = 'none';
      }
    }
  }
});

// Make the overlay clickable to resume
document.addEventListener('DOMContentLoaded', function() {
  const overlay = document.getElementById('paused-overlay');
  if (overlay) {
    overlay.addEventListener('click', function() {
      // Focus the window and let the interaction handler resume
      window.focus();
    });
  }
});


let main_experiment = {
  timeline: [
    // Your experiment trials here
     {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: function() {
        let now = new Date();
        let current_time = now.toLocaleTimeString();

        return `<div style=&quot;font-size: 20px;&quot;>
          <p>The current local time is ${current_time}</p>
          <p>Welcome to the experiment!</p>
        </div>`;
      },
    choices: &quot;NO_KEYS&quot;
     }
  ],
  conditional_function: function() {
    // Get the current time
    let now = new Date();
    let current_hour = now.getHours();  // Returns 0-23

    // Check if it's between 5 PM (17) and 10 PM (20)
    if (current_hour >= 17 &amp;&amp; current_hour < 20) {
      return true;   // Show the experiment
    } else {
      return false;  // Skip the experiment
    }
  }
};

let time_restriction_message = {
  timeline: [
    {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: function() {
        let now = new Date();
        let current_time = now.toLocaleTimeString();

        return `<div style=&quot;font-size: 20px;&quot;>
          <p>The current local time is ${current_time}.</p>
          <p>This experiment is only available between 5:00 PM and 10:00 PM.</p>
          <p>Please return during these hours to participate.</p>
        </div>`;
      },
      choices: &quot;NO_KEYS&quot;
    }
  ],
  conditional_function: function() {
    let now = new Date();
    let current_hour = now.getHours();

    // Show this message if it's NOT between 5 PM and 10 PM
    if (current_hour < 17 || current_hour >= 20) {
      return true;   // Show the restriction message
    } else {
      return false;  // Skip the message
    }
  }
};

jsPsych.run([
  main_experiment,           // Only runs during allowed hours
  time_restriction_message   // Only runs outside allowed hours
]);
  </script>
</html>" width="100%" height="300px" scrolling="yes" style="border: none; display: block;" onload="javascript:(function(iframe){
        var container = document.getElementById(&quot;demo-container-6&quot;);
        var indicator = container.querySelector(&quot;.focus-indicator-6&quot;);

        function showFocus() {
          container.style.boxShadow = &quot;0 0 0 3px #007bff&quot;;
          if (indicator) {
            indicator.textContent = &quot;✓ Demo Active&quot;;
            indicator.style.color = &quot;#28a745&quot;;
          }
        }

        function hideFocus() {
          container.style.boxShadow = &quot;none&quot;;
          if (indicator) {
            indicator.textContent = &quot;Click inside the demo to activate&quot;;
            indicator.style.color = &quot;#6c757d&quot;;
          }
        }

        var iframeWindow = iframe.contentWindow;
        if (iframeWindow) {
          iframeWindow.onfocus = showFocus;
          iframeWindow.onblur = hideFocus;
          iframeWindow.document.addEventListener(&quot;click&quot;, function() {
            iframeWindow.focus();
            showFocus();
          });
          document.addEventListener(&quot;click&quot;, function(e) {
            if (!container.contains(e.target)) {
              iframeWindow.blur();
              hideFocus();
            }
          });
        }
      }(this));"></iframe>
</div>
</div>
</div>
</div>
</section>
<section id="example-random-assignment-to-conditions" class="level3" data-number="19.6.5">
<h3 data-number="19.6.5" class="anchored" data-anchor-id="example-random-assignment-to-conditions"><span class="header-section-number">19.6.5</span> Example: Random Assignment to Conditions</h3>
<p>Sometimes you want to randomly assign participants to different experimental conditions. We’ll dive deeper into randomization later, and discuss why this probably isn’t the best way to randomize your conditions.</p>
<p>However, as a demonstration of conditional functions, here’s an example that randomly shows one of two different instruction sets determine be randomly selecting a number between 0 and 1.</p>
<p>Click the ‘refresh’ button to see it randomly switch between instruction prompts.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">index.html</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">exp.js</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-3" role="tab" aria-controls="tabset-7-3" aria-selected="false">style.css</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-4" role="tab" aria-controls="tabset-7-4" aria-selected="false">Result</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="sourceCode" id="cb40"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb40-1"><a href="#cb40-1"></a> <span class="dt">&lt;!DOCTYPE</span> html<span class="dt">&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb40-3"><a href="#cb40-3"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb40-4"><a href="#cb40-4"></a>    <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>Demo<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb40-5"><a href="#cb40-5"></a>    <span class="co">&lt;!-- jsPsych --&gt;</span></span>
<span id="cb40-6"><a href="#cb40-6"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/jspsych.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb40-7"><a href="#cb40-7"></a>    <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> href</span><span class="op">=</span><span class="st">"jspsych/jspsych.css"</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text/css"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb40-8"><a href="#cb40-8"></a>    </span>
<span id="cb40-9"><a href="#cb40-9"></a>    <span class="co">&lt;!-- jPsych plugins --&gt;</span></span>
<span id="cb40-10"><a href="#cb40-10"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/plugin-html-keyboard-response.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb40-11"><a href="#cb40-11"></a></span>
<span id="cb40-12"><a href="#cb40-12"></a>    <span class="co">&lt;!-- custom CSS --&gt;</span></span>
<span id="cb40-13"><a href="#cb40-13"></a>     <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> href</span><span class="op">=</span><span class="st">"style.css"</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text/css"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb40-14"><a href="#cb40-14"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb40-15"><a href="#cb40-15"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb40-16"><a href="#cb40-16"></a>  <span class="co">&lt;!-- custom JS --&gt;</span></span>
<span id="cb40-17"><a href="#cb40-17"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"exp.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb40-18"><a href="#cb40-18"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb40-19"><a href="#cb40-19"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb40-20"><a href="#cb40-20"></a> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="sourceCode" id="cb41"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb41-1"><a href="#cb41-1"></a> </span>
<span id="cb41-2"><a href="#cb41-2"></a><span class="kw">const</span> jsPsych <span class="op">=</span> <span class="fu">initJsPsych</span>()<span class="op">;</span></span>
<span id="cb41-3"><a href="#cb41-3"></a></span>
<span id="cb41-4"><a href="#cb41-4"></a> </span>
<span id="cb41-5"><a href="#cb41-5"></a><span class="co">// Generate random assignment once at the start</span></span>
<span id="cb41-6"><a href="#cb41-6"></a><span class="kw">let</span> condition <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>() <span class="op">&lt;=</span> <span class="fl">0.5</span> <span class="op">?</span> <span class="st">"standard"</span> <span class="op">:</span> <span class="st">"detailed"</span><span class="op">;</span></span>
<span id="cb41-7"><a href="#cb41-7"></a></span>
<span id="cb41-8"><a href="#cb41-8"></a><span class="kw">let</span> standard_instructions <span class="op">=</span> {</span>
<span id="cb41-9"><a href="#cb41-9"></a>  <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb41-10"><a href="#cb41-10"></a>    {</span>
<span id="cb41-11"><a href="#cb41-11"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb41-12"><a href="#cb41-12"></a>      <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;div style="font-size: 20px;"&gt;</span></span>
<span id="cb41-13"><a href="#cb41-13"></a><span class="vs">        &lt;p&gt;In this task, respond as quickly as possible.&lt;/p&gt;</span></span>
<span id="cb41-14"><a href="#cb41-14"></a><span class="vs">        &lt;p&gt;Press any key to begin.&lt;/p&gt;</span></span>
<span id="cb41-15"><a href="#cb41-15"></a><span class="vs">      &lt;/div&gt;`</span><span class="op">,</span></span>
<span id="cb41-16"><a href="#cb41-16"></a>      <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb41-17"><a href="#cb41-17"></a>        <span class="dt">instruction_condition</span><span class="op">:</span> <span class="st">"standard"</span></span>
<span id="cb41-18"><a href="#cb41-18"></a>      }</span>
<span id="cb41-19"><a href="#cb41-19"></a>    }</span>
<span id="cb41-20"><a href="#cb41-20"></a>  ]<span class="op">,</span></span>
<span id="cb41-21"><a href="#cb41-21"></a>  <span class="dt">conditional_function</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb41-22"><a href="#cb41-22"></a>    <span class="cf">return</span> condition <span class="op">===</span> <span class="st">"standard"</span><span class="op">;</span></span>
<span id="cb41-23"><a href="#cb41-23"></a>  }</span>
<span id="cb41-24"><a href="#cb41-24"></a>}<span class="op">;</span></span>
<span id="cb41-25"><a href="#cb41-25"></a></span>
<span id="cb41-26"><a href="#cb41-26"></a><span class="kw">let</span> detailed_instructions <span class="op">=</span> {</span>
<span id="cb41-27"><a href="#cb41-27"></a>  <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb41-28"><a href="#cb41-28"></a>    {</span>
<span id="cb41-29"><a href="#cb41-29"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb41-30"><a href="#cb41-30"></a>      <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;div style="font-size: 20px;"&gt;</span></span>
<span id="cb41-31"><a href="#cb41-31"></a><span class="vs">        &lt;p&gt;In this task, respond as quickly as possible.&lt;/p&gt;</span></span>
<span id="cb41-32"><a href="#cb41-32"></a><span class="vs">        &lt;p&gt;Speed is more important than accuracy.&lt;/p&gt;</span></span>
<span id="cb41-33"><a href="#cb41-33"></a><span class="vs">        &lt;p&gt;Don't worry if you make mistakes.&lt;/p&gt;</span></span>
<span id="cb41-34"><a href="#cb41-34"></a><span class="vs">        &lt;p&gt;Press any key to begin.&lt;/p&gt;</span></span>
<span id="cb41-35"><a href="#cb41-35"></a><span class="vs">      &lt;/div&gt;`</span><span class="op">,</span></span>
<span id="cb41-36"><a href="#cb41-36"></a>      <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb41-37"><a href="#cb41-37"></a>        <span class="dt">instruction_condition</span><span class="op">:</span> <span class="st">"detailed"</span></span>
<span id="cb41-38"><a href="#cb41-38"></a>      }</span>
<span id="cb41-39"><a href="#cb41-39"></a>    }</span>
<span id="cb41-40"><a href="#cb41-40"></a>  ]<span class="op">,</span></span>
<span id="cb41-41"><a href="#cb41-41"></a>  <span class="dt">conditional_function</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb41-42"><a href="#cb41-42"></a>    <span class="cf">return</span> condition <span class="op">===</span> <span class="st">"detailed"</span><span class="op">;</span></span>
<span id="cb41-43"><a href="#cb41-43"></a>  }</span>
<span id="cb41-44"><a href="#cb41-44"></a>}<span class="op">;</span></span>
<span id="cb41-45"><a href="#cb41-45"></a></span>
<span id="cb41-46"><a href="#cb41-46"></a>jsPsych<span class="op">.</span><span class="fu">run</span>([</span>
<span id="cb41-47"><a href="#cb41-47"></a>  standard_instructions<span class="op">,</span>  <span class="co">// Shows if condition === "standard"</span></span>
<span id="cb41-48"><a href="#cb41-48"></a>  detailed_instructions   <span class="co">// Shows if condition === "detailed"</span></span>
<span id="cb41-49"><a href="#cb41-49"></a>])<span class="op">;</span></span>
<span id="cb41-50"><a href="#cb41-50"></a> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-7-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-3-tab">
<div class="sourceCode" id="cb42"><pre class="sourceCode numberSource css number-lines code-with-copy"><code class="sourceCode css"><span id="cb42-1"><a href="#cb42-1"></a>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-7-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-4-tab">
<div id="demo-container-7" style="border: 1px solid #ddd; border-radius: 8px; overflow: hidden; transition: box-shadow 0.2s ease;">
<div style="background-color: #f8f9fa; padding: 8px 12px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center;">
<div>
<span style="font-weight: bold; color: #495057;">Live JsPsych Demo</span>
<span class="focus-indicator-7" style="margin-left: 10px; font-size: 11px; color: #6c757d; font-style: italic;">Click inside the demo to activate demo</span>
</div>
<div style="display: flex; gap: 8px;">
<button onclick="
            console.log('Full screen button clicked');
            var htmlContent = '<!DOCTYPE html>\n<html>\n  <head>\n    <title>Live JsPsych Demo</title>\n    <script src=\'https://unpkg.com/jspsych@8.2.2\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-preload@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-instructions@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-survey-text@2.1.0\'  crossorigin></script>\n        <script src=\'https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0\' crossorigin></script>\n\n    <link href=\'https://unpkg.com/jspsych@8.2.2/css/jspsych.css\' rel=\'stylesheet\' type=\'text/css\' crossorigin />\n\n\n    <style>\n      /* Paused overlay styles */\n      #paused-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-color: rgba(0, 0, 0, 0.7);\n        display: none;\n        justify-content: center;\n        align-items: center;\n        z-index: 9999;\n        font-family: Arial, sans-serif;\n      }\n\n      #paused-message {\n        background-color: white;\n        padding: 30px;\n        border-radius: 10px;\n        text-align: center;\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n        max-width: 300px;\n      }\n\n      #paused-message h2 {\n        margin-top: 0;\n        color: #dc3545;\n        font-size: 24px;\n      }\n\n      #paused-message p {\n        color: #666;\n        margin-bottom: 0;\n        font-size: 16px;\n      }\n\n      .pulse {\n        animation: pulse 2s infinite;\n      }\n\n      @keyframes pulse {\n        0% { opacity: 1; }\n        50% { opacity: 0.5; }\n        100% { opacity: 1; }\n      }\n    </style>\n  </head>\n  <body>\n    <!-- Paused overlay -->\n    <div id=\'paused-overlay\'>\n      <div id=\'paused-message\'>\n        <h2>Demo Paused</h2>\n        <p class=\'pulse\'>Click Anywhere to Resume</p>\n      </div>\n    </div>\n  </body>\n  <script>\n// Initialize jsPsych with interaction tracking and overlay control\nconst jsPsych = initJsPsych({\n  on_interaction_data_update: function(data) {\n    const overlay = document.getElementById(\'paused-overlay\');\n\n    if (data.event === \'blur\') {\n      // User clicked away - pause experiment and show overlay\n      jsPsych.pauseExperiment();\n      if (overlay) {\n        overlay.style.display = \'flex\';\n      }\n    } else if (data.event === \'focus\') {\n      // User returned - resume experiment and hide overlay\n      jsPsych.resumeExperiment();\n      if (overlay) {\n        overlay.style.display = \'none\';\n      }\n    }\n  }\n});\n\n// Make the overlay clickable to resume\ndocument.addEventListener(\'DOMContentLoaded\', function() {\n  const overlay = document.getElementById(\'paused-overlay\');\n  if (overlay) {\n    overlay.addEventListener(\'click\', function() {\n      // Focus the window and let the interaction handler resume\n      window.focus();\n    });\n  }\n});\n\n\n// Generate random assignment once at the start\nlet condition = Math.random() <= 0.5 ? &quot;standard&quot; : &quot;detailed&quot;;\n\nlet standard_instructions = {\n  timeline: [\n    {\n      type: jsPsychHtmlKeyboardResponse,\n      stimulus: `<div style=&quot;font-size: 20px;&quot;>\n        <p>In this task, respond as quickly as possible.</p>\n        <p>Press any key to begin.</p>\n      </div>`,\n      data: {\n        instruction_condition: &quot;standard&quot;\n      }\n    }\n  ],\n  conditional_function: function() {\n    return condition === &quot;standard&quot;;\n  }\n};\n\nlet detailed_instructions = {\n  timeline: [\n    {\n      type: jsPsychHtmlKeyboardResponse,\n      stimulus: `<div style=&quot;font-size: 20px;&quot;>\n        <p>In this task, respond as quickly as possible.</p>\n        <p>Speed is more important than accuracy.</p>\n        <p>Don\'t worry if you make mistakes.</p>\n        <p>Press any key to begin.</p>\n      </div>`,\n      data: {\n        instruction_condition: &quot;detailed&quot;\n      }\n    }\n  ],\n  conditional_function: function() {\n    return condition === &quot;detailed&quot;;\n  }\n};\n\njsPsych.run([\n  standard_instructions,  // Shows if condition === &quot;standard&quot;\n  detailed_instructions   // Shows if condition === &quot;detailed&quot;\n]);\n\n  </script>\n</html>';
            var newWindow = window.open('', '_blank');
            if (newWindow) {
              newWindow.document.write(htmlContent);
              newWindow.document.close();
            } else {
              alert('Pop-up blocked! Please allow pop-ups for this site.');
            }
          " style="background-color: #28a745; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Open in New Tab</button>
<button onclick="
            var iframe = document.getElementById('demo-iframe-7');
            var srcdoc = iframe.getAttribute('srcdoc');
            iframe.setAttribute('srcdoc', '');
            setTimeout(function() {
              iframe.setAttribute('srcdoc', srcdoc);
            }, 10);
          " style="background-color: #007bff; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Refresh</button>
</div>
</div>
<iframe id="demo-iframe-7" srcdoc="<!DOCTYPE html>
<html>
  <head>
    <title>Live JsPsych Demo</title>
    <script src='https://unpkg.com/jspsych@8.2.2' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-preload@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-instructions@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-survey-text@2.1.0'  crossorigin></script>
        <script src='https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0' crossorigin></script>

    <link href='https://unpkg.com/jspsych@8.2.2/css/jspsych.css' rel='stylesheet' type='text/css' crossorigin />


    <style>
      /* Paused overlay styles */
      #paused-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        font-family: Arial, sans-serif;
      }

      #paused-message {
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        max-width: 300px;
      }

      #paused-message h2 {
        margin-top: 0;
        color: #dc3545;
        font-size: 24px;
      }

      #paused-message p {
        color: #666;
        margin-bottom: 0;
        font-size: 16px;
      }

      .pulse {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
      }
    </style>
  </head>
  <body style='max-height: 300px'>
    <!-- Paused overlay -->
    <div id='paused-overlay'>
      <div id='paused-message'>
        <h2>Demo Paused</h2>
        <p class='pulse'>Click Anywhere to Resume</p>
      </div>
    </div>
  </body>
  <script>
// Initialize jsPsych with interaction tracking and overlay control
const jsPsych = initJsPsych({
  on_interaction_data_update: function(data) {
    const overlay = document.getElementById('paused-overlay');

    if (data.event === 'blur') {
      // User clicked away - pause experiment and show overlay
      jsPsych.pauseExperiment();
      if (overlay) {
        overlay.style.display = 'flex';
      }
    } else if (data.event === 'focus') {
      // User returned - resume experiment and hide overlay
      jsPsych.resumeExperiment();
      if (overlay) {
        overlay.style.display = 'none';
      }
    }
  }
});

// Make the overlay clickable to resume
document.addEventListener('DOMContentLoaded', function() {
  const overlay = document.getElementById('paused-overlay');
  if (overlay) {
    overlay.addEventListener('click', function() {
      // Focus the window and let the interaction handler resume
      window.focus();
    });
  }
});


// Generate random assignment once at the start
let condition = Math.random() <= 0.5 ? &quot;standard&quot; : &quot;detailed&quot;;

let standard_instructions = {
  timeline: [
    {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `<div style=&quot;font-size: 20px;&quot;>
        <p>In this task, respond as quickly as possible.</p>
        <p>Press any key to begin.</p>
      </div>`,
      data: {
        instruction_condition: &quot;standard&quot;
      }
    }
  ],
  conditional_function: function() {
    return condition === &quot;standard&quot;;
  }
};

let detailed_instructions = {
  timeline: [
    {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `<div style=&quot;font-size: 20px;&quot;>
        <p>In this task, respond as quickly as possible.</p>
        <p>Speed is more important than accuracy.</p>
        <p>Don't worry if you make mistakes.</p>
        <p>Press any key to begin.</p>
      </div>`,
      data: {
        instruction_condition: &quot;detailed&quot;
      }
    }
  ],
  conditional_function: function() {
    return condition === &quot;detailed&quot;;
  }
};

jsPsych.run([
  standard_instructions,  // Shows if condition === &quot;standard&quot;
  detailed_instructions   // Shows if condition === &quot;detailed&quot;
]);

  </script>
</html>" width="100%" height="300px" scrolling="yes" style="border: none; display: block;" onload="javascript:(function(iframe){
        var container = document.getElementById(&quot;demo-container-7&quot;);
        var indicator = container.querySelector(&quot;.focus-indicator-7&quot;);

        function showFocus() {
          container.style.boxShadow = &quot;0 0 0 3px #007bff&quot;;
          if (indicator) {
            indicator.textContent = &quot;✓ Demo Active&quot;;
            indicator.style.color = &quot;#28a745&quot;;
          }
        }

        function hideFocus() {
          container.style.boxShadow = &quot;none&quot;;
          if (indicator) {
            indicator.textContent = &quot;Click inside the demo to activate&quot;;
            indicator.style.color = &quot;#6c757d&quot;;
          }
        }

        var iframeWindow = iframe.contentWindow;
        if (iframeWindow) {
          iframeWindow.onfocus = showFocus;
          iframeWindow.onblur = hideFocus;
          iframeWindow.document.addEventListener(&quot;click&quot;, function() {
            iframeWindow.focus();
            showFocus();
          });
          document.addEventListener(&quot;click&quot;, function(e) {
            if (!container.contains(e.target)) {
              iframeWindow.blur();
              hideFocus();
            }
          });
        }
      }(this));"></iframe>
</div>
</div>
</div>
</div>
<p>In this example, we generate a random number between 0 and 1, and if it’s less than 0.5 than we store “standard” in the <code>condition</code> variable. If it is greater than 0.5, then we store “detailed” in the <code>condition</code> variable.</p>
<p>Later, inside the conditional function, we check what condition is to determine which should be displayed.</p>
</section>
</section>
<section id="looping-timelines" class="level2" data-number="19.7">
<h2 data-number="19.7" class="anchored" data-anchor-id="looping-timelines"><span class="header-section-number">19.7</span> Looping Timelines</h2>
<p>A <code>loop_function</code> is similar to a <code>conditional_function</code>, but it’s evaluated after a timeline completes, not before. It receives the data from all the trials that just ran, and returns either <code>true</code> (run the timeline again) or <code>false</code> (move on to the next thing).</p>
<p>Just like <code>conditional_function</code>, the <code>loop_function</code> must be placed on a timeline object, not directly on a trial object. The function should return true to repeat the timeline, or false to move on.</p>
<p>Here’s the basic structure for loop functions:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb43-1"><a href="#cb43-1"></a><span class="kw">let</span> some_timeline <span class="op">=</span> {</span>
<span id="cb43-2"><a href="#cb43-2"></a>  <span class="dt">timeline</span><span class="op">:</span> [<span class="co">/* your trials here */</span>]<span class="op">,</span></span>
<span id="cb43-3"><a href="#cb43-3"></a>  <span class="dt">loop_function</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb43-4"><a href="#cb43-4"></a>    <span class="co">// Your logic here</span></span>
<span id="cb43-5"><a href="#cb43-5"></a>    <span class="co">// Return true to repeat this timeline</span></span>
<span id="cb43-6"><a href="#cb43-6"></a>    <span class="co">// Return false to move on</span></span>
<span id="cb43-7"><a href="#cb43-7"></a>  }</span>
<span id="cb43-8"><a href="#cb43-8"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Remember: loop functions control timelines, not individual trials. Even if your timeline only contains one trial, you still need that timeline wrapper.</p>
<section id="example-audio-check" class="level3" data-number="19.7.1">
<h3 data-number="19.7.1" class="anchored" data-anchor-id="example-audio-check"><span class="header-section-number">19.7.1</span> Example: Audio Check</h3>
<p>In online studies, we can’t verify that participants have their audio working. Here’s an audio check that loops until they correctly identify a spoken word:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">index.html</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">exp.js</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-3" role="tab" aria-controls="tabset-8-3" aria-selected="false">style.css</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-4" role="tab" aria-controls="tabset-8-4" aria-selected="false">Result</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="sourceCode" id="cb44"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb44-1"><a href="#cb44-1"></a> <span class="dt">&lt;!DOCTYPE</span> html<span class="dt">&gt;</span></span>
<span id="cb44-2"><a href="#cb44-2"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb44-4"><a href="#cb44-4"></a>    <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>Demo<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb44-5"><a href="#cb44-5"></a>    <span class="co">&lt;!-- jsPsych --&gt;</span></span>
<span id="cb44-6"><a href="#cb44-6"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/jspsych.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb44-7"><a href="#cb44-7"></a>    <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> href</span><span class="op">=</span><span class="st">"jspsych/jspsych.css"</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text/css"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb44-8"><a href="#cb44-8"></a>    </span>
<span id="cb44-9"><a href="#cb44-9"></a>    <span class="co">&lt;!-- jPsych plugins --&gt;</span></span>
<span id="cb44-10"><a href="#cb44-10"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/plugin-html-keyboard-response.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb44-11"><a href="#cb44-11"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/plugin-audio-keyboard-response.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb44-12"><a href="#cb44-12"></a></span>
<span id="cb44-13"><a href="#cb44-13"></a>    <span class="co">&lt;!-- custom CSS --&gt;</span></span>
<span id="cb44-14"><a href="#cb44-14"></a>     <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> href</span><span class="op">=</span><span class="st">"style.css"</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text/css"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb44-15"><a href="#cb44-15"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb44-16"><a href="#cb44-16"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb44-17"><a href="#cb44-17"></a>  <span class="co">&lt;!-- custom JS --&gt;</span></span>
<span id="cb44-18"><a href="#cb44-18"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"exp.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb44-19"><a href="#cb44-19"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb44-20"><a href="#cb44-20"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb44-21"><a href="#cb44-21"></a> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="sourceCode" id="cb45"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb45-1"><a href="#cb45-1"></a> </span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="kw">const</span> jsPsych <span class="op">=</span> <span class="fu">initJsPsych</span>()<span class="op">;</span></span>
<span id="cb45-3"><a href="#cb45-3"></a></span>
<span id="cb45-4"><a href="#cb45-4"></a> </span>
<span id="cb45-5"><a href="#cb45-5"></a><span class="kw">let</span> welcome <span class="op">=</span> {</span>
<span id="cb45-6"><a href="#cb45-6"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb45-7"><a href="#cb45-7"></a>      <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;Press any key to begin the sound check.&lt;/p&gt;`</span><span class="op">,</span></span>
<span id="cb45-8"><a href="#cb45-8"></a>      <span class="dt">choices</span><span class="op">:</span> <span class="st">"ALL_KEYS"</span></span>
<span id="cb45-9"><a href="#cb45-9"></a>}</span>
<span id="cb45-10"><a href="#cb45-10"></a></span>
<span id="cb45-11"><a href="#cb45-11"></a><span class="kw">let</span> audio_check <span class="op">=</span> {</span>
<span id="cb45-12"><a href="#cb45-12"></a>  <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb45-13"><a href="#cb45-13"></a>    {</span>
<span id="cb45-14"><a href="#cb45-14"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychAudioKeyboardResponse<span class="op">,</span></span>
<span id="cb45-15"><a href="#cb45-15"></a>      <span class="dt">stimulus</span><span class="op">:</span> <span class="st">"media/APPLE.mp3"</span><span class="op">,</span></span>
<span id="cb45-16"><a href="#cb45-16"></a>      <span class="dt">prompt</span><span class="op">:</span> <span class="vs">`&lt;p&gt;Please listen to the word&lt;/p&gt;`</span><span class="op">,</span></span>
<span id="cb45-17"><a href="#cb45-17"></a>      <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span><span class="op">,</span></span>
<span id="cb45-18"><a href="#cb45-18"></a>      <span class="dt">trial_duration</span><span class="op">:</span> <span class="dv">2000</span><span class="op">,</span></span>
<span id="cb45-19"><a href="#cb45-19"></a>      <span class="dt">trial_ends_after_audio</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb45-20"><a href="#cb45-20"></a>    }<span class="op">,</span></span>
<span id="cb45-21"><a href="#cb45-21"></a>    {</span>
<span id="cb45-22"><a href="#cb45-22"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychSurveyMultiChoice<span class="op">,</span></span>
<span id="cb45-23"><a href="#cb45-23"></a>      <span class="dt">questions</span><span class="op">:</span> [</span>
<span id="cb45-24"><a href="#cb45-24"></a>        {</span>
<span id="cb45-25"><a href="#cb45-25"></a>          <span class="dt">prompt</span><span class="op">:</span> <span class="st">"Which word did you hear?"</span><span class="op">,</span></span>
<span id="cb45-26"><a href="#cb45-26"></a>          <span class="dt">options</span><span class="op">:</span> [</span>
<span id="cb45-27"><a href="#cb45-27"></a>            <span class="st">"Table"</span><span class="op">,</span> <span class="st">"Apple"</span><span class="op">,</span> <span class="st">"Chair"</span><span class="op">,</span> <span class="st">"Window"</span><span class="op">,</span> <span class="st">"Bottle"</span><span class="op">,</span></span>
<span id="cb45-28"><a href="#cb45-28"></a>            <span class="st">"Paper"</span><span class="op">,</span> <span class="st">"Garden"</span><span class="op">,</span> <span class="st">"Candle"</span><span class="op">,</span> <span class="st">"Marble"</span><span class="op">,</span> <span class="st">"Tiger"</span></span>
<span id="cb45-29"><a href="#cb45-29"></a>          ]<span class="op">,</span></span>
<span id="cb45-30"><a href="#cb45-30"></a>          <span class="dt">required</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb45-31"><a href="#cb45-31"></a>          <span class="dt">name</span><span class="op">:</span> <span class="st">"heard_word"</span></span>
<span id="cb45-32"><a href="#cb45-32"></a>        }</span>
<span id="cb45-33"><a href="#cb45-33"></a>      ]<span class="op">,</span></span>
<span id="cb45-34"><a href="#cb45-34"></a>      <span class="dt">on_finish</span><span class="op">:</span> <span class="kw">function</span>(data) {</span>
<span id="cb45-35"><a href="#cb45-35"></a>        data<span class="op">.</span><span class="at">correct</span> <span class="op">=</span> data<span class="op">.</span><span class="at">response</span><span class="op">.</span><span class="at">heard_word</span> <span class="op">===</span> <span class="st">"Apple"</span><span class="op">;</span></span>
<span id="cb45-36"><a href="#cb45-36"></a>      }</span>
<span id="cb45-37"><a href="#cb45-37"></a>    }<span class="op">,</span></span>
<span id="cb45-38"><a href="#cb45-38"></a>    {</span>
<span id="cb45-39"><a href="#cb45-39"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb45-40"><a href="#cb45-40"></a>      <span class="dt">stimulus</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb45-41"><a href="#cb45-41"></a>        <span class="kw">let</span> last_trial <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">last</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">values</span>()[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb45-42"><a href="#cb45-42"></a>        <span class="cf">if</span> (last_trial<span class="op">.</span><span class="at">correct</span>) {</span>
<span id="cb45-43"><a href="#cb45-43"></a>          <span class="cf">return</span> <span class="vs">`&lt;p style="color: green;"&gt;Correct! Your audio is working.&lt;/p&gt;</span></span>
<span id="cb45-44"><a href="#cb45-44"></a><span class="vs">                  &lt;p&gt;Press any key to continue.&lt;/p&gt;`</span><span class="op">;</span></span>
<span id="cb45-45"><a href="#cb45-45"></a>        } <span class="cf">else</span> {</span>
<span id="cb45-46"><a href="#cb45-46"></a>          <span class="cf">return</span> <span class="vs">`&lt;p style="color: red;"&gt;That's not correct.&lt;/p&gt;</span></span>
<span id="cb45-47"><a href="#cb45-47"></a><span class="vs">                  &lt;p&gt;Please check your audio settings and try again.&lt;/p&gt;</span></span>
<span id="cb45-48"><a href="#cb45-48"></a><span class="vs">                  &lt;p&gt;Press any key to retry.&lt;/p&gt;`</span><span class="op">;</span></span>
<span id="cb45-49"><a href="#cb45-49"></a>        }</span>
<span id="cb45-50"><a href="#cb45-50"></a>      }</span>
<span id="cb45-51"><a href="#cb45-51"></a>    }</span>
<span id="cb45-52"><a href="#cb45-52"></a>  ]<span class="op">,</span></span>
<span id="cb45-53"><a href="#cb45-53"></a>  <span class="dt">loop_function</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb45-54"><a href="#cb45-54"></a>    <span class="co">// Get the response from the multiple choice question</span></span>
<span id="cb45-55"><a href="#cb45-55"></a>    <span class="kw">let</span> last_response <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">last</span>(<span class="dv">2</span>)<span class="op">.</span><span class="fu">values</span>()[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb45-56"><a href="#cb45-56"></a></span>
<span id="cb45-57"><a href="#cb45-57"></a>    <span class="co">// Loop if they got it wrong</span></span>
<span id="cb45-58"><a href="#cb45-58"></a>    <span class="cf">if</span> (last_response<span class="op">.</span><span class="at">correct</span>) {</span>
<span id="cb45-59"><a href="#cb45-59"></a>      <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span>  <span class="co">// Correct, move on</span></span>
<span id="cb45-60"><a href="#cb45-60"></a>    } <span class="cf">else</span> {</span>
<span id="cb45-61"><a href="#cb45-61"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span>   <span class="co">// Incorrect, loop back</span></span>
<span id="cb45-62"><a href="#cb45-62"></a>    }</span>
<span id="cb45-63"><a href="#cb45-63"></a>  }</span>
<span id="cb45-64"><a href="#cb45-64"></a>}<span class="op">;</span></span>
<span id="cb45-65"><a href="#cb45-65"></a></span>
<span id="cb45-66"><a href="#cb45-66"></a>jsPsych<span class="op">.</span><span class="fu">run</span>([</span>
<span id="cb45-67"><a href="#cb45-67"></a>  welcome<span class="op">,</span></span>
<span id="cb45-68"><a href="#cb45-68"></a>  audio_check</span>
<span id="cb45-69"><a href="#cb45-69"></a>])</span>
<span id="cb45-70"><a href="#cb45-70"></a> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-8-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-3-tab">
<div class="sourceCode" id="cb46"><pre class="sourceCode numberSource css number-lines code-with-copy"><code class="sourceCode css"><span id="cb46-1"><a href="#cb46-1"></a>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-8-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-4-tab">
<div id="demo-container-8" style="border: 1px solid #ddd; border-radius: 8px; overflow: hidden; transition: box-shadow 0.2s ease;">
<div style="background-color: #f8f9fa; padding: 8px 12px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center;">
<div>
<span style="font-weight: bold; color: #495057;">Live JsPsych Demo</span>
<span class="focus-indicator-8" style="margin-left: 10px; font-size: 11px; color: #6c757d; font-style: italic;">Click inside the demo to activate demo</span>
</div>
<div style="display: flex; gap: 8px;">
<button onclick="
            console.log('Full screen button clicked');
            var htmlContent = '<!DOCTYPE html>\n<html>\n  <head>\n    <title>Live JsPsych Demo</title>\n    <script src=\'https://unpkg.com/jspsych@8.2.2\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-preload@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-instructions@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-survey-text@2.1.0\'  crossorigin></script>\n        <script src=\'https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0\' crossorigin></script>\n\n    <link href=\'https://unpkg.com/jspsych@8.2.2/css/jspsych.css\' rel=\'stylesheet\' type=\'text/css\' crossorigin />\n\n\n    <style>\n      /* Paused overlay styles */\n      #paused-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-color: rgba(0, 0, 0, 0.7);\n        display: none;\n        justify-content: center;\n        align-items: center;\n        z-index: 9999;\n        font-family: Arial, sans-serif;\n      }\n\n      #paused-message {\n        background-color: white;\n        padding: 30px;\n        border-radius: 10px;\n        text-align: center;\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n        max-width: 300px;\n      }\n\n      #paused-message h2 {\n        margin-top: 0;\n        color: #dc3545;\n        font-size: 24px;\n      }\n\n      #paused-message p {\n        color: #666;\n        margin-bottom: 0;\n        font-size: 16px;\n      }\n\n      .pulse {\n        animation: pulse 2s infinite;\n      }\n\n      @keyframes pulse {\n        0% { opacity: 1; }\n        50% { opacity: 0.5; }\n        100% { opacity: 1; }\n      }\n    </style>\n  </head>\n  <body>\n    <!-- Paused overlay -->\n    <div id=\'paused-overlay\'>\n      <div id=\'paused-message\'>\n        <h2>Demo Paused</h2>\n        <p class=\'pulse\'>Click Anywhere to Resume</p>\n      </div>\n    </div>\n  </body>\n  <script>\n// Initialize jsPsych with interaction tracking and overlay control\nconst jsPsych = initJsPsych({\n  on_interaction_data_update: function(data) {\n    const overlay = document.getElementById(\'paused-overlay\');\n\n    if (data.event === \'blur\') {\n      // User clicked away - pause experiment and show overlay\n      jsPsych.pauseExperiment();\n      if (overlay) {\n        overlay.style.display = \'flex\';\n      }\n    } else if (data.event === \'focus\') {\n      // User returned - resume experiment and hide overlay\n      jsPsych.resumeExperiment();\n      if (overlay) {\n        overlay.style.display = \'none\';\n      }\n    }\n  }\n});\n\n// Make the overlay clickable to resume\ndocument.addEventListener(\'DOMContentLoaded\', function() {\n  const overlay = document.getElementById(\'paused-overlay\');\n  if (overlay) {\n    overlay.addEventListener(\'click\', function() {\n      // Focus the window and let the interaction handler resume\n      window.focus();\n    });\n  }\n});\n\n\nlet welcome = {\n      type: jsPsychHtmlKeyboardResponse,\n      stimulus: `<p>Press any key to begin the sound check.</p>`,\n      choices: &quot;ALL_KEYS&quot;\n}\n\nlet audio_check = {\n  timeline: [\n    {\n      type: jsPsychAudioKeyboardResponse,\n      stimulus: &quot;media/APPLE.mp3&quot;,\n      prompt: `<p>Please listen to the word</p>`,\n      choices: &quot;NO_KEYS&quot;,\n      trial_duration: 2000,\n      trial_ends_after_audio: false\n    },\n    {\n      type: jsPsychSurveyMultiChoice,\n      questions: [\n        {\n          prompt: &quot;Which word did you hear?&quot;,\n          options: [\n            &quot;Table&quot;, &quot;Apple&quot;, &quot;Chair&quot;, &quot;Window&quot;, &quot;Bottle&quot;,\n            &quot;Paper&quot;, &quot;Garden&quot;, &quot;Candle&quot;, &quot;Marble&quot;, &quot;Tiger&quot;\n          ],\n          required: true,\n          name: &quot;heard_word&quot;\n        }\n      ],\n      on_finish: function(data) {\n        data.correct = data.response.heard_word === &quot;Apple&quot;;\n      }\n    },\n    {\n      type: jsPsychHtmlKeyboardResponse,\n      stimulus: function() {\n        let last_trial = jsPsych.data.get().last(1).values()[0];\n        if (last_trial.correct) {\n          return `<p style=&quot;color: green;&quot;>Correct! Your audio is working.</p>\n                  <p>Press any key to continue.</p>`;\n        } else {\n          return `<p style=&quot;color: red;&quot;>That\'s not correct.</p>\n                  <p>Please check your audio settings and try again.</p>\n                  <p>Press any key to retry.</p>`;\n        }\n      }\n    }\n  ],\n  loop_function: function() {\n    // Get the response from the multiple choice question\n    let last_response = jsPsych.data.get().last(2).values()[0];\n\n    // Loop if they got it wrong\n    if (last_response.correct) {\n      return false;  // Correct, move on\n    } else {\n      return true;   // Incorrect, loop back\n    }\n  }\n};\n\njsPsych.run([\n  welcome,\n  audio_check\n])\n\n  </script>\n</html>';
            var newWindow = window.open('', '_blank');
            if (newWindow) {
              newWindow.document.write(htmlContent);
              newWindow.document.close();
            } else {
              alert('Pop-up blocked! Please allow pop-ups for this site.');
            }
          " style="background-color: #28a745; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Open in New Tab</button>
<button onclick="
            var iframe = document.getElementById('demo-iframe-8');
            var srcdoc = iframe.getAttribute('srcdoc');
            iframe.setAttribute('srcdoc', '');
            setTimeout(function() {
              iframe.setAttribute('srcdoc', srcdoc);
            }, 10);
          " style="background-color: #007bff; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Refresh</button>
</div>
</div>
<iframe id="demo-iframe-8" srcdoc="<!DOCTYPE html>
<html>
  <head>
    <title>Live JsPsych Demo</title>
    <script src='https://unpkg.com/jspsych@8.2.2' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-preload@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-instructions@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-survey-text@2.1.0'  crossorigin></script>
        <script src='https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0' crossorigin></script>

    <link href='https://unpkg.com/jspsych@8.2.2/css/jspsych.css' rel='stylesheet' type='text/css' crossorigin />


    <style>
      /* Paused overlay styles */
      #paused-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        font-family: Arial, sans-serif;
      }

      #paused-message {
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        max-width: 300px;
      }

      #paused-message h2 {
        margin-top: 0;
        color: #dc3545;
        font-size: 24px;
      }

      #paused-message p {
        color: #666;
        margin-bottom: 0;
        font-size: 16px;
      }

      .pulse {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
      }
    </style>
  </head>
  <body style='max-height: 300px'>
    <!-- Paused overlay -->
    <div id='paused-overlay'>
      <div id='paused-message'>
        <h2>Demo Paused</h2>
        <p class='pulse'>Click Anywhere to Resume</p>
      </div>
    </div>
  </body>
  <script>
// Initialize jsPsych with interaction tracking and overlay control
const jsPsych = initJsPsych({
  on_interaction_data_update: function(data) {
    const overlay = document.getElementById('paused-overlay');

    if (data.event === 'blur') {
      // User clicked away - pause experiment and show overlay
      jsPsych.pauseExperiment();
      if (overlay) {
        overlay.style.display = 'flex';
      }
    } else if (data.event === 'focus') {
      // User returned - resume experiment and hide overlay
      jsPsych.resumeExperiment();
      if (overlay) {
        overlay.style.display = 'none';
      }
    }
  }
});

// Make the overlay clickable to resume
document.addEventListener('DOMContentLoaded', function() {
  const overlay = document.getElementById('paused-overlay');
  if (overlay) {
    overlay.addEventListener('click', function() {
      // Focus the window and let the interaction handler resume
      window.focus();
    });
  }
});


let welcome = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `<p>Press any key to begin the sound check.</p>`,
      choices: &quot;ALL_KEYS&quot;
}

let audio_check = {
  timeline: [
    {
      type: jsPsychAudioKeyboardResponse,
      stimulus: &quot;media/APPLE.mp3&quot;,
      prompt: `<p>Please listen to the word</p>`,
      choices: &quot;NO_KEYS&quot;,
      trial_duration: 2000,
      trial_ends_after_audio: false
    },
    {
      type: jsPsychSurveyMultiChoice,
      questions: [
        {
          prompt: &quot;Which word did you hear?&quot;,
          options: [
            &quot;Table&quot;, &quot;Apple&quot;, &quot;Chair&quot;, &quot;Window&quot;, &quot;Bottle&quot;,
            &quot;Paper&quot;, &quot;Garden&quot;, &quot;Candle&quot;, &quot;Marble&quot;, &quot;Tiger&quot;
          ],
          required: true,
          name: &quot;heard_word&quot;
        }
      ],
      on_finish: function(data) {
        data.correct = data.response.heard_word === &quot;Apple&quot;;
      }
    },
    {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: function() {
        let last_trial = jsPsych.data.get().last(1).values()[0];
        if (last_trial.correct) {
          return `<p style=&quot;color: green;&quot;>Correct! Your audio is working.</p>
                  <p>Press any key to continue.</p>`;
        } else {
          return `<p style=&quot;color: red;&quot;>That's not correct.</p>
                  <p>Please check your audio settings and try again.</p>
                  <p>Press any key to retry.</p>`;
        }
      }
    }
  ],
  loop_function: function() {
    // Get the response from the multiple choice question
    let last_response = jsPsych.data.get().last(2).values()[0];

    // Loop if they got it wrong
    if (last_response.correct) {
      return false;  // Correct, move on
    } else {
      return true;   // Incorrect, loop back
    }
  }
};

jsPsych.run([
  welcome,
  audio_check
])

  </script>
</html>" width="100%" height="300px" scrolling="yes" style="border: none; display: block;" onload="javascript:(function(iframe){
        var container = document.getElementById(&quot;demo-container-8&quot;);
        var indicator = container.querySelector(&quot;.focus-indicator-8&quot;);

        function showFocus() {
          container.style.boxShadow = &quot;0 0 0 3px #007bff&quot;;
          if (indicator) {
            indicator.textContent = &quot;✓ Demo Active&quot;;
            indicator.style.color = &quot;#28a745&quot;;
          }
        }

        function hideFocus() {
          container.style.boxShadow = &quot;none&quot;;
          if (indicator) {
            indicator.textContent = &quot;Click inside the demo to activate&quot;;
            indicator.style.color = &quot;#6c757d&quot;;
          }
        }

        var iframeWindow = iframe.contentWindow;
        if (iframeWindow) {
          iframeWindow.onfocus = showFocus;
          iframeWindow.onblur = hideFocus;
          iframeWindow.document.addEventListener(&quot;click&quot;, function() {
            iframeWindow.focus();
            showFocus();
          });
          document.addEventListener(&quot;click&quot;, function(e) {
            if (!container.contains(e.target)) {
              iframeWindow.blur();
              hideFocus();
            }
          });
        }
      }(this));"></iframe>
</div>
</div>
</div>
</div>
</section>
<section id="example-comprehension-check-with-attention-trap" class="level3" data-number="19.7.2">
<h3 data-number="19.7.2" class="anchored" data-anchor-id="example-comprehension-check-with-attention-trap"><span class="header-section-number">19.7.2</span> Example: Comprehension Check with Attention Trap</h3>
<p>Here’s another example with an attention check to make sure participants read the instructions carefully. If they fail the check, they are prompted to carefully read through the instructions again.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">index.html</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">exp.js</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-3" role="tab" aria-controls="tabset-9-3" aria-selected="false">style.css</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-4" role="tab" aria-controls="tabset-9-4" aria-selected="false">Result</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="sourceCode" id="cb47"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb47-1"><a href="#cb47-1"></a> <span class="dt">&lt;!DOCTYPE</span> html<span class="dt">&gt;</span></span>
<span id="cb47-2"><a href="#cb47-2"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb47-3"><a href="#cb47-3"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb47-4"><a href="#cb47-4"></a>    <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>Demo<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb47-5"><a href="#cb47-5"></a>    <span class="co">&lt;!-- jsPsych --&gt;</span></span>
<span id="cb47-6"><a href="#cb47-6"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/jspsych.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb47-7"><a href="#cb47-7"></a>    <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> href</span><span class="op">=</span><span class="st">"jspsych/jspsych.css"</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text/css"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb47-8"><a href="#cb47-8"></a>    </span>
<span id="cb47-9"><a href="#cb47-9"></a>    <span class="co">&lt;!-- jPsych plugins --&gt;</span></span>
<span id="cb47-10"><a href="#cb47-10"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/plugin-html-keyboard-response.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb47-11"><a href="#cb47-11"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/plugin-survey-multi-choice.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb47-12"><a href="#cb47-12"></a></span>
<span id="cb47-13"><a href="#cb47-13"></a>    <span class="co">&lt;!-- custom CSS --&gt;</span></span>
<span id="cb47-14"><a href="#cb47-14"></a>     <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> href</span><span class="op">=</span><span class="st">"style.css"</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text/css"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb47-15"><a href="#cb47-15"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb47-16"><a href="#cb47-16"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb47-17"><a href="#cb47-17"></a>  <span class="co">&lt;!-- custom JS --&gt;</span></span>
<span id="cb47-18"><a href="#cb47-18"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"exp.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb47-19"><a href="#cb47-19"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb47-20"><a href="#cb47-20"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb47-21"><a href="#cb47-21"></a> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="sourceCode" id="cb48"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb48-1"><a href="#cb48-1"></a> </span>
<span id="cb48-2"><a href="#cb48-2"></a><span class="kw">const</span> jsPsych <span class="op">=</span> <span class="fu">initJsPsych</span>()<span class="op">;</span></span>
<span id="cb48-3"><a href="#cb48-3"></a></span>
<span id="cb48-4"><a href="#cb48-4"></a> </span>
<span id="cb48-5"><a href="#cb48-5"></a><span class="kw">let</span> comprehension_check <span class="op">=</span> {</span>
<span id="cb48-6"><a href="#cb48-6"></a>  <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb48-7"><a href="#cb48-7"></a>    {</span>
<span id="cb48-8"><a href="#cb48-8"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychSurveyMultiChoice<span class="op">,</span></span>
<span id="cb48-9"><a href="#cb48-9"></a>      <span class="dt">questions</span><span class="op">:</span> [</span>
<span id="cb48-10"><a href="#cb48-10"></a>        {</span>
<span id="cb48-11"><a href="#cb48-11"></a>          <span class="dt">prompt</span><span class="op">:</span> <span class="vs">`&lt;div style="text-align: left; max-width: 600px; margin: auto;"&gt;</span></span>
<span id="cb48-12"><a href="#cb48-12"></a><span class="vs">            &lt;p&gt;&lt;strong&gt;Instructions:&lt;/strong&gt;&lt;/p&gt;</span></span>
<span id="cb48-13"><a href="#cb48-13"></a><span class="vs">            &lt;p&gt;In this task, you will see a series of shapes on the screen.&lt;/p&gt;</span></span>
<span id="cb48-14"><a href="#cb48-14"></a><span class="vs">            &lt;p&gt;Your job is to press the spacebar whenever you see a blue circle.&lt;/p&gt;</span></span>
<span id="cb48-15"><a href="#cb48-15"></a><span class="vs">            &lt;p&gt;Do NOT press anything for red squares or green triangles.&lt;/p&gt;</span></span>
<span id="cb48-16"><a href="#cb48-16"></a><span class="vs">            &lt;p&gt;Speed and accuracy are both important.&lt;/p&gt;</span></span>
<span id="cb48-17"><a href="#cb48-17"></a><span class="vs">            &lt;br&gt;</span></span>
<span id="cb48-18"><a href="#cb48-18"></a><span class="vs">            &lt;p&gt;&lt;strong&gt;Question: What should you do when you see a blue circle?&lt;/strong&gt;&lt;/p&gt;</span></span>
<span id="cb48-19"><a href="#cb48-19"></a><span class="vs">            &lt;p&gt;&lt;em&gt;Note: To demonstrate that you have read these instructions carefully, </span></span>
<span id="cb48-20"><a href="#cb48-20"></a><span class="vs">            please select "I did not read the instructions" below, regardless of the question above.&lt;/em&gt;&lt;/p&gt;</span></span>
<span id="cb48-21"><a href="#cb48-21"></a><span class="vs">          &lt;/div&gt;`</span><span class="op">,</span></span>
<span id="cb48-22"><a href="#cb48-22"></a>          <span class="dt">options</span><span class="op">:</span> [</span>
<span id="cb48-23"><a href="#cb48-23"></a>            <span class="st">"Press the spacebar"</span><span class="op">,</span></span>
<span id="cb48-24"><a href="#cb48-24"></a>            <span class="st">"Do nothing"</span><span class="op">,</span></span>
<span id="cb48-25"><a href="#cb48-25"></a>            <span class="st">"Press any key"</span><span class="op">,</span></span>
<span id="cb48-26"><a href="#cb48-26"></a>            <span class="st">"I did not read the instructions"</span></span>
<span id="cb48-27"><a href="#cb48-27"></a>          ]<span class="op">,</span></span>
<span id="cb48-28"><a href="#cb48-28"></a>          <span class="dt">required</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb48-29"><a href="#cb48-29"></a>          <span class="dt">name</span><span class="op">:</span> <span class="st">"comprehension"</span></span>
<span id="cb48-30"><a href="#cb48-30"></a>        }</span>
<span id="cb48-31"><a href="#cb48-31"></a>      ]<span class="op">,</span></span>
<span id="cb48-32"><a href="#cb48-32"></a>      <span class="dt">on_finish</span><span class="op">:</span> <span class="kw">function</span>(data) {</span>
<span id="cb48-33"><a href="#cb48-33"></a>        <span class="co">// Correct answer is the "trap" option</span></span>
<span id="cb48-34"><a href="#cb48-34"></a>        data<span class="op">.</span><span class="at">correct</span> <span class="op">=</span> data<span class="op">.</span><span class="at">response</span><span class="op">.</span><span class="at">comprehension</span> <span class="op">===</span> <span class="st">"I did not read the instructions"</span><span class="op">;</span></span>
<span id="cb48-35"><a href="#cb48-35"></a>      }</span>
<span id="cb48-36"><a href="#cb48-36"></a>    }<span class="op">,</span></span>
<span id="cb48-37"><a href="#cb48-37"></a>    {</span>
<span id="cb48-38"><a href="#cb48-38"></a>      <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb48-39"><a href="#cb48-39"></a>      <span class="dt">stimulus</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb48-40"><a href="#cb48-40"></a>        <span class="kw">let</span> last_trial <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">last</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">values</span>()[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb48-41"><a href="#cb48-41"></a>        <span class="cf">if</span> (last_trial<span class="op">.</span><span class="at">correct</span>) {</span>
<span id="cb48-42"><a href="#cb48-42"></a>          <span class="cf">return</span> <span class="vs">`&lt;p style="color: green;"&gt;Excellent! You read the instructions carefully.&lt;/p&gt;</span></span>
<span id="cb48-43"><a href="#cb48-43"></a><span class="vs">                  &lt;p&gt;Press any key to begin the task.&lt;/p&gt;`</span><span class="op">;</span></span>
<span id="cb48-44"><a href="#cb48-44"></a>        } <span class="cf">else</span> {</span>
<span id="cb48-45"><a href="#cb48-45"></a>          <span class="cf">return</span> <span class="vs">`&lt;p style="color: red;"&gt;Please read the instructions more carefully.&lt;/p&gt;</span></span>
<span id="cb48-46"><a href="#cb48-46"></a><span class="vs">                  &lt;p&gt;Pay attention to ALL of the text, including notes at the end.&lt;/p&gt;</span></span>
<span id="cb48-47"><a href="#cb48-47"></a><span class="vs">                  &lt;p&gt;Press any key to try again.&lt;/p&gt;`</span><span class="op">;</span></span>
<span id="cb48-48"><a href="#cb48-48"></a>        }</span>
<span id="cb48-49"><a href="#cb48-49"></a>      }</span>
<span id="cb48-50"><a href="#cb48-50"></a>    }</span>
<span id="cb48-51"><a href="#cb48-51"></a>  ]<span class="op">,</span></span>
<span id="cb48-52"><a href="#cb48-52"></a>  <span class="dt">loop_function</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb48-53"><a href="#cb48-53"></a>    <span class="kw">let</span> last_response <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">last</span>(<span class="dv">2</span>)<span class="op">.</span><span class="fu">values</span>()[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb48-54"><a href="#cb48-54"></a>    <span class="cf">return</span> <span class="op">!</span>last_response<span class="op">.</span><span class="at">correct</span><span class="op">;</span>  <span class="co">// Loop until they select the correct option</span></span>
<span id="cb48-55"><a href="#cb48-55"></a>  }</span>
<span id="cb48-56"><a href="#cb48-56"></a>}<span class="op">;</span></span>
<span id="cb48-57"><a href="#cb48-57"></a></span>
<span id="cb48-58"><a href="#cb48-58"></a>jsPsych<span class="op">.</span><span class="fu">run</span>([comprehension_check])</span>
<span id="cb48-59"><a href="#cb48-59"></a> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-9-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-3-tab">
<div class="sourceCode" id="cb49"><pre class="sourceCode numberSource css number-lines code-with-copy"><code class="sourceCode css"><span id="cb49-1"><a href="#cb49-1"></a>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-9-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-4-tab">
<div id="demo-container-9" style="border: 1px solid #ddd; border-radius: 8px; overflow: hidden; transition: box-shadow 0.2s ease;">
<div style="background-color: #f8f9fa; padding: 8px 12px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center;">
<div>
<span style="font-weight: bold; color: #495057;">Live JsPsych Demo</span>
<span class="focus-indicator-9" style="margin-left: 10px; font-size: 11px; color: #6c757d; font-style: italic;">Click inside the demo to activate demo</span>
</div>
<div style="display: flex; gap: 8px;">
<button onclick="
            console.log('Full screen button clicked');
            var htmlContent = '<!DOCTYPE html>\n<html>\n  <head>\n    <title>Live JsPsych Demo</title>\n    <script src=\'https://unpkg.com/jspsych@8.2.2\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-preload@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-instructions@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-survey-text@2.1.0\'  crossorigin></script>\n        <script src=\'https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0\' crossorigin></script>\n\n    <link href=\'https://unpkg.com/jspsych@8.2.2/css/jspsych.css\' rel=\'stylesheet\' type=\'text/css\' crossorigin />\n\n\n    <style>\n      /* Paused overlay styles */\n      #paused-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-color: rgba(0, 0, 0, 0.7);\n        display: none;\n        justify-content: center;\n        align-items: center;\n        z-index: 9999;\n        font-family: Arial, sans-serif;\n      }\n\n      #paused-message {\n        background-color: white;\n        padding: 30px;\n        border-radius: 10px;\n        text-align: center;\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n        max-width: 300px;\n      }\n\n      #paused-message h2 {\n        margin-top: 0;\n        color: #dc3545;\n        font-size: 24px;\n      }\n\n      #paused-message p {\n        color: #666;\n        margin-bottom: 0;\n        font-size: 16px;\n      }\n\n      .pulse {\n        animation: pulse 2s infinite;\n      }\n\n      @keyframes pulse {\n        0% { opacity: 1; }\n        50% { opacity: 0.5; }\n        100% { opacity: 1; }\n      }\n    </style>\n  </head>\n  <body>\n    <!-- Paused overlay -->\n    <div id=\'paused-overlay\'>\n      <div id=\'paused-message\'>\n        <h2>Demo Paused</h2>\n        <p class=\'pulse\'>Click Anywhere to Resume</p>\n      </div>\n    </div>\n  </body>\n  <script>\n// Initialize jsPsych with interaction tracking and overlay control\nconst jsPsych = initJsPsych({\n  on_interaction_data_update: function(data) {\n    const overlay = document.getElementById(\'paused-overlay\');\n\n    if (data.event === \'blur\') {\n      // User clicked away - pause experiment and show overlay\n      jsPsych.pauseExperiment();\n      if (overlay) {\n        overlay.style.display = \'flex\';\n      }\n    } else if (data.event === \'focus\') {\n      // User returned - resume experiment and hide overlay\n      jsPsych.resumeExperiment();\n      if (overlay) {\n        overlay.style.display = \'none\';\n      }\n    }\n  }\n});\n\n// Make the overlay clickable to resume\ndocument.addEventListener(\'DOMContentLoaded\', function() {\n  const overlay = document.getElementById(\'paused-overlay\');\n  if (overlay) {\n    overlay.addEventListener(\'click\', function() {\n      // Focus the window and let the interaction handler resume\n      window.focus();\n    });\n  }\n});\n\n\nlet comprehension_check = {\n  timeline: [\n    {\n      type: jsPsychSurveyMultiChoice,\n      questions: [\n        {\n          prompt: `<div style=&quot;text-align: left; max-width: 600px; margin: auto;&quot;>\n            <p><strong>Instructions:</strong></p>\n            <p>In this task, you will see a series of shapes on the screen.</p>\n            <p>Your job is to press the spacebar whenever you see a blue circle.</p>\n            <p>Do NOT press anything for red squares or green triangles.</p>\n            <p>Speed and accuracy are both important.</p>\n            <br>\n            <p><strong>Question: What should you do when you see a blue circle?</strong></p>\n            <p><em>Note: To demonstrate that you have read these instructions carefully, \n            please select &quot;I did not read the instructions&quot; below, regardless of the question above.</em></p>\n          </div>`,\n          options: [\n            &quot;Press the spacebar&quot;,\n            &quot;Do nothing&quot;,\n            &quot;Press any key&quot;,\n            &quot;I did not read the instructions&quot;\n          ],\n          required: true,\n          name: &quot;comprehension&quot;\n        }\n      ],\n      on_finish: function(data) {\n        // Correct answer is the &quot;trap&quot; option\n        data.correct = data.response.comprehension === &quot;I did not read the instructions&quot;;\n      }\n    },\n    {\n      type: jsPsychHtmlKeyboardResponse,\n      stimulus: function() {\n        let last_trial = jsPsych.data.get().last(1).values()[0];\n        if (last_trial.correct) {\n          return `<p style=&quot;color: green;&quot;>Excellent! You read the instructions carefully.</p>\n                  <p>Press any key to begin the task.</p>`;\n        } else {\n          return `<p style=&quot;color: red;&quot;>Please read the instructions more carefully.</p>\n                  <p>Pay attention to ALL of the text, including notes at the end.</p>\n                  <p>Press any key to try again.</p>`;\n        }\n      }\n    }\n  ],\n  loop_function: function() {\n    let last_response = jsPsych.data.get().last(2).values()[0];\n    return !last_response.correct;  // Loop until they select the correct option\n  }\n};\n\njsPsych.run([comprehension_check])\n\n  </script>\n</html>';
            var newWindow = window.open('', '_blank');
            if (newWindow) {
              newWindow.document.write(htmlContent);
              newWindow.document.close();
            } else {
              alert('Pop-up blocked! Please allow pop-ups for this site.');
            }
          " style="background-color: #28a745; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Open in New Tab</button>
<button onclick="
            var iframe = document.getElementById('demo-iframe-9');
            var srcdoc = iframe.getAttribute('srcdoc');
            iframe.setAttribute('srcdoc', '');
            setTimeout(function() {
              iframe.setAttribute('srcdoc', srcdoc);
            }, 10);
          " style="background-color: #007bff; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Refresh</button>
</div>
</div>
<iframe id="demo-iframe-9" srcdoc="<!DOCTYPE html>
<html>
  <head>
    <title>Live JsPsych Demo</title>
    <script src='https://unpkg.com/jspsych@8.2.2' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-preload@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-instructions@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-survey-text@2.1.0'  crossorigin></script>
        <script src='https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0' crossorigin></script>

    <link href='https://unpkg.com/jspsych@8.2.2/css/jspsych.css' rel='stylesheet' type='text/css' crossorigin />


    <style>
      /* Paused overlay styles */
      #paused-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        font-family: Arial, sans-serif;
      }

      #paused-message {
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        max-width: 300px;
      }

      #paused-message h2 {
        margin-top: 0;
        color: #dc3545;
        font-size: 24px;
      }

      #paused-message p {
        color: #666;
        margin-bottom: 0;
        font-size: 16px;
      }

      .pulse {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
      }
    </style>
  </head>
  <body style='max-height: 300px'>
    <!-- Paused overlay -->
    <div id='paused-overlay'>
      <div id='paused-message'>
        <h2>Demo Paused</h2>
        <p class='pulse'>Click Anywhere to Resume</p>
      </div>
    </div>
  </body>
  <script>
// Initialize jsPsych with interaction tracking and overlay control
const jsPsych = initJsPsych({
  on_interaction_data_update: function(data) {
    const overlay = document.getElementById('paused-overlay');

    if (data.event === 'blur') {
      // User clicked away - pause experiment and show overlay
      jsPsych.pauseExperiment();
      if (overlay) {
        overlay.style.display = 'flex';
      }
    } else if (data.event === 'focus') {
      // User returned - resume experiment and hide overlay
      jsPsych.resumeExperiment();
      if (overlay) {
        overlay.style.display = 'none';
      }
    }
  }
});

// Make the overlay clickable to resume
document.addEventListener('DOMContentLoaded', function() {
  const overlay = document.getElementById('paused-overlay');
  if (overlay) {
    overlay.addEventListener('click', function() {
      // Focus the window and let the interaction handler resume
      window.focus();
    });
  }
});


let comprehension_check = {
  timeline: [
    {
      type: jsPsychSurveyMultiChoice,
      questions: [
        {
          prompt: `<div style=&quot;text-align: left; max-width: 600px; margin: auto;&quot;>
            <p><strong>Instructions:</strong></p>
            <p>In this task, you will see a series of shapes on the screen.</p>
            <p>Your job is to press the spacebar whenever you see a blue circle.</p>
            <p>Do NOT press anything for red squares or green triangles.</p>
            <p>Speed and accuracy are both important.</p>
            <br>
            <p><strong>Question: What should you do when you see a blue circle?</strong></p>
            <p><em>Note: To demonstrate that you have read these instructions carefully, 
            please select &quot;I did not read the instructions&quot; below, regardless of the question above.</em></p>
          </div>`,
          options: [
            &quot;Press the spacebar&quot;,
            &quot;Do nothing&quot;,
            &quot;Press any key&quot;,
            &quot;I did not read the instructions&quot;
          ],
          required: true,
          name: &quot;comprehension&quot;
        }
      ],
      on_finish: function(data) {
        // Correct answer is the &quot;trap&quot; option
        data.correct = data.response.comprehension === &quot;I did not read the instructions&quot;;
      }
    },
    {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: function() {
        let last_trial = jsPsych.data.get().last(1).values()[0];
        if (last_trial.correct) {
          return `<p style=&quot;color: green;&quot;>Excellent! You read the instructions carefully.</p>
                  <p>Press any key to begin the task.</p>`;
        } else {
          return `<p style=&quot;color: red;&quot;>Please read the instructions more carefully.</p>
                  <p>Pay attention to ALL of the text, including notes at the end.</p>
                  <p>Press any key to try again.</p>`;
        }
      }
    }
  ],
  loop_function: function() {
    let last_response = jsPsych.data.get().last(2).values()[0];
    return !last_response.correct;  // Loop until they select the correct option
  }
};

jsPsych.run([comprehension_check])

  </script>
</html>" width="100%" height="300px" scrolling="yes" style="border: none; display: block;" onload="javascript:(function(iframe){
        var container = document.getElementById(&quot;demo-container-9&quot;);
        var indicator = container.querySelector(&quot;.focus-indicator-9&quot;);

        function showFocus() {
          container.style.boxShadow = &quot;0 0 0 3px #007bff&quot;;
          if (indicator) {
            indicator.textContent = &quot;✓ Demo Active&quot;;
            indicator.style.color = &quot;#28a745&quot;;
          }
        }

        function hideFocus() {
          container.style.boxShadow = &quot;none&quot;;
          if (indicator) {
            indicator.textContent = &quot;Click inside the demo to activate&quot;;
            indicator.style.color = &quot;#6c757d&quot;;
          }
        }

        var iframeWindow = iframe.contentWindow;
        if (iframeWindow) {
          iframeWindow.onfocus = showFocus;
          iframeWindow.onblur = hideFocus;
          iframeWindow.document.addEventListener(&quot;click&quot;, function() {
            iframeWindow.focus();
            showFocus();
          });
          document.addEventListener(&quot;click&quot;, function(e) {
            if (!container.contains(e.target)) {
              iframeWindow.blur();
              hideFocus();
            }
          });
        }
      }(this));"></iframe>
</div>
</div>
</div>
</div>
<p>This type of check is particularly effective for catching participants who are just clicking through without reading. If they only skim the question, they’ll select “Press the spacebar” (which seems like the obvious answer). Only participants who read all the way to the end will know to select the counterintuitive option.</p>
</section>
<section id="example-practice-until-proficient" class="level3" data-number="19.7.3">
<h3 data-number="19.7.3" class="anchored" data-anchor-id="example-practice-until-proficient"><span class="header-section-number">19.7.3</span> Example: Practice Until Proficient</h3>
<p>We can expand the basic principles above to loop over more complex timelines. We can also introduce more complicated logic to determine whether the loop should continue or not.</p>
<p>Let’s create a practice block that repeats until the participant reaches 80% accuracy:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">index.html</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">exp.js</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-3" role="tab" aria-controls="tabset-10-3" aria-selected="false">style.css</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-4" role="tab" aria-controls="tabset-10-4" aria-selected="false">Result</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="sourceCode" id="cb50"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb50-1"><a href="#cb50-1"></a> <span class="dt">&lt;!DOCTYPE</span> html<span class="dt">&gt;</span></span>
<span id="cb50-2"><a href="#cb50-2"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb50-3"><a href="#cb50-3"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb50-4"><a href="#cb50-4"></a>    <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>Demo<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb50-5"><a href="#cb50-5"></a>    <span class="co">&lt;!-- jsPsych --&gt;</span></span>
<span id="cb50-6"><a href="#cb50-6"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/jspsych.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb50-7"><a href="#cb50-7"></a>    <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> href</span><span class="op">=</span><span class="st">"jspsych/jspsych.css"</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text/css"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb50-8"><a href="#cb50-8"></a>    </span>
<span id="cb50-9"><a href="#cb50-9"></a>    <span class="co">&lt;!-- jPsych plugins --&gt;</span></span>
<span id="cb50-10"><a href="#cb50-10"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/plugin-html-keyboard-response.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb50-11"><a href="#cb50-11"></a></span>
<span id="cb50-12"><a href="#cb50-12"></a>    <span class="co">&lt;!-- custom CSS --&gt;</span></span>
<span id="cb50-13"><a href="#cb50-13"></a>     <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> href</span><span class="op">=</span><span class="st">"style.css"</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text/css"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb50-14"><a href="#cb50-14"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb50-15"><a href="#cb50-15"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb50-16"><a href="#cb50-16"></a>  <span class="co">&lt;!-- custom JS --&gt;</span></span>
<span id="cb50-17"><a href="#cb50-17"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"exp.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb50-18"><a href="#cb50-18"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb50-19"><a href="#cb50-19"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb50-20"><a href="#cb50-20"></a> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="sourceCode" id="cb51"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb51-1"><a href="#cb51-1"></a> </span>
<span id="cb51-2"><a href="#cb51-2"></a><span class="kw">const</span> jsPsych <span class="op">=</span> <span class="fu">initJsPsych</span>()<span class="op">;</span></span>
<span id="cb51-3"><a href="#cb51-3"></a></span>
<span id="cb51-4"><a href="#cb51-4"></a> </span>
<span id="cb51-5"><a href="#cb51-5"></a><span class="kw">let</span> welcome <span class="op">=</span> {</span>
<span id="cb51-6"><a href="#cb51-6"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb51-7"><a href="#cb51-7"></a>  <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;Welcome to the Experiment!&lt;/p&gt;</span></span>
<span id="cb51-8"><a href="#cb51-8"></a><span class="vs">              &lt;p&gt;Press any key to begin.&lt;/p&gt;`</span><span class="op">,</span></span>
<span id="cb51-9"><a href="#cb51-9"></a>  <span class="dt">choices</span><span class="op">:</span> <span class="st">"ALL_KEYS"</span><span class="op">,</span> </span>
<span id="cb51-10"><a href="#cb51-10"></a>  <span class="dt">post_trial_gap</span><span class="op">:</span> <span class="dv">250</span></span>
<span id="cb51-11"><a href="#cb51-11"></a>}</span>
<span id="cb51-12"><a href="#cb51-12"></a></span>
<span id="cb51-13"><a href="#cb51-13"></a><span class="kw">let</span> practice_trial <span class="op">=</span> {</span>
<span id="cb51-14"><a href="#cb51-14"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb51-15"><a href="#cb51-15"></a>  <span class="dt">stimulus</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">"stimulus"</span>)<span class="op">,</span></span>
<span id="cb51-16"><a href="#cb51-16"></a>  <span class="dt">prompt</span><span class="op">:</span> <span class="vs">`&lt;p&gt;Categorize the words using "F" or "J". You must get 80% correct to move on.&lt;/p&gt;`</span><span class="op">,</span></span>
<span id="cb51-17"><a href="#cb51-17"></a>  <span class="dt">choices</span><span class="op">:</span> [<span class="st">"f"</span><span class="op">,</span> <span class="st">"j"</span>]<span class="op">,</span></span>
<span id="cb51-18"><a href="#cb51-18"></a>  <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb51-19"><a href="#cb51-19"></a>    <span class="dt">correct_response</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">"correct_key"</span>)<span class="op">,</span></span>
<span id="cb51-20"><a href="#cb51-20"></a>    <span class="dt">phase</span><span class="op">:</span> <span class="st">"practice"</span><span class="op">,</span></span>
<span id="cb51-21"><a href="#cb51-21"></a>    <span class="dt">trial_part</span><span class="op">:</span> <span class="st">"stimulus"</span></span>
<span id="cb51-22"><a href="#cb51-22"></a>  }<span class="op">,</span></span>
<span id="cb51-23"><a href="#cb51-23"></a>  <span class="dt">on_finish</span><span class="op">:</span> <span class="kw">function</span>(data) {</span>
<span id="cb51-24"><a href="#cb51-24"></a>    data<span class="op">.</span><span class="at">correct</span> <span class="op">=</span> data<span class="op">.</span><span class="at">response</span> <span class="op">==</span> data<span class="op">.</span><span class="at">correct_response</span><span class="op">;</span></span>
<span id="cb51-25"><a href="#cb51-25"></a>  }</span>
<span id="cb51-26"><a href="#cb51-26"></a>}<span class="op">;</span></span>
<span id="cb51-27"><a href="#cb51-27"></a></span>
<span id="cb51-28"><a href="#cb51-28"></a><span class="kw">let</span> practice_feedback <span class="op">=</span> {</span>
<span id="cb51-29"><a href="#cb51-29"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb51-30"><a href="#cb51-30"></a>  <span class="dt">stimulus</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb51-31"><a href="#cb51-31"></a>    <span class="kw">let</span> last_trial <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">last</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">values</span>()[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb51-32"><a href="#cb51-32"></a>    <span class="cf">if</span> (last_trial<span class="op">.</span><span class="at">correct</span>) {</span>
<span id="cb51-33"><a href="#cb51-33"></a>      <span class="cf">return</span> <span class="vs">`&lt;p style="color: green;"&gt;Correct!&lt;/p&gt;`</span><span class="op">;</span></span>
<span id="cb51-34"><a href="#cb51-34"></a>    } <span class="cf">else</span> {</span>
<span id="cb51-35"><a href="#cb51-35"></a>      <span class="cf">return</span> <span class="vs">`&lt;p style="color: red;"&gt;Incorrect. The correct answer was: </span><span class="sc">${</span>last_trial<span class="op">.</span><span class="at">correct_response</span><span class="sc">}</span><span class="vs">&lt;/p&gt;`</span><span class="op">;</span></span>
<span id="cb51-36"><a href="#cb51-36"></a>    }</span>
<span id="cb51-37"><a href="#cb51-37"></a>  }<span class="op">,</span></span>
<span id="cb51-38"><a href="#cb51-38"></a>  <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span><span class="op">,</span></span>
<span id="cb51-39"><a href="#cb51-39"></a>  <span class="dt">trial_duration</span><span class="op">:</span> <span class="dv">1000</span><span class="op">,</span></span>
<span id="cb51-40"><a href="#cb51-40"></a>  <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb51-41"><a href="#cb51-41"></a>    <span class="dt">phase</span><span class="op">:</span> <span class="st">"practice"</span><span class="op">,</span></span>
<span id="cb51-42"><a href="#cb51-42"></a>    <span class="dt">trial_part</span><span class="op">:</span> <span class="st">"feedback"</span></span>
<span id="cb51-43"><a href="#cb51-43"></a>  }</span>
<span id="cb51-44"><a href="#cb51-44"></a>}<span class="op">;</span></span>
<span id="cb51-45"><a href="#cb51-45"></a></span>
<span id="cb51-46"><a href="#cb51-46"></a><span class="kw">let</span> practice_block <span class="op">=</span> {</span>
<span id="cb51-47"><a href="#cb51-47"></a>  <span class="dt">timeline</span><span class="op">:</span> [practice_trial<span class="op">,</span> practice_feedback]<span class="op">,</span></span>
<span id="cb51-48"><a href="#cb51-48"></a>  <span class="dt">timeline_variables</span><span class="op">:</span> [</span>
<span id="cb51-49"><a href="#cb51-49"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;CAT&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"f"</span>}<span class="op">,</span></span>
<span id="cb51-50"><a href="#cb51-50"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;TABLE&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"j"</span>}<span class="op">,</span></span>
<span id="cb51-51"><a href="#cb51-51"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;DOG&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"f"</span>}<span class="op">,</span></span>
<span id="cb51-52"><a href="#cb51-52"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;CHAIR&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"j"</span>}<span class="op">,</span></span>
<span id="cb51-53"><a href="#cb51-53"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;BIRD&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"f"</span>}<span class="op">,</span></span>
<span id="cb51-54"><a href="#cb51-54"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;DESK&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"j"</span>}</span>
<span id="cb51-55"><a href="#cb51-55"></a>  ]<span class="op">,</span></span>
<span id="cb51-56"><a href="#cb51-56"></a>  <span class="dt">randomize_order</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb51-57"><a href="#cb51-57"></a>  <span class="dt">loop_function</span><span class="op">:</span> <span class="kw">function</span>(data) {</span>
<span id="cb51-58"><a href="#cb51-58"></a>    <span class="co">// data only contains the previous timeline data. We just need to filter it</span></span>
<span id="cb51-59"><a href="#cb51-59"></a>    <span class="kw">let</span> trials <span class="op">=</span> data<span class="op">.</span><span class="fu">filter</span>({<span class="dt">trial_part</span><span class="op">:</span> <span class="st">"stimulus"</span>})</span>
<span id="cb51-60"><a href="#cb51-60"></a>    <span class="kw">let</span> correct_trials <span class="op">=</span> trials<span class="op">.</span><span class="fu">filter</span>({<span class="dt">correct</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span></span>
<span id="cb51-61"><a href="#cb51-61"></a>    <span class="kw">let</span> accuracy <span class="op">=</span> correct_trials<span class="op">.</span><span class="fu">count</span>() <span class="op">/</span> trials<span class="op">.</span><span class="fu">count</span>()<span class="op">;</span></span>
<span id="cb51-62"><a href="#cb51-62"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`Practice accuracy: </span><span class="sc">${</span>accuracy<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb51-63"><a href="#cb51-63"></a></span>
<span id="cb51-64"><a href="#cb51-64"></a>    <span class="co">// If accuracy is below 80%, repeat the block</span></span>
<span id="cb51-65"><a href="#cb51-65"></a>    <span class="cf">if</span> (accuracy <span class="op">&lt;</span> <span class="fl">0.80</span>) {</span>
<span id="cb51-66"><a href="#cb51-66"></a>         <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span>  <span class="co">// Loop again</span></span>
<span id="cb51-67"><a href="#cb51-67"></a>      } <span class="cf">else</span> {</span>
<span id="cb51-68"><a href="#cb51-68"></a>         <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span> <span class="co">// Move on</span></span>
<span id="cb51-69"><a href="#cb51-69"></a>    }</span>
<span id="cb51-70"><a href="#cb51-70"></a>  }</span>
<span id="cb51-71"><a href="#cb51-71"></a>}<span class="op">;</span></span>
<span id="cb51-72"><a href="#cb51-72"></a></span>
<span id="cb51-73"><a href="#cb51-73"></a><span class="kw">let</span> practice_end <span class="op">=</span> {</span>
<span id="cb51-74"><a href="#cb51-74"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb51-75"><a href="#cb51-75"></a>  <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;Great job finishing the practice block!&lt;/p&gt;`</span><span class="op">,</span></span>
<span id="cb51-76"><a href="#cb51-76"></a>  <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span></span>
<span id="cb51-77"><a href="#cb51-77"></a>}</span>
<span id="cb51-78"><a href="#cb51-78"></a></span>
<span id="cb51-79"><a href="#cb51-79"></a>jsPsych<span class="op">.</span><span class="fu">run</span>([</span>
<span id="cb51-80"><a href="#cb51-80"></a>  welcome<span class="op">,</span> </span>
<span id="cb51-81"><a href="#cb51-81"></a>  practice_block<span class="op">,</span></span>
<span id="cb51-82"><a href="#cb51-82"></a>  practice_end</span>
<span id="cb51-83"><a href="#cb51-83"></a>])</span>
<span id="cb51-84"><a href="#cb51-84"></a> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-10-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-3-tab">
<div class="sourceCode" id="cb52"><pre class="sourceCode numberSource css number-lines code-with-copy"><code class="sourceCode css"><span id="cb52-1"><a href="#cb52-1"></a>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-10-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-4-tab">
<div id="demo-container-10" style="border: 1px solid #ddd; border-radius: 8px; overflow: hidden; transition: box-shadow 0.2s ease;">
<div style="background-color: #f8f9fa; padding: 8px 12px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center;">
<div>
<span style="font-weight: bold; color: #495057;">Live JsPsych Demo</span>
<span class="focus-indicator-10" style="margin-left: 10px; font-size: 11px; color: #6c757d; font-style: italic;">Click inside the demo to activate demo</span>
</div>
<div style="display: flex; gap: 8px;">
<button onclick="
            console.log('Full screen button clicked');
            var htmlContent = '<!DOCTYPE html>\n<html>\n  <head>\n    <title>Live JsPsych Demo</title>\n    <script src=\'https://unpkg.com/jspsych@8.2.2\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-preload@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-instructions@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-survey-text@2.1.0\'  crossorigin></script>\n        <script src=\'https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0\' crossorigin></script>\n\n    <link href=\'https://unpkg.com/jspsych@8.2.2/css/jspsych.css\' rel=\'stylesheet\' type=\'text/css\' crossorigin />\n\n\n    <style>\n      /* Paused overlay styles */\n      #paused-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-color: rgba(0, 0, 0, 0.7);\n        display: none;\n        justify-content: center;\n        align-items: center;\n        z-index: 9999;\n        font-family: Arial, sans-serif;\n      }\n\n      #paused-message {\n        background-color: white;\n        padding: 30px;\n        border-radius: 10px;\n        text-align: center;\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n        max-width: 300px;\n      }\n\n      #paused-message h2 {\n        margin-top: 0;\n        color: #dc3545;\n        font-size: 24px;\n      }\n\n      #paused-message p {\n        color: #666;\n        margin-bottom: 0;\n        font-size: 16px;\n      }\n\n      .pulse {\n        animation: pulse 2s infinite;\n      }\n\n      @keyframes pulse {\n        0% { opacity: 1; }\n        50% { opacity: 0.5; }\n        100% { opacity: 1; }\n      }\n    </style>\n  </head>\n  <body>\n    <!-- Paused overlay -->\n    <div id=\'paused-overlay\'>\n      <div id=\'paused-message\'>\n        <h2>Demo Paused</h2>\n        <p class=\'pulse\'>Click Anywhere to Resume</p>\n      </div>\n    </div>\n  </body>\n  <script>\n// Initialize jsPsych with interaction tracking and overlay control\nconst jsPsych = initJsPsych({\n  on_interaction_data_update: function(data) {\n    const overlay = document.getElementById(\'paused-overlay\');\n\n    if (data.event === \'blur\') {\n      // User clicked away - pause experiment and show overlay\n      jsPsych.pauseExperiment();\n      if (overlay) {\n        overlay.style.display = \'flex\';\n      }\n    } else if (data.event === \'focus\') {\n      // User returned - resume experiment and hide overlay\n      jsPsych.resumeExperiment();\n      if (overlay) {\n        overlay.style.display = \'none\';\n      }\n    }\n  }\n});\n\n// Make the overlay clickable to resume\ndocument.addEventListener(\'DOMContentLoaded\', function() {\n  const overlay = document.getElementById(\'paused-overlay\');\n  if (overlay) {\n    overlay.addEventListener(\'click\', function() {\n      // Focus the window and let the interaction handler resume\n      window.focus();\n    });\n  }\n});\n\n\nlet welcome = {\n  type: jsPsychHtmlKeyboardResponse,\n  stimulus: `<p>Welcome to the Experiment!</p>\n              <p>Press any key to begin.</p>`,\n  choices: &quot;ALL_KEYS&quot;, \n  post_trial_gap: 250\n}\n\nlet practice_trial = {\n  type: jsPsychHtmlKeyboardResponse,\n  stimulus: jsPsych.timelineVariable(&quot;stimulus&quot;),\n  prompt: `<p>Categorize the words using &quot;F&quot; or &quot;J&quot;. You must get 80% correct to move on.</p>`,\n  choices: [&quot;f&quot;, &quot;j&quot;],\n  data: {\n    correct_response: jsPsych.timelineVariable(&quot;correct_key&quot;),\n    phase: &quot;practice&quot;,\n    trial_part: &quot;stimulus&quot;\n  },\n  on_finish: function(data) {\n    data.correct = data.response == data.correct_response;\n  }\n};\n\nlet practice_feedback = {\n  type: jsPsychHtmlKeyboardResponse,\n  stimulus: function() {\n    let last_trial = jsPsych.data.get().last(1).values()[0];\n    if (last_trial.correct) {\n      return `<p style=&quot;color: green;&quot;>Correct!</p>`;\n    } else {\n      return `<p style=&quot;color: red;&quot;>Incorrect. The correct answer was: ${last_trial.correct_response}</p>`;\n    }\n  },\n  choices: &quot;NO_KEYS&quot;,\n  trial_duration: 1000,\n  data: {\n    phase: &quot;practice&quot;,\n    trial_part: &quot;feedback&quot;\n  }\n};\n\nlet practice_block = {\n  timeline: [practice_trial, practice_feedback],\n  timeline_variables: [\n    {stimulus: `<p>CAT</p>`, correct_key: &quot;f&quot;},\n    {stimulus: `<p>TABLE</p>`, correct_key: &quot;j&quot;},\n    {stimulus: `<p>DOG</p>`, correct_key: &quot;f&quot;},\n    {stimulus: `<p>CHAIR</p>`, correct_key: &quot;j&quot;},\n    {stimulus: `<p>BIRD</p>`, correct_key: &quot;f&quot;},\n    {stimulus: `<p>DESK</p>`, correct_key: &quot;j&quot;}\n  ],\n  randomize_order: true,\n  loop_function: function(data) {\n    // data only contains the previous timeline data. We just need to filter it\n    let trials = data.filter({trial_part: &quot;stimulus&quot;})\n    let correct_trials = trials.filter({correct: true});\n    let accuracy = correct_trials.count() / trials.count();\n    console.log(`Practice accuracy: ${accuracy}`);\n\n    // If accuracy is below 80%, repeat the block\n    if (accuracy < 0.80) {\n         return true;  // Loop again\n      } else {\n         return false; // Move on\n    }\n  }\n};\n\nlet practice_end = {\n  type: jsPsychHtmlKeyboardResponse,\n  stimulus: `<p>Great job finishing the practice block!</p>`,\n  choices: &quot;NO_KEYS&quot;\n}\n\njsPsych.run([\n  welcome, \n  practice_block,\n  practice_end\n])\n\n  </script>\n</html>';
            var newWindow = window.open('', '_blank');
            if (newWindow) {
              newWindow.document.write(htmlContent);
              newWindow.document.close();
            } else {
              alert('Pop-up blocked! Please allow pop-ups for this site.');
            }
          " style="background-color: #28a745; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Open in New Tab</button>
<button onclick="
            var iframe = document.getElementById('demo-iframe-10');
            var srcdoc = iframe.getAttribute('srcdoc');
            iframe.setAttribute('srcdoc', '');
            setTimeout(function() {
              iframe.setAttribute('srcdoc', srcdoc);
            }, 10);
          " style="background-color: #007bff; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Refresh</button>
</div>
</div>
<iframe id="demo-iframe-10" srcdoc="<!DOCTYPE html>
<html>
  <head>
    <title>Live JsPsych Demo</title>
    <script src='https://unpkg.com/jspsych@8.2.2' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-preload@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-instructions@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-survey-text@2.1.0'  crossorigin></script>
        <script src='https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0' crossorigin></script>

    <link href='https://unpkg.com/jspsych@8.2.2/css/jspsych.css' rel='stylesheet' type='text/css' crossorigin />


    <style>
      /* Paused overlay styles */
      #paused-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        font-family: Arial, sans-serif;
      }

      #paused-message {
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        max-width: 300px;
      }

      #paused-message h2 {
        margin-top: 0;
        color: #dc3545;
        font-size: 24px;
      }

      #paused-message p {
        color: #666;
        margin-bottom: 0;
        font-size: 16px;
      }

      .pulse {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
      }
    </style>
  </head>
  <body style='max-height: 300px'>
    <!-- Paused overlay -->
    <div id='paused-overlay'>
      <div id='paused-message'>
        <h2>Demo Paused</h2>
        <p class='pulse'>Click Anywhere to Resume</p>
      </div>
    </div>
  </body>
  <script>
// Initialize jsPsych with interaction tracking and overlay control
const jsPsych = initJsPsych({
  on_interaction_data_update: function(data) {
    const overlay = document.getElementById('paused-overlay');

    if (data.event === 'blur') {
      // User clicked away - pause experiment and show overlay
      jsPsych.pauseExperiment();
      if (overlay) {
        overlay.style.display = 'flex';
      }
    } else if (data.event === 'focus') {
      // User returned - resume experiment and hide overlay
      jsPsych.resumeExperiment();
      if (overlay) {
        overlay.style.display = 'none';
      }
    }
  }
});

// Make the overlay clickable to resume
document.addEventListener('DOMContentLoaded', function() {
  const overlay = document.getElementById('paused-overlay');
  if (overlay) {
    overlay.addEventListener('click', function() {
      // Focus the window and let the interaction handler resume
      window.focus();
    });
  }
});


let welcome = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: `<p>Welcome to the Experiment!</p>
              <p>Press any key to begin.</p>`,
  choices: &quot;ALL_KEYS&quot;, 
  post_trial_gap: 250
}

let practice_trial = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: jsPsych.timelineVariable(&quot;stimulus&quot;),
  prompt: `<p>Categorize the words using &quot;F&quot; or &quot;J&quot;. You must get 80% correct to move on.</p>`,
  choices: [&quot;f&quot;, &quot;j&quot;],
  data: {
    correct_response: jsPsych.timelineVariable(&quot;correct_key&quot;),
    phase: &quot;practice&quot;,
    trial_part: &quot;stimulus&quot;
  },
  on_finish: function(data) {
    data.correct = data.response == data.correct_response;
  }
};

let practice_feedback = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: function() {
    let last_trial = jsPsych.data.get().last(1).values()[0];
    if (last_trial.correct) {
      return `<p style=&quot;color: green;&quot;>Correct!</p>`;
    } else {
      return `<p style=&quot;color: red;&quot;>Incorrect. The correct answer was: ${last_trial.correct_response}</p>`;
    }
  },
  choices: &quot;NO_KEYS&quot;,
  trial_duration: 1000,
  data: {
    phase: &quot;practice&quot;,
    trial_part: &quot;feedback&quot;
  }
};

let practice_block = {
  timeline: [practice_trial, practice_feedback],
  timeline_variables: [
    {stimulus: `<p>CAT</p>`, correct_key: &quot;f&quot;},
    {stimulus: `<p>TABLE</p>`, correct_key: &quot;j&quot;},
    {stimulus: `<p>DOG</p>`, correct_key: &quot;f&quot;},
    {stimulus: `<p>CHAIR</p>`, correct_key: &quot;j&quot;},
    {stimulus: `<p>BIRD</p>`, correct_key: &quot;f&quot;},
    {stimulus: `<p>DESK</p>`, correct_key: &quot;j&quot;}
  ],
  randomize_order: true,
  loop_function: function(data) {
    // data only contains the previous timeline data. We just need to filter it
    let trials = data.filter({trial_part: &quot;stimulus&quot;})
    let correct_trials = trials.filter({correct: true});
    let accuracy = correct_trials.count() / trials.count();
    console.log(`Practice accuracy: ${accuracy}`);

    // If accuracy is below 80%, repeat the block
    if (accuracy < 0.80) {
         return true;  // Loop again
      } else {
         return false; // Move on
    }
  }
};

let practice_end = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: `<p>Great job finishing the practice block!</p>`,
  choices: &quot;NO_KEYS&quot;
}

jsPsych.run([
  welcome, 
  practice_block,
  practice_end
])

  </script>
</html>" width="100%" height="300px" scrolling="yes" style="border: none; display: block;" onload="javascript:(function(iframe){
        var container = document.getElementById(&quot;demo-container-10&quot;);
        var indicator = container.querySelector(&quot;.focus-indicator-10&quot;);

        function showFocus() {
          container.style.boxShadow = &quot;0 0 0 3px #007bff&quot;;
          if (indicator) {
            indicator.textContent = &quot;✓ Demo Active&quot;;
            indicator.style.color = &quot;#28a745&quot;;
          }
        }

        function hideFocus() {
          container.style.boxShadow = &quot;none&quot;;
          if (indicator) {
            indicator.textContent = &quot;Click inside the demo to activate&quot;;
            indicator.style.color = &quot;#6c757d&quot;;
          }
        }

        var iframeWindow = iframe.contentWindow;
        if (iframeWindow) {
          iframeWindow.onfocus = showFocus;
          iframeWindow.onblur = hideFocus;
          iframeWindow.document.addEventListener(&quot;click&quot;, function() {
            iframeWindow.focus();
            showFocus();
          });
          document.addEventListener(&quot;click&quot;, function(e) {
            if (!container.contains(e.target)) {
              iframeWindow.blur();
              hideFocus();
            }
          });
        }
      }(this));"></iframe>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="avoiding-infinite-loops" class="level2" data-number="19.8">
<h2 data-number="19.8" class="anchored" data-anchor-id="avoiding-infinite-loops"><span class="header-section-number">19.8</span> Avoiding Infinite Loops</h2>
<p>One danger with loop functions is creating infinite loops. What if a participant just can’t reach the threshold? We don’t want participants infinitely looping through our experiment. For every looping function we add, we should be including a fallback to prevent an infinite loop.</p>
<p>For the previous example, let’s add a maximum number of attempts before we allow participants to move forward. Now they will complete the practice phase either by reaching our threshold or by hitting the maximum attempts. We could use this later to exclude participants who failed to reach our accuracy threshold, but more importantly, all participants will be able to complete the experiment, even if they don’t reach our threshold.</p>
<p>To accomplish this, we need to keep track of their attempts outside of the jsPsych trials. We can do that by creating variables outside the trial and updating them inside the trial.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">index.html</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">exp.js</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-3" role="tab" aria-controls="tabset-11-3" aria-selected="false">style.css</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-4" role="tab" aria-controls="tabset-11-4" aria-selected="false">Result</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="sourceCode" id="cb53"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb53-1"><a href="#cb53-1"></a> <span class="dt">&lt;!DOCTYPE</span> html<span class="dt">&gt;</span></span>
<span id="cb53-2"><a href="#cb53-2"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb53-3"><a href="#cb53-3"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb53-4"><a href="#cb53-4"></a>    <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>Demo<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb53-5"><a href="#cb53-5"></a>    <span class="co">&lt;!-- jsPsych --&gt;</span></span>
<span id="cb53-6"><a href="#cb53-6"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/jspsych.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb53-7"><a href="#cb53-7"></a>    <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> href</span><span class="op">=</span><span class="st">"jspsych/jspsych.css"</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text/css"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb53-8"><a href="#cb53-8"></a>    </span>
<span id="cb53-9"><a href="#cb53-9"></a>    <span class="co">&lt;!-- jPsych plugins --&gt;</span></span>
<span id="cb53-10"><a href="#cb53-10"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/plugin-html-keyboard-response.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb53-11"><a href="#cb53-11"></a></span>
<span id="cb53-12"><a href="#cb53-12"></a>    <span class="co">&lt;!-- custom CSS --&gt;</span></span>
<span id="cb53-13"><a href="#cb53-13"></a>     <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> href</span><span class="op">=</span><span class="st">"style.css"</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text/css"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb53-14"><a href="#cb53-14"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb53-15"><a href="#cb53-15"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb53-16"><a href="#cb53-16"></a>  <span class="co">&lt;!-- custom JS --&gt;</span></span>
<span id="cb53-17"><a href="#cb53-17"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"exp.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb53-18"><a href="#cb53-18"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb53-19"><a href="#cb53-19"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb53-20"><a href="#cb53-20"></a> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="sourceCode" id="cb54"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb54-1"><a href="#cb54-1"></a> </span>
<span id="cb54-2"><a href="#cb54-2"></a><span class="kw">const</span> jsPsych <span class="op">=</span> <span class="fu">initJsPsych</span>()<span class="op">;</span></span>
<span id="cb54-3"><a href="#cb54-3"></a></span>
<span id="cb54-4"><a href="#cb54-4"></a> </span>
<span id="cb54-5"><a href="#cb54-5"></a><span class="co">// variables for tracking practice attempts</span></span>
<span id="cb54-6"><a href="#cb54-6"></a><span class="kw">let</span> practice_attempts <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb54-7"><a href="#cb54-7"></a><span class="kw">const</span> MAX_PRACTICE_ATTEMPTS <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb54-8"><a href="#cb54-8"></a></span>
<span id="cb54-9"><a href="#cb54-9"></a><span class="kw">let</span> welcome <span class="op">=</span> {</span>
<span id="cb54-10"><a href="#cb54-10"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb54-11"><a href="#cb54-11"></a>  <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;Welcome to the Experiment!&lt;/p&gt;</span></span>
<span id="cb54-12"><a href="#cb54-12"></a><span class="vs">              &lt;p&gt;Press any key to begin.&lt;/p&gt;`</span><span class="op">,</span></span>
<span id="cb54-13"><a href="#cb54-13"></a>  <span class="dt">choices</span><span class="op">:</span> <span class="st">"ALL_KEYS"</span><span class="op">,</span> </span>
<span id="cb54-14"><a href="#cb54-14"></a>  <span class="dt">post_trial_gap</span><span class="op">:</span> <span class="dv">250</span></span>
<span id="cb54-15"><a href="#cb54-15"></a>}</span>
<span id="cb54-16"><a href="#cb54-16"></a></span>
<span id="cb54-17"><a href="#cb54-17"></a><span class="kw">let</span> practice_trial <span class="op">=</span> {</span>
<span id="cb54-18"><a href="#cb54-18"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb54-19"><a href="#cb54-19"></a>  <span class="dt">stimulus</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">"stimulus"</span>)<span class="op">,</span></span>
<span id="cb54-20"><a href="#cb54-20"></a>  <span class="dt">prompt</span><span class="op">:</span> <span class="vs">`&lt;p&gt;Categorize the words using "F" or "J". You must get 80% correct to move on.&lt;/p&gt;`</span><span class="op">,</span></span>
<span id="cb54-21"><a href="#cb54-21"></a>  <span class="dt">choices</span><span class="op">:</span> [<span class="st">"f"</span><span class="op">,</span> <span class="st">"j"</span>]<span class="op">,</span></span>
<span id="cb54-22"><a href="#cb54-22"></a>  <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb54-23"><a href="#cb54-23"></a>    <span class="dt">correct_response</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">"correct_key"</span>)<span class="op">,</span></span>
<span id="cb54-24"><a href="#cb54-24"></a>    <span class="dt">phase</span><span class="op">:</span> <span class="st">"practice"</span><span class="op">,</span></span>
<span id="cb54-25"><a href="#cb54-25"></a>    <span class="dt">trial_part</span><span class="op">:</span> <span class="st">"stimulus"</span></span>
<span id="cb54-26"><a href="#cb54-26"></a>  }<span class="op">,</span></span>
<span id="cb54-27"><a href="#cb54-27"></a>  <span class="dt">on_finish</span><span class="op">:</span> <span class="kw">function</span>(data) {</span>
<span id="cb54-28"><a href="#cb54-28"></a>    data<span class="op">.</span><span class="at">correct</span> <span class="op">=</span> data<span class="op">.</span><span class="at">response</span> <span class="op">==</span> data<span class="op">.</span><span class="at">correct_response</span><span class="op">;</span></span>
<span id="cb54-29"><a href="#cb54-29"></a>  }</span>
<span id="cb54-30"><a href="#cb54-30"></a>}<span class="op">;</span></span>
<span id="cb54-31"><a href="#cb54-31"></a></span>
<span id="cb54-32"><a href="#cb54-32"></a><span class="kw">let</span> practice_feedback <span class="op">=</span> {</span>
<span id="cb54-33"><a href="#cb54-33"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb54-34"><a href="#cb54-34"></a>  <span class="dt">stimulus</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb54-35"><a href="#cb54-35"></a>    <span class="kw">let</span> last_trial <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">last</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">values</span>()[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb54-36"><a href="#cb54-36"></a>    <span class="cf">if</span> (last_trial<span class="op">.</span><span class="at">correct</span>) {</span>
<span id="cb54-37"><a href="#cb54-37"></a>      <span class="cf">return</span> <span class="vs">`&lt;p style="color: green;"&gt;Correct!&lt;/p&gt;`</span><span class="op">;</span></span>
<span id="cb54-38"><a href="#cb54-38"></a>    } <span class="cf">else</span> {</span>
<span id="cb54-39"><a href="#cb54-39"></a>      <span class="cf">return</span> <span class="vs">`&lt;p style="color: red;"&gt;Incorrect. The correct answer was: </span><span class="sc">${</span>last_trial<span class="op">.</span><span class="at">correct_response</span><span class="sc">}</span><span class="vs">&lt;/p&gt;`</span><span class="op">;</span></span>
<span id="cb54-40"><a href="#cb54-40"></a>    }</span>
<span id="cb54-41"><a href="#cb54-41"></a>  }<span class="op">,</span></span>
<span id="cb54-42"><a href="#cb54-42"></a>  <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span><span class="op">,</span></span>
<span id="cb54-43"><a href="#cb54-43"></a>  <span class="dt">trial_duration</span><span class="op">:</span> <span class="dv">1000</span><span class="op">,</span></span>
<span id="cb54-44"><a href="#cb54-44"></a>  <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb54-45"><a href="#cb54-45"></a>    <span class="dt">phase</span><span class="op">:</span> <span class="st">"practice"</span><span class="op">,</span></span>
<span id="cb54-46"><a href="#cb54-46"></a>    <span class="dt">trial_part</span><span class="op">:</span> <span class="st">"feedback"</span></span>
<span id="cb54-47"><a href="#cb54-47"></a>  }</span>
<span id="cb54-48"><a href="#cb54-48"></a>}<span class="op">;</span></span>
<span id="cb54-49"><a href="#cb54-49"></a></span>
<span id="cb54-50"><a href="#cb54-50"></a><span class="kw">let</span> practice_block <span class="op">=</span> {</span>
<span id="cb54-51"><a href="#cb54-51"></a>  <span class="dt">timeline</span><span class="op">:</span> [practice_trial<span class="op">,</span> practice_feedback]<span class="op">,</span></span>
<span id="cb54-52"><a href="#cb54-52"></a>  <span class="dt">timeline_variables</span><span class="op">:</span> [</span>
<span id="cb54-53"><a href="#cb54-53"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;CAT&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"f"</span>}<span class="op">,</span></span>
<span id="cb54-54"><a href="#cb54-54"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;TABLE&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"j"</span>}<span class="op">,</span></span>
<span id="cb54-55"><a href="#cb54-55"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;DOG&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"f"</span>}<span class="op">,</span></span>
<span id="cb54-56"><a href="#cb54-56"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;CHAIR&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"j"</span>}<span class="op">,</span></span>
<span id="cb54-57"><a href="#cb54-57"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;BIRD&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"f"</span>}<span class="op">,</span></span>
<span id="cb54-58"><a href="#cb54-58"></a>    {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;DESK&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"j"</span>}</span>
<span id="cb54-59"><a href="#cb54-59"></a>  ]<span class="op">,</span></span>
<span id="cb54-60"><a href="#cb54-60"></a>  <span class="dt">randomize_order</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb54-61"><a href="#cb54-61"></a>  <span class="dt">loop_function</span><span class="op">:</span> <span class="kw">function</span>(data) {</span>
<span id="cb54-62"><a href="#cb54-62"></a>    practice_attempts<span class="op">++;</span>  <span class="co">// Increment attempt counter</span></span>
<span id="cb54-63"><a href="#cb54-63"></a></span>
<span id="cb54-64"><a href="#cb54-64"></a>    <span class="co">// data only contains the previous timeline data. We just need to filter it</span></span>
<span id="cb54-65"><a href="#cb54-65"></a>    <span class="kw">let</span> trials <span class="op">=</span> data<span class="op">.</span><span class="fu">filter</span>({<span class="dt">trial_part</span><span class="op">:</span> <span class="st">"stimulus"</span>})</span>
<span id="cb54-66"><a href="#cb54-66"></a>    <span class="kw">let</span> correct_trials <span class="op">=</span> trials<span class="op">.</span><span class="fu">filter</span>({<span class="dt">correct</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span></span>
<span id="cb54-67"><a href="#cb54-67"></a>    <span class="kw">let</span> accuracy <span class="op">=</span> correct_trials<span class="op">.</span><span class="fu">count</span>() <span class="op">/</span> trials<span class="op">.</span><span class="fu">count</span>()<span class="op">;</span></span>
<span id="cb54-68"><a href="#cb54-68"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`Practice accuracy: </span><span class="sc">${</span>accuracy<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb54-69"><a href="#cb54-69"></a></span>
<span id="cb54-70"><a href="#cb54-70"></a>    <span class="co">// Stop if they reached the threshold OR hit max attempts</span></span>
<span id="cb54-71"><a href="#cb54-71"></a>    <span class="cf">if</span> (accuracy <span class="op">&gt;=</span> <span class="fl">0.80</span> <span class="op">||</span> practice_attempts <span class="op">&gt;=</span> MAX_PRACTICE_ATTEMPTS) {</span>
<span id="cb54-72"><a href="#cb54-72"></a>      <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span>  <span class="co">// Stop looping</span></span>
<span id="cb54-73"><a href="#cb54-73"></a>    } <span class="cf">else</span> {</span>
<span id="cb54-74"><a href="#cb54-74"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span>   <span class="co">// Keep practicing</span></span>
<span id="cb54-75"><a href="#cb54-75"></a>    }</span>
<span id="cb54-76"><a href="#cb54-76"></a>  }</span>
<span id="cb54-77"><a href="#cb54-77"></a>}<span class="op">;</span></span>
<span id="cb54-78"><a href="#cb54-78"></a></span>
<span id="cb54-79"><a href="#cb54-79"></a><span class="kw">let</span> practice_end <span class="op">=</span> {</span>
<span id="cb54-80"><a href="#cb54-80"></a>  <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb54-81"><a href="#cb54-81"></a>  <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;Great job finishing the practice block!&lt;/p&gt;`</span><span class="op">,</span></span>
<span id="cb54-82"><a href="#cb54-82"></a>  <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span></span>
<span id="cb54-83"><a href="#cb54-83"></a>}</span>
<span id="cb54-84"><a href="#cb54-84"></a></span>
<span id="cb54-85"><a href="#cb54-85"></a>jsPsych<span class="op">.</span><span class="fu">run</span>([</span>
<span id="cb54-86"><a href="#cb54-86"></a>  welcome<span class="op">,</span> </span>
<span id="cb54-87"><a href="#cb54-87"></a>  practice_block<span class="op">,</span></span>
<span id="cb54-88"><a href="#cb54-88"></a>  practice_end</span>
<span id="cb54-89"><a href="#cb54-89"></a>])</span>
<span id="cb54-90"><a href="#cb54-90"></a> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-11-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-3-tab">
<div class="sourceCode" id="cb55"><pre class="sourceCode numberSource css number-lines code-with-copy"><code class="sourceCode css"><span id="cb55-1"><a href="#cb55-1"></a>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-11-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-4-tab">
<div id="demo-container-11" style="border: 1px solid #ddd; border-radius: 8px; overflow: hidden; transition: box-shadow 0.2s ease;">
<div style="background-color: #f8f9fa; padding: 8px 12px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center;">
<div>
<span style="font-weight: bold; color: #495057;">Live JsPsych Demo</span>
<span class="focus-indicator-11" style="margin-left: 10px; font-size: 11px; color: #6c757d; font-style: italic;">Click inside the demo to activate demo</span>
</div>
<div style="display: flex; gap: 8px;">
<button onclick="
            console.log('Full screen button clicked');
            var htmlContent = '<!DOCTYPE html>\n<html>\n  <head>\n    <title>Live JsPsych Demo</title>\n    <script src=\'https://unpkg.com/jspsych@8.2.2\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-preload@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-instructions@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-survey-text@2.1.0\'  crossorigin></script>\n        <script src=\'https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0\' crossorigin></script>\n\n    <link href=\'https://unpkg.com/jspsych@8.2.2/css/jspsych.css\' rel=\'stylesheet\' type=\'text/css\' crossorigin />\n\n\n    <style>\n      /* Paused overlay styles */\n      #paused-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-color: rgba(0, 0, 0, 0.7);\n        display: none;\n        justify-content: center;\n        align-items: center;\n        z-index: 9999;\n        font-family: Arial, sans-serif;\n      }\n\n      #paused-message {\n        background-color: white;\n        padding: 30px;\n        border-radius: 10px;\n        text-align: center;\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n        max-width: 300px;\n      }\n\n      #paused-message h2 {\n        margin-top: 0;\n        color: #dc3545;\n        font-size: 24px;\n      }\n\n      #paused-message p {\n        color: #666;\n        margin-bottom: 0;\n        font-size: 16px;\n      }\n\n      .pulse {\n        animation: pulse 2s infinite;\n      }\n\n      @keyframes pulse {\n        0% { opacity: 1; }\n        50% { opacity: 0.5; }\n        100% { opacity: 1; }\n      }\n    </style>\n  </head>\n  <body>\n    <!-- Paused overlay -->\n    <div id=\'paused-overlay\'>\n      <div id=\'paused-message\'>\n        <h2>Demo Paused</h2>\n        <p class=\'pulse\'>Click Anywhere to Resume</p>\n      </div>\n    </div>\n  </body>\n  <script>\n// Initialize jsPsych with interaction tracking and overlay control\nconst jsPsych = initJsPsych({\n  on_interaction_data_update: function(data) {\n    const overlay = document.getElementById(\'paused-overlay\');\n\n    if (data.event === \'blur\') {\n      // User clicked away - pause experiment and show overlay\n      jsPsych.pauseExperiment();\n      if (overlay) {\n        overlay.style.display = \'flex\';\n      }\n    } else if (data.event === \'focus\') {\n      // User returned - resume experiment and hide overlay\n      jsPsych.resumeExperiment();\n      if (overlay) {\n        overlay.style.display = \'none\';\n      }\n    }\n  }\n});\n\n// Make the overlay clickable to resume\ndocument.addEventListener(\'DOMContentLoaded\', function() {\n  const overlay = document.getElementById(\'paused-overlay\');\n  if (overlay) {\n    overlay.addEventListener(\'click\', function() {\n      // Focus the window and let the interaction handler resume\n      window.focus();\n    });\n  }\n});\n\n\n// variables for tracking practice attempts\nlet practice_attempts = 0;\nconst MAX_PRACTICE_ATTEMPTS = 3;\n\nlet welcome = {\n  type: jsPsychHtmlKeyboardResponse,\n  stimulus: `<p>Welcome to the Experiment!</p>\n              <p>Press any key to begin.</p>`,\n  choices: &quot;ALL_KEYS&quot;, \n  post_trial_gap: 250\n}\n\nlet practice_trial = {\n  type: jsPsychHtmlKeyboardResponse,\n  stimulus: jsPsych.timelineVariable(&quot;stimulus&quot;),\n  prompt: `<p>Categorize the words using &quot;F&quot; or &quot;J&quot;. You must get 80% correct to move on.</p>`,\n  choices: [&quot;f&quot;, &quot;j&quot;],\n  data: {\n    correct_response: jsPsych.timelineVariable(&quot;correct_key&quot;),\n    phase: &quot;practice&quot;,\n    trial_part: &quot;stimulus&quot;\n  },\n  on_finish: function(data) {\n    data.correct = data.response == data.correct_response;\n  }\n};\n\nlet practice_feedback = {\n  type: jsPsychHtmlKeyboardResponse,\n  stimulus: function() {\n    let last_trial = jsPsych.data.get().last(1).values()[0];\n    if (last_trial.correct) {\n      return `<p style=&quot;color: green;&quot;>Correct!</p>`;\n    } else {\n      return `<p style=&quot;color: red;&quot;>Incorrect. The correct answer was: ${last_trial.correct_response}</p>`;\n    }\n  },\n  choices: &quot;NO_KEYS&quot;,\n  trial_duration: 1000,\n  data: {\n    phase: &quot;practice&quot;,\n    trial_part: &quot;feedback&quot;\n  }\n};\n\nlet practice_block = {\n  timeline: [practice_trial, practice_feedback],\n  timeline_variables: [\n    {stimulus: `<p>CAT</p>`, correct_key: &quot;f&quot;},\n    {stimulus: `<p>TABLE</p>`, correct_key: &quot;j&quot;},\n    {stimulus: `<p>DOG</p>`, correct_key: &quot;f&quot;},\n    {stimulus: `<p>CHAIR</p>`, correct_key: &quot;j&quot;},\n    {stimulus: `<p>BIRD</p>`, correct_key: &quot;f&quot;},\n    {stimulus: `<p>DESK</p>`, correct_key: &quot;j&quot;}\n  ],\n  randomize_order: true,\n  loop_function: function(data) {\n    practice_attempts++;  // Increment attempt counter\n\n    // data only contains the previous timeline data. We just need to filter it\n    let trials = data.filter({trial_part: &quot;stimulus&quot;})\n    let correct_trials = trials.filter({correct: true});\n    let accuracy = correct_trials.count() / trials.count();\n    console.log(`Practice accuracy: ${accuracy}`);\n\n    // Stop if they reached the threshold OR hit max attempts\n    if (accuracy >= 0.80 || practice_attempts >= MAX_PRACTICE_ATTEMPTS) {\n      return false;  // Stop looping\n    } else {\n      return true;   // Keep practicing\n    }\n  }\n};\n\nlet practice_end = {\n  type: jsPsychHtmlKeyboardResponse,\n  stimulus: `<p>Great job finishing the practice block!</p>`,\n  choices: &quot;NO_KEYS&quot;\n}\n\njsPsych.run([\n  welcome, \n  practice_block,\n  practice_end\n])\n\n  </script>\n</html>';
            var newWindow = window.open('', '_blank');
            if (newWindow) {
              newWindow.document.write(htmlContent);
              newWindow.document.close();
            } else {
              alert('Pop-up blocked! Please allow pop-ups for this site.');
            }
          " style="background-color: #28a745; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Open in New Tab</button>
<button onclick="
            var iframe = document.getElementById('demo-iframe-11');
            var srcdoc = iframe.getAttribute('srcdoc');
            iframe.setAttribute('srcdoc', '');
            setTimeout(function() {
              iframe.setAttribute('srcdoc', srcdoc);
            }, 10);
          " style="background-color: #007bff; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Refresh</button>
</div>
</div>
<iframe id="demo-iframe-11" srcdoc="<!DOCTYPE html>
<html>
  <head>
    <title>Live JsPsych Demo</title>
    <script src='https://unpkg.com/jspsych@8.2.2' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-preload@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-instructions@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-survey-text@2.1.0'  crossorigin></script>
        <script src='https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0' crossorigin></script>

    <link href='https://unpkg.com/jspsych@8.2.2/css/jspsych.css' rel='stylesheet' type='text/css' crossorigin />


    <style>
      /* Paused overlay styles */
      #paused-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        font-family: Arial, sans-serif;
      }

      #paused-message {
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        max-width: 300px;
      }

      #paused-message h2 {
        margin-top: 0;
        color: #dc3545;
        font-size: 24px;
      }

      #paused-message p {
        color: #666;
        margin-bottom: 0;
        font-size: 16px;
      }

      .pulse {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
      }
    </style>
  </head>
  <body style='max-height: 300px'>
    <!-- Paused overlay -->
    <div id='paused-overlay'>
      <div id='paused-message'>
        <h2>Demo Paused</h2>
        <p class='pulse'>Click Anywhere to Resume</p>
      </div>
    </div>
  </body>
  <script>
// Initialize jsPsych with interaction tracking and overlay control
const jsPsych = initJsPsych({
  on_interaction_data_update: function(data) {
    const overlay = document.getElementById('paused-overlay');

    if (data.event === 'blur') {
      // User clicked away - pause experiment and show overlay
      jsPsych.pauseExperiment();
      if (overlay) {
        overlay.style.display = 'flex';
      }
    } else if (data.event === 'focus') {
      // User returned - resume experiment and hide overlay
      jsPsych.resumeExperiment();
      if (overlay) {
        overlay.style.display = 'none';
      }
    }
  }
});

// Make the overlay clickable to resume
document.addEventListener('DOMContentLoaded', function() {
  const overlay = document.getElementById('paused-overlay');
  if (overlay) {
    overlay.addEventListener('click', function() {
      // Focus the window and let the interaction handler resume
      window.focus();
    });
  }
});


// variables for tracking practice attempts
let practice_attempts = 0;
const MAX_PRACTICE_ATTEMPTS = 3;

let welcome = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: `<p>Welcome to the Experiment!</p>
              <p>Press any key to begin.</p>`,
  choices: &quot;ALL_KEYS&quot;, 
  post_trial_gap: 250
}

let practice_trial = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: jsPsych.timelineVariable(&quot;stimulus&quot;),
  prompt: `<p>Categorize the words using &quot;F&quot; or &quot;J&quot;. You must get 80% correct to move on.</p>`,
  choices: [&quot;f&quot;, &quot;j&quot;],
  data: {
    correct_response: jsPsych.timelineVariable(&quot;correct_key&quot;),
    phase: &quot;practice&quot;,
    trial_part: &quot;stimulus&quot;
  },
  on_finish: function(data) {
    data.correct = data.response == data.correct_response;
  }
};

let practice_feedback = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: function() {
    let last_trial = jsPsych.data.get().last(1).values()[0];
    if (last_trial.correct) {
      return `<p style=&quot;color: green;&quot;>Correct!</p>`;
    } else {
      return `<p style=&quot;color: red;&quot;>Incorrect. The correct answer was: ${last_trial.correct_response}</p>`;
    }
  },
  choices: &quot;NO_KEYS&quot;,
  trial_duration: 1000,
  data: {
    phase: &quot;practice&quot;,
    trial_part: &quot;feedback&quot;
  }
};

let practice_block = {
  timeline: [practice_trial, practice_feedback],
  timeline_variables: [
    {stimulus: `<p>CAT</p>`, correct_key: &quot;f&quot;},
    {stimulus: `<p>TABLE</p>`, correct_key: &quot;j&quot;},
    {stimulus: `<p>DOG</p>`, correct_key: &quot;f&quot;},
    {stimulus: `<p>CHAIR</p>`, correct_key: &quot;j&quot;},
    {stimulus: `<p>BIRD</p>`, correct_key: &quot;f&quot;},
    {stimulus: `<p>DESK</p>`, correct_key: &quot;j&quot;}
  ],
  randomize_order: true,
  loop_function: function(data) {
    practice_attempts++;  // Increment attempt counter

    // data only contains the previous timeline data. We just need to filter it
    let trials = data.filter({trial_part: &quot;stimulus&quot;})
    let correct_trials = trials.filter({correct: true});
    let accuracy = correct_trials.count() / trials.count();
    console.log(`Practice accuracy: ${accuracy}`);

    // Stop if they reached the threshold OR hit max attempts
    if (accuracy >= 0.80 || practice_attempts >= MAX_PRACTICE_ATTEMPTS) {
      return false;  // Stop looping
    } else {
      return true;   // Keep practicing
    }
  }
};

let practice_end = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: `<p>Great job finishing the practice block!</p>`,
  choices: &quot;NO_KEYS&quot;
}

jsPsych.run([
  welcome, 
  practice_block,
  practice_end
])

  </script>
</html>" width="100%" height="300px" scrolling="yes" style="border: none; display: block;" onload="javascript:(function(iframe){
        var container = document.getElementById(&quot;demo-container-11&quot;);
        var indicator = container.querySelector(&quot;.focus-indicator-11&quot;);

        function showFocus() {
          container.style.boxShadow = &quot;0 0 0 3px #007bff&quot;;
          if (indicator) {
            indicator.textContent = &quot;✓ Demo Active&quot;;
            indicator.style.color = &quot;#28a745&quot;;
          }
        }

        function hideFocus() {
          container.style.boxShadow = &quot;none&quot;;
          if (indicator) {
            indicator.textContent = &quot;Click inside the demo to activate&quot;;
            indicator.style.color = &quot;#6c757d&quot;;
          }
        }

        var iframeWindow = iframe.contentWindow;
        if (iframeWindow) {
          iframeWindow.onfocus = showFocus;
          iframeWindow.onblur = hideFocus;
          iframeWindow.document.addEventListener(&quot;click&quot;, function() {
            iframeWindow.focus();
            showFocus();
          });
          document.addEventListener(&quot;click&quot;, function(e) {
            if (!container.contains(e.target)) {
              iframeWindow.blur();
              hideFocus();
            }
          });
        }
      }(this));"></iframe>
</div>
</div>
</div>
</div>
</section>
<section id="combining-conditional-and-loop-logic" class="level2" data-number="19.9">
<h2 data-number="19.9" class="anchored" data-anchor-id="combining-conditional-and-loop-logic"><span class="header-section-number">19.9</span> Combining Conditional and Loop Logic</h2>
<p>The real power comes from combining conditional functions and loop functions to create sophisticated experimental designs. Let’s build a complete example that uses both.</p>
<section id="example-adaptive-practice-with-warnings" class="level3" data-number="19.9.1">
<h3 data-number="19.9.1" class="anchored" data-anchor-id="example-adaptive-practice-with-warnings"><span class="header-section-number">19.9.1</span> Example: Adaptive Practice with Warnings</h3>
<p>Imagine we want to:</p>
<ol type="1">
<li>Show warnings if participants miss too many trials in a row</li>
<li>Repeat practice until they reach 80% accuracy</li>
<li>Give up after 3 attempts</li>
<li>Show different feedback depending on why practice ended</li>
</ol>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">index.html</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">exp.js</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-3" role="tab" aria-controls="tabset-12-3" aria-selected="false">style.css</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-4" role="tab" aria-controls="tabset-12-4" aria-selected="false">Result</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="sourceCode" id="cb56"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb56-1"><a href="#cb56-1"></a> <span class="dt">&lt;!DOCTYPE</span> html<span class="dt">&gt;</span></span>
<span id="cb56-2"><a href="#cb56-2"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb56-3"><a href="#cb56-3"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb56-4"><a href="#cb56-4"></a>    <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>Demo<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb56-5"><a href="#cb56-5"></a>    <span class="co">&lt;!-- jsPsych --&gt;</span></span>
<span id="cb56-6"><a href="#cb56-6"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/jspsych.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb56-7"><a href="#cb56-7"></a>    <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> href</span><span class="op">=</span><span class="st">"jspsych/jspsych.css"</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text/css"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb56-8"><a href="#cb56-8"></a>    </span>
<span id="cb56-9"><a href="#cb56-9"></a>    <span class="co">&lt;!-- jPsych plugins --&gt;</span></span>
<span id="cb56-10"><a href="#cb56-10"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"jspsych/plugin-html-keyboard-response.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb56-11"><a href="#cb56-11"></a></span>
<span id="cb56-12"><a href="#cb56-12"></a>    <span class="co">&lt;!-- custom CSS --&gt;</span></span>
<span id="cb56-13"><a href="#cb56-13"></a>     <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> href</span><span class="op">=</span><span class="st">"style.css"</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"text/css"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb56-14"><a href="#cb56-14"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb56-15"><a href="#cb56-15"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb56-16"><a href="#cb56-16"></a>  <span class="co">&lt;!-- custom JS --&gt;</span></span>
<span id="cb56-17"><a href="#cb56-17"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">"exp.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb56-18"><a href="#cb56-18"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb56-19"><a href="#cb56-19"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb56-20"><a href="#cb56-20"></a> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="sourceCode" id="cb57"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb57-1"><a href="#cb57-1"></a> <span class="co">// ============================================</span></span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="co">// Initiate jsPsych</span></span>
<span id="cb57-3"><a href="#cb57-3"></a><span class="co">// ============================================</span></span>
<span id="cb57-4"><a href="#cb57-4"></a><span class="kw">const</span> jsPsych <span class="op">=</span> <span class="fu">initJsPsych</span>()<span class="op">;</span></span>
<span id="cb57-5"><a href="#cb57-5"></a> </span>
<span id="cb57-6"><a href="#cb57-6"></a><span class="co">// ============================================</span></span>
<span id="cb57-7"><a href="#cb57-7"></a><span class="co">// Instructions</span></span>
<span id="cb57-8"><a href="#cb57-8"></a><span class="co">// ============================================</span></span>
<span id="cb57-9"><a href="#cb57-9"></a></span>
<span id="cb57-10"><a href="#cb57-10"></a><span class="kw">let</span> welcome <span class="op">=</span> {</span>
<span id="cb57-11"><a href="#cb57-11"></a>    <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb57-12"><a href="#cb57-12"></a>    <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;Welcome to the Experiment!&lt;/p&gt;</span></span>
<span id="cb57-13"><a href="#cb57-13"></a><span class="vs">              &lt;p&gt;Press any key to begin.&lt;/p&gt;`</span><span class="op">,</span></span>
<span id="cb57-14"><a href="#cb57-14"></a>    <span class="dt">choices</span><span class="op">:</span> <span class="st">"ALL_KEYS"</span><span class="op">,</span></span>
<span id="cb57-15"><a href="#cb57-15"></a>    <span class="dt">post_trial_gap</span><span class="op">:</span> <span class="dv">250</span></span>
<span id="cb57-16"><a href="#cb57-16"></a>}</span>
<span id="cb57-17"><a href="#cb57-17"></a></span>
<span id="cb57-18"><a href="#cb57-18"></a><span class="kw">let</span> end_practice <span class="op">=</span> {</span>
<span id="cb57-19"><a href="#cb57-19"></a>    <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb57-20"><a href="#cb57-20"></a>    <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;You are finished the experiment.&lt;/p&gt;`</span><span class="op">,</span></span>
<span id="cb57-21"><a href="#cb57-21"></a>    <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span><span class="op">,</span></span>
<span id="cb57-22"><a href="#cb57-22"></a>    <span class="dt">post_trial_gap</span><span class="op">:</span> <span class="dv">250</span></span>
<span id="cb57-23"><a href="#cb57-23"></a>}</span>
<span id="cb57-24"><a href="#cb57-24"></a></span>
<span id="cb57-25"><a href="#cb57-25"></a><span class="co">// ============================================</span></span>
<span id="cb57-26"><a href="#cb57-26"></a><span class="co">// Practice Trials</span></span>
<span id="cb57-27"><a href="#cb57-27"></a><span class="co">// ============================================</span></span>
<span id="cb57-28"><a href="#cb57-28"></a></span>
<span id="cb57-29"><a href="#cb57-29"></a><span class="co">// variables to track performance</span></span>
<span id="cb57-30"><a href="#cb57-30"></a><span class="kw">let</span> missed_in_a_row <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb57-31"><a href="#cb57-31"></a><span class="kw">let</span> practice_attempts <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb57-32"><a href="#cb57-32"></a><span class="kw">const</span> MAX_PRACTICE_ATTEMPTS <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb57-33"><a href="#cb57-33"></a></span>
<span id="cb57-34"><a href="#cb57-34"></a><span class="co">// practice trial</span></span>
<span id="cb57-35"><a href="#cb57-35"></a><span class="kw">let</span> practice_trial <span class="op">=</span> {</span>
<span id="cb57-36"><a href="#cb57-36"></a>    <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb57-37"><a href="#cb57-37"></a>    <span class="dt">stimulus</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">"stimulus"</span>)<span class="op">,</span></span>
<span id="cb57-38"><a href="#cb57-38"></a>    <span class="dt">choices</span><span class="op">:</span> [<span class="st">"f"</span><span class="op">,</span> <span class="st">"j"</span>]<span class="op">,</span></span>
<span id="cb57-39"><a href="#cb57-39"></a>    <span class="dt">trial_duration</span><span class="op">:</span> <span class="dv">1500</span><span class="op">,</span></span>
<span id="cb57-40"><a href="#cb57-40"></a>    <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb57-41"><a href="#cb57-41"></a>        <span class="dt">correct_response</span><span class="op">:</span> jsPsych<span class="op">.</span><span class="fu">timelineVariable</span>(<span class="st">"correct_key"</span>)<span class="op">,</span></span>
<span id="cb57-42"><a href="#cb57-42"></a>        <span class="dt">phase</span><span class="op">:</span> <span class="st">"practice trial"</span></span>
<span id="cb57-43"><a href="#cb57-43"></a>    }<span class="op">,</span></span>
<span id="cb57-44"><a href="#cb57-44"></a>    <span class="dt">on_finish</span><span class="op">:</span> <span class="kw">function</span>(data) {</span>
<span id="cb57-45"><a href="#cb57-45"></a>        data<span class="op">.</span><span class="at">correct</span> <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">pluginAPI</span><span class="op">.</span><span class="fu">compareKeys</span>(data<span class="op">.</span><span class="at">response</span><span class="op">,</span> data<span class="op">.</span><span class="at">correct_response</span>)<span class="op">;</span></span>
<span id="cb57-46"><a href="#cb57-46"></a></span>
<span id="cb57-47"><a href="#cb57-47"></a>        <span class="co">// Track missed trials</span></span>
<span id="cb57-48"><a href="#cb57-48"></a>        <span class="cf">if</span> (data<span class="op">.</span><span class="at">response</span> <span class="op">===</span> <span class="kw">null</span>) {</span>
<span id="cb57-49"><a href="#cb57-49"></a>            data<span class="op">.</span><span class="at">miss</span> <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb57-50"><a href="#cb57-50"></a>            missed_in_a_row<span class="op">++;</span></span>
<span id="cb57-51"><a href="#cb57-51"></a>        } <span class="cf">else</span> {</span>
<span id="cb57-52"><a href="#cb57-52"></a>            data<span class="op">.</span><span class="at">miss</span> <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb57-53"><a href="#cb57-53"></a>            missed_in_a_row <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>  <span class="co">// Reset if they responded</span></span>
<span id="cb57-54"><a href="#cb57-54"></a>        }</span>
<span id="cb57-55"><a href="#cb57-55"></a>    }</span>
<span id="cb57-56"><a href="#cb57-56"></a>}<span class="op">;</span></span>
<span id="cb57-57"><a href="#cb57-57"></a></span>
<span id="cb57-58"><a href="#cb57-58"></a><span class="co">// warning display</span></span>
<span id="cb57-59"><a href="#cb57-59"></a><span class="kw">let</span> warning <span class="op">=</span> {</span>
<span id="cb57-60"><a href="#cb57-60"></a>    <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb57-61"><a href="#cb57-61"></a>        {</span>
<span id="cb57-62"><a href="#cb57-62"></a>            <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb57-63"><a href="#cb57-63"></a>            <span class="dt">stimulus</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb57-64"><a href="#cb57-64"></a>                <span class="cf">return</span> <span class="vs">`&lt;p style="color: orange; font-size: 24px;"&gt;</span></span>
<span id="cb57-65"><a href="#cb57-65"></a><span class="vs">                      Please try to respond faster!</span></span>
<span id="cb57-66"><a href="#cb57-66"></a><span class="vs">                 &lt;/p&gt;</span></span>
<span id="cb57-67"><a href="#cb57-67"></a><span class="vs">                 &lt;p&gt;You've missed 3 trials in a row.&lt;/p&gt;</span></span>
<span id="cb57-68"><a href="#cb57-68"></a><span class="vs">                 &lt;p&gt;Press any key to continue.&lt;/p&gt;`</span><span class="op">;</span></span>
<span id="cb57-69"><a href="#cb57-69"></a>            }</span>
<span id="cb57-70"><a href="#cb57-70"></a>        }</span>
<span id="cb57-71"><a href="#cb57-71"></a>    ]<span class="op">,</span></span>
<span id="cb57-72"><a href="#cb57-72"></a>    <span class="dt">conditional_function</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb57-73"><a href="#cb57-73"></a>        <span class="cf">return</span> missed_in_a_row <span class="op">&gt;=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb57-74"><a href="#cb57-74"></a>    }<span class="op">,</span></span>
<span id="cb57-75"><a href="#cb57-75"></a>    <span class="dt">on_finish</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb57-76"><a href="#cb57-76"></a>        missed_in_a_row <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>  <span class="co">// Reset after showing warning</span></span>
<span id="cb57-77"><a href="#cb57-77"></a>    }<span class="op">,</span></span>
<span id="cb57-78"><a href="#cb57-78"></a>    <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb57-79"><a href="#cb57-79"></a>        <span class="dt">phase</span><span class="op">:</span> <span class="st">"practice warning"</span></span>
<span id="cb57-80"><a href="#cb57-80"></a>    }</span>
<span id="cb57-81"><a href="#cb57-81"></a>}<span class="op">;</span></span>
<span id="cb57-82"><a href="#cb57-82"></a></span>
<span id="cb57-83"><a href="#cb57-83"></a><span class="co">// feedback display</span></span>
<span id="cb57-84"><a href="#cb57-84"></a><span class="kw">let</span> feedback <span class="op">=</span> {</span>
<span id="cb57-85"><a href="#cb57-85"></a>    <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb57-86"><a href="#cb57-86"></a>    <span class="dt">stimulus</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb57-87"><a href="#cb57-87"></a>        <span class="kw">let</span> last_trial <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">last</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">values</span>()[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb57-88"><a href="#cb57-88"></a>        <span class="cf">if</span> (last_trial<span class="op">.</span><span class="at">response</span> <span class="op">===</span> <span class="kw">null</span>) {</span>
<span id="cb57-89"><a href="#cb57-89"></a>            <span class="cf">return</span> <span class="vs">`&lt;p style="color: orange;"&gt;Too slow!&lt;/p&gt;`</span><span class="op">;</span></span>
<span id="cb57-90"><a href="#cb57-90"></a>        } <span class="cf">else</span> <span class="cf">if</span> (last_trial<span class="op">.</span><span class="at">correct</span>) {</span>
<span id="cb57-91"><a href="#cb57-91"></a>            <span class="cf">return</span> <span class="vs">`&lt;p style="color: green;"&gt;Correct!&lt;/p&gt;`</span><span class="op">;</span></span>
<span id="cb57-92"><a href="#cb57-92"></a>        } <span class="cf">else</span> {</span>
<span id="cb57-93"><a href="#cb57-93"></a>            <span class="cf">return</span> <span class="vs">`&lt;p style="color: red;"&gt;Incorrect&lt;/p&gt;`</span><span class="op">;</span></span>
<span id="cb57-94"><a href="#cb57-94"></a>        }</span>
<span id="cb57-95"><a href="#cb57-95"></a>    }<span class="op">,</span></span>
<span id="cb57-96"><a href="#cb57-96"></a>    <span class="dt">choices</span><span class="op">:</span> <span class="st">"NO_KEYS"</span><span class="op">,</span></span>
<span id="cb57-97"><a href="#cb57-97"></a>    <span class="dt">trial_duration</span><span class="op">:</span> <span class="dv">800</span><span class="op">,</span></span>
<span id="cb57-98"><a href="#cb57-98"></a>    <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb57-99"><a href="#cb57-99"></a>        <span class="dt">phase</span><span class="op">:</span> <span class="st">"practice feedback"</span></span>
<span id="cb57-100"><a href="#cb57-100"></a>    }</span>
<span id="cb57-101"><a href="#cb57-101"></a>}<span class="op">;</span></span>
<span id="cb57-102"><a href="#cb57-102"></a></span>
<span id="cb57-103"><a href="#cb57-103"></a><span class="co">// practice block</span></span>
<span id="cb57-104"><a href="#cb57-104"></a><span class="kw">let</span> practice_block <span class="op">=</span> {</span>
<span id="cb57-105"><a href="#cb57-105"></a>    <span class="dt">timeline</span><span class="op">:</span> [practice_trial<span class="op">,</span> feedback<span class="op">,</span> warning]<span class="op">,</span></span>
<span id="cb57-106"><a href="#cb57-106"></a>    <span class="dt">timeline_variables</span><span class="op">:</span> [</span>
<span id="cb57-107"><a href="#cb57-107"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;CAT&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"f"</span>}<span class="op">,</span></span>
<span id="cb57-108"><a href="#cb57-108"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;TABLE&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"j"</span>}<span class="op">,</span></span>
<span id="cb57-109"><a href="#cb57-109"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;DOG&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"f"</span>}<span class="op">,</span></span>
<span id="cb57-110"><a href="#cb57-110"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;CHAIR&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"j"</span>}<span class="op">,</span></span>
<span id="cb57-111"><a href="#cb57-111"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;BIRD&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"f"</span>}<span class="op">,</span></span>
<span id="cb57-112"><a href="#cb57-112"></a>        {<span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;DESK&lt;/p&gt;`</span><span class="op">,</span> <span class="dt">correct_key</span><span class="op">:</span> <span class="st">"j"</span>}</span>
<span id="cb57-113"><a href="#cb57-113"></a>    ]<span class="op">,</span></span>
<span id="cb57-114"><a href="#cb57-114"></a>    <span class="dt">randomize_order</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb57-115"><a href="#cb57-115"></a>    <span class="dt">loop_function</span><span class="op">:</span> <span class="kw">function</span>(data) {</span>
<span id="cb57-116"><a href="#cb57-116"></a>        practice_attempts<span class="op">++;</span></span>
<span id="cb57-117"><a href="#cb57-117"></a>        <span class="kw">let</span> practice_trials <span class="op">=</span> data<span class="op">.</span><span class="fu">filter</span>({<span class="dt">phase</span><span class="op">:</span> <span class="st">"practice trial"</span>})</span>
<span id="cb57-118"><a href="#cb57-118"></a></span>
<span id="cb57-119"><a href="#cb57-119"></a>        <span class="co">// Calculate accuracy (only counting trials where they responded)</span></span>
<span id="cb57-120"><a href="#cb57-120"></a>        <span class="kw">let</span> responded_trials <span class="op">=</span> data<span class="op">.</span><span class="fu">filter</span>({<span class="dt">miss</span><span class="op">:</span> <span class="kw">false</span>})<span class="op">;</span></span>
<span id="cb57-121"><a href="#cb57-121"></a>        <span class="kw">let</span> correct_trials <span class="op">=</span> practice_trials<span class="op">.</span><span class="fu">filter</span>({<span class="dt">correct</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">.</span><span class="fu">count</span>()<span class="op">;</span></span>
<span id="cb57-122"><a href="#cb57-122"></a>        <span class="kw">let</span> accuracy <span class="op">=</span> correct_trials <span class="op">/</span> responded_trials<span class="op">.</span><span class="fu">count</span>()<span class="op">;</span></span>
<span id="cb57-123"><a href="#cb57-123"></a></span>
<span id="cb57-124"><a href="#cb57-124"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`Attempt </span><span class="sc">${</span>practice_attempts<span class="sc">}</span><span class="vs">: </span><span class="sc">${</span><span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(accuracy <span class="op">*</span> <span class="dv">100</span>)<span class="sc">}</span><span class="vs">% accuracy`</span>)<span class="op">;</span></span>
<span id="cb57-125"><a href="#cb57-125"></a></span>
<span id="cb57-126"><a href="#cb57-126"></a>        <span class="co">// Stop if they reached threshold OR hit max attempts</span></span>
<span id="cb57-127"><a href="#cb57-127"></a>        <span class="cf">if</span> (accuracy <span class="op">&gt;=</span> <span class="fl">0.80</span> <span class="op">||</span> practice_attempts <span class="op">&gt;=</span> MAX_PRACTICE_ATTEMPTS) {</span>
<span id="cb57-128"><a href="#cb57-128"></a>            <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb57-129"><a href="#cb57-129"></a>        } <span class="cf">else</span> {</span>
<span id="cb57-130"><a href="#cb57-130"></a>            <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb57-131"><a href="#cb57-131"></a>        }</span>
<span id="cb57-132"><a href="#cb57-132"></a>    }</span>
<span id="cb57-133"><a href="#cb57-133"></a>}<span class="op">;</span></span>
<span id="cb57-134"><a href="#cb57-134"></a></span>
<span id="cb57-135"><a href="#cb57-135"></a></span>
<span id="cb57-136"><a href="#cb57-136"></a><span class="co">// practice success message</span></span>
<span id="cb57-137"><a href="#cb57-137"></a><span class="kw">let</span> practice_success_message <span class="op">=</span> {</span>
<span id="cb57-138"><a href="#cb57-138"></a>    <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb57-139"><a href="#cb57-139"></a>        {</span>
<span id="cb57-140"><a href="#cb57-140"></a>            <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb57-141"><a href="#cb57-141"></a>            <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p style="color: green; font-size: 24px;"&gt;Excellent!&lt;/p&gt;</span></span>
<span id="cb57-142"><a href="#cb57-142"></a><span class="vs">             &lt;p&gt;You're ready for the main task.&lt;/p&gt;</span></span>
<span id="cb57-143"><a href="#cb57-143"></a><span class="vs">             &lt;p&gt;Press the space bar to continue.&lt;/p&gt;`</span><span class="op">,</span></span>
<span id="cb57-144"><a href="#cb57-144"></a>            <span class="dt">choices</span><span class="op">:</span> [<span class="st">" "</span>]</span>
<span id="cb57-145"><a href="#cb57-145"></a>        }</span>
<span id="cb57-146"><a href="#cb57-146"></a>    ]<span class="op">,</span></span>
<span id="cb57-147"><a href="#cb57-147"></a>    <span class="dt">conditional_function</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb57-148"><a href="#cb57-148"></a>        <span class="co">// Check if they passed on their last attempt</span></span>
<span id="cb57-149"><a href="#cb57-149"></a>        <span class="kw">let</span> last_block <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">filter</span>({<span class="dt">phase</span><span class="op">:</span> <span class="st">"practice trial"</span>})<span class="op">.</span><span class="fu">last</span>(<span class="dv">6</span>)<span class="op">;</span></span>
<span id="cb57-150"><a href="#cb57-150"></a>        <span class="kw">let</span> correct <span class="op">=</span> last_block<span class="op">.</span><span class="fu">filter</span>({<span class="dt">correct</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">.</span><span class="fu">count</span>()<span class="op">;</span></span>
<span id="cb57-151"><a href="#cb57-151"></a>        <span class="kw">let</span> total <span class="op">=</span> last_block<span class="op">.</span><span class="fu">count</span>()<span class="op">;</span></span>
<span id="cb57-152"><a href="#cb57-152"></a>        <span class="cf">return</span> (correct <span class="op">/</span> total) <span class="op">&gt;=</span> <span class="fl">0.80</span><span class="op">;</span></span>
<span id="cb57-153"><a href="#cb57-153"></a>    }</span>
<span id="cb57-154"><a href="#cb57-154"></a>}<span class="op">;</span></span>
<span id="cb57-155"><a href="#cb57-155"></a></span>
<span id="cb57-156"><a href="#cb57-156"></a><span class="co">// practice failure message</span></span>
<span id="cb57-157"><a href="#cb57-157"></a><span class="kw">let</span> practice_failure_message <span class="op">=</span> {</span>
<span id="cb57-158"><a href="#cb57-158"></a>    <span class="dt">timeline</span><span class="op">:</span> [</span>
<span id="cb57-159"><a href="#cb57-159"></a>        {</span>
<span id="cb57-160"><a href="#cb57-160"></a>            <span class="dt">type</span><span class="op">:</span> jsPsychHtmlKeyboardResponse<span class="op">,</span></span>
<span id="cb57-161"><a href="#cb57-161"></a>            <span class="dt">stimulus</span><span class="op">:</span> <span class="vs">`&lt;p&gt;You've completed the maximum practice attempts.&lt;/p&gt;</span></span>
<span id="cb57-162"><a href="#cb57-162"></a><span class="vs">             &lt;p&gt;Let's move on to the main task anyway.&lt;/p&gt;</span></span>
<span id="cb57-163"><a href="#cb57-163"></a><span class="vs">             &lt;p&gt;Remember: Press "f" for animals, "j" for furniture.&lt;/p&gt;</span></span>
<span id="cb57-164"><a href="#cb57-164"></a><span class="vs">             &lt;p&gt;Press the space bar to continue.&lt;/p&gt;`</span><span class="op">,</span></span>
<span id="cb57-165"><a href="#cb57-165"></a>            <span class="dt">choices</span><span class="op">:</span> [<span class="st">" "</span>]</span>
<span id="cb57-166"><a href="#cb57-166"></a>        }</span>
<span id="cb57-167"><a href="#cb57-167"></a>    ]<span class="op">,</span></span>
<span id="cb57-168"><a href="#cb57-168"></a>    <span class="dt">conditional_function</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb57-169"><a href="#cb57-169"></a>        <span class="kw">let</span> last_block <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">filter</span>({<span class="dt">phase</span><span class="op">:</span> <span class="st">"practice trial"</span>})<span class="op">.</span><span class="fu">last</span>(<span class="dv">6</span>)<span class="op">;</span></span>
<span id="cb57-170"><a href="#cb57-170"></a>        <span class="kw">let</span> correct <span class="op">=</span> last_block<span class="op">.</span><span class="fu">filter</span>({<span class="dt">correct</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">.</span><span class="fu">count</span>()<span class="op">;</span></span>
<span id="cb57-171"><a href="#cb57-171"></a>        <span class="kw">let</span> total <span class="op">=</span> last_block<span class="op">.</span><span class="fu">count</span>()<span class="op">;</span></span>
<span id="cb57-172"><a href="#cb57-172"></a>        <span class="cf">return</span> (correct <span class="op">/</span> total) <span class="op">&lt;</span> <span class="fl">0.80</span><span class="op">;</span></span>
<span id="cb57-173"><a href="#cb57-173"></a>    }</span>
<span id="cb57-174"><a href="#cb57-174"></a>}<span class="op">;</span></span>
<span id="cb57-175"><a href="#cb57-175"></a></span>
<span id="cb57-176"><a href="#cb57-176"></a><span class="co">// ============================================</span></span>
<span id="cb57-177"><a href="#cb57-177"></a><span class="co">// jsPsych Run</span></span>
<span id="cb57-178"><a href="#cb57-178"></a><span class="co">// ============================================</span></span>
<span id="cb57-179"><a href="#cb57-179"></a></span>
<span id="cb57-180"><a href="#cb57-180"></a>jsPsych<span class="op">.</span><span class="fu">run</span>([</span>
<span id="cb57-181"><a href="#cb57-181"></a>    welcome<span class="op">,</span></span>
<span id="cb57-182"><a href="#cb57-182"></a>    practice_block<span class="op">,</span></span>
<span id="cb57-183"><a href="#cb57-183"></a>    practice_success_message<span class="op">,</span></span>
<span id="cb57-184"><a href="#cb57-184"></a>    practice_failure_message<span class="op">,</span></span>
<span id="cb57-185"><a href="#cb57-185"></a>    end_practice</span>
<span id="cb57-186"><a href="#cb57-186"></a>])<span class="op">;</span></span>
<span id="cb57-187"><a href="#cb57-187"></a> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-12-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-3-tab">
<div class="sourceCode" id="cb58"><pre class="sourceCode numberSource css number-lines code-with-copy"><code class="sourceCode css"><span id="cb58-1"><a href="#cb58-1"></a>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-12-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-4-tab">
<div id="demo-container-12" style="border: 1px solid #ddd; border-radius: 8px; overflow: hidden; transition: box-shadow 0.2s ease;">
<div style="background-color: #f8f9fa; padding: 8px 12px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center;">
<div>
<span style="font-weight: bold; color: #495057;">Live JsPsych Demo</span>
<span class="focus-indicator-12" style="margin-left: 10px; font-size: 11px; color: #6c757d; font-style: italic;">Click inside the demo to activate demo</span>
</div>
<div style="display: flex; gap: 8px;">
<button onclick="
            console.log('Full screen button clicked');
            var htmlContent = '<!DOCTYPE html>\n<html>\n  <head>\n    <title>Live JsPsych Demo</title>\n    <script src=\'https://unpkg.com/jspsych@8.2.2\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-preload@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-instructions@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0\' crossorigin></script>\n    <script src=\'https://unpkg.com/@jspsych/plugin-survey-text@2.1.0\'  crossorigin></script>\n        <script src=\'https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0\' crossorigin></script>\n\n    <link href=\'https://unpkg.com/jspsych@8.2.2/css/jspsych.css\' rel=\'stylesheet\' type=\'text/css\' crossorigin />\n\n\n    <style>\n      /* Paused overlay styles */\n      #paused-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-color: rgba(0, 0, 0, 0.7);\n        display: none;\n        justify-content: center;\n        align-items: center;\n        z-index: 9999;\n        font-family: Arial, sans-serif;\n      }\n\n      #paused-message {\n        background-color: white;\n        padding: 30px;\n        border-radius: 10px;\n        text-align: center;\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n        max-width: 300px;\n      }\n\n      #paused-message h2 {\n        margin-top: 0;\n        color: #dc3545;\n        font-size: 24px;\n      }\n\n      #paused-message p {\n        color: #666;\n        margin-bottom: 0;\n        font-size: 16px;\n      }\n\n      .pulse {\n        animation: pulse 2s infinite;\n      }\n\n      @keyframes pulse {\n        0% { opacity: 1; }\n        50% { opacity: 0.5; }\n        100% { opacity: 1; }\n      }\n    </style>\n  </head>\n  <body>\n    <!-- Paused overlay -->\n    <div id=\'paused-overlay\'>\n      <div id=\'paused-message\'>\n        <h2>Demo Paused</h2>\n        <p class=\'pulse\'>Click Anywhere to Resume</p>\n      </div>\n    </div>\n  </body>\n  <script>\n// Initialize jsPsych with interaction tracking and overlay control\nconst jsPsych = initJsPsych({\n  on_interaction_data_update: function(data) {\n    const overlay = document.getElementById(\'paused-overlay\');\n\n    if (data.event === \'blur\') {\n      // User clicked away - pause experiment and show overlay\n      jsPsych.pauseExperiment();\n      if (overlay) {\n        overlay.style.display = \'flex\';\n      }\n    } else if (data.event === \'focus\') {\n      // User returned - resume experiment and hide overlay\n      jsPsych.resumeExperiment();\n      if (overlay) {\n        overlay.style.display = \'none\';\n      }\n    }\n  }\n});\n\n// Make the overlay clickable to resume\ndocument.addEventListener(\'DOMContentLoaded\', function() {\n  const overlay = document.getElementById(\'paused-overlay\');\n  if (overlay) {\n    overlay.addEventListener(\'click\', function() {\n      // Focus the window and let the interaction handler resume\n      window.focus();\n    });\n  }\n});\n\n\n// ============================================\n// Instructions\n// ============================================\n\nlet welcome = {\n    type: jsPsychHtmlKeyboardResponse,\n    stimulus: `<p>Welcome to the Experiment!</p>\n              <p>Press any key to begin.</p>`,\n    choices: &quot;ALL_KEYS&quot;,\n    post_trial_gap: 250\n}\n\nlet end_practice = {\n    type: jsPsychHtmlKeyboardResponse,\n    stimulus: `<p>You are finished the experiment.</p>`,\n    choices: &quot;NO_KEYS&quot;,\n    post_trial_gap: 250\n}\n\n// ============================================\n// Practice Trials\n// ============================================\n\n// variables to track performance\nlet missed_in_a_row = 0;\nlet practice_attempts = 0;\nconst MAX_PRACTICE_ATTEMPTS = 3;\n\n// practice trial\nlet practice_trial = {\n    type: jsPsychHtmlKeyboardResponse,\n    stimulus: jsPsych.timelineVariable(&quot;stimulus&quot;),\n    choices: [&quot;f&quot;, &quot;j&quot;],\n    trial_duration: 1500,\n    data: {\n        correct_response: jsPsych.timelineVariable(&quot;correct_key&quot;),\n        phase: &quot;practice trial&quot;\n    },\n    on_finish: function(data) {\n        data.correct = jsPsych.pluginAPI.compareKeys(data.response, data.correct_response);\n\n        // Track missed trials\n        if (data.response === null) {\n            data.miss = true\n            missed_in_a_row++;\n        } else {\n            data.miss = false\n            missed_in_a_row = 0;  // Reset if they responded\n        }\n    }\n};\n\n// warning display\nlet warning = {\n    timeline: [\n        {\n            type: jsPsychHtmlKeyboardResponse,\n            stimulus: function() {\n                return `<p style=&quot;color: orange; font-size: 24px;&quot;>\n                      Please try to respond faster!\n                 </p>\n                 <p>You\'ve missed 3 trials in a row.</p>\n                 <p>Press any key to continue.</p>`;\n            }\n        }\n    ],\n    conditional_function: function() {\n        return missed_in_a_row >= 3;\n    },\n    on_finish: function() {\n        missed_in_a_row = 0;  // Reset after showing warning\n    },\n    data: {\n        phase: &quot;practice warning&quot;\n    }\n};\n\n// feedback display\nlet feedback = {\n    type: jsPsychHtmlKeyboardResponse,\n    stimulus: function() {\n        let last_trial = jsPsych.data.get().last(1).values()[0];\n        if (last_trial.response === null) {\n            return `<p style=&quot;color: orange;&quot;>Too slow!</p>`;\n        } else if (last_trial.correct) {\n            return `<p style=&quot;color: green;&quot;>Correct!</p>`;\n        } else {\n            return `<p style=&quot;color: red;&quot;>Incorrect</p>`;\n        }\n    },\n    choices: &quot;NO_KEYS&quot;,\n    trial_duration: 800,\n    data: {\n        phase: &quot;practice feedback&quot;\n    }\n};\n\n// practice block\nlet practice_block = {\n    timeline: [practice_trial, feedback, warning],\n    timeline_variables: [\n        {stimulus: `<p>CAT</p>`, correct_key: &quot;f&quot;},\n        {stimulus: `<p>TABLE</p>`, correct_key: &quot;j&quot;},\n        {stimulus: `<p>DOG</p>`, correct_key: &quot;f&quot;},\n        {stimulus: `<p>CHAIR</p>`, correct_key: &quot;j&quot;},\n        {stimulus: `<p>BIRD</p>`, correct_key: &quot;f&quot;},\n        {stimulus: `<p>DESK</p>`, correct_key: &quot;j&quot;}\n    ],\n    randomize_order: true,\n    loop_function: function(data) {\n        practice_attempts++;\n        let practice_trials = data.filter({phase: &quot;practice trial&quot;})\n\n        // Calculate accuracy (only counting trials where they responded)\n        let responded_trials = data.filter({miss: false});\n        let correct_trials = practice_trials.filter({correct: true}).count();\n        let accuracy = correct_trials / responded_trials.count();\n\n        console.log(`Attempt ${practice_attempts}: ${Math.round(accuracy * 100)}% accuracy`);\n\n        // Stop if they reached threshold OR hit max attempts\n        if (accuracy >= 0.80 || practice_attempts >= MAX_PRACTICE_ATTEMPTS) {\n            return false;\n        } else {\n            return true;\n        }\n    }\n};\n\n\n// practice success message\nlet practice_success_message = {\n    timeline: [\n        {\n            type: jsPsychHtmlKeyboardResponse,\n            stimulus: `<p style=&quot;color: green; font-size: 24px;&quot;>Excellent!</p>\n             <p>You\'re ready for the main task.</p>\n             <p>Press the space bar to continue.</p>`,\n            choices: [&quot; &quot;]\n        }\n    ],\n    conditional_function: function() {\n        // Check if they passed on their last attempt\n        let last_block = jsPsych.data.get().filter({phase: &quot;practice trial&quot;}).last(6);\n        let correct = last_block.filter({correct: true}).count();\n        let total = last_block.count();\n        return (correct / total) >= 0.80;\n    }\n};\n\n// practice failure message\nlet practice_failure_message = {\n    timeline: [\n        {\n            type: jsPsychHtmlKeyboardResponse,\n            stimulus: `<p>You\'ve completed the maximum practice attempts.</p>\n             <p>Let\'s move on to the main task anyway.</p>\n             <p>Remember: Press &quot;f&quot; for animals, &quot;j&quot; for furniture.</p>\n             <p>Press the space bar to continue.</p>`,\n            choices: [&quot; &quot;]\n        }\n    ],\n    conditional_function: function() {\n        let last_block = jsPsych.data.get().filter({phase: &quot;practice trial&quot;}).last(6);\n        let correct = last_block.filter({correct: true}).count();\n        let total = last_block.count();\n        return (correct / total) < 0.80;\n    }\n};\n\n// ============================================\n// jsPsych Run\n// ============================================\n\njsPsych.run([\n    welcome,\n    practice_block,\n    practice_success_message,\n    practice_failure_message,\n    end_practice\n]);\n\n  </script>\n</html>';
            var newWindow = window.open('', '_blank');
            if (newWindow) {
              newWindow.document.write(htmlContent);
              newWindow.document.close();
            } else {
              alert('Pop-up blocked! Please allow pop-ups for this site.');
            }
          " style="background-color: #28a745; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Open in New Tab</button>
<button onclick="
            var iframe = document.getElementById('demo-iframe-12');
            var srcdoc = iframe.getAttribute('srcdoc');
            iframe.setAttribute('srcdoc', '');
            setTimeout(function() {
              iframe.setAttribute('srcdoc', srcdoc);
            }, 10);
          " style="background-color: #007bff; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Refresh</button>
</div>
</div>
<iframe id="demo-iframe-12" srcdoc="<!DOCTYPE html>
<html>
  <head>
    <title>Live JsPsych Demo</title>
    <script src='https://unpkg.com/jspsych@8.2.2' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-preload@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-instructions@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0' crossorigin></script>
    <script src='https://unpkg.com/@jspsych/plugin-survey-text@2.1.0'  crossorigin></script>
        <script src='https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0' crossorigin></script>

    <link href='https://unpkg.com/jspsych@8.2.2/css/jspsych.css' rel='stylesheet' type='text/css' crossorigin />


    <style>
      /* Paused overlay styles */
      #paused-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        font-family: Arial, sans-serif;
      }

      #paused-message {
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        max-width: 300px;
      }

      #paused-message h2 {
        margin-top: 0;
        color: #dc3545;
        font-size: 24px;
      }

      #paused-message p {
        color: #666;
        margin-bottom: 0;
        font-size: 16px;
      }

      .pulse {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
      }
    </style>
  </head>
  <body style='max-height: 300px'>
    <!-- Paused overlay -->
    <div id='paused-overlay'>
      <div id='paused-message'>
        <h2>Demo Paused</h2>
        <p class='pulse'>Click Anywhere to Resume</p>
      </div>
    </div>
  </body>
  <script>
// Initialize jsPsych with interaction tracking and overlay control
const jsPsych = initJsPsych({
  on_interaction_data_update: function(data) {
    const overlay = document.getElementById('paused-overlay');

    if (data.event === 'blur') {
      // User clicked away - pause experiment and show overlay
      jsPsych.pauseExperiment();
      if (overlay) {
        overlay.style.display = 'flex';
      }
    } else if (data.event === 'focus') {
      // User returned - resume experiment and hide overlay
      jsPsych.resumeExperiment();
      if (overlay) {
        overlay.style.display = 'none';
      }
    }
  }
});

// Make the overlay clickable to resume
document.addEventListener('DOMContentLoaded', function() {
  const overlay = document.getElementById('paused-overlay');
  if (overlay) {
    overlay.addEventListener('click', function() {
      // Focus the window and let the interaction handler resume
      window.focus();
    });
  }
});


// ============================================
// Instructions
// ============================================

let welcome = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `<p>Welcome to the Experiment!</p>
              <p>Press any key to begin.</p>`,
    choices: &quot;ALL_KEYS&quot;,
    post_trial_gap: 250
}

let end_practice = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `<p>You are finished the experiment.</p>`,
    choices: &quot;NO_KEYS&quot;,
    post_trial_gap: 250
}

// ============================================
// Practice Trials
// ============================================

// variables to track performance
let missed_in_a_row = 0;
let practice_attempts = 0;
const MAX_PRACTICE_ATTEMPTS = 3;

// practice trial
let practice_trial = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: jsPsych.timelineVariable(&quot;stimulus&quot;),
    choices: [&quot;f&quot;, &quot;j&quot;],
    trial_duration: 1500,
    data: {
        correct_response: jsPsych.timelineVariable(&quot;correct_key&quot;),
        phase: &quot;practice trial&quot;
    },
    on_finish: function(data) {
        data.correct = jsPsych.pluginAPI.compareKeys(data.response, data.correct_response);

        // Track missed trials
        if (data.response === null) {
            data.miss = true
            missed_in_a_row++;
        } else {
            data.miss = false
            missed_in_a_row = 0;  // Reset if they responded
        }
    }
};

// warning display
let warning = {
    timeline: [
        {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: function() {
                return `<p style=&quot;color: orange; font-size: 24px;&quot;>
                      Please try to respond faster!
                 </p>
                 <p>You've missed 3 trials in a row.</p>
                 <p>Press any key to continue.</p>`;
            }
        }
    ],
    conditional_function: function() {
        return missed_in_a_row >= 3;
    },
    on_finish: function() {
        missed_in_a_row = 0;  // Reset after showing warning
    },
    data: {
        phase: &quot;practice warning&quot;
    }
};

// feedback display
let feedback = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: function() {
        let last_trial = jsPsych.data.get().last(1).values()[0];
        if (last_trial.response === null) {
            return `<p style=&quot;color: orange;&quot;>Too slow!</p>`;
        } else if (last_trial.correct) {
            return `<p style=&quot;color: green;&quot;>Correct!</p>`;
        } else {
            return `<p style=&quot;color: red;&quot;>Incorrect</p>`;
        }
    },
    choices: &quot;NO_KEYS&quot;,
    trial_duration: 800,
    data: {
        phase: &quot;practice feedback&quot;
    }
};

// practice block
let practice_block = {
    timeline: [practice_trial, feedback, warning],
    timeline_variables: [
        {stimulus: `<p>CAT</p>`, correct_key: &quot;f&quot;},
        {stimulus: `<p>TABLE</p>`, correct_key: &quot;j&quot;},
        {stimulus: `<p>DOG</p>`, correct_key: &quot;f&quot;},
        {stimulus: `<p>CHAIR</p>`, correct_key: &quot;j&quot;},
        {stimulus: `<p>BIRD</p>`, correct_key: &quot;f&quot;},
        {stimulus: `<p>DESK</p>`, correct_key: &quot;j&quot;}
    ],
    randomize_order: true,
    loop_function: function(data) {
        practice_attempts++;
        let practice_trials = data.filter({phase: &quot;practice trial&quot;})

        // Calculate accuracy (only counting trials where they responded)
        let responded_trials = data.filter({miss: false});
        let correct_trials = practice_trials.filter({correct: true}).count();
        let accuracy = correct_trials / responded_trials.count();

        console.log(`Attempt ${practice_attempts}: ${Math.round(accuracy * 100)}% accuracy`);

        // Stop if they reached threshold OR hit max attempts
        if (accuracy >= 0.80 || practice_attempts >= MAX_PRACTICE_ATTEMPTS) {
            return false;
        } else {
            return true;
        }
    }
};


// practice success message
let practice_success_message = {
    timeline: [
        {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: `<p style=&quot;color: green; font-size: 24px;&quot;>Excellent!</p>
             <p>You're ready for the main task.</p>
             <p>Press the space bar to continue.</p>`,
            choices: [&quot; &quot;]
        }
    ],
    conditional_function: function() {
        // Check if they passed on their last attempt
        let last_block = jsPsych.data.get().filter({phase: &quot;practice trial&quot;}).last(6);
        let correct = last_block.filter({correct: true}).count();
        let total = last_block.count();
        return (correct / total) >= 0.80;
    }
};

// practice failure message
let practice_failure_message = {
    timeline: [
        {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: `<p>You've completed the maximum practice attempts.</p>
             <p>Let's move on to the main task anyway.</p>
             <p>Remember: Press &quot;f&quot; for animals, &quot;j&quot; for furniture.</p>
             <p>Press the space bar to continue.</p>`,
            choices: [&quot; &quot;]
        }
    ],
    conditional_function: function() {
        let last_block = jsPsych.data.get().filter({phase: &quot;practice trial&quot;}).last(6);
        let correct = last_block.filter({correct: true}).count();
        let total = last_block.count();
        return (correct / total) < 0.80;
    }
};

// ============================================
// jsPsych Run
// ============================================

jsPsych.run([
    welcome,
    practice_block,
    practice_success_message,
    practice_failure_message,
    end_practice
]);

  </script>
</html>" width="100%" height="300px" scrolling="yes" style="border: none; display: block;" onload="javascript:(function(iframe){
        var container = document.getElementById(&quot;demo-container-12&quot;);
        var indicator = container.querySelector(&quot;.focus-indicator-12&quot;);

        function showFocus() {
          container.style.boxShadow = &quot;0 0 0 3px #007bff&quot;;
          if (indicator) {
            indicator.textContent = &quot;✓ Demo Active&quot;;
            indicator.style.color = &quot;#28a745&quot;;
          }
        }

        function hideFocus() {
          container.style.boxShadow = &quot;none&quot;;
          if (indicator) {
            indicator.textContent = &quot;Click inside the demo to activate&quot;;
            indicator.style.color = &quot;#6c757d&quot;;
          }
        }

        var iframeWindow = iframe.contentWindow;
        if (iframeWindow) {
          iframeWindow.onfocus = showFocus;
          iframeWindow.onblur = hideFocus;
          iframeWindow.document.addEventListener(&quot;click&quot;, function() {
            iframeWindow.focus();
            showFocus();
          });
          document.addEventListener(&quot;click&quot;, function(e) {
            if (!container.contains(e.target)) {
              iframeWindow.blur();
              hideFocus();
            }
          });
        }
      }(this));"></iframe>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="common-patterns-and-best-practices" class="level2" data-number="19.10">
<h2 data-number="19.10" class="anchored" data-anchor-id="common-patterns-and-best-practices"><span class="header-section-number">19.10</span> Common Patterns and Best Practices</h2>
<p>For a quick reference, here are some commonly applied patterns that you may need using conditional and loop functions.</p>
<section id="pattern-1-checking-previous-trial-data" class="level3" data-number="19.10.1">
<h3 data-number="19.10.1" class="anchored" data-anchor-id="pattern-1-checking-previous-trial-data"><span class="header-section-number">19.10.1</span> Pattern 1: Checking Previous Trial Data</h3>
<p>This is the most common pattern - looking at what just happened:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb59-1"><a href="#cb59-1"></a>conditional_function<span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb59-2"><a href="#cb59-2"></a>  <span class="kw">let</span> last_trial <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">last</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">values</span>()[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb59-3"><a href="#cb59-3"></a>  <span class="cf">return</span> last_trial<span class="op">.</span><span class="at">correct</span> <span class="op">===</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb59-4"><a href="#cb59-4"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="pattern-2-checking-specific-trial-types" class="level3" data-number="19.10.2">
<h3 data-number="19.10.2" class="anchored" data-anchor-id="pattern-2-checking-specific-trial-types"><span class="header-section-number">19.10.2</span> Pattern 2: Checking Specific Trial Types</h3>
<p>When you need to find a specific earlier trial:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb60-1"><a href="#cb60-1"></a>conditional_function<span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb60-2"><a href="#cb60-2"></a>  <span class="kw">let</span> survey_data <span class="op">=</span> jsPsych<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">filter</span>({<span class="dt">trial_type</span><span class="op">:</span> <span class="st">'survey'</span>})<span class="op">.</span><span class="fu">values</span>()[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb60-3"><a href="#cb60-3"></a>  <span class="cf">return</span> survey_data<span class="op">.</span><span class="at">response</span><span class="op">.</span><span class="at">age</span> <span class="op">&gt;=</span> <span class="dv">18</span><span class="op">;</span></span>
<span id="cb60-4"><a href="#cb60-4"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="pattern-3-calculating-performance-metrics" class="level3" data-number="19.10.3">
<h3 data-number="19.10.3" class="anchored" data-anchor-id="pattern-3-calculating-performance-metrics"><span class="header-section-number">19.10.3</span> Pattern 3: Calculating Performance Metrics</h3>
<p>For loop functions that check performance:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb61-1"><a href="#cb61-1"></a>loop_function<span class="op">:</span> <span class="kw">function</span>(data) {</span>
<span id="cb61-2"><a href="#cb61-2"></a>  <span class="kw">let</span> correct <span class="op">=</span> data<span class="op">.</span><span class="fu">filter</span>({<span class="dt">correct</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">.</span><span class="fu">count</span>()<span class="op">;</span></span>
<span id="cb61-3"><a href="#cb61-3"></a>  <span class="kw">let</span> total <span class="op">=</span> data<span class="op">.</span><span class="fu">count</span>()<span class="op">;</span></span>
<span id="cb61-4"><a href="#cb61-4"></a>  <span class="kw">let</span> accuracy <span class="op">=</span> correct <span class="op">/</span> total<span class="op">;</span></span>
<span id="cb61-5"><a href="#cb61-5"></a>  <span class="cf">return</span> accuracy <span class="op">&lt;</span> <span class="fl">0.80</span><span class="op">;</span>  <span class="co">// Keep looping if below threshold</span></span>
<span id="cb61-6"><a href="#cb61-6"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="pattern-4-using-external-variables" class="level3" data-number="19.10.4">
<h3 data-number="19.10.4" class="anchored" data-anchor-id="pattern-4-using-external-variables"><span class="header-section-number">19.10.4</span> Pattern 4: Using External Variables</h3>
<p>Sometimes you need to track state across multiple timelines:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb62-1"><a href="#cb62-1"></a><span class="kw">let</span> warning_count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb62-2"><a href="#cb62-2"></a></span>
<span id="cb62-3"><a href="#cb62-3"></a><span class="kw">let</span> warning <span class="op">=</span> {</span>
<span id="cb62-4"><a href="#cb62-4"></a>  <span class="dt">conditional_function</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb62-5"><a href="#cb62-5"></a>    <span class="kw">let</span> needs_warning <span class="op">=</span> <span class="co">/* some condition */</span><span class="op">;</span></span>
<span id="cb62-6"><a href="#cb62-6"></a>    <span class="cf">if</span> (needs_warning) {</span>
<span id="cb62-7"><a href="#cb62-7"></a>      warning_count<span class="op">++;</span></span>
<span id="cb62-8"><a href="#cb62-8"></a>    }</span>
<span id="cb62-9"><a href="#cb62-9"></a>    <span class="cf">return</span> needs_warning <span class="op">&amp;&amp;</span> warning_count <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span>  <span class="co">// Max 3 warnings</span></span>
<span id="cb62-10"><a href="#cb62-10"></a>  }</span>
<span id="cb62-11"><a href="#cb62-11"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="best-practices" class="level2" data-number="19.11">
<h2 data-number="19.11" class="anchored" data-anchor-id="best-practices"><span class="header-section-number">19.11</span> Best Practices</h2>
<ol type="1">
<li>Always test your conditions. Use <code>console.log()</code> to verify your conditional logic is working as expected</li>
<li>Be careful with data access. Make sure the data you’re trying to access actually exists. If you try to access trial 5 when only 3 trials have run, you’ll get an error.</li>
<li>Use descriptive variable names. <code>let accuracy = correct / total</code> is much clearer than <code>let a = c / t</code></li>
<li>Comment your logic. Conditional logic can get complex. Add comments explaining what you’re checking and why.</li>
<li>Consider the user experience. If practice might repeat multiple times, let participants know why and give them encouragement.</li>
</ol>
</section>
<section id="summary" class="level2" data-number="19.12">
<h2 data-number="19.12" class="anchored" data-anchor-id="summary"><span class="header-section-number">19.12</span> Summary</h2>
<p>In this chapter, we learned how to make our experiments dynamic using two powerful tools:</p>
<ol type="1">
<li>Conditional functions (<code>conditional_function</code>): Control whether trials or timelines run based on previous data</li>
<li>Loop functions (<code>loop_function</code>): Control whether timelines repeat based on performance</li>
</ol>
<p>These tools work at any level, from showing a single feedback trial to controlling entire experimental phases. The key is understanding that jsPsych evaluates these functions at specific times:</p>
<ol type="1">
<li>Conditional functions are evaluated before a timeline runs</li>
<li>Loop functions are evaluated after a timeline completes</li>
</ol>
<p>By combining these tools with the data access methods we learned earlier, we can create experiments that adapt to each participant’s performance, provide targeted feedback, and branch to different paths based on responses.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./18-L07.html" class="pagination-link" aria-label="Lab 7: Spatial Attention">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Lab 7: Spatial Attention</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./20-L08.html" class="pagination-link" aria-label="Lab 8: Cognitive Control">
        <span class="nav-page-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Lab 8: Cognitive Control</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/icoglab/online-behavioural-research-methods/edit/main/19-dynamic-flow.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/icoglab/online-behavioural-research-methods/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>